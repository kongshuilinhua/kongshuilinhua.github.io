<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Java集合</title>
    <link href="/2025/03/13/Java%E9%9B%86%E5%90%88/"/>
    <url>/2025/03/13/Java%E9%9B%86%E5%90%88/</url>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2025/03/13/5lNqzV4PUDi3j9b.png" alt="image.png"></p><h1 id="1-Collection-接口"><a href="#1-Collection-接口" class="headerlink" title="1. Collection 接口"></a>1. Collection 接口</h1><h2 id="1-1-Collection-接口的方法"><a href="#1-1-Collection-接口的方法" class="headerlink" title="1.1 Collection 接口的方法"></a>1.1 Collection 接口的方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">// Collection是一个接口，ArrayList是它的实现类</span><br>    Collection&lt;String&gt; coll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-comment">// 添加一个元素</span><br>    coll.add(<span class="hljs-string">&quot;a&quot;</span>);<br>    coll.add(<span class="hljs-string">&quot;d&quot;</span>);<br>    <span class="hljs-comment">// 添加一个集合</span><br>    Collection&lt;String&gt; coll2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    coll2.add(<span class="hljs-string">&quot;b&quot;</span>);<br>    coll2.add(<span class="hljs-string">&quot;c&quot;</span>);<br>    coll.addAll(coll2);<br>    <span class="hljs-comment">// 删除一个元素</span><br>    System.out.println(coll.remove(<span class="hljs-string">&quot;e&quot;</span>));<br>    <span class="hljs-comment">// 删除一个集合</span><br>    coll.removeAll(coll2);<br>    <span class="hljs-comment">// 判断是否包含</span><br>    System.out.println(coll.contains(<span class="hljs-string">&quot;d&quot;</span>));<br>    <span class="hljs-comment">// 判断是否为空</span><br>    System.out.println(coll.isEmpty());<br>    <span class="hljs-comment">// 获取集合大小</span><br>    System.out.println(coll.size());<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-2-迭代器遍历"><a href="#1-2-迭代器遍历" class="headerlink" title="1.2 迭代器遍历"></a>1.2 迭代器遍历</h2><ul><li>报错 NoSuchElementException，原因是迭代器的指针已经指向了最后一个元素，再调用 next()方法就会报错</li><li>迭代器遍历结束后，指针指向最后一个元素的后面，不会复位</li><li>循环中只能使用一次 it.next()</li><li>迭代器遍历时，不能使用集合的方法增删元素，否则会报错 ConcurrentModificationException</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    Collection&lt;String&gt; coll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    coll.add(<span class="hljs-string">&quot;a&quot;</span>);<br>    coll.add(<span class="hljs-string">&quot;b&quot;</span>);<br>    coll.add(<span class="hljs-string">&quot;d&quot;</span>);<br>    <span class="hljs-comment">// 迭代器遍历</span><br>    Iterator&lt;String&gt; it = coll.iterator();<br>    <span class="hljs-keyword">while</span>(it.hasNext())&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> it.next();<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;b&quot;</span>.equals(s))&#123;<br>            it.remove();<br>        &#125;<br>    &#125;<br>    System.out.println(coll);<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-3-增强-for-循环-和-forEach-方法"><a href="#1-3-增强-for-循环-和-forEach-方法" class="headerlink" title="1.3 增强 for 循环 和 forEach 方法"></a>1.3 增强 for 循环 和 forEach 方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    Collection&lt;String&gt; coll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    coll.add(<span class="hljs-string">&quot;a&quot;</span>);<br>    coll.add(<span class="hljs-string">&quot;b&quot;</span>);<br>    coll.add(<span class="hljs-string">&quot;d&quot;</span>);<br>    <span class="hljs-comment">// 增强 for 循环</span><br>    <span class="hljs-keyword">for</span> (String s : coll) &#123;<br>        System.out.println(s);<br>    &#125;<br>    <span class="hljs-comment">// lambda 表达式</span><br>    coll.forEach(s -&gt; &#123;<br>        System.out.println(s);<br>    &#125;);<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2-List"><a href="#2-List" class="headerlink" title="2. List"></a>2. List</h1><h2 id="2-1-List-接口的方法"><a href="#2-1-List-接口的方法" class="headerlink" title="2.1 List 接口的方法"></a>2.1 List 接口的方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    List&lt;Integer&gt; coll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    coll.add(<span class="hljs-number">1</span>);<br>    coll.add(<span class="hljs-number">2</span>);<br>    coll.add(<span class="hljs-number">3</span>);<br>    coll.add(<span class="hljs-number">4</span>);<br>    <span class="hljs-comment">// 删除指定索引的元素 or 删除指定元素(主要根据传入参数的类型选择调用的方法)</span><br>    coll.remove(<span class="hljs-number">2</span>);  <span class="hljs-comment">// 索引</span><br>    coll.remove(Integer.valueOf(<span class="hljs-number">2</span>)); <span class="hljs-comment">// 元素</span><br>    <span class="hljs-comment">// 返回指定索引的元素</span><br>    System.out.println(coll.get(<span class="hljs-number">0</span>));<br>    <span class="hljs-comment">// 修改指定索引的元素</span><br>    coll.set(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);<br>    System.out.println(coll);<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-2-List-五种遍历方式"><a href="#2-2-List-五种遍历方式" class="headerlink" title="2.2 List 五种遍历方式"></a>2.2 List 五种遍历方式</h2><ul><li>迭代器遍历</li><li>增强 for 循环</li><li>lambda 表达式</li><li>普通 for 循环</li><li>列表迭代器（新增 add 方法）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    List&lt;Integer&gt; coll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    coll.add(<span class="hljs-number">1</span>);<br>    coll.add(<span class="hljs-number">2</span>);<br>    coll.add(<span class="hljs-number">3</span>);<br>    coll.add(<span class="hljs-number">4</span>);<br>    ListIterator&lt;Integer&gt; it = coll.listIterator();<br>    <span class="hljs-keyword">while</span>(it.hasNext())&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> it.next();<br>        <span class="hljs-keyword">if</span>(j == <span class="hljs-number">2</span>)&#123;<br>            it.remove();<br>        &#125;<br>    &#125;<br>    System.out.println(coll);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="3-Set"><a href="#3-Set" class="headerlink" title="3. Set"></a>3. Set</h1><p>继承了 Collection 的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    Set&lt;String&gt; s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>    <span class="hljs-comment">// 添加元素，元素不保证有序（如果有序可能是插入的数连续，经过哈希运算后分在了相邻位置）</span><br>    s.add(<span class="hljs-string">&quot;d&quot;</span>);<br>    s.add(<span class="hljs-string">&quot;h&quot;</span>);<br>    s.add(<span class="hljs-string">&quot;b&quot;</span>);<br>    System.out.println(s);<br>    Set&lt;String&gt; s2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();<br>    <span class="hljs-comment">// 添加元素, 按插入顺序有序</span><br>    s2.add(<span class="hljs-string">&quot;d&quot;</span>);<br>    s2.add(<span class="hljs-string">&quot;b&quot;</span>);<br>    s2.add(<span class="hljs-string">&quot;c&quot;</span>);<br>    s2.add(<span class="hljs-string">&quot;a&quot;</span>);<br>    s2.add(<span class="hljs-string">&quot;a&quot;</span>);<br><br>    System.out.println(s2);<br><br>    Set&lt;String&gt; s3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeSet</span>&lt;&gt;();<br>    <span class="hljs-comment">// 添加元素</span><br>    s3.add(<span class="hljs-string">&quot;d&quot;</span>);<br>    s3.add(<span class="hljs-string">&quot;b&quot;</span>);<br>    s3.add(<span class="hljs-string">&quot;c&quot;</span>);<br>    s3.add(<span class="hljs-string">&quot;a&quot;</span>);<br>    s3.add(<span class="hljs-string">&quot;a&quot;</span>);<br>    System.out.println(s3);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4-Map"><a href="#4-Map" class="headerlink" title="4. Map"></a>4. Map</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    Map&lt;String, Integer&gt; mp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-comment">// 添加元素</span><br>    mp.put(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>);<br>    mp.put(<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">2</span>);<br>    mp.put(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-number">4</span>);<br>    <span class="hljs-comment">// 如果key不存在, 则添加元素</span><br>    mp.computeIfAbsent(<span class="hljs-string">&quot;d&quot;</span>, k -&gt; <span class="hljs-number">5</span>);<br>    <span class="hljs-comment">// 如果key存在, 则更新元素</span><br>    mp.computeIfPresent(<span class="hljs-string">&quot;a&quot;</span>, (k, v) -&gt; v + <span class="hljs-number">1</span>);<br>    <span class="hljs-comment">// 删除元素, 返回被删除的value</span><br>    System.out.println(mp.remove(<span class="hljs-string">&quot;c&quot;</span>));<br>    <span class="hljs-comment">// 判断是否包含某个key</span><br>    System.out.println(mp.containsKey(<span class="hljs-string">&quot;a&quot;</span>));<br>    <span class="hljs-comment">// 判断是否包含某个value</span><br>    System.out.println(mp.containsValue(<span class="hljs-number">2</span>));<br>    <span class="hljs-comment">// 获取所有的key</span><br>    System.out.println(mp.keySet());<br>    <span class="hljs-comment">// 获取所有的value</span><br>    System.out.println(mp.values());<br>    <span class="hljs-comment">// 获取所有的key-value</span><br>    Set&lt;Map.Entry&lt;String, Integer&gt;&gt; entries = mp.entrySet();<br>    <span class="hljs-comment">// 遍历方式: 增强for</span><br>    <span class="hljs-keyword">for</span>(String k: mp.keySet()) &#123;<br>        System.out.println(k + <span class="hljs-string">&quot; &quot;</span> + mp.get(k));<br>    &#125;<br>    <span class="hljs-keyword">for</span>(Map.Entry&lt;String, Integer&gt; entry: mp.entrySet()) &#123;<br>        System.out.println(entry.getKey() + <span class="hljs-string">&quot; &quot;</span> + entry.getValue());<br>    &#125;<br>    <span class="hljs-comment">// 迭代器</span><br>    Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; it = entries.iterator();<br>    <span class="hljs-keyword">while</span>(it.hasNext()) &#123;<br>        Map.Entry&lt;String, Integer&gt; entry = it.next();<br>        System.out.println(entry.getKey() + <span class="hljs-string">&quot; &quot;</span> + entry.getValue());<br>    &#125;<br>    <span class="hljs-comment">// lambda表达式</span><br>    mp.forEach((k, v) -&gt; System.out.println(k + <span class="hljs-string">&quot; &quot;</span> + v));<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>集合</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>并发编程</title>
    <link href="/2025/03/13/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    <url>/2025/03/13/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="1-线程"><a href="#1-线程" class="headerlink" title="1. 线程"></a>1. 线程</h1><h2 id="1-1-什么是线程和进程？"><a href="#1-1-什么是线程和进程？" class="headerlink" title="1.1 什么是线程和进程？"></a>1.1 什么是线程和进程？</h2><ul><li>进程：进程是程序的一次执行过程，是系统运行程序的基本单位，因此进程是动态的。系统运行一个程序即是一个进程从创建，运行到消亡的过程。在 Java 中，当我们启动 main 函数时其实就是启动了一个 JVM 的进程，而 main 函数所在的线程就是这个进程中的一个线程，也称主线程。</li><li>线程：线程与进程相似，但线程是一个比进程更小的执行单位。一个进程在其执行的过程中可以产生多个线程。与进程不同的是同类的多个线程共享进程的堆和方法区资源，但每个线程有自己的程序计数器、虚拟机栈和本地方法栈，所以系统在产生一个线程，或是在各个线程之间做切换工作时，负担要比进程小得多，也正因为如此，线程也被称为轻量级进程。</li></ul><h2 id="1-2-线程和进程的关系"><a href="#1-2-线程和进程的关系" class="headerlink" title="1.2 线程和进程的关系"></a>1.2 线程和进程的关系</h2><p>线程是进程划分成的更小的运行单位。线程和进程最大的不同在于基本上各进程是独立的，而各线程则不一定，因为同一进程中的线程极有可能会相互影响。线程执行开销小，但不利于资源的管理和保护；而进程正相反。</p><h1 id="2-线程"><a href="#2-线程" class="headerlink" title="2. 线程"></a>2. 线程</h1><h2 id="2-1-线程的创建"><a href="#2-1-线程的创建" class="headerlink" title="2.1 线程的创建"></a>2.1 线程的创建</h2><h3 id="2-1-1-继承-Thread-类"><a href="#2-1-1-继承-Thread-类" class="headerlink" title="2.1.1 继承 Thread 类"></a>2.1.1 继承 Thread 类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>            <span class="hljs-comment">// getName() 获取线程名称, 此方法继承自 Thread 类</span><br>            System.out.println(getName() +<span class="hljs-string">&quot; &quot;</span> + i);<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>创建线程对象，调用 start 方法启动线程。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">MyThread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br>        <span class="hljs-comment">// 设置线程名称</span><br>        thread1.setName(<span class="hljs-string">&quot;Thread1&quot;</span>);<br>        <span class="hljs-type">MyThread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br>        thread2.setName(<span class="hljs-string">&quot;Thread2&quot;</span>);<br>        thread1.start();<br>        thread2.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-1-2-实现-Runnable-接口"><a href="#2-1-2-实现-Runnable-接口" class="headerlink" title="2.1.2 实现 Runnable 接口"></a>2.1.2 实现 Runnable 接口</h3><p>自己定义一个类实现 Runnable 接口，重写 run 方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-comment">// Thread.currentThread() 获取当前线程对象</span><br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; &quot;</span> + i);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>创建类对象并调用 start 方法启动线程。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">MyRunnable</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>();<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);<br>        t1.setName(<span class="hljs-string">&quot;Thread 1&quot;</span>);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);<br>        t2.setName(<span class="hljs-string">&quot;Thread 2&quot;</span>);<br>        t1.start();<br>        t2.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-1-3-实现-Callable-接口"><a href="#2-1-3-实现-Callable-接口" class="headerlink" title="2.1.3 实现 Callable 接口"></a>2.1.3 实现 Callable 接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> n;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyCallable</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span>&#123;<br>        <span class="hljs-built_in">this</span>.n = n;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>            sum += i;<br>        &#125;<br>        <span class="hljs-keyword">return</span> sum;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>创建类对象并调用 start 方法启动线程。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-comment">// 创建MyCallable对象（表示要执行的任务）</span><br>        <span class="hljs-type">MyCallable</span> <span class="hljs-variable">mc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>(<span class="hljs-number">10</span>);<br>        <span class="hljs-comment">// 创建FutureTask对象（管理多线程运行的结果）</span><br>        FutureTask&lt;Integer&gt; ft = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(mc);<br>        <span class="hljs-comment">// 创建线程的对象</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(ft);<br>        <span class="hljs-comment">// 启动线程</span><br>        t.start();<br>        <span class="hljs-comment">// 获取线程的返回值</span><br>        System.out.println(ft.get());<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-2-线程常用方法"><a href="#2-2-线程常用方法" class="headerlink" title="2.2 线程常用方法"></a>2.2 线程常用方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-comment">// 可以传入字符串作为线程的名字，但是需要调用父类的构造方法</span><br>        <span class="hljs-type">MyThread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br>        <span class="hljs-comment">// 1.获取线程的名字，默认是 Thread-X</span><br>        System.out.println(thread1.getName());<br>        <span class="hljs-comment">// 2.设置线程的名字</span><br>        thread1.setName(<span class="hljs-string">&quot;线程1&quot;</span>);<br>        <span class="hljs-comment">// 3.获取当前线程对象</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>        <span class="hljs-comment">// 4.线程休眠。哪条线程执行到这个方法，哪条线程就休眠。单位是ms</span><br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        <span class="hljs-comment">// 5.获取线程的优先级[1, 10], 越大优先级越高，默认是5</span><br>        System.out.println(thread.getPriority());<br>        <span class="hljs-comment">// 6.设置守护线程， 当其他线程执行完毼，守护线程也会结束。</span><br>        thread1.setDaemon(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">// 7.礼让线程，让当前线程暂停，让其他线程执行 [不一定成功] Thread.yield();</span><br>        <span class="hljs-comment">// 8.插入线程，让其他线程等待当前线程执行完毕再执行 thread1.join()</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-3-线程的状态"><a href="#2-3-线程的状态" class="headerlink" title="2.3 线程的状态"></a>2.3 线程的状态</h2><p>Java 线程在运行的生命周期中的指定时刻只可能处于下面 6 种不同状态的其中一个状态：</p><ul><li>NEW: 初始状态，线程被创建出来但没有被调用 start() 。</li><li>RUNNABLE: 运行状态，线程被调用了 start()等待运行的状态。</li><li>BLOCKED：阻塞状态，需要等待锁释放。</li><li>WAITING：等待状态，表示该线程需要等待其他线程做出一些特定动作（通知或中断）。</li><li>TIME_WAITING：超时等待状态，可以在指定的时间后自行返回而不是像 WAITING 那样一直等待。</li><li>TERMINATED：终止状态，表示该线程已经运行完毕。</li></ul><p><img src="https://s2.loli.net/2025/03/14/kXL9aoxsSDglEKy.png" alt="image.png"></p><p>线程创建之后它将处于 NEW（新建） 状态，调用 start() 方法后开始运行，线程这时候处于 READY（可运行） 状态。可运行状态的线程获得了 CPU 时间片（timeslice）后就处于 RUNNING（运行） 状态。</p><blockquote><p>在操作系统层面，线程有 READY 和 RUNNING 状态；而在 JVM 层面，只能看到 RUNNABLE 状态。因为现在的时分多任务系统多采用时间分片方式抢占式轮转调度，时间分片通常很小，所以操作系统会频繁地进行线程切换，大概只有 0.01s 这个量级，也就没什么必要区分这两种状态了。</p></blockquote><h2 id="2-4-线程同步"><a href="#2-4-线程同步" class="headerlink" title="2.4 线程同步"></a>2.4 线程同步</h2><h3 id="2-4-1-synchronized"><a href="#2-4-1-synchronized" class="headerlink" title="2.4.1 synchronized"></a>2.4.1 synchronized</h3><h4 id="2-4-1-1-同步代码块"><a href="#2-4-1-1-同步代码块" class="headerlink" title="2.4.1.1 同步代码块"></a>2.4.1.1 同步代码块</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">ticket</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// 锁对象一定要唯一</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;<br>            <span class="hljs-keyword">synchronized</span> (obj)&#123;<br>                <span class="hljs-keyword">if</span>(ticket &gt; <span class="hljs-number">100</span>)&#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                ticket++;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;卖票&quot;</span> + ticket);<br>        &#125;<br>    &#125;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-type">MyThread</span> <span class="hljs-variable">mt1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br>        <span class="hljs-type">MyThread</span> <span class="hljs-variable">mt2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br>        <span class="hljs-type">MyThread</span> <span class="hljs-variable">mt3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br>        mt1.start();<br>        mt2.start();<br>        mt3.start();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>锁对象一定要唯一，否则会出现线程安全问题。<br>synchronized 一定要写在 while 循环里面，否则只有一个线程能卖票。</p><h4 id="2-4-1-2-同步方法"><a href="#2-4-1-2-同步方法" class="headerlink" title="2.4.1.2 同步方法"></a>2.4.1.2 同步方法</h4><p>需求：三个窗口卖票，总票数为 100 张。</p><ul><li>同步方法是是锁方法里面的全部代码</li><li>非静态方法锁对象是 this，静态方法锁对象是当前类的字节码对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-type">MyRunnable</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>();<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);<br>        t1.setName(<span class="hljs-string">&quot;窗口1&quot;</span>);<br>        t2.setName(<span class="hljs-string">&quot;窗口2&quot;</span>);<br>        t3.setName(<span class="hljs-string">&quot;窗口3&quot;</span>);<br>        t1.start();<br>        t2.start();<br>        t3.start();<br><br><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>    <span class="hljs-comment">// 只创建一个对象，所以票数是共享的</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">ticket</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;<br>            <span class="hljs-keyword">synchronized</span> (MyRunnable.class)&#123;<br>                <span class="hljs-keyword">if</span> (method()) <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// this</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (ticket == <span class="hljs-number">100</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">10</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>            ticket++;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;卖票&quot;</span> + ticket);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>并发</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java反射机制</title>
    <link href="/2025/03/12/Java%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    <url>/2025/03/12/Java%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="1-Java-反射机制"><a href="#1-Java-反射机制" class="headerlink" title="1. Java 反射机制"></a>1. Java 反射机制</h1><h2 id="1-1-什么是反射？"><a href="#1-1-什么是反射？" class="headerlink" title="1.1. 什么是反射？"></a>1.1. 什么是反射？</h2><p>反射是一种可以间接操作目标对象的机制。当使用反射时，JVM 在运行的时候才动态加载类，对于任意类，知道其属性和方法，并不需要提前在编译期知道运行的对象是谁，允许运行时的 Java 程序获取类的信息并对其进行操作。</p><p>对象的类型在编译期就可以确定，但程序运行时可能需要动态加载一些类（之前没有用到，故没有加载进 jvm），使用反射可以在运行期动态生成对象实例并对其进行操作。</p><p>简单来说通过反射你可以获取任意一个类的所有属性和方法，你还可以调用这些方法和属性。</p><p>Java 的反射 API 提供了一系列的类和接口来操作 Class 对象。主要的类包括：</p><ul><li>java.lang.Class：表示类的对象。提供了方法来获取类的字段、方法、构造函数等。</li><li>java.lang.reflect.Field：表示类的字段（属性）。提供了访问和修改字段的能力。</li><li>java.lang.reflect.Method：表示类的方法。提供了调用方法的能力。</li><li>java.lang.reflect.Constructor：表示类的构造函数。提供了创建对象的能力。</li></ul><h2 id="1-2-反射的应用场景"><a href="#1-2-反射的应用场景" class="headerlink" title="1.2. 反射的应用场景"></a>1.2. 反射的应用场景</h2><p>像 Spring&#x2F;Spring Boot、MyBatis 等等框架中都大量使用了反射机制。<br>这些框架中也大量使用了动态代理，而动态代理的实现也依赖反射。<br>Java 中的一大利器注解的实现也用到了反射。</p><h2 id="1-3-反射的优缺点"><a href="#1-3-反射的优缺点" class="headerlink" title="1.3. 反射的优缺点"></a>1.3. 反射的优缺点</h2><ul><li>优点：可以让代码更加灵活、为各种框架提供开箱即用的功能提供了便利</li><li>缺点：让我们在运行时有了分析操作类的能力，这同样也增加了安全问题。比如可以无视泛型参数的安全检查（泛型参数的安全检查发生在编译时）。另外，反射的性能也要稍差点。</li></ul><h1 id="2-反射的基本使用"><a href="#2-反射的基本使用" class="headerlink" title="2. 反射的基本使用"></a>2. 反射的基本使用</h1><p>创建一个学生类进行操作：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> test;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.util.Objects;<br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-keyword">public</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span> String address;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Static block executed&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printInfo</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;I am a student&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">printInfo2</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(name + <span class="hljs-string">&quot;:I am not a student&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;print info 2&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age, String address)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.address = address;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = <span class="hljs-string">&quot;Tom&quot;</span>;<br>        <span class="hljs-built_in">this</span>.age = <span class="hljs-number">20</span>;<br>        <span class="hljs-built_in">this</span>.address = <span class="hljs-string">&quot;ChengHuaDaDao&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Student&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, address=&#x27;&quot;</span> + address + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span> + <span class="hljs-string">&quot;\n&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">if</span> (o == <span class="hljs-literal">null</span> || getClass() != o.getClass()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> (Student) o;<br>        <span class="hljs-keyword">return</span> age == student.age &amp;&amp; Objects.equals(name, student.name) &amp;&amp; Objects.equals(address, student.address);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Objects.hash(name, age, address);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-1-获取-Class-对象"><a href="#2-1-获取-Class-对象" class="headerlink" title="2.1. 获取 Class 对象"></a>2.1. 获取 Class 对象</h2><p>通过这四种方式获取的 Class 对象是一样的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 1.通过类名获取Class对象</span><br>    Class&lt;Student&gt; studentClass1 = Student.class;<br>    <span class="hljs-comment">// 2.通过全类名（包名+类名）获取Class对象</span><br>    Class&lt;?&gt; studentClass2 = Class.forName(<span class="hljs-string">&quot;test.Student&quot;</span>);<br>    <span class="hljs-comment">// 3.通过对象实例获取Class对象</span><br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>    Class&lt;?&gt; studentClass3 = student.getClass();<br>    <span class="hljs-comment">// 4.通过类加载器获取Class对象</span><br>    <span class="hljs-comment">// 通过类加载器获取 Class 对象不会进行初始化，意味着不进行包括初始化等一系列步骤，静态代码块和静态对象不会得到执行(1, 2, 4都不会执行静态代码块)</span><br>    Class&lt;?&gt; studentClass4 = ClassLoader.getSystemClassLoader().loadClass(<span class="hljs-string">&quot;test.Student&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-2-反射的基本操作"><a href="#2-2-反射的基本操作" class="headerlink" title="2.2 反射的基本操作"></a>2.2 反射的基本操作</h2><h3 id="2-2-1-获取类的构造方法并创建对象"><a href="#2-2-1-获取类的构造方法并创建对象" class="headerlink" title="2.2.1. 获取类的构造方法并创建对象"></a>2.2.1. 获取类的构造方法并创建对象</h3><h4 id="2-2-1-1-获取构造方法"><a href="#2-2-1-1-获取构造方法" class="headerlink" title="2.2.1.1. 获取构造方法"></a>2.2.1.1. 获取构造方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 1.通过类名获取Class对象</span><br>    Class&lt;Student&gt; studentClass = Student.class;<br>    <span class="hljs-comment">// 2. 获取构造方法</span><br>    <span class="hljs-comment">// 2.1 获取所有的公共构造方法</span><br>    Constructor&lt;?&gt;[] constructors = studentClass.getConstructors();<br>    <span class="hljs-comment">// 2.2 获取所有的构造方法</span><br>    Constructor&lt;?&gt;[] declaredConstructors = studentClass.getDeclaredConstructors();<br>    <span class="hljs-comment">// 2.3 获取指定参数类型的公有的构造方法</span><br>    Constructor&lt;Student&gt; constructor = studentClass.getConstructor(String.class, <span class="hljs-type">int</span>.class, String.class);<br>    <span class="hljs-comment">// 2.4 获取指定参数类型的所有类型构造方法</span><br>    Constructor&lt;Student&gt; declaredConstructor = studentClass.getDeclaredConstructor(String.class, <span class="hljs-type">int</span>.class);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="2-2-1-2-创建对象"><a href="#2-2-1-2-创建对象" class="headerlink" title="2.2.1.2. 创建对象"></a>2.2.1.2. 创建对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 1.通过类名获取Class对象</span><br>    Class&lt;Student&gt; studentClass = Student.class;<br>    <span class="hljs-comment">// 公共构造方法</span><br>    Constructor&lt;Student&gt; declaredPublicConstructor = studentClass.getDeclaredConstructor(String.class, <span class="hljs-type">int</span>.class, String.class);<br>    declaredPublicConstructor.newInstance(<span class="hljs-string">&quot;Tom&quot;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&quot;ChengHuaDaDao&quot;</span>);<br>    <span class="hljs-comment">// 私有构造方法需要取消访问权限检查</span><br>    Constructor&lt;Student&gt; declaredPrivateConstructor = studentClass.getDeclaredConstructor(String.class, <span class="hljs-type">int</span>.class);<br>    <span class="hljs-comment">// 暴力反射：取消访问权限检查</span><br>    declaredPrivateConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>    declaredPrivateConstructor.newInstance(<span class="hljs-string">&quot;Tom&quot;</span>, <span class="hljs-number">20</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-2-获取类的成员变量并操作"><a href="#2-2-2-获取类的成员变量并操作" class="headerlink" title="2.2.2. 获取类的成员变量并操作"></a>2.2.2. 获取类的成员变量并操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 1.通过类名获取Class对象</span><br>        Class&lt;Student&gt; studentClass = Student.class;<br>        <span class="hljs-comment">// 获取所有公共字段</span><br>        Field[] fields = studentClass.getFields();<br>        <span class="hljs-comment">// 获取所有字段</span><br>        Field[] declaredFields = studentClass.getDeclaredFields();<br>        <span class="hljs-comment">// 获取单个指定的公共字段（name为公有）</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> studentClass.getField(<span class="hljs-string">&quot;name&quot;</span>);<br>        <span class="hljs-comment">// 获取单个指定的任意类型字段（address为私有）</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">address</span> <span class="hljs-operator">=</span> studentClass.getDeclaredField(<span class="hljs-string">&quot;address&quot;</span>);<br><br>        <span class="hljs-comment">// 获取字段的值，私有字段需要取消访问权限检查</span><br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>        System.out.println(name.get(student));<br><br>        address.setAccessible(<span class="hljs-literal">true</span>);<br>        System.out.println(address.get(student));<br>        <span class="hljs-comment">// 修改字段的值，私有字段需要取消访问权限检查</span><br>        name.set(student, <span class="hljs-string">&quot;Alice&quot;</span>);<br><br>        address.setAccessible(<span class="hljs-literal">true</span>);<br>        address.set(student, <span class="hljs-string">&quot;ChengDu&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-3-获取类的方法并操作"><a href="#2-2-3-获取类的方法并操作" class="headerlink" title="2.2.3. 获取类的方法并操作"></a>2.2.3. 获取类的方法并操作</h3><h4 id="2-2-3-1-获取全部公共方法"><a href="#2-2-3-1-获取全部公共方法" class="headerlink" title="2.2.3.1 获取全部公共方法"></a>2.2.3.1 获取全部公共方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 1.通过类名获取Class对象</span><br>    Class&lt;Student&gt; studentClass = Student.class;<br>    <span class="hljs-comment">// 获取全部公共方法</span><br>    Method[] methods = studentClass.getMethods();<br>    <span class="hljs-keyword">for</span> (Method method : methods) &#123;<br>        System.out.println(method);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>输出结果如下，可以看到除了 Student 类中定义的公共方法外，还有一些 Object 类（父类）中公共的方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">public void test.Student.printInfo()<br>public boolean test.Student.equals(java.lang.Object)<br>public java.lang.String test.Student.toString()<br>public int test.Student.hashCode()<br>public final void java.lang.Object.<span class="hljs-built_in">wait</span>(long,int) throws java.lang.InterruptedException<br>public final void java.lang.Object.<span class="hljs-built_in">wait</span>() throws java.lang.InterruptedException<br>public final native void java.lang.Object.<span class="hljs-built_in">wait</span>(long) throws java.lang.InterruptedException<br>public final native java.lang.Class java.lang.Object.getClass()<br>public final native void java.lang.Object.notify()<br>public final native void java.lang.Object.notifyAll()<br></code></pre></td></tr></table></figure><h4 id="2-2-3-2-获取全部类型的所有方法"><a href="#2-2-3-2-获取全部类型的所有方法" class="headerlink" title="2.2.3.2 获取全部类型的所有方法"></a>2.2.3.2 获取全部类型的所有方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>    <span class="hljs-comment">// 1.通过类名获取Class对象</span><br>    Class&lt;Student&gt; studentClass = Student.class;<br>    <span class="hljs-comment">// 获取全部类型的所有方法</span><br>    Method[] methods = studentClass.getDeclaredMethods();<br>    <span class="hljs-keyword">for</span> (Method method : methods) &#123;<br>        System.out.println(method);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>输出结果如下，只有 Student 类中定义的方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">public boolean test.Student.equals(java.lang.Object)<br>public java.lang.String test.Student.toString()<br>public int test.Student.hashCode()<br>private void test.Student.printInfo2(java.lang.String)<br>public void test.Student.printInfo()<br></code></pre></td></tr></table></figure><h4 id="2-2-3-3-获取指定方法"><a href="#2-2-3-3-获取指定方法" class="headerlink" title="2.2.3.3 获取指定方法"></a>2.2.3.3 获取指定方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 1.通过类名获取Class对象</span><br>    Class&lt;Student&gt; studentClass = Student.class;<br>    <span class="hljs-comment">// 获取单个方法,需要指定方法名和参数列表（因为函数有可能重载）</span><br>    <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> studentClass.getDeclaredMethod(<span class="hljs-string">&quot;printInfo2&quot;</span>, String.class);<br>    <span class="hljs-comment">// 获取方法权限修饰符</span><br>    System.out.println(method.getModifiers());<br>    <span class="hljs-comment">// 获取方法名</span><br>    System.out.println(method.getName());<br>    <span class="hljs-comment">// 获取方法返回值类型</span><br>    System.out.println(method.getReturnType());<br>    <span class="hljs-comment">// 获取方法参数列表</span><br>    System.out.println(Arrays.toString(method.getParameterTypes()));<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-2-3-4-调用方法"><a href="#2-2-3-4-调用方法" class="headerlink" title="2.2.3.4 调用方法"></a>2.2.3.4 调用方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>    <span class="hljs-comment">// 1.通过类名获取Class对象</span><br>    Class&lt;Student&gt; studentClass = Student.class;<br>    <span class="hljs-comment">// 获取单个方法,需要指定方法名和参数列表（因为函数有可能重载）</span><br>    <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> studentClass.getDeclaredMethod(<span class="hljs-string">&quot;printInfo2&quot;</span>, String.class);<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>    <span class="hljs-comment">// 通过反射调用方法, 私有方法需要设置Accessible为true</span><br>    <span class="hljs-comment">// 可以接受返回值,没有就不写</span><br>    method.setAccessible(<span class="hljs-literal">true</span>);<br>    System.out.println(method.invoke(student, <span class="hljs-string">&quot;Tom&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="3-注解"><a href="#3-注解" class="headerlink" title="3. 注解"></a>3. 注解</h1><h2 id="3-1-什么是注解"><a href="#3-1-什么是注解" class="headerlink" title="3.1 什么是注解?"></a>3.1 什么是注解?</h2><p>注解 (Annotation)，也叫元数据。一种代码级别的说明。它是 JDK1.5 及以后版本引入的一个特性，与类、接口、枚举是在同一个层次。它可以声明在包、类、字段、方法、局部变量、方法参数等的前面，用来对这些元素进行说明，注释。<br>简单来说就是 Java 代码中的特殊标记比如@Override、@Test 等,作用是让其他程序根据注解信息决定如何执行该程序。</p><h2 id="3-2-自定义注解"><a href="#3-2-自定义注解" class="headerlink" title="3.2 自定义注解"></a>3.2 自定义注解</h2><p>创建一个注解类 MyAnnotation.java<br>格式为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> 注解名 &#123;<br>    <span class="hljs-comment">// 注解的属性</span><br>    <span class="hljs-keyword">public</span> 属性类型 属性名() <span class="hljs-keyword">default</span> 默认值;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>默认 public 可以省略，默认值也可以不写,但是如果不写默认值，那么在使用注解时必须给属性赋值。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> test;<br><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyAnnotation &#123;<br>    String <span class="hljs-title function_">aaa</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">bbb</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;<br>    String[] ccc();<br>&#125;<br></code></pre></td></tr></table></figure><p>上面注解本质是一个接口，Java 所有注解都继承了 Annotation 接口反编译后的代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> test;<br><span class="hljs-keyword">import</span> java.lang.annotation.Annotation;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyAnnotation</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Annotation</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">aaa</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">bbb</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String[] ccc();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@MyAnnotation(aaa = &quot;cxk&quot;, ccc = &#123;&quot;zhangsan&quot;, &quot;lisi&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>&#125;<br><br>@注解(...)其实就是实现类对象,实现了该注解以及Annotation接口。<br></code></pre></td></tr></table></figure><p>另外有一个特殊属性名为 value，可以省略属性名，直接赋值。<br>即只有一个 value 属性或者剩余的属性都有默认值时，可以省略属性名。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyAnnotation &#123;<br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">bbb</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@MyAnnotation(&quot;cxk&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-3-元注解"><a href="#3-3-元注解" class="headerlink" title="3.3 元注解"></a>3.3 元注解</h2><p>指的是可以注解到注解上的注解，Java 提供了 5 个元注解，专门负责注解其他注解。</p><h3 id="3-3-1-Target"><a href="#3-3-1-Target" class="headerlink" title="3.3.1 @Target"></a>3.3.1 @Target</h3><p>作用：声明被修饰的注解只能在哪些位置使用（默认是全部范围生效）</p><ul><li>Type：类、接口、枚举</li><li>Field：字段</li><li>Method：方法</li><li>Parameter：参数</li><li>Constructor：构造方法</li><li>Local_Variable：局部变量</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.Type, ElementType.Field)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyAnnotation &#123;<br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-3-2-Retention"><a href="#3-3-2-Retention" class="headerlink" title="3.3.2 @Retention"></a>3.3.2 @Retention</h3><p>声明注解的生命周期<br><code>@Retention(RetentionPolicy.RUNTIME)：注解会在 class 文件中存在，在运行时可以通过反射获取到。</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">- SOURCE（源码级别，编译后丢弃）<br>  用于只在代码编辑或编译期间提供辅助信息，不需要出现在生成的字节码中。<br>  例子： Java 内置的注解 <span class="hljs-meta">@SuppressWarnings</span> 就采用 SOURCE 策略。它只用于指示编译器忽略特定的警告，编译后便不保留在 class 文件中。<br><br>- CLASS（编译时注解，运行时丢弃，默认值）<br>  注解会被编译进字节码，但在运行时通过反射无法访问。适合那些需要在编译期或打包时被工具处理，但运行期不需要的场景。<br>  例子： 如果你定义一个注解，仅用于代码生成或静态检查工具（如代码质量检测、自动生成文档等），可以选择 CLASS 策略，这样相关信息会保留在 class 文件中供工具分析，但不会增加运行时开销。<br><br>- RUNTIME（运行时注解，运行时保留）<br>  注解在编译后会保留在 class 文件中，并可在运行时通过反射读取。适合依赖动态探测注解信息的场景。<br>  例子： Spring 框架中的 <span class="hljs-meta">@Autowired</span> 注解，就是运行时注解。容器通过反射检查、解析这些注解，完成依赖注入等动态操作。<br></code></pre></td></tr></table></figure><h3 id="3-3-3-Documented"><a href="#3-3-3-Documented" class="headerlink" title="3.3.3 @Documented"></a>3.3.3 @Documented</h3><p>@Documented 是一个简单的标记注解，表示是否将注解信息添加在 Java 文档，即 Javadoc 中。</p><h3 id="3-3-4-Inherited"><a href="#3-3-4-Inherited" class="headerlink" title="3.3.4 @Inherited"></a>3.3.4 @Inherited</h3><p>Inherited 是指继承，@Inherited 定义了一个注释与子类的关系。如果一个超类带有 @Inherited 注解，那么对于该超类，它的子类如果没有被任何注解应用的话，那么这个子类就继承了超类的注解。<br>例如下面的例子，如果 A 类上有 @Test 注解，那么 B 类也会继承 @Test 注解。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@interface</span> Test &#123;&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span> &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="3-3-5-Repeatable"><a href="#3-3-5-Repeatable" class="headerlink" title="3.3.5 @Repeatable"></a>3.3.5 @Repeatable</h3><p>@Repeatable 是 Java 8 中加入的，是指可重复的意思。通常使用 @Repeatable 的时候指注解的值可以同时取多个。<br>例如一个人可以有多种身份</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@interface</span> Persons &#123;<br>    Person[] value();<br>&#125;<br><br><span class="hljs-meta">@Repeatable(Persons.class)</span><br><span class="hljs-meta">@interface</span> Person &#123;<br>    String role <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@Person(role=&quot;artist&quot;)</span><br><span class="hljs-meta">@Person(role=&quot;coder&quot;)</span><br><span class="hljs-meta">@Person(role=&quot;PM&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperMan</span> &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-4-注解的解析"><a href="#3-4-注解的解析" class="headerlink" title="3.4 注解的解析"></a>3.4 注解的解析</h2><p>判断类、方法、字段上是否有注解，如果有则获取注解对象并解析其中的内容。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> test.MyAnnotation;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseClass</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1. 获取类对象</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Main.class;<br>        <span class="hljs-comment">// 2.判断是否存在注解</span><br>        <span class="hljs-keyword">if</span>(clazz.isAnnotationPresent(MyAnnotation.class))&#123;<br>            <span class="hljs-comment">// 3.获取注解对象</span><br>            <span class="hljs-type">MyAnnotation</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> (MyAnnotation) clazz.getAnnotation(MyAnnotation.class);<br>            System.out.println(annotation.address());<br>            System.out.println(annotation.value());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseMethod</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NoSuchMethodException &#123;<br>        <span class="hljs-comment">// 1. 获取类对象和方法对象</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Main.class;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getDeclaredMethod(<span class="hljs-string">&quot;main&quot;</span>, String[].class);<br>        <span class="hljs-comment">// 2.判断是否存在注解</span><br>        <span class="hljs-keyword">if</span>(method.isAnnotationPresent(MyAnnotation.class))&#123;<br>            <span class="hljs-comment">// 3.获取注解对象</span><br>            <span class="hljs-type">MyAnnotation</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> (MyAnnotation) method.getAnnotation(MyAnnotation.class);<br>            System.out.println(annotation.address());<br>            System.out.println(annotation.value());<br>        &#125;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="4-动态代理"><a href="#4-动态代理" class="headerlink" title="4. 动态代理"></a>4. 动态代理</h1><p>动态代理是一种设计模式，它是在运行时创建一个实现了一组给定接口的新类的对象。动态代理类的实例将通常用于替换对其他对象的直接调用。通过使用动态代理，可以将调用分派到不同的调用处理程序，这些处理程序可以将调用连接到实际的服务对象。</p><p>创建一个接口类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> test;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Star</span> &#123;<br>    String <span class="hljs-title function_">sing</span><span class="hljs-params">(String name)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">dance</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">rap</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">basketball</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>创建一个实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> test;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigStar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Star</span> &#123;<br>    <span class="hljs-keyword">public</span> String name;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sing</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;唱歌&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dance</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;跳&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rap</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;rap&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">basketball</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;篮球&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>创建一个代理工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> test;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyUtil</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Star <span class="hljs-title function_">createProxy</span><span class="hljs-params">(BigStar bigStar)</span> &#123;<br>        <span class="hljs-comment">// newProxyInstance方法的三个参数分别是：类加载器、接口数组、InvocationHandler对象内部类</span><br>        <span class="hljs-type">Star</span> <span class="hljs-variable">starProxy</span> <span class="hljs-operator">=</span> (Star) Proxy.newProxyInstance(ProxyUtil.class.getClassLoader(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Star.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>() &#123;<br>                    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// invoke方法是调用代理对象的方法时会被调用的方法</span><br>                    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>                        <span class="hljs-comment">// 如果方法名是sing，则返回“唱歌”</span><br>                        <span class="hljs-keyword">if</span> (method.getName().equals(<span class="hljs-string">&quot;sing&quot;</span>)) &#123;<br>                            System.out.println(<span class="hljs-string">&quot;准备唱歌&quot;</span>);<br>                        &#125;<br>                        <span class="hljs-comment">// 如果方法名是dance，则打印“跳”</span><br>                        <span class="hljs-keyword">if</span> (method.getName().equals(<span class="hljs-string">&quot;dance&quot;</span>)) &#123;<br>                            System.out.println(<span class="hljs-string">&quot;准备跳舞&quot;</span>);<br>                        &#125;<br>                        <span class="hljs-comment">// 如果方法名是rap，则打印“rap”</span><br>                        <span class="hljs-keyword">if</span> (method.getName().equals(<span class="hljs-string">&quot;rap&quot;</span>)) &#123;<br>                            System.out.println(<span class="hljs-string">&quot;准备rap&quot;</span>);<br>                        &#125;<br>                        <span class="hljs-comment">// 如果方法名是basketball，则打印“篮球”</span><br>                        <span class="hljs-keyword">if</span> (method.getName().equals(<span class="hljs-string">&quot;basketball&quot;</span>)) &#123;<br>                            System.out.println(<span class="hljs-string">&quot;准备打篮球&quot;</span>);<br>                        &#125;<br>                        <span class="hljs-keyword">return</span> method.invoke(bigStar, args);<br>                    &#125;<br>                &#125;);<br>        <span class="hljs-keyword">return</span> starProxy;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>调用测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> test;<br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">BigStar</span> <span class="hljs-variable">bigStar</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigStar</span>(<span class="hljs-string">&quot;cxk&quot;</span>);<br>        <span class="hljs-type">Star</span> <span class="hljs-variable">starProxy</span> <span class="hljs-operator">=</span> ProxyUtil.createProxy(bigStar);<br>        System.out.println(starProxy.sing(<span class="hljs-string">&quot;cxk&quot;</span>));<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>反射</tag>
      
      <tag>注解</tag>
      
      <tag>动态代理</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>elasticsearch</title>
    <link href="/2025/03/04/elasticsearch/"/>
    <url>/2025/03/04/elasticsearch/</url>
    
    <content type="html"><![CDATA[<h1 id="1-Elasticsearch-入门"><a href="#1-Elasticsearch-入门" class="headerlink" title="1. Elasticsearch 入门"></a>1. Elasticsearch 入门</h1><h2 id="1-1-什么是-Elasticsearch"><a href="#1-1-什么是-Elasticsearch" class="headerlink" title="1.1 什么是 Elasticsearch"></a>1.1 什么是 Elasticsearch</h2><p>Elasticsearch 是由 elastic 公司开发的一套搜索引擎技术，它是 elastic 技术栈中的一部分。完整的技术栈包括：</p><ul><li>Elasticsearch：用于数据存储、计算和搜索</li><li>Logstash&#x2F;Beats：用于数据收集</li><li>Kibana：用于数据可视化</li></ul><h3 id="1-1-1-安装-Elasticsearch"><a href="#1-1-1-安装-Elasticsearch" class="headerlink" title="1.1.1 安装 Elasticsearch"></a>1.1.1 安装 Elasticsearch</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  --name es \<br>  -e <span class="hljs-string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \<br>  -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> \<br>  -v es-data:/usr/share/elasticsearch/data \<br>  -v es-plugins:/usr/share/elasticsearch/plugins \<br>  --privileged \<br>  --network hmall \<br>  -p 9200:9200 \<br>  -p 9300:9300 \<br>  elasticsearch:7.12.1<br></code></pre></td></tr></table></figure><h3 id="1-1-2-安装-Kibana"><a href="#1-1-2-安装-Kibana" class="headerlink" title="1.1.2.安装 Kibana"></a>1.1.2.安装 Kibana</h3><p>通过下面的 Docker 命令，即可部署 Kibana：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>--name kibana \<br>-e ELASTICSEARCH_HOSTS=http://es:9200 \<br>--network=hmall \<br>-p 5601:5601 \<br>kibana:7.12.1<br></code></pre></td></tr></table></figure><h2 id="1-2-倒排索引"><a href="#1-2-倒排索引" class="headerlink" title="1.2 倒排索引"></a>1.2 倒排索引</h2><h3 id="1-2-1-正序索引"><a href="#1-2-1-正序索引" class="headerlink" title="1.2.1 正序索引"></a>1.2.1 正序索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_goods <span class="hljs-keyword">where</span> title <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%手机%&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/03/04/uCw7IiDgHNafWGc.png" alt="image.png"></p><ul><li>1）检查到搜索条件为 like ‘%手机%’，需要找到 title 中包含手机的数据</li><li>2）逐条遍历每行数据（每个叶子节点），比如第 1 次拿到 id 为 1 的数据</li><li>3）判断数据中的 title 字段值是否符合条件</li><li>4）如果符合则放入结果集，不符合则丢弃</li><li>5）回到步骤 1</li></ul><h3 id="1-2-2-倒排索引"><a href="#1-2-2-倒排索引" class="headerlink" title="1.2.2 倒排索引"></a>1.2.2 倒排索引</h3><p>倒排索引中有两个非常重要的概念：</p><ul><li>文档（Document）：用来搜索的数据，其中的每一条数据就是一个文档。例如一个网页、一个商品信息</li><li>词条（Term）：对文档数据或用户搜索数据，利用某种算法分词，得到的具备含义的词语就是词条。例如：我是中国人，就可以分为：我、是、中国人、中国、国人这样的几个词条</li></ul><p>创建倒排索引是对正向索引的一种特殊处理和应用，流程如下：</p><ul><li>将每一个文档的数据利用分词算法根据语义拆分，得到一个个词条</li><li>创建表，每行数据包括词条、词条所在文档 id、位置等信息</li><li>因为词条唯一性，可以给词条创建正向索引<br>此时形成的这张以词条为索引的表，就是倒排索引表，两者对比如下：</li></ul><p><img src="https://s2.loli.net/2025/03/04/aASoR9YtgkqfJvy.png" alt="image.png"></p><p>那么为什么一个叫做正向索引，一个叫做倒排索引呢？</p><ul><li>正向索引是最传统的，根据 id 索引的方式。但根据词条查询时，必须先逐条获取每个文档，然后判断文档中是否包含所需要的词条，是根据文档找词条的过程。</li><li>而倒排索引则相反，是先找到用户要搜索的词条，根据词条得到保护词条的文档的 id，然后根据 id 获取文档。是根据词条找文档的过程。</li></ul><h2 id="1-3-IK-分词器"><a href="#1-3-IK-分词器" class="headerlink" title="1.3 IK 分词器"></a>1.3 IK 分词器</h2><p>Elasticsearch 的关键就是倒排索引，而倒排索引依赖于对文档内容的分词，而分词则需要高效、精准的分词算法，IK 分词器就是这样一个中文分词算法。</p><h3 id="1-3-1-IK-分词器的安装"><a href="#1-3-1-IK-分词器的安装" class="headerlink" title="1.3.1 IK 分词器的安装"></a>1.3.1 IK 分词器的安装</h3><p>首先，查看之前安装的 Elasticsearch 容器的 plugins 数据卷目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker volume inspect es-plugins<br></code></pre></td></tr></table></figure><p>可以看到 elasticsearch 的插件挂载到了&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;es-plugins&#x2F;_data 这个目录。我们需要把 IK 分词器上传至这个目录。<br>最后重启 Elasticsearch 容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart es<br></code></pre></td></tr></table></figure><h3 id="1-3-2-IK-分词器的使用"><a href="#1-3-2-IK-分词器的使用" class="headerlink" title="1.3.2 IK 分词器的使用"></a>1.3.2 IK 分词器的使用</h3><p>在 Kibana 的 DevTools 上来测试分词器的效果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /_analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;黑马程序员学习java太棒了&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2-索引库操作"><a href="#2-索引库操作" class="headerlink" title="2.索引库操作"></a>2.索引库操作</h1><h2 id="2-1-Mapping-映射属性"><a href="#2-1-Mapping-映射属性" class="headerlink" title="2.1 Mapping 映射属性"></a>2.1 Mapping 映射属性</h2><p>Mapping 是对索引库中文档的约束，常见的 Mapping 属性包括：</p><ul><li>type：字段数据类型，常见的简单类型有：<ul><li>字符串：text（可分词的文本）、keyword（精确值，例如：品牌、国家、ip 地址）</li><li>数值：long、integer、short、byte、double、float、</li><li>布尔：boolean</li><li>日期：date</li><li>对象：object</li></ul></li><li>index：是否创建索引，默认为 true</li><li>analyzer：使用哪种分词器</li><li>properties：该字段的子字段</li></ul><h2 id="2-2-索引库的-CRUD"><a href="#2-2-索引库的-CRUD" class="headerlink" title="2.2.索引库的 CRUD"></a>2.2.索引库的 CRUD</h2><p>由于 Elasticsearch 采用的是 Restful 风格的 API，因此其请求方式和路径相对都比较规范，而且请求参数也都采用 JSON 风格。<br>我们直接基于 Kibana 的 DevTools 来编写请求做测试，由于有语法提示，会非常方便。</p><h3 id="2-2-1-创建索引库和映射"><a href="#2-2-1-创建索引库和映射" class="headerlink" title="2.2.1.创建索引库和映射"></a>2.2.1.创建索引库和映射</h3><p>基本语法：</p><ul><li>请求方式：PUT</li><li>请求路径：&#x2F;索引库名，可以自定义</li><li>请求参数：mapping 映射</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs json">PUT /heima<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="2-2-2-查询索引库"><a href="#2-2-2-查询索引库" class="headerlink" title="2.2.2.查询索引库"></a>2.2.2.查询索引库</h3><p>基本语法：</p><ul><li>请求方式：GET</li><li>请求路径：&#x2F;索引库名</li><li>请求参数：无</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /heima<br></code></pre></td></tr></table></figure><h3 id="2-2-3-修改索引库"><a href="#2-2-3-修改索引库" class="headerlink" title="2.2.3.修改索引库"></a>2.2.3.修改索引库</h3><p>倒排索引结构虽然不复杂，但是一旦数据结构改变（比如改变了分词器），就需要重新创建倒排索引，这简直是灾难。因此索引库一旦创建，无法修改 mapping。</p><p>虽然无法修改 mapping 中已有的字段，但是却允许添加新的字段到 mapping 中，因为不会对倒排索引产生影响。因此修改索引库能做的就是向索引库中添加新字段，或者更新索引库的基础属性。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">PUT /heima/_mapping<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;integer&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="2-2-4-删除索引库"><a href="#2-2-4-删除索引库" class="headerlink" title="2.2.4.删除索引库"></a>2.2.4.删除索引库</h3><p>语法：</p><ul><li>请求方式：DELETE</li><li>请求路径：&#x2F;索引库名</li><li>请求参数：无</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">DELETE /heima<br></code></pre></td></tr></table></figure><h1 id="3-文档操作"><a href="#3-文档操作" class="headerlink" title="3.文档操作"></a>3.文档操作</h1><p>有了索引库，接下来就可以向索引库中添加数据了。<br>Elasticsearch 中的数据其实就是 JSON 风格的文档。操作文档自然保护增、删、改、查等几种常见操作</p><h2 id="3-1-新增文档"><a href="#3-1-新增文档" class="headerlink" title="3.1 新增文档"></a>3.1 新增文档</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">POST /heima/_doc/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;黑马程序员Java讲师&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zy@itcast.cn&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;云&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;赵&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="3-2-查询文档"><a href="#3-2-查询文档" class="headerlink" title="3.2.查询文档"></a>3.2.查询文档</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /heima/_doc/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="3-3-删除文档"><a href="#3-3-删除文档" class="headerlink" title="3.3 删除文档"></a>3.3 删除文档</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">DELETE /heima/_doc/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="3-4-修改文档"><a href="#3-4-修改文档" class="headerlink" title="3.4 修改文档"></a>3.4 修改文档</h2><h3 id="3-4-1-全量修改"><a href="#3-4-1-全量修改" class="headerlink" title="3.4.1.全量修改"></a>3.4.1.全量修改</h3><p>全量修改是覆盖原来的文档，其本质是两步操作：</p><ul><li>根据指定的 id 删除文档</li><li>新增一个相同 id 的文档<br>注意：如果根据 id 删除时，id 不存在，第二步的新增也会执行，也就从修改变成了新增操作了。</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">PUT /heima/_doc/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;黑马程序员高级Java讲师&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zy@itcast.cn&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;云&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;赵&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="3-4-2-局部修改"><a href="#3-4-2-局部修改" class="headerlink" title="3.4.2.局部修改"></a>3.4.2.局部修改</h3><p>局部修改是只修改指定 id 匹配的文档中的部分字段。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">POST /heima/_update/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;doc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ZhaoYun@itcast.cn&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="3-5-批处理"><a href="#3-5-批处理" class="headerlink" title="3.5 批处理"></a>3.5 批处理</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">POST _bulk<br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;field1&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;value1&quot;</span> <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;delete&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;create&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;field1&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;value3&quot;</span> <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;update&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;doc&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;field2&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;value2&quot;</span><span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>index 代表新增操作<ul><li>_index：指定索引库名</li><li>_id 指定要操作的文档 id</li><li>{ “field1” : “value1” }：则是要新增的文档内容</li></ul></li><li>delete 代表删除操作<ul><li>_index：指定索引库名</li><li>_id 指定要操作的文档 id</li></ul></li><li>update 代表更新操作<ul><li>_index：指定索引库名</li><li>_id 指定要操作的文档 id</li><li>{ “doc” : {“field2” : “value2”} }：要更新的文档字段</li></ul></li></ul><h1 id="4-RestApi"><a href="#4-RestApi" class="headerlink" title="4. RestApi"></a>4. RestApi</h1><h2 id="4-1-引入依赖"><a href="#4-1-引入依赖" class="headerlink" title="4.1 引入依赖"></a>4.1 引入依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>因为 SpringBoot 默认的 ES 版本是 7.17.10，所以我们需要覆盖默认的 ES 版本</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">elasticsearch.version</span>&gt;</span>7.12.1<span class="hljs-tag">&lt;/<span class="hljs-name">elasticsearch.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="5-DSL-查询"><a href="#5-DSL-查询" class="headerlink" title="5. DSL 查询"></a>5. DSL 查询</h1><h2 id="5-1-叶子查询"><a href="#5-1-叶子查询" class="headerlink" title="5.1 叶子查询"></a>5.1 叶子查询</h2><h3 id="5-1-1-全文检索查询"><a href="#5-1-1-全文检索查询" class="headerlink" title="5.1.1.全文检索查询"></a>5.1.1.全文检索查询</h3><ul><li>全文检索查询（Full Text Queries）：利用分词器对用户输入搜索条件先分词，得到词条，然后再利用倒排索引搜索词条。例如：<ul><li>match：</li><li>multi_match</li></ul></li><li>精确查询（Term-level queries）：不对用户输入搜索条件分词，根据字段内容精确值匹配。但只能查找 keyword、数值、日期、boolean 类型的字段。例如：<ul><li>ids</li><li>term</li><li>range</li></ul></li><li>地理坐标查询：用于搜索地理位置，搜索方式很多，例如：<ul><li>geo_bounding_box：按矩形搜索</li><li>geo_distance：按点和半径搜索</li></ul></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /<span class="hljs-punctuation">&#123;</span>索引库名<span class="hljs-punctuation">&#125;</span>/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;multi_match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;搜索条件&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;字段1&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;字段2&quot;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="5-1-2-精确查询"><a href="#5-1-2-精确查询" class="headerlink" title="5.1.2.精确查询"></a>5.1.2.精确查询</h3><p>精确查询，英文是 Term-level query，顾名思义，词条级别的查询。也就是说不会对用户输入的搜索条件再分词，而是作为一个词条，与搜索的字段内容精确值匹配。因此推荐查找 keyword、数值、日期、boolean 类型的字段。例如：</p><ul><li>id</li><li>price</li><li>城市</li><li>地名</li><li>人名<br>等等，作为一个整体才有含义的字段。</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /<span class="hljs-punctuation">&#123;</span>索引库名<span class="hljs-punctuation">&#125;</span>/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;term&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;字段名&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;搜索条件&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="5-1-3-range-查询"><a href="#5-1-3-range-查询" class="headerlink" title="5.1.3 range 查询"></a>5.1.3 range 查询</h3><p>再来看下 range 查询，语法如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /<span class="hljs-punctuation">&#123;</span>索引库名<span class="hljs-punctuation">&#125;</span>/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;字段名&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;gte&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>最小值<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;lte&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>最大值<span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>range 是范围查询，对于范围筛选的关键字有：</p><ul><li>gte：大于等于</li><li>gt：大于</li><li>lte：小于等于</li><li>lt：小于</li></ul><h2 id="5-2-复合查询"><a href="#5-2-复合查询" class="headerlink" title="5.2 复合查询"></a>5.2 复合查询</h2><h3 id="5-2-1-bool-查询"><a href="#5-2-1-bool-查询" class="headerlink" title="5.2.1 bool 查询"></a>5.2.1 bool 查询</h3><p>bool 查询，即布尔查询。就是利用逻辑运算来组合一个或多个查询子句的组合。bool 查询支持的逻辑运算有：</p><ul><li>must：必须匹配每个子查询，类似“与”</li><li>should：选择性匹配子查询，类似“或”</li><li>must_not：必须不匹配，不参与算分，类似“非”</li><li>filter：必须匹配，不参与算分</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /items/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;bool&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;must&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;手机&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;should&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;term&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;brand&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vivo&quot;</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;term&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;brand&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;小米&quot;</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;must_not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;gte&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;lte&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="5-3-排序"><a href="#5-3-排序" class="headerlink" title="5.3 排序"></a>5.3 排序</h2><p>elasticsearch 默认是根据相关度算分（_score）来排序，但是也支持自定义方式对搜索结果排序。不过分词字段无法排序，能参与排序字段类型有：keyword 类型、数值类型、地理坐标类型、日期类型等。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /indexName/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match_all&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;排序字段&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;排序方式asc和desc&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="5-4-分页"><a href="#5-4-分页" class="headerlink" title="5.4 分页"></a>5.4 分页</h2><p>elasticsearch 默认情况下只返回 top10 的数据。而如果要查询更多数据就需要修改分页参数了。</p><h3 id="5-4-1-基础分页"><a href="#5-4-1-基础分页" class="headerlink" title="5.4.1 基础分页"></a>5.4.1 基础分页</h3><p>elasticsearch 中通过修改 from、size 参数来控制要返回的分页结果：</p><ul><li>from：从第几个文档开始</li><li>size：总共查询几个文档<br>类似于 mysql 中的 limit ?, ?</li></ul><h3 id="5-4-2-深度分页"><a href="#5-4-2-深度分页" class="headerlink" title="5.4.2 深度分页"></a>5.4.2 深度分页</h3><p>elasticsearch 的数据一般会采用分片存储，也就是把一个索引中的数据分成 N 份，存储到不同节点上。这种存储方式比较有利于数据扩展，但给分页带来了一些麻烦。<br>比如一个索引库中有 100000 条数据，分别存储到 4 个分片，每个分片 25000 条数据。现在每页查询 10 条，查询第 99 页。那么分页查询的条件如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /items/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;from&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">990</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 从第990条开始查询</span><br>  <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 每页查询10条</span><br>  <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;asc&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>试想一下，假如我们现在要查询的是第 999 页数据呢，是不是要找第 9990~10000 的数据，那岂不是需要把每个分片中的前 10000 名数据都查询出来，汇总在一起，在内存中排序？如果查询的分页深度更深呢，需要一次检索的数据岂不是更多？<br>由此可知，当查询分页深度较大时，汇总数据过多，对内存和 CPU 会产生非常大的压力。<br>因此 elasticsearch 会禁止 from+ size 超过 10000 的请求。<br>针对深度分页，elasticsearch 提供了两种解决方案：</p><ul><li>search after：分页时需要排序，原理是从上一次的排序值开始，查询下一页数据。官方推荐使用的方式。</li><li>scroll：原理将排序后的文档 id 形成快照，保存下来，基于快照做分页。官方已经不推荐使用。</li></ul><p>假设你有一张按时间排序的日志表，想分页查询每页 10 条记录。</p><p>传统分页（from 和 size）<br>第一页：from&#x3D;0, size&#x3D;10<br>ES 返回第 1 到 10 条记录。</p><p>第二页：from&#x3D;10, size&#x3D;10<br>ES 需要从头遍历前 10 条记录，跳过它们，再返回第 11 到 20 条。</p><p>第 100 页：from&#x3D;1000, size&#x3D;10<br>ES 需要从头遍历前 1000 条记录，跳过它们，再返回第 1001 到 1010 条。</p><p>search_after 分页<br>第一页：size&#x3D;10, sort&#x3D;时间戳<br>ES 返回第 1 到 10 条记录，并记录第 10 条的时间戳（比如 2023-10-01 12:00:00）。</p><p>第二页：size&#x3D;10, sort&#x3D;时间戳, search_after&#x3D;[2023-10-01 12:00:00]<br>ES 直接从 2023-10-01 12:00:00 之后开始查询，返回第 11 到 20 条记录。</p><p>第 100 页：size&#x3D;10, sort&#x3D;时间戳, search_after&#x3D;[上次最后一条的时间戳]<br>ES 直接从上一次的最后一条记录开始查询，不需要遍历前面的数据。</p><blockquote><p>总结：<br>大多数情况下，我们采用普通分页就可以了。查看百度、京东等网站，会发现其分页都有限制。例如百度最多支持 77 页，每页不足 20 条。京东最多 100 页，每页最多 60 条。<br>因此，一般我们采用限制分页深度的方式即可，无需实现深度分页。</p></blockquote><h2 id="5-5-高亮"><a href="#5-5-高亮" class="headerlink" title="5.5 高亮"></a>5.5 高亮</h2><p>观察页面源码，你会发现两件事情：</p><ul><li>高亮词条都被加了<code>&lt;em&gt;</code>标签</li><li><code>&lt;em&gt;</code>标签都添加了红色样式</li></ul><p>css 样式肯定是前端实现页面的时候写好的，但是前端编写页面的时候是不知道页面要展示什么数据的，不可能给数据加标签。而服务端实现搜索功能，要是有 elasticsearch 做分词搜索，是知道哪些词条需要高亮的。<br>因此词条的高亮标签肯定是由服务端提供数据的时候已经加上的。</p><p>因此实现高亮的思路就是：</p><ul><li>用户输入搜索关键字搜索数据</li><li>服务端根据搜索关键字到 elasticsearch 搜索，并给搜索结果中的关键字词条添加 html 标签</li><li>前端提前给约定好的 html 标签添加 CSS 样式</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /<span class="hljs-punctuation">&#123;</span>索引库名<span class="hljs-punctuation">&#125;</span>/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;搜索字段&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;搜索关键字&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;highlight&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;高亮字段名称&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;pre_tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;em&gt;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;post_tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;/em&gt;&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>搜索必须有查询条件，而且是全文检索类型的查询条件，例如 match</li><li>参与高亮的字段必须是 text 类型的字段</li><li>默认情况下参与高亮的字段要与搜索字段一致，除非添加：required_field_match&#x3D;false</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>微服务</tag>
      
      <tag>Elasticsearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MQ基础</title>
    <link href="/2025/03/02/MQ%E5%9F%BA%E7%A1%80/"/>
    <url>/2025/03/02/MQ%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="1-初识-RabbitMQ"><a href="#1-初识-RabbitMQ" class="headerlink" title="1. 初识 RabbitMQ"></a>1. 初识 RabbitMQ</h1><h2 id="1-1-同步调用和异步调用"><a href="#1-1-同步调用和异步调用" class="headerlink" title="1.1 同步调用和异步调用"></a>1.1 同步调用和异步调用</h2><p>同步调用的方式存在下列问题：</p><ul><li>拓展性差</li><li>性能下降</li><li>级联失败</li></ul><p>异步调用方式其实就是基于消息通知的方式，一般包含三个角色：</p><ul><li>消息发送者：投递消息的人，就是原来的调用方</li><li>消息 Broker：管理、暂存、转发消息，你可以把它理解成微信服务器</li><li>消息接收者：接收和处理消息的人，就是原来的服务提供方</li></ul><p>异步调用的优势包括：</p><ul><li>耦合度更低</li><li>性能更好</li><li>业务拓展性强</li><li>故障隔离，避免级联失败</li></ul><p>当然，异步通信也并非完美无缺，它存在下列缺点：</p><ul><li>完全依赖于 Broker 的可靠性、安全性和性能</li><li>架构复杂，后期维护和调试麻烦</li></ul><h2 id="1-2-常见-MQ"><a href="#1-2-常见-MQ" class="headerlink" title="1.2 常见 MQ"></a>1.2 常见 MQ</h2><p><img src="https://s2.loli.net/2025/03/02/PuJmh4cgpOzDoTx.png" alt="image.png"></p><h1 id="2-RabbitMQ"><a href="#2-RabbitMQ" class="headerlink" title="2. RabbitMQ"></a>2. RabbitMQ</h1><h2 id="2-1-RabbitMQ-安装"><a href="#2-1-RabbitMQ-安装" class="headerlink" title="2.1 RabbitMQ 安装"></a>2.1 RabbitMQ 安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run \<br> -e RABBITMQ_DEFAULT_USER=root \<br> -e RABBITMQ_DEFAULT_PASS=123 \<br> -v mq-plugins:/plugins \<br> --name mq \<br> --hostname mq \<br> -p 15672:15672 \<br> -p 5672:5672 \<br> --network hmall\<br> -d \<br> rabbitmq:3.8-management<br></code></pre></td></tr></table></figure><h2 id="2-2-收发消息"><a href="#2-2-收发消息" class="headerlink" title="2.2 收发消息"></a>2.2 收发消息</h2><p>创建队列之和和交换机建立绑定关系，然后发送消息到交换机，交换机再将消息发送到队列。</p><h2 id="2-3-数据隔离"><a href="#2-3-数据隔离" class="headerlink" title="2.3 数据隔离"></a>2.3 数据隔离</h2><p>对于小型企业而言，出于成本考虑，我们通常只会搭建一套 MQ 集群，公司内的多个不同项目同时使用。这个时候为了避免互相干扰， 我们会利用 virtual host 的隔离特性，将不同项目隔离。一般会做两件事情：</p><ul><li>给每个项目创建独立的运维账号，将管理权限分离。</li><li>给每个项目创建不同的 virtual host，将每个项目的数据隔离。</li></ul><h1 id="3-SpringAMQP"><a href="#3-SpringAMQP" class="headerlink" title="3.SpringAMQP"></a>3.SpringAMQP</h1><p>将来我们开发业务功能的时候，肯定不会在控制台收发消息，而是应该基于编程的方式。由于 RabbitMQ 采用了 AMQP 协议，因此它具备跨语言的特性。任何语言只要遵循 AMQP 协议收发消息，都可以与 RabbitMQ 交互。并且 RabbitMQ 官方也提供了各种不同语言的客户端。<br>但是，RabbitMQ 官方提供的 Java 客户端编码相对复杂，一般生产环境下我们更多会结合 Spring 来使用。而 Spring 的官方刚好基于 RabbitMQ 提供了这样一套消息收发的模板工具：SpringAMQP。并且还基于 SpringBoot 对其实现了自动装配，使用起来非常方便。</p><p>SpringAMQP 提供了三个功能：</p><ul><li>自动声明队列、交换机及其绑定关系</li><li>基于注解的监听器模式，异步接收消息</li><li>封装了 RabbitTemplate 工具，用于发送消息</li></ul><h2 id="3-1-WorkQueues-模型"><a href="#3-1-WorkQueues-模型" class="headerlink" title="3.1 WorkQueues 模型"></a>3.1 WorkQueues 模型</h2><p>消息是平均分配给每个消费者，并没有考虑到消费者的处理能力。导致 1 个消费者空闲，另一个消费者忙的不可开交。没有充分利用每一个消费者的能力，最终消息处理的耗时远远超过了 1 秒。这样显然是有问题的。</p><p>Work 模型的使用：</p><ul><li>多个消费者绑定到一个队列，同一条消息只会被一个消费者处理</li><li>通过设置 prefetch 来控制消费者预取的消息数量</li></ul><p>在 spring 中有一个简单的配置，可以解决这个问题。我们修改 consumer 服务的 application.yml 文件，添加配置:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">listener:</span><br>      <span class="hljs-attr">simple:</span><br>        <span class="hljs-attr">prefetch:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># 每次只能获取一条消息，处理完成才能获取下一个消息</span><br></code></pre></td></tr></table></figure><h2 id="3-2-交换机类型"><a href="#3-2-交换机类型" class="headerlink" title="3.2 交换机类型"></a>3.2 交换机类型</h2><p>Exchange（交换机）只负责转发消息，不具备存储消息的能力，因此如果没有任何队列与 Exchange 绑定，或者没有符合路由规则的队列，那么消息会丢失！</p><p>交换机的类型有四种：</p><ul><li>Fanout：广播，将消息交给所有绑定到交换机的队列。我们最早在控制台使用的正是 Fanout 交换机</li><li>Direct：订阅，基于 RoutingKey（路由 key）发送给订阅了消息的队列</li><li>Topic：通配符订阅，与 Direct 类似，只不过 RoutingKey 可以使用通配符</li><li>Headers：头匹配，基于 MQ 的消息头匹配，用的较少。</li></ul><h2 id="3-3-声明队列和交换机"><a href="#3-3-声明队列和交换机" class="headerlink" title="3.3 声明队列和交换机"></a>3.3 声明队列和交换机</h2><p>基于注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span><br><span class="hljs-meta">    exchange = @Exchange(name = &quot;hmall.direct&quot;, type = ExchangeTypes.DIRECT),</span><br><span class="hljs-meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenDirectQueue1</span><span class="hljs-params">(String msg)</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;消费者1接收到direct.queue1的消息：【&quot;</span> + msg + <span class="hljs-string">&quot;】&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span><br><span class="hljs-meta">    exchange = @Exchange(name = &quot;hmall.direct&quot;, type = ExchangeTypes.DIRECT),</span><br><span class="hljs-meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenDirectQueue2</span><span class="hljs-params">(String msg)</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;消费者2接收到direct.queue2的消息：【&quot;</span> + msg + <span class="hljs-string">&quot;】&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4-MQ-的可靠性"><a href="#4-MQ-的可靠性" class="headerlink" title="4. MQ 的可靠性"></a>4. MQ 的可靠性</h1><p>消息到达 MQ 以后，如果 MQ 不能及时保存，也会导致消息丢失，所以 MQ 的可靠性也非常重要。</p><h2 id="4-1-数据持久化"><a href="#4-1-数据持久化" class="headerlink" title="4.1.数据持久化"></a>4.1.数据持久化</h2><p>为了提升性能，默认情况下 MQ 的数据都是在内存存储的临时数据，重启后就会消失。为了保证数据的可靠性，必须配置数据持久化，包括：</p><ul><li>交换机持久化</li><li>队列持久化</li><li>消息持久化</li></ul><blockquote><p>说明：在开启持久化机制以后，如果同时还开启了生产者确认，那么 MQ 会在消息持久化以后才发送 ACK 回执，进一步确保消息的可靠性。<br>不过出于性能考虑，为了减少 IO 次数，发送到 MQ 的消息并不是逐条持久化到数据库的，而是每隔一段时间批量持久化。一般间隔在 100 毫秒左右，这就会导致 ACK 有一定的延迟，因此建议生产者确认全部采用异步方式。</p></blockquote><h2 id="4-2-LazyQueue"><a href="#4-2-LazyQueue" class="headerlink" title="4.2 LazyQueue"></a>4.2 LazyQueue</h2><p>在默认情况下，RabbitMQ 会将接收到的信息保存在内存中以降低消息收发的延迟。但在某些特殊情况下，这会导致消息积压，比如：</p><ul><li>消费者宕机或出现网络故障</li><li>消息发送量激增，超过了消费者处理速度</li><li>消费者处理业务发生阻塞</li></ul><p>一旦出现消息堆积问题，RabbitMQ 的内存占用就会越来越高，直到触发内存预警上限。此时 RabbitMQ 会将内存消息刷到磁盘上，这个行为成为 PageOut. PageOut 会耗费一段时间，并且会阻塞队列进程。因此在这个过程中 RabbitMQ 不会再处理新的消息，生产者的所有请求都会被阻塞。</p><p>为了解决这个问题，从 RabbitMQ 的 3.6.0 版本开始，就增加了 Lazy Queues 的模式，也就是惰性队列。惰性队列的特征如下：</p><ul><li>接收到消息后直接存入磁盘而非内存</li><li>消费者要消费消息时才会从磁盘中读取并加载到内存（也就是懒加载）</li><li>支持数百万条的消息存储<br>而在 3.12 版本之后，LazyQueue 已经成为所有队列的默认格式。因此官方推荐升级 MQ 为 3.12 版本或者所有队列都设置为 LazyQueue 模式。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">lazyQueue</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> QueueBuilder<br>            .durable(<span class="hljs-string">&quot;lazy.queue&quot;</span>)<br>            .lazy() <span class="hljs-comment">// 开启Lazy模式</span><br>            .build();<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="5-消费者的可靠性"><a href="#5-消费者的可靠性" class="headerlink" title="5.消费者的可靠性"></a>5.消费者的可靠性</h1><h2 id="5-1-消费者确认机制"><a href="#5-1-消费者确认机制" class="headerlink" title="5.1 消费者确认机制"></a>5.1 消费者确认机制</h2><p>为了确认消费者是否成功处理消息，RabbitMQ 提供了消费者确认机制（Consumer Acknowledgement）。即：当消费者处理消息结束后，应该向 RabbitMQ 发送一个回执，告知 RabbitMQ 自己消息处理状态。回执有三种可选值：</p><ul><li>ack：成功处理消息，RabbitMQ 从队列中删除该消息</li><li>nack：消息处理失败，RabbitMQ 需要再次投递消息</li><li>reject：消息处理失败并拒绝该消息，RabbitMQ 从队列中删除该消息</li></ul><p>一般 reject 方式用的较少，除非是消息格式有问题，那就是开发问题了。因此大多数情况下我们需要将消息处理的代码通过 try catch 机制捕获，消息处理成功时返回 ack，处理失败时返回 nack.</p><p>由于消息回执的处理代码比较统一，因此 SpringAMQP 帮我们实现了消息确认。并允许我们通过配置文件设置 ACK 处理方式，有三种模式：</p><ul><li>none：不处理。即消息投递给消费者后立刻 ack，消息会立刻从 MQ 删除。非常不安全，不建议使用</li><li>manual：手动模式。需要自己在业务代码中调用 api，发送 ack 或 reject，存在业务入侵，但更灵活</li><li>auto：自动模式。SpringAMQP 利用 AOP 对我们的消息处理逻辑做了环绕增强，当业务正常执行时则自动返回 ack. 当业务出现异常时，根据异常判断返回不同结果：<ul><li>如果是业务异常，会自动返回 nack；</li><li>如果是消息处理或校验异常，自动返回 reject;</li></ul></li></ul><h2 id="5-2-消费者重试机制"><a href="#5-2-消费者重试机制" class="headerlink" title="5.2 消费者重试机制"></a>5.2 消费者重试机制</h2><p>当消费者出现异常后，消息会不断 requeue（重入队）到队列，再重新发送给消费者。如果消费者再次执行依然出错，消息会再次 requeue 到队列，再次投递，直到消息处理成功为止。<br>极端情况就是消费者一直无法执行成功，那么消息 requeue 就会无限循环，导致 mq 的消息处理飙升，带来不必要的压力：可以配置消息的最大重试次数，超过次数后，消息会被丢弃。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">listener:</span><br>      <span class="hljs-attr">simple:</span><br>        <span class="hljs-attr">retry:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启消费者失败重试</span><br>          <span class="hljs-attr">initial-interval:</span> <span class="hljs-string">1000ms</span> <span class="hljs-comment"># 初识的失败等待时长为1秒</span><br>          <span class="hljs-attr">multiplier:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># 失败的等待时长倍数，下次等待时长 = multiplier * last-interval</span><br>          <span class="hljs-attr">max-attempts:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># 最大重试次数</span><br>          <span class="hljs-attr">stateless:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># true无状态；false有状态。如果业务中包含事务，这里改为false</span><br></code></pre></td></tr></table></figure><h2 id="5-3-失败处理策略"><a href="#5-3-失败处理策略" class="headerlink" title="5.3 失败处理策略"></a>5.3 失败处理策略</h2><p>Spring 也允许我们自定义重试次数耗尽后的消息处理策略，这个策略是由 MessageRecovery 接口来定义的，它有 3 个不同实现：</p><ul><li>RejectAndDontRequeueRecoverer：重试耗尽后，直接 reject，丢弃消息。默认就是这种方式</li><li>ImmediateRequeueMessageRecoverer：重试耗尽后，返回 nack，消息重新入队</li><li>RepublishMessageRecoverer：重试耗尽后，将失败消息投递到指定的交换机</li></ul><p>比较优雅的一种处理方案是 RepublishMessageRecoverer，失败后将消息投递到一个指定的，专门存放异常消息的队列，后续由人工集中处理。</p><h2 id="5-4-业务幂等性"><a href="#5-4-业务幂等性" class="headerlink" title="5.4 业务幂等性"></a>5.4 业务幂等性</h2><h3 id="5-4-1-唯一消息-ID"><a href="#5-4-1-唯一消息-ID" class="headerlink" title="5.4.1 唯一消息 ID"></a>5.4.1 唯一消息 ID</h3><p>这个思路非常简单：</p><ol><li>每一条消息都生成一个唯一的 id，与消息一起投递给消费者。</li><li>消费者接收到消息后处理自己的业务，业务处理成功后将消息 ID 保存到数据库</li><li>如果下次又收到相同消息，去数据库查询判断是否存在，存在则为重复消息放弃处理。</li></ol><h3 id="5-4-2-业务判断"><a href="#5-4-2-业务判断" class="headerlink" title="5.4.2 业务判断"></a>5.4.2 业务判断</h3><p>业务判断就是基于业务本身的逻辑或状态来判断是否是重复的请求或消息，不同的业务场景判断的思路也不一样。<br>例如我们当前案例中，处理消息的业务逻辑是把订单状态从未支付修改为已支付。因此我们就可以在执行业务时判断订单状态是否是未支付，如果不是则证明订单已经被处理过，无需重复处理。</p><p>相比较而言，消息 ID 的方案需要改造原有的数据库，所以我更推荐使用业务判断的方案。</p><h1 id="6-延迟消息"><a href="#6-延迟消息" class="headerlink" title="6. 延迟消息"></a>6. 延迟消息</h1><h2 id="6-1-死信交换机与延迟消息"><a href="#6-1-死信交换机与延迟消息" class="headerlink" title="6.1 死信交换机与延迟消息"></a>6.1 死信交换机与延迟消息</h2><p>当一个队列中的消息满足下列情况之一时，可以成为死信（dead letter）：</p><ul><li>消费者使用 basic.reject 或 basic.nack 声明消费失败，并且消息的 requeue 参数设置为 false</li><li>消息是一个过期消息，超时无人消费</li><li>要投递的队列消息满了，无法投递</li></ul><p><img src="https://s2.loli.net/2025/03/03/2VH3bOEKs9oYMem.png" alt="image.png"></p><blockquote><p>RabbitMQ 的消息过期是基于追溯方式来实现的，也就是说当一个消息的 TTL 到期以后不一定会被移除或投递到死信交换机，而是在消息恰好处于队首时才会被处理。<br>当队列中消息堆积很多的时候，过期消息可能不会被按时处理，因此你设置的 TTL 时间不一定准确。</p></blockquote><h2 id="6-2-DelayExchange-插件"><a href="#6-2-DelayExchange-插件" class="headerlink" title="6.2 DelayExchange 插件"></a>6.2 DelayExchange 插件</h2><p>先查看 RabbitMQ 的插件目录对应的数据卷。<br>docker volume inspect mq-plugins<br>结果如下，把插件放到这个目录&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;mq-plugins&#x2F;_data</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[<br>    &#123;<br>        <span class="hljs-string">&quot;CreatedAt&quot;</span>: <span class="hljs-string">&quot;2025-03-02T16:35:49+08:00&quot;</span>,<br>        <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;local&quot;</span>,<br>        <span class="hljs-string">&quot;Labels&quot;</span>: null,<br>        <span class="hljs-string">&quot;Mountpoint&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/volumes/mq-plugins/_data&quot;</span>,<br>        <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;mq-plugins&quot;</span>,<br>        <span class="hljs-string">&quot;Options&quot;</span>: null,<br>        <span class="hljs-string">&quot;Scope&quot;</span>: <span class="hljs-string">&quot;local&quot;</span><br>    &#125;<br>]<br></code></pre></td></tr></table></figure><p>接下来执行命令，安装插件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it mq rabbitmq-plugins <span class="hljs-built_in">enable</span> rabbitmq_delayed_message_exchange<br></code></pre></td></tr></table></figure><p>声明延迟交换机</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">        value = @Queue(name = &quot;delay.queue&quot;, durable = &quot;true&quot;),</span><br><span class="hljs-meta">        exchange = @Exchange(name = &quot;delay.direct&quot;, delayed = &quot;true&quot;),</span><br><span class="hljs-meta">        key = &quot;delay&quot;</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenDelayMessage</span><span class="hljs-params">(String msg)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;接收到delay.queue的延迟消息：&#123;&#125;&quot;</span>, msg);<br>&#125;<br></code></pre></td></tr></table></figure><p>发送延迟消息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testPublisherDelayMessage</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.创建消息</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello, delayed message&quot;</span>;<br>    <span class="hljs-comment">// 2.发送消息，利用消息后置处理器添加消息头</span><br>    rabbitTemplate.convertAndSend(<span class="hljs-string">&quot;delay.direct&quot;</span>, <span class="hljs-string">&quot;delay&quot;</span>, message, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePostProcessor</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Message <span class="hljs-title function_">postProcessMessage</span><span class="hljs-params">(Message message)</span> <span class="hljs-keyword">throws</span> AmqpException &#123;<br>            <span class="hljs-comment">// 添加延迟消息属性</span><br>            message.getMessageProperties().setDelay(<span class="hljs-number">5000</span>);<br>            <span class="hljs-keyword">return</span> message;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>延迟消息插件内部会维护一个本地数据库表，同时使用 Elang Timers 功能实现计时。如果消息的延迟时间设置较长，可能会导致堆积的延迟消息非常多，会带来较大的 CPU 开销，同时延迟消息的时间会存在误差。<br>因此，不建议设置延迟时间过长的延迟消息。</p></blockquote><h2 id="6-3-处理超时订单"><a href="#6-3-处理超时订单" class="headerlink" title="6.3 处理超时订单"></a>6.3 处理超时订单</h2><p><img src="https://s2.loli.net/2025/03/03/O2pKPbo5CwRsh1i.png" alt="image.png"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>微服务</tag>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>服务保护和分布式事务</title>
    <link href="/2025/03/01/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    <url>/2025/03/01/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<p>查询购物车的业务，假如商品服务业务并发较高，占用过多 Tomcat 连接。可能会导致商品服务的所有接口响应时间增加，延迟变高，甚至是长时间阻塞直至查询失败。<br>此时查询购物车业务需要查询并等待商品查询结果，从而导致查询购物车列表业务的响应时间也变长，甚至也阻塞直至无法访问。而此时如果查询购物车的请求较多，可能导致购物车服务的 Tomcat 连接占用较多，所有接口的响应时间都会增加，整个服务性能很差， 甚至不可用。<br>依次类推，整个微服务群中与购物车服务、商品服务等有调用关系的服务可能都会出现问题，最终导致整个集群不可用。<br>这就是级联失败问题，或者叫雪崩问题。</p><h1 id="1-微服务保护"><a href="#1-微服务保护" class="headerlink" title="1.微服务保护"></a>1.微服务保护</h1><h2 id="1-1-服务保护方案"><a href="#1-1-服务保护方案" class="headerlink" title="1.1 服务保护方案"></a>1.1 服务保护方案</h2><ul><li>请求限流</li><li>线程隔离</li><li>服务熔断</li></ul><h3 id="1-1-1-请求限流"><a href="#1-1-1-请求限流" class="headerlink" title="1.1.1 请求限流"></a>1.1.1 请求限流</h3><p>服务故障最重要原因，就是并发太高！解决了这个问题，就能避免大部分故障。当然，接口的并发不是一直很高，而是突发的。因此请求限流，就是限制或控制接口访问的并发流量，避免服务因流量激增而出现故障。</p><p>请求限流往往会有一个限流器，数量高低起伏的并发请求曲线，经过限流器就变的非常平稳。这就像是水电站的大坝，起到蓄水的作用，可以通过开关控制水流出的大小，让下游水流始终维持在一个平稳的量。</p><p><img src="https://s2.loli.net/2025/03/01/PlTQh4dzmgaOnrk.png" alt="image.png"></p><h3 id="1-1-2-线程隔离"><a href="#1-1-2-线程隔离" class="headerlink" title="1.1.2 线程隔离"></a>1.1.2 线程隔离</h3><p>当一个业务接口响应时间长，而且并发高时，就可能耗尽服务器的线程资源，导致服务内的其它接口受到影响。所以我们必须把这种影响降低，或者缩减影响的范围。线程隔离正是解决这个问题的好办法。</p><p>线程隔离：也叫做舱壁模式，模拟船舱隔板的防水原理。通过限定每个业务能使用的线程数量而将故障业务隔离，避免故障扩散。</p><p><img src="https://s2.loli.net/2025/03/01/d9YwmIiRVGz1qsf.png" alt="image.png"></p><h3 id="1-1-3-服务熔断"><a href="#1-1-3-服务熔断" class="headerlink" title="1.1.3 服务熔断"></a>1.1.3 服务熔断</h3><p>线程隔离虽然避免了雪崩问题，但故障服务（商品服务）依然会拖慢购物车服务（服务调用方）的接口响应速度。而且商品查询的故障依然会导致查询购物车功能出现故障，购物车业务也变的不可用了。</p><p>所以，我们要做两件事情：</p><ul><li>编写服务降级逻辑：就是服务调用失败后的处理逻辑，根据业务场景，可以抛出异常，也可以返回友好提示或默认数据。</li><li>异常统计和熔断：统计服务提供方的异常比例，当比例过高表明该接口会影响到其它服务，应该拒绝调用该接口，而是直接走降级逻辑。</li></ul><p><img src="https://s2.loli.net/2025/03/01/5YgFC9nhRy1Sov8.png" alt="image.png"></p><h2 id="1-2-Sentinel"><a href="#1-2-Sentinel" class="headerlink" title="1.2 Sentinel"></a>1.2 Sentinel</h2><h3 id="1-2-1-微服务启动"><a href="#1-2-1-微服务启动" class="headerlink" title="1.2.1.微服务启动"></a>1.2.1.微服务启动</h3><p>Sentinel 的使用可以分为两个部分:</p><ul><li>核心库（Jar 包）：不依赖任何框架&#x2F;库，能够运行于 Java 8 及以上的版本的运行时环境，同时对 Dubbo &#x2F; Spring Cloud 等框架也有较好的支持。在项目中引入依赖即可实现服务限流、隔离、熔断等功能。</li><li>控制台（Dashboard）：Dashboard 主要负责管理推送规则、监控、管理机器信息等。</li></ul><p>启动 Sentinel 控制台：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">java -Dserver.port=8090 -Dcsp.sentinel.dashboard.server=localhost:8090 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard.jar<br></code></pre></td></tr></table></figure><h3 id="1-2-2-微服务整合"><a href="#1-2-2-微服务整合" class="headerlink" title="1.2.2.微服务整合"></a>1.2.2.微服务整合</h3><p>我们在 cart-service 模块中整合 sentinel，连接 sentinel-dashboard 控制台，步骤如下：<br>1）引入 sentinel 依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--sentinel--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>修改 application.yaml 文件，添加下面内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">localhost:8090</span><br></code></pre></td></tr></table></figure><p>重启服务就可以在 Sentinel 控制台看到 cart-service 服务的监控信息了。<br><a href="http://localhost:8090/#/dashboard/identity/cart-service">http://localhost:8090/#/dashboard/identity/cart-service</a><br>簇点链路，就是单机调用链路，是一次请求进入服务后经过的每一个被 Sentinel 监控的资源。默认情况下，Sentinel 会监控 SpringMVC 的每一个 Endpoint（接口）。<br>因此，我们看到&#x2F;carts 这个接口路径就是其中一个簇点，我们可以对其进行限流、熔断、隔离等保护措施。</p><p>默认情况下 Sentinel 会把路径作为簇点资源的名称，无法区分路径相同但请求方式不同的接口，查询、删除、修改等都被识别为一个簇点资源，这显然是不合适的。</p><p>所以我们可以选择打开 Sentinel 的请求方式前缀，把请求方式 + 请求路径作为簇点资源名：<br>首先，在 cart-service 的 application.yml 中添加下面的配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">localhost:8090</span><br>      <span class="hljs-attr">http-method-specify:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启请求方式前缀</span><br></code></pre></td></tr></table></figure><h2 id="1-3-请求限流"><a href="#1-3-请求限流" class="headerlink" title="1.3 请求限流"></a>1.3 请求限流</h2><p>打开控制台，在簇点链路后面点击流控按钮，即可对其做限流配置。</p><h2 id="1-4-线程隔离"><a href="#1-4-线程隔离" class="headerlink" title="1.4 线程隔离"></a>1.4 线程隔离</h2><p>修改 cart-service 模块的 application.yml 文件，开启 Feign 的 sentinel 功能：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">feign:</span><br><span class="hljs-attr">sentinel:</span><br><span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启 feign 对 sentinel 的支持</span><br></code></pre></td></tr></table></figure><p>需要注意的是，默认情况下 SpringBoot 项目的 tomcat 最大线程数是 200，允许的最大连接是 8192，单机测试很难打满。<br>所以我们需要配置一下 cart-service 模块的 application.yml 文件，修改 tomcat 连接：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8082</span><br>  <span class="hljs-attr">tomcat:</span><br>    <span class="hljs-attr">threads:</span><br>      <span class="hljs-attr">max:</span> <span class="hljs-number">50</span> <span class="hljs-comment"># 允许的最大线程数</span><br>    <span class="hljs-attr">accept-count:</span> <span class="hljs-number">50</span> <span class="hljs-comment"># 最大排队等待数量</span><br>    <span class="hljs-attr">max-connections:</span> <span class="hljs-number">100</span> <span class="hljs-comment"># 允许的最大连接</span><br></code></pre></td></tr></table></figure><p>接下来，点击查询商品的 FeignClient 对应的簇点资源后面的流控按钮进行配置即可。</p><h2 id="1-5-服务熔断"><a href="#1-5-服务熔断" class="headerlink" title="1.5.服务熔断"></a>1.5.服务熔断</h2><p>之前 我们利用线程隔离对查询购物车业务进行隔离，保护了购物车服务的其它接口。由于查询商品的功能耗时较高（我们模拟了 500 毫秒延时），再加上线程隔离限定了线程数为 5，导致接口吞吐能力有限，最终 QPS 只有 10 左右。这就导致了几个问题：</p><p>第一，超出的 QPS 上限的请求就只能抛出异常，从而导致购物车的查询失败。但从业务角度来说，即便没有查询到最新的商品信息，购物车也应该展示给用户，用户体验更好。也就是给查询失败设置一个降级处理逻辑。</p><p>第二，由于查询商品的延迟较高（模拟的 500ms），从而导致查询购物车的响应时间也变的很长。这样不仅拖慢了购物车服务，消耗了购物车服务的更多资源，而且用户体验也很差。对于商品服务这种不太健康的接口，我们应该直接停止调用，直接走降级逻辑，避免影响到当前服务。也就是将商品查询接口熔断。</p><h3 id="1-5-1-编写降级逻辑"><a href="#1-5-1-编写降级逻辑" class="headerlink" title="1.5.1 编写降级逻辑"></a>1.5.1 编写降级逻辑</h3><p>触发限流或熔断后的请求不一定要直接报错，也可以返回一些默认数据或者友好提示，用户体验会更好。<br>给 FeignClient 编写失败后的降级逻辑有两种方式：</p><ul><li>方式一：FallbackClass，无法对远程调用的异常做处理</li><li>方式二：FallbackFactory，可以对远程调用的异常做处理，我们一般选择这种方式。</li></ul><p>在 hm-api 模块中给 ItemClient 定义降级处理类，实现 ItemClientFallbackFactory</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.hmall.api.client.fallback;<br><br><span class="hljs-keyword">import</span> com.hmall.api.client.ItemClient;<br><span class="hljs-keyword">import</span> com.hmall.api.dto.ItemDTO;<br><span class="hljs-keyword">import</span> com.hmall.api.dto.OrderDetailDTO;<br><span class="hljs-keyword">import</span> com.hmall.common.exception.BizIllegalException;<br><span class="hljs-keyword">import</span> com.hmall.common.utils.CollUtils;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FallbackFactory;<br><br><span class="hljs-keyword">import</span> java.util.Collection;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ItemClientFallbackFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FallbackFactory</span>&lt;ItemClient&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ItemClient <span class="hljs-title function_">create</span><span class="hljs-params">(Throwable cause)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ItemClient</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> List&lt;ItemDTO&gt; <span class="hljs-title function_">queryItemByIds</span><span class="hljs-params">(Collection&lt;Long&gt; ids)</span> &#123;<br>                log.error(<span class="hljs-string">&quot;远程调用ItemClient#queryItemByIds方法出现异常，参数：&#123;&#125;&quot;</span>, ids, cause);<br>                <span class="hljs-comment">// 查询购物车允许失败，查询失败，返回空集合</span><br>                <span class="hljs-keyword">return</span> CollUtils.emptyList();<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(List&lt;OrderDetailDTO&gt; items)</span> &#123;<br>                <span class="hljs-comment">// 库存扣减业务需要触发事务回滚，查询失败，抛出异常</span><br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BizIllegalException</span>(cause);<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>步骤二：在 hm-api 模块中的 com.hmall.api.config.DefaultFeignConfig 类中将 ItemClientFallback 注册为一个 Bean：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> ItemClientFallbackFactory <span class="hljs-title function_">itemClientFallbackFactory</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ItemClientFallbackFactory</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>步骤三：在 hm-api 模块中的 ItemClient 接口中使用 ItemClientFallbackFactory：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(value = &quot;item-service&quot;, fallbackFactory = ItemClientFallbackFactory.class)</span><br></code></pre></td></tr></table></figure><h3 id="1-5-2-服务熔断"><a href="#1-5-2-服务熔断" class="headerlink" title="1.5.2. 服务熔断"></a>1.5.2. 服务熔断</h3><p>查询商品的 RT 较高（模拟的 500ms），从而导致查询购物车的 RT 也变的很长。这样不仅拖慢了购物车服务，消耗了购物车服务的更多资源，而且用户体验也很差。<br>对于商品服务这种不太健康的接口，我们应该停止调用，直接走降级逻辑，避免影响到当前服务。也就是将商品查询接口熔断。当商品服务接口恢复正常后，再允许调用。这其实就是断路器的工作模式了。</p><p>Sentinel 中的断路器不仅可以统计某个接口的慢请求比例，还可以统计异常请求比例。当这些比例超出阈值时，就会熔断该接口，即拦截访问该接口的一切请求，降级处理；当该接口恢复正常时，再放行对于该接口的请求。<br>断路器的工作状态切换有一个状态机来控制：</p><p><img src="https://s2.loli.net/2025/03/01/8DO3gVM4HedzhUa.png" alt="image.png"></p><p>状态机包括三个状态：</p><ul><li>closed：关闭状态，断路器放行所有请求，并开始统计异常比例、慢请求比例。超过阈值则切换到 open 状态</li><li>open：打开状态，服务调用被熔断，访问被熔断服务的请求会被拒绝，快速失败，直接走降级逻辑。Open 状态持续一段时间后会进入 half-open 状态</li><li>half-open：半开状态，放行一次请求，根据执行结果来判断接下来的操作。<ul><li>请求成功：则切换到 closed 状态</li><li>请求失败：则切换到 open 状态</li></ul></li></ul><h1 id="2-分布式事务"><a href="#2-分布式事务" class="headerlink" title="2.分布式事务"></a>2.分布式事务</h1><p>我们知道每一个分支事务就是传统的单体事务，都可以满足 ACID 特性，但全局事务跨越多个服务、多个数据库，是否还能满足呢？</p><p>参与事务的多个子业务在不同的微服务，跨越了不同的数据库。虽然每个单独的业务都能在本地遵循 ACID，但是它们互相之间没有感知，不知道有人失败了，无法保证最终结果的统一，也就无法遵循 ACID 的事务特性了。<br>这就是分布式事务问题，出现以下情况之一就可能产生分布式事务问题：</p><ul><li>业务跨多个服务实现</li><li>业务跨多个数据源实现</li></ul><h2 id="2-1-认识-Seata"><a href="#2-1-认识-Seata" class="headerlink" title="2.1 认识 Seata"></a>2.1 认识 Seata</h2><p>其实分布式事务产生的一个重要原因，就是参与事务的多个分支事务互相无感知，不知道彼此的执行状态。因此解决分布式事务的思想非常简单：<br>就是找一个统一的事务协调者，与多个分支事务通信，检测每个分支事务的执行状态，保证全局事务下的每一个分支事务同时成功或失败即可。大多数的分布式事务框架都是基于这个理论来实现的。</p><p>Seata 也不例外，在 Seata 的事务管理中有三个重要的角色：</p><ul><li>TC (Transaction Coordinator) - 事务协调者：维护全局和分支事务的状态，协调全局事务提交或回滚。</li><li>TM (Transaction Manager) - 事务管理器：定义全局事务的范围、开始全局事务、提交或回滚全局事务。</li><li>RM (Resource Manager) - 资源管理器：管理分支事务，与 TC 交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。</li></ul><p><img src="https://s2.loli.net/2025/03/01/faGnQ5iyXqImTbs.png" alt="image.png"></p><p>其中，TM 和 RM 可以理解为 Seata 的客户端部分，引入到参与事务的微服务依赖中即可。将来 TM 和 RM 就会协助微服务，实现本地分支事务与 TC 之间交互，实现事务的提交或回滚。</p><p>而 TC 服务则是事务协调中心，是一个独立的微服务，需要单独部署。</p><h2 id="2-2-部署-TC-服务"><a href="#2-2-部署-TC-服务" class="headerlink" title="2.2.部署 TC 服务"></a>2.2.部署 TC 服务</h2><p>Seata 支持多种存储模式，但考虑到持久化的需要，我们一般选择基于数据库存储。执行课前资料提供的《seata-tc.sql》，导入数据库表</p><p>我们将整个 seata 文件夹拷贝到虚拟机的&#x2F;root 目录<br>需要注意，要确保 nacos、mysql 都在 hm-net 网络中。如果某个容器不再 hm-net 网络，可以参考下面的命令将某容器加入指定网络：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker network connect [网络名] [容器名]<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run --name seata \<br>-p 8099:8099 \<br>-p 7099:7099 \<br>-e SEATA_IP=192.168.48.89 \<br>-v ./seata:/seata-server/resources \<br>--privileged=true \<br>--network hmall \<br>-d \<br>seataio/seata-server:1.5.2<br></code></pre></td></tr></table></figure><h2 id="2-3-微服务集成-Seata"><a href="#2-3-微服务集成-Seata" class="headerlink" title="2.3 微服务集成 Seata"></a>2.3 微服务集成 Seata</h2><p>java 17 以上版本需要添加以下参数</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">--add-opens java.base/java.lang=ALL-UNNAMED<br></code></pre></td></tr></table></figure><h3 id="2-3-1-引入依赖"><a href="#2-3-1-引入依赖" class="headerlink" title="2.3.1.引入依赖"></a>2.3.1.引入依赖</h3><p>为了方便各个微服务集成 seata，我们需要把 seata 配置共享到 nacos，因此 trade-service 模块不仅仅要引入 seata 依赖，还要引入 nacos 依赖:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--统一配置管理--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--读取bootstrap文件--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--seata--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2-3-2-改造配置"><a href="#2-3-2-改造配置" class="headerlink" title="2.3.2.改造配置"></a>2.3.2.改造配置</h3><p>首先在 nacos 上添加一个共享的 seata 配置，命名为 shared-seata.yaml：</p><p>内容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">registry:</span> <span class="hljs-comment"># TC服务注册中心的配置，微服务根据这些信息去注册中心获取tc服务地址</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span> <span class="hljs-comment"># 注册中心类型 nacos</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span><span class="hljs-string">:8848</span> <span class="hljs-comment"># nacos地址</span><br>      <span class="hljs-attr">namespace:</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment"># namespace，默认为空</span><br>      <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span> <span class="hljs-comment"># 分组，默认是DEFAULT_GROUP</span><br>      <span class="hljs-attr">application:</span> <span class="hljs-string">seata-server</span> <span class="hljs-comment"># seata服务名称</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">nacos</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">nacos</span><br>  <span class="hljs-attr">tx-service-group:</span> <span class="hljs-string">hmall</span> <span class="hljs-comment"># 事务组名称</span><br>  <span class="hljs-attr">service:</span><br>    <span class="hljs-attr">vgroup-mapping:</span> <span class="hljs-comment"># 事务组与tc集群的映射关系</span><br>      <span class="hljs-attr">hmall:</span> <span class="hljs-string">&quot;default&quot;</span><br></code></pre></td></tr></table></figure><p>然后，改造 trade-service 模块，添加 bootstrap.yaml：</p><p>内容如下:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">trade-service</span> <span class="hljs-comment"># 服务名称</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span> <span class="hljs-comment"># nacos地址</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span> <span class="hljs-comment"># 文件后缀名</span><br>        <span class="hljs-attr">shared-configs:</span> <span class="hljs-comment"># 共享配置</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">dataId:</span> <span class="hljs-string">shared-jdbc.yaml</span> <span class="hljs-comment"># 共享mybatis配置</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">dataId:</span> <span class="hljs-string">shared-log.yaml</span> <span class="hljs-comment"># 共享日志配置</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">dataId:</span> <span class="hljs-string">shared-swagger.yaml</span> <span class="hljs-comment"># 共享日志配置</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">dataId:</span> <span class="hljs-string">shared-seata.yaml</span> <span class="hljs-comment"># 共享seata配置</span><br></code></pre></td></tr></table></figure><p>可以看到这里加载了共享的 seata 配置。<br>然后改造 application.yaml 文件，内容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8085</span><br><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">okhttp:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启OKHttp连接池支持</span><br>  <span class="hljs-attr">sentinel:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启Feign对Sentinel的整合</span><br><span class="hljs-attr">hm:</span><br>  <span class="hljs-attr">swagger:</span><br>    <span class="hljs-attr">title:</span> <span class="hljs-string">交易服务接口文档</span><br>    <span class="hljs-attr">package:</span> <span class="hljs-string">com.hmall.trade.controller</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-string">hm-trade</span><br></code></pre></td></tr></table></figure><p>参考上述办法分别改造 hm-cart 和 hm-item 两个微服务模块。</p><h3 id="2-3-3-添加数据库表"><a href="#2-3-3-添加数据库表" class="headerlink" title="2.3.3.添加数据库表"></a>2.3.3.添加数据库表</h3><p>seata 的客户端在解决分布式事务的时候需要记录一些中间数据，保存在数据库中。因此我们要先准备一个这样的表。<br>将课前资料的 seata-at.sql 分别文件导入 hm-trade、hm-cart、hm-item 三个数据库中：<br>OK，至此为止，微服务整合的工作就完成了。可以参考上述方式对 hm-item 和 hm-cart 模块完成整合改造。</p><p>简述 AT 模式与 XA 模式最大的区别是什么？</p><ul><li>XA 模式一阶段不提交事务，锁定资源；AT 模式一阶段直接提交，不锁定资源。</li><li>XA 模式依赖数据库机制实现回滚；AT 模式利用数据快照实现数据回滚。</li><li>XA 模式强一致；AT 模式最终一致</li></ul><p>可见，AT 模式使用起来更加简单，无业务侵入，性能更好。因此企业 90%的分布式事务都可以用 AT 模式来解决。</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>微服务</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>网关</title>
    <link href="/2025/02/28/%E7%BD%91%E5%85%B3/"/>
    <url>/2025/02/28/%E7%BD%91%E5%85%B3/</url>
    
    <content type="html"><![CDATA[<p>单体架构时我们只需要完成一次用户登录、身份校验，就可以在所有业务中获取到用户信息。而微服务拆分后，每个微服务都独立部署，这就存在一些问题：</p><ul><li>每个微服务都需要编写登录校验、用户信息获取的功能吗？</li><li>当微服务之间调用时，该如何传递用户信息？</li></ul><h1 id="1-网关路由"><a href="#1-网关路由" class="headerlink" title="1. 网关路由"></a>1. 网关路由</h1><h2 id="1-1-什么是网关"><a href="#1-1-什么是网关" class="headerlink" title="1.1. 什么是网关"></a>1.1. 什么是网关</h2><p>顾名思义，网关就是网络的关口。数据在网络间传输，从一个网络传输到另一网络时就需要经过网关来做数据的路由和转发以及数据安全的校验。</p><p>现在，微服务网关就起到同样的作用。前端请求不能直接访问微服务，而是要请求网关：</p><ul><li>网关可以做安全控制，也就是登录身份校验，校验通过才放行</li><li>通过认证后，网关再根据请求判断应该访问哪个微服务，将请求转发过去</li></ul><p><img src="https://s2.loli.net/2025/02/28/Gart8LBve9JOZuj.png" alt="image.png"></p><p>在 SpringCloud 当中，提供了两种网关实现方案：</p><ul><li>Netflix Zuul：早期实现，目前已经淘汰</li><li>SpringCloudGateway：基于 Spring 的 WebFlux 技术，完全支持响应式编程，吞吐能力更强</li></ul><h2 id="1-2-快速入门"><a href="#1-2-快速入门" class="headerlink" title="1.2 快速入门"></a>1.2 快速入门</h2><p>接下来，我们先看下如何利用网关实现请求路由。由于网关本身也是一个独立的微服务，因此也需要创建一个模块开发功能。大概步骤如下：</p><ul><li>创建网关微服务</li><li>引入 SpringCloudGateway、NacosDiscovery 依赖</li><li>编写启动类</li><li>配置网关路由</li></ul><h3 id="1-2-1-创建网关微服务"><a href="#1-2-1-创建网关微服务" class="headerlink" title="1.2.1 创建网关微服务"></a>1.2.1 创建网关微服务</h3><p>建个模块</p><h3 id="1-2-2-引入依赖"><a href="#1-2-2-引入依赖" class="headerlink" title="1.2.2 引入依赖"></a>1.2.2 引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--common--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.heima<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hm-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--网关--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--nacos discovery--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--负载均衡--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="1-2-3-编写启动类"><a href="#1-2-3-编写启动类" class="headerlink" title="1.2.3 编写启动类"></a>1.2.3 编写启动类</h3><p>自己建文件一开始忘记加启动类注解了，诗人我吃</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> com.hmall.gatewat;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GatewayApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(GatewayApplication.class, args);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h3 id="1-2-4-配置路由"><a href="#1-2-4-配置路由" class="headerlink" title="1.2.4.配置路由"></a>1.2.4.配置路由</h3><p>接下来，在 hm-gateway 模块的 resources 目录新建一个 application.yaml 文件，内容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.48</span><span class="hljs-number">.89</span><span class="hljs-string">:8848</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">item</span> <span class="hljs-comment"># 路由规则id，自定义，唯一</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://item-service</span> <span class="hljs-comment"># 路由的目标服务，lb代表负载均衡，会从注册中心拉取服务列表</span><br>          <span class="hljs-attr">predicates:</span> <span class="hljs-comment"># 路由断言，判断当前请求是否符合当前规则，符合则路由到目标服务</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/items/**,/search/**</span> <span class="hljs-comment"># 这里是以请求路径作为判断规则</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">cart</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://cart-service</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/carts/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://user-service</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/users/**,/addresses/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">trade</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://trade-service</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/orders/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">pay</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://pay-service</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/pay-orders/**</span><br></code></pre></td></tr></table></figure><h1 id="2-网关登录校验"><a href="#2-网关登录校验" class="headerlink" title="2. 网关登录校验"></a>2. 网关登录校验</h1><p>单体架构时我们只需要完成一次用户登录、身份校验，就可以在所有业务中获取到用户信息。而微服务拆分后，每个微服务都独立部署，不再共享数据。也就意味着每个微服务都需要做登录校验，这显然不可取。</p><h2 id="2-1-鉴权思路分析"><a href="#2-1-鉴权思路分析" class="headerlink" title="2.1.鉴权思路分析"></a>2.1.鉴权思路分析</h2><p>我们的登录是基于 JWT 来实现的，校验 JWT 的算法复杂，而且需要用到秘钥。如果每个微服务都去做登录校验，这就存在着两大问题：</p><ul><li>每个微服务都需要知道 JWT 的秘钥，不安全</li><li>每个微服务重复编写登录校验代码、权限校验代码，麻烦</li></ul><p>既然网关是所有微服务的入口，一切请求都需要先经过网关。我们完全可以把登录校验的工作放到网关去做，这样之前说的问题就解决了：</p><ul><li>只需要在网关和用户服务保存秘钥</li><li>只需要在网关开发登录校验功能</li></ul><p>不过，这里存在几个问题：</p><ul><li>网关路由是配置的，请求转发是 Gateway 内部代码，我们如何在转发之前做登录校验？</li><li>网关校验 JWT 之后，如何将用户信息传递给微服务？</li><li>微服务之间也会相互调用，这种调用不经过网关，又该如何传递用户信息？</li></ul><h2 id="2-2-网关过滤器"><a href="#2-2-网关过滤器" class="headerlink" title="2.2 网关过滤器"></a>2.2 网关过滤器</h2><p>登录校验必须在请求转发到微服务之前做，否则就失去了意义。而网关的请求转发是 Gateway 内部代码实现的，要想在请求转发之前做登录校验，就必须了解 Gateway 内部工作的基本原理。</p><p><img src="https://s2.loli.net/2025/02/28/kRMExTqXfnre4sV.png" alt="image.png"></p><p>如图中所示，最终请求转发是有一个名为 NettyRoutingFilter 的过滤器来执行的，而且这个过滤器是整个过滤器链中顺序最靠后的一个。如果我们能够定义一个过滤器，在其中实现登录校验逻辑，并且将过滤器执行顺序定义到 NettyRoutingFilter 之前，这就符合我们的需求了！</p><p>那么，该如何实现一个网关过滤器呢？<br>网关过滤器链中的过滤器有两种：</p><ul><li>GatewayFilter：路由过滤器，作用范围比较灵活，可以是任意指定的路由 Route.</li><li>GlobalFilter：全局过滤器，作用范围是所有路由，不可配置。</li></ul><h2 id="2-3-实现登录校验"><a href="#2-3-实现登录校验" class="headerlink" title="2.3.实现登录校验"></a>2.3.实现登录校验</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.hmall.gateway.filters;<br><span class="hljs-keyword">import</span> com.hmall.common.exception.UnauthorizedException;<br><span class="hljs-keyword">import</span> com.hmall.common.utils.CollUtils;<br><span class="hljs-keyword">import</span> com.hmall.gateway.config.AuthProperties;<br><span class="hljs-keyword">import</span> com.hmall.gateway.utils.JwtTool;<br><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;<br><span class="hljs-keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;<br><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;<br><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;<br><span class="hljs-keyword">import</span> org.springframework.core.Ordered;<br><span class="hljs-keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;<br><span class="hljs-keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponse;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.util.AntPathMatcher;<br><span class="hljs-keyword">import</span> org.springframework.web.server.ServerWebExchange;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@RequiredArgsConstructor</span><br><span class="hljs-meta">@EnableConfigurationProperties(AuthProperties.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthGlobalFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GlobalFilter</span>, Ordered &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JwtTool jwtTool;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AuthProperties authProperties;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AntPathMatcher</span> <span class="hljs-variable">antPathMatcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AntPathMatcher</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;<br>        <span class="hljs-comment">// 1.获取Request</span><br>        <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> exchange.getRequest();<br>        <span class="hljs-comment">// 2.判断是否不需要拦截</span><br>        <span class="hljs-keyword">if</span>(isExclude(request.getPath().toString()))&#123;<br>            <span class="hljs-comment">// 无需拦截，直接放行</span><br>            <span class="hljs-keyword">return</span> chain.filter(exchange);<br>        &#125;<br>        <span class="hljs-comment">// 3.获取请求头中的token</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        List&lt;String&gt; headers = request.getHeaders().get(<span class="hljs-string">&quot;authorization&quot;</span>);<br>        <span class="hljs-keyword">if</span> (!CollUtils.isEmpty(headers)) &#123;<br>            token = headers.get(<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-comment">// 4.校验并解析token</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            userId = jwtTool.parseToken(token);<br>        &#125; <span class="hljs-keyword">catch</span> (UnauthorizedException e) &#123;<br>            <span class="hljs-comment">// 如果无效，拦截</span><br>            <span class="hljs-type">ServerHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> exchange.getResponse();<br>            response.setRawStatusCode(<span class="hljs-number">401</span>);<br>            <span class="hljs-keyword">return</span> response.setComplete();<br>        &#125;<br><br>        <span class="hljs-comment">// TODO 5.如果有效，传递用户信息</span><br>        System.out.println(<span class="hljs-string">&quot;userId = &quot;</span> + userId);<br>        <span class="hljs-comment">// 6.放行</span><br>        <span class="hljs-keyword">return</span> chain.filter(exchange);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isExclude</span><span class="hljs-params">(String antPath)</span> &#123;<br>        <span class="hljs-keyword">for</span> (String pathPattern : authProperties.getExcludePaths()) &#123;<br>            <span class="hljs-keyword">if</span>(antPathMatcher.match(pathPattern, antPath))&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-4-微服务获取用户信息"><a href="#2-4-微服务获取用户信息" class="headerlink" title="2.4 微服务获取用户信息"></a>2.4 微服务获取用户信息</h2><p>现在，网关已经可以完成登录校验并获取登录用户身份信息。但是当网关将请求转发到微服务时，微服务又该如何获取用户身份呢？<br>由于网关发送请求到微服务依然采用的是 Http 请求，因此我们可以将用户信息以请求头的方式传递到下游微服务。然后微服务可以从请求头中获取登录用户信息。考虑到微服务内部可能很多地方都需要用到登录用户信息，因此我们可以利用 SpringMVC 的拦截器来实现登录用户信息获取，并存入 ThreadLocal，方便后续使用。</p>]]></content>
    
    
    
    <tags>
      
      <tag>微服务</tag>
      
      <tag>网关</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker使用</title>
    <link href="/2025/02/24/docker/"/>
    <url>/2025/02/24/docker/</url>
    
    <content type="html"><![CDATA[<h1 id="1-Docker-的安装"><a href="#1-Docker-的安装" class="headerlink" title="1. Docker 的安装"></a>1. Docker 的安装</h1><h2 id="1-1-安装-Docker"><a href="#1-1-安装-Docker" class="headerlink" title="1.1 安装 Docker"></a>1.1 安装 Docker</h2><p>我使用的是 Ubuntu 20.04，安装 Docker 的步骤如下：</p><h3 id="1-1-1-更新-apt-包索引。"><a href="#1-1-1-更新-apt-包索引。" class="headerlink" title="1.1.1 更新 apt 包索引。"></a>1.1.1 更新 apt 包索引。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-get update<br></code></pre></td></tr></table></figure><h3 id="1-1-2-安装-apt-依赖包，⽤于通过-HTTPS-来获取仓库"><a href="#1-1-2-安装-apt-依赖包，⽤于通过-HTTPS-来获取仓库" class="headerlink" title="1.1.2 安装 apt 依赖包，⽤于通过 HTTPS 来获取仓库"></a>1.1.2 安装 apt 依赖包，⽤于通过 HTTPS 来获取仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common<br></code></pre></td></tr></table></figure><h3 id="1-1-3-添加-Docker-的官⽅-GPG-密钥"><a href="#1-1-3-添加-Docker-的官⽅-GPG-密钥" class="headerlink" title="1.1.3 添加 Docker 的官⽅ GPG 密钥"></a>1.1.3 添加 Docker 的官⽅ GPG 密钥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | <span class="hljs-built_in">sudo</span> apt-key add -<br><br></code></pre></td></tr></table></figure><h3 id="1-1-4-通过搜索指纹的后-8-个字符，验证您现在是否拥有带有指纹的密钥"><a href="#1-1-4-通过搜索指纹的后-8-个字符，验证您现在是否拥有带有指纹的密钥" class="headerlink" title="1.1.4 通过搜索指纹的后 8 个字符，验证您现在是否拥有带有指纹的密钥"></a>1.1.4 通过搜索指纹的后 8 个字符，验证您现在是否拥有带有指纹的密钥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-key fingerprint 0EBFCD88<br></code></pre></td></tr></table></figure><p>输出如下表示成功了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">pub   rsa4096 2017-02-22 [SCEA]<br>      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88<br>uid           [ unknown] Docker Release (CE deb) &lt;docker@docker.com&gt;<br>sub   rsa4096 2017-02-22 [S]<br></code></pre></td></tr></table></figure><h3 id="1-1-5-设置稳定版仓库"><a href="#1-1-5-设置稳定版仓库" class="headerlink" title="1.1.5 设置稳定版仓库"></a>1.1.5 设置稳定版仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br></code></pre></td></tr></table></figure><h2 id="1-2-安装-Docker-Engine-Community"><a href="#1-2-安装-Docker-Engine-Community" class="headerlink" title="1.2 安装 Docker Engine-Community"></a>1.2 安装 Docker Engine-Community</h2><h3 id="1-2-1-更新-apt-包索引"><a href="#1-2-1-更新-apt-包索引" class="headerlink" title="1.2.1 更新 apt 包索引"></a>1.2.1 更新 apt 包索引</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-get update<br></code></pre></td></tr></table></figure><h3 id="1-2-2-安装最新版本的-Docker-Engine-Community-和-containerd"><a href="#1-2-2-安装最新版本的-Docker-Engine-Community-和-containerd" class="headerlink" title="1.2.2 安装最新版本的 Docker Engine-Community 和 containerd"></a>1.2.2 安装最新版本的 Docker Engine-Community 和 containerd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-get install docker-ce docker-ce-cli containerd.io<br></code></pre></td></tr></table></figure><h3 id="1-2-3-测试-docker"><a href="#1-2-3-测试-docker" class="headerlink" title="1.2.3 测试 docker"></a>1.2.3 测试 docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> docker run hello-world<br></code></pre></td></tr></table></figure><p>输出以下内容表示成功了！</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">Unable to find image <span class="hljs-string">&#x27;hello-world:latest&#x27;</span> locally<br>latest: Pulling from library/hello-world<br>e6590344b1a5: Pull complete<br>Digest: sha256:e0b569a5163a5e6be84e210a2587e7d447e08f87a0e90798363fa44a0464a1e8<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> hello-world:latest<br><br>Hello from Docker!<br>This message shows that your installation appears to be working correctly.<br><br>To generate this message, Docker took the following steps:<br> 1. The Docker client contacted the Docker daemon.<br> 2. The Docker daemon pulled the <span class="hljs-string">&quot;hello-world&quot;</span> image from the Docker Hub.<br>    (amd64)<br> 3. The Docker daemon created a new container from that image <span class="hljs-built_in">which</span> runs the<br>    executable that produces the output you are currently reading.<br> 4. The Docker daemon streamed that output to the Docker client, <span class="hljs-built_in">which</span> sent it<br>    to your terminal.<br><br>To try something more ambitious, you can run an Ubuntu container with:<br> $ docker run -it ubuntu bash<br><br>Share images, automate workflows, and more with a free Docker ID:<br> https://hub.docker.com/<br><br>For more examples and ideas, visit:<br> https://docs.docker.com/get-started/<br></code></pre></td></tr></table></figure><h3 id="1-2-4-查看-docker-版本"><a href="#1-2-4-查看-docker-版本" class="headerlink" title="1.2.4 查看 docker 版本"></a>1.2.4 查看 docker 版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker -v<br></code></pre></td></tr></table></figure><h3 id="1-2-5-docker-服务启动与停止"><a href="#1-2-5-docker-服务启动与停止" class="headerlink" title="1.2.5 docker 服务启动与停止"></a>1.2.5 docker 服务启动与停止</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 启动docker</span><br><span class="hljs-built_in">sudo</span> service docker start<br><span class="hljs-comment"># 重启docker</span><br><span class="hljs-built_in">sudo</span> service docker restart<br><span class="hljs-comment"># 停⽌docker</span><br><span class="hljs-built_in">sudo</span> service docker stop<br></code></pre></td></tr></table></figure><h3 id="1-2-6-查看-docker-镜像"><a href="#1-2-6-查看-docker-镜像" class="headerlink" title="1.2.6 查看 docker 镜像"></a>1.2.6 查看 docker 镜像</h3><p>注意要先启动 docker 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> docker images<br></code></pre></td></tr></table></figure><h3 id="1-2-7-开机自动启动-docker-服务"><a href="#1-2-7-开机自动启动-docker-服务" class="headerlink" title="1.2.7 开机自动启动 docker 服务"></a>1.2.7 开机自动启动 docker 服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure><h1 id="2-docker-常用知识"><a href="#2-docker-常用知识" class="headerlink" title="2.docker 常用知识"></a>2.docker 常用知识</h1><p>不同操作系统下其安装包、运行环境是都不相同的！如果是手动安装，必须手动解决安装包不同、环境不同的、配置不同的问题！</p><p>而使用 Docker，这些完全不用考虑。就是因为 Docker 会自动搜索并下载 MySQL。注意：这里下载的不是安装包，而是镜像。镜像中不仅包含了 MySQL 本身，还包含了其运行所需要的环境、配置、系统级函数库。因此它在运行时就有自己独立的环境，就可以跨系统运行，也不需要手动再次配置环境了。这套独立运行的隔离环境我们称为容器。</p><ul><li>镜像：英文是 image</li><li>容器：英文是 container</li></ul><h2 id="2-1-安装-mysql"><a href="#2-1-安装-mysql" class="headerlink" title="2.1 安装 mysql"></a>2.1 安装 mysql</h2><h3 id="2-1-1-安装命令"><a href="#2-1-1-安装命令" class="headerlink" title="2.1.1 安装命令"></a>2.1.1 安装命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> docker run -d \<br>  --name mysql \<br>  -p 3306:3306 \<br>  -e TZ=Asia/Shanghai \<br>  -e MYSQL_ROOT_PASSWORD=123 \<br>  mysql<br></code></pre></td></tr></table></figure><h3 id="2-1-2-命令参数解读"><a href="#2-1-2-命令参数解读" class="headerlink" title="2.1.2 命令参数解读"></a>2.1.2 命令参数解读</h3><p>这里对命令各个参数的解释如下：</p><ul><li><p><code>sudo docker run -d</code></p><ul><li><code>docker run</code>：创建并启动一个新的容器。</li><li><code>-d</code>：以后台（守护进程）模式运行容器。</li></ul></li><li><p><code>--name mysql</code><br>指定容器的名字为 “mysql”，方便后续管理和使用容器。</p></li><li><p><code>-p 3306:3306</code> : 设置端口映射。</p><ul><li>容器是隔离环境，外界不可访问。但是可以将宿主机端口映射容器内到端口，当访问宿主机指定端口时，就是在访问容器内的端口了。</li><li>容器内端口往往是由容器内的进程决定，例如 MySQL 进程默认端口是 3306，因此容器内端口一定是 3306；而宿主机端口则可以任意指定，一般与容器内保持一致。</li><li>格式： -p 宿主机端口:容器内端口，示例中就是将宿主机的 3306 映射到容器内的 3306 端口</li></ul></li><li><p><code>-e TZ=Asia/Shanghai</code> : 配置容器内进程运行时的一些参数</p><ul><li>格式：-e KEY&#x3D;VALUE，KEY 和 VALUE 都由容器内进程决定</li><li>案例中，TZ&#x3D;Asia&#x2F;Shanghai 是设置时区；MYSQL_ROOT_PASSWORD&#x3D;123 是设置 MySQL 默认密码</li></ul></li><li><p><code>mysql</code> : 设置镜像名称，Docker 会根据这个名字搜索并下载镜像</p><ul><li>格式：REPOSITORY:TAG，例如 mysql:8.0，其中 REPOSITORY 可以理解为镜像名，TAG 是版本号</li><li>在未指定 TAG 的情况下，默认是最新版本，也就是 mysql:latest</li></ul></li></ul><h2 id="2-2-常用命令"><a href="#2-2-常用命令" class="headerlink" title="2.2 常用命令"></a>2.2 常用命令</h2><h3 id="2-2-1-命令介绍"><a href="#2-2-1-命令介绍" class="headerlink" title="2.2.1 命令介绍"></a>2.2.1 命令介绍</h3><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>docker pull</code></td><td>拉取镜像</td></tr><tr><td><code>docker push</code></td><td>推送镜像到 Docker Registry</td></tr><tr><td><code>docker images</code></td><td>查看本地镜像</td></tr><tr><td><code>docker rmi</code></td><td>删除本地镜像</td></tr><tr><td><code>docker run</code></td><td>创建并运行容器（不能重复创建）</td></tr><tr><td><code>docker stop</code></td><td>停止指定容器</td></tr><tr><td><code>docker start</code></td><td>启动指定容器</td></tr><tr><td><code>docker restart</code></td><td>重新启动容器</td></tr><tr><td><code>docker rm</code></td><td>删除指定容器</td></tr><tr><td><code>docker ps</code></td><td>查看运行中的容器（-a 查看全部）</td></tr><tr><td><code>docker logs</code></td><td>查看容器运行日志</td></tr><tr><td><code>docker exec</code></td><td>进入容器</td></tr><tr><td><code>docker save</code></td><td>保存镜像到本地压缩文件</td></tr><tr><td><code>docker load</code></td><td>加载本地压缩文件到镜像</td></tr><tr><td><code>docker inspect</code></td><td>查看容器详细信息</td></tr></tbody></table><p>用一张图表示它们之间的关系<br><img src="https://s2.loli.net/2025/02/24/X6CpfRA3mSoMWzV.png" alt="image.png"></p><h3 id="2-2-2-以安装-ngnix-为例"><a href="#2-2-2-以安装-ngnix-为例" class="headerlink" title="2.2.2 以安装 ngnix 为例"></a>2.2.2 以安装 ngnix 为例</h3><blockquote><p>如果报错了可以在命令之前加个 sudo。Docker 守护进程默认情况下需要超级用户权限才能访问。<br>感觉这样有点麻烦，可以将当前用户添加到 docker 组就不用每个命令都加 sudo 了,之后记得重启一下系统</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> usermod -aG docker <span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 第1步，去DockerHub查看nginx镜像仓库及相关信息</span><br><br><span class="hljs-comment"># 第2步，拉取Nginx镜像</span><br>docker pull nginx<br><br><span class="hljs-comment"># 第3步，查看镜像</span><br>docker images<br><span class="hljs-comment"># 结果如下：</span><br>REPOSITORY   TAG       IMAGE ID       CREATED         SIZE<br>nginx        latest    605c77e624dd   16 months ago   141MB<br>mysql        latest    3218b38490ce   17 months ago   516MB<br><br><span class="hljs-comment"># 第4步，创建并允许Nginx容器</span><br>docker run -d --name nginx -p 80:80 nginx<br><br><span class="hljs-comment"># 第5步，查看运行中容器</span><br>docker ps<br><span class="hljs-comment"># 也可以加格式化方式访问，格式会更加清爽</span><br>docker ps --format <span class="hljs-string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span><br><br><span class="hljs-comment"># 第6步，访问网页，地址：http://虚拟机地址</span><br><br><span class="hljs-comment"># 第7步，停止容器</span><br>docker stop nginx<br><br><span class="hljs-comment"># 第8步，查看所有容器</span><br>docker ps -a --format <span class="hljs-string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span><br><br><span class="hljs-comment"># 第9步，再次启动nginx容器</span><br>docker start nginx<br><br><span class="hljs-comment"># 第10步，再次查看容器</span><br>docker ps --format <span class="hljs-string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span><br><br><span class="hljs-comment"># 第11步，查看容器详细信息</span><br>docker inspect nginx<br><br><span class="hljs-comment"># 第12步，进入容器,查看容器内目录</span><br>docker <span class="hljs-built_in">exec</span> -it nginx bash<br><span class="hljs-comment"># 或者，可以进入MySQL</span><br>docker <span class="hljs-built_in">exec</span> -it mysql mysql -uroot -p<br><br><span class="hljs-comment"># 第13步，删除容器</span><br>docker <span class="hljs-built_in">rm</span> nginx<br><span class="hljs-comment"># 发现无法删除，因为容器运行中，强制删除容器</span><br>docker <span class="hljs-built_in">rm</span> -f nginx<br></code></pre></td></tr></table></figure><h2 id="2-3-数据卷"><a href="#2-3-数据卷" class="headerlink" title="2.3 数据卷"></a>2.3 数据卷</h2><p>容器是隔离环境，容器内程序的文件、配置、运行时产生的容器都在容器内部，我们要读写容器内的文件非常不方便。大家思考几个问题：</p><ul><li>如果要升级 MySQL 版本，需要销毁旧容器，那么数据岂不是跟着被销毁了？</li><li>MySQL、Nginx 容器运行后，如果我要修改其中的某些配置该怎么办？</li><li>我想要让 Nginx 代理我的静态资源怎么办？</li></ul><p>因此，容器提供程序的运行环境，但是程序运行产生的数据、程序运行依赖的配置都应该与容器解耦。</p><h3 id="2-3-1-什么是数据卷"><a href="#2-3-1-什么是数据卷" class="headerlink" title="2.3.1 什么是数据卷"></a>2.3.1 什么是数据卷</h3><p>数据卷（volume）是一个虚拟目录，是容器内目录与宿主机目录之间映射的桥梁。它们之间的关联叫做挂载。<br>简单来说操作宿主机的内容就可以更改容器内的内容，操作容器内的内容也可以更改宿主机的内容。</p><p>&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes 这个目录就是默认的存放所有容器数据卷的目录，其下再根据数据卷名称创建新目录，格式为&#x2F;数据卷名&#x2F;_data。</p><blockquote><p>注意：容器与数据卷的挂载要在创建容器时配置，对于创建好的容器，是不能设置数据卷的。而且创建容器的过程中，数据卷会自动创建。</p></blockquote><h3 id="2-3-2-数据卷的常用命令"><a href="#2-3-2-数据卷的常用命令" class="headerlink" title="2.3.2 数据卷的常用命令"></a>2.3.2 数据卷的常用命令</h3><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>docker volume create</code></td><td>创建数据卷</td></tr><tr><td><code>docker volume ls</code></td><td>查看所有数据卷</td></tr><tr><td><code>docker volume rm</code></td><td>删除指定数据卷</td></tr><tr><td><code>docker volume inspect</code></td><td>查看某个数据卷的详情</td></tr><tr><td><code>docker volume prune</code></td><td>清除数据卷</td></tr></tbody></table><p>示例：nginx 的 html 目录挂载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.首先创建容器并指定数据卷，注意通过 -v 参数来指定数据卷</span><br>docker run -d --name nginx -p 80:80 -v html:/usr/share/nginx/html nginx<br><br><span class="hljs-comment"># 2.然后查看数据卷</span><br>docker volume <span class="hljs-built_in">ls</span><br><span class="hljs-comment"># 结果</span><br>DRIVER    VOLUME NAME<br><span class="hljs-built_in">local</span>     2dacf60661c98b13c9d8540bf1562fb8120de940b3a45a46891ec2b029a60628<br><span class="hljs-built_in">local</span>     html<br><br><br><span class="hljs-comment"># 3.查看数据卷详情</span><br>docker volume inspect html<br><span class="hljs-comment"># 结果</span><br>[<br>    &#123;<br>        <span class="hljs-string">&quot;CreatedAt&quot;</span>: <span class="hljs-string">&quot;2025-02-24T16:21:28+08:00&quot;</span>,<br>        <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;local&quot;</span>,<br>        <span class="hljs-string">&quot;Labels&quot;</span>: null,<br>        <span class="hljs-string">&quot;Mountpoint&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/volumes/html/_data&quot;</span>,<br>        <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;html&quot;</span>,<br>        <span class="hljs-string">&quot;Options&quot;</span>: null,<br>        <span class="hljs-string">&quot;Scope&quot;</span>: <span class="hljs-string">&quot;local&quot;</span><br>    &#125;<br>]<br><br><br><span class="hljs-comment"># 4.查看/var/lib/docker/volumes/html/_data目录</span><br>ll /var/lib/docker/volumes/html/_data<br><span class="hljs-comment"># 可以看到与nginx的html目录内容一样，结果如下：</span><br>root@elysia:~# ll /var/lib/docker/volumes/html/_data<br>total 16<br>drwxr-xr-x 2 root root 4096 2月  24 16:21 ./<br>drwx-----x 3 root root 4096 2月  24 16:21 ../<br>-rw-r--r-- 1 root root  497 2月   5 19:06 50x.html<br>-rw-r--r-- 1 root root  615 2月   5 19:06 index.html<br><br><br><span class="hljs-comment"># 5.进入该目录，并随意修改index.html内容</span><br><span class="hljs-built_in">cd</span> /var/lib/docker/volumes/html/_data<br>vi index.html<br><br><span class="hljs-comment"># 6.打开页面，查看效果</span><br><br><span class="hljs-comment"># 7.进入容器内部，查看/usr/share/nginx/html目录内的文件是否变化</span><br>docker <span class="hljs-built_in">exec</span> -it nginx bash<br></code></pre></td></tr></table></figure><h3 id="2-3-3-挂载本地目录或文件"><a href="#2-3-3-挂载本地目录或文件" class="headerlink" title="2.3.3 挂载本地目录或文件"></a>2.3.3 挂载本地目录或文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 挂载本地目录</span><br>-v 本地目录:容器内目录<br><span class="hljs-comment"># 挂载本地文件</span><br>-v 本地文件:容器内文件<br></code></pre></td></tr></table></figure><blockquote><p>注意：本地目录或文件必须以 &#x2F; 或 .&#x2F;开头，如果直接以名字开头，会被识别为数据卷名而非本地目录名。<br>如果无权复制文件到容器内，可以使用 chown 命令修改文件的所属用户和组。<br>或者直接用 root 权限连接，省的麻烦。<a href="https://blog.csdn.net/logani/article/details/126806571">root 连接教程</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> -R yourusername:yourusername /path/to/target/directory<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.删除原来的MySQL容器</span><br>docker <span class="hljs-built_in">rm</span> -f mysql<br><br><span class="hljs-comment"># 2.进入root目录</span><br><span class="hljs-built_in">cd</span> ~<br><br><span class="hljs-comment"># 3.创建并运行新mysql容器，挂载本地目录</span><br>docker run -d \<br>  --name mysql \<br>  -p 3306:3306 \<br>  -e TZ=Asia/Shanghai \<br>  -e MYSQL_ROOT_PASSWORD=123 \<br>  -v ./mysql/data:/var/lib/mysql \<br>  -v ./mysql/conf:/etc/mysql/conf.d \<br>  -v ./mysql/init:/docker-entrypoint-initdb.d \<br>  mysql<br><br><span class="hljs-comment"># 4.查看root目录，可以发现~/mysql/data目录已经自动创建好了</span><br><span class="hljs-built_in">ls</span> -l mysql<br><span class="hljs-comment"># 结果：</span><br><br>总用量 12<br>drwxr-xr-x 2 root             root 4096 2月  26 23:03 conf<br>drwxr-xr-x 8 systemd-coredump root 4096 2月  26 23:07 data<br>drwxr-xr-x 2 root             root 4096 2月  26 23:03 init<br><br><br><span class="hljs-comment"># 查看data目录，会发现里面有大量数据库数据，说明数据库完成了初始化</span><br><span class="hljs-built_in">ls</span> -l data<br><br><span class="hljs-comment"># 5.查看MySQL容器内数据</span><br><span class="hljs-comment"># 5.1.进入MySQL</span><br>docker <span class="hljs-built_in">exec</span> -it mysql mysql -uroot -p123<br><span class="hljs-comment"># 5.2.查看编码表</span><br>show variables like <span class="hljs-string">&quot;%char%&quot;</span>;<br><span class="hljs-comment"># 5.3.结果，发现编码是utf8mb4没有问题</span><br>+--------------------------+--------------------------------+<br>| Variable_name            | Value                          |<br>+--------------------------+--------------------------------+<br>| character_set_client     | utf8mb4                        |<br>| character_set_connection | utf8mb4                        |<br>| character_set_database   | utf8mb4                        |<br>| character_set_filesystem | binary                         |<br>| character_set_results    | utf8mb4                        |<br>| character_set_server     | utf8mb4                        |<br>| character_set_system     | utf8mb3                        |<br>| character_sets_dir       | /usr/share/mysql-8.0/charsets/ |<br>+--------------------------+--------------------------------+<br><br><span class="hljs-comment"># 6.查看数据</span><br><span class="hljs-comment"># 6.1.查看数据库</span><br>show databases;<br><span class="hljs-comment"># 结果，hmall是黑马商城数据库</span><br>+--------------------+<br>| Database           |<br>+--------------------+<br>| hmall              |<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><span class="hljs-comment"># 6.2.切换到hmall数据库</span><br>use hmall;<br><span class="hljs-comment"># 6.3.查看表</span><br>show tables;<br><span class="hljs-comment"># 结果：</span><br>+-----------------+<br>| Tables_in_hmall |<br>+-----------------+<br>| address         |<br>| cart            |<br>| item            |<br>| order           |<br>| order_detail    |<br>| order_logistics |<br>| pay_order       |<br>| user            |<br>+-----------------+<br><span class="hljs-comment"># 6.4.查看address表数据</span><br>+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+<br>| <span class="hljs-built_in">id</span> | user_id | province | city   | town     | mobile      | street        | contact   | is_default | notes |<br>+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+<br>| 59 |       1 | 北京     | 北京   | 朝阳区    | 13900112222 | 金燕龙办公楼   | 李佳诚    | 0          | NULL  |<br>| 60 |       1 | 北京     | 北京   | 朝阳区    | 13700221122 | 修正大厦       | 李佳红    | 0          | NULL  |<br>| 61 |       1 | 上海     | 上海   | 浦东新区  | 13301212233 | 航头镇航头路   | 李佳星    | 1          | NULL  |<br>| 63 |       1 | 广东     | 佛山   | 永春      | 13301212233 | 永春武馆       | 李晓龙    | 0          | NULL  |<br>+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="2-4-镜像"><a href="#2-4-镜像" class="headerlink" title="2.4 镜像"></a>2.4 镜像</h2><h3 id="2-4-1-镜像结构"><a href="#2-4-1-镜像结构" class="headerlink" title="2.4.1 镜像结构"></a>2.4.1 镜像结构</h3><p>镜像就是一堆文件的集合。<br>但需要注意的是，镜像文件不是随意堆放的，而是按照操作的步骤分层叠加而成，每一层形成的文件都会单独打包并标记一个唯一 id，称为 Layer（层）。这样，如果我们构建时用到的某些层其他人已经制作过，就可以直接拷贝使用这些层，而不用重复制作。<br><img src="https://s2.loli.net/2025/02/26/dcYFOhfP4VEpzqm.png" alt="image.png"></p><h3 id="2-4-2-Dockerfile"><a href="#2-4-2-Dockerfile" class="headerlink" title="2.4.2 Dockerfile"></a>2.4.2 Dockerfile</h3><p>由于制作镜像的过程中，需要逐层处理和打包，比较复杂，所以 Docker 就提供了自动打包镜像的功能。我们只需要将打包的过程，每一层要做的事情用固定的语法写下来，交给 Docker 去执行即可。<br>而这种记录镜像结构的文件就称为 Dockerfile，其对应的语法可以参考官方文档：<br><a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p><table><thead><tr><th>指令</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>FROM</td><td>指定基础镜像</td><td>FROM centos:6</td></tr><tr><td>ENV</td><td>设置环境变量，可在后面指令使用</td><td>ENV key value</td></tr><tr><td>COPY</td><td>拷贝本地文件到镜像的指定目录</td><td>COPY .&#x2F;xx.jar &#x2F;tmp&#x2F;app.jar</td></tr><tr><td>RUN</td><td>执行 Linux 的 shell 命令，一般是安装过程的命令</td><td>RUN yum install gcc</td></tr><tr><td>EXPOSE</td><td>指定容器运行时监听的端口，是给镜像使用者看的</td><td>EXPOSE 8080</td></tr><tr><td>ENTRYPOINT</td><td>镜像中应用的启动命令，容器运行时调用</td><td>ENTRYPOINT java -jar xx.jar</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基础镜像</span><br>FROM openjdk:11.0-jre-buster<br><span class="hljs-comment"># 设定时区</span><br>ENV TZ=Asia/Shanghai<br>RUN <span class="hljs-built_in">ln</span> -snf /usr/share/zoneinfo/<span class="hljs-variable">$TZ</span> /etc/localtime &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-variable">$TZ</span> &gt; /etc/timezone<br><span class="hljs-comment"># 拷贝jar包</span><br>COPY docker-demo.jar /app.jar<br><span class="hljs-comment"># 入口</span><br>ENTRYPOINT [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>, <span class="hljs-string">&quot;/app.jar&quot;</span>]<br></code></pre></td></tr></table></figure><h3 id="2-4-3-制作镜像"><a href="#2-4-3-制作镜像" class="headerlink" title="2.4.3 制作镜像"></a>2.4.3 制作镜像</h3><p>将提供的 docker-demo.jar 包以及 Dockerfile 拷贝到虚拟机的&#x2F;root&#x2F;demo 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 进入镜像目录</span><br><span class="hljs-built_in">cd</span> /root/demo<br><span class="hljs-comment"># 开始构建</span><br>docker build -t docker-demo:1.0 .<br></code></pre></td></tr></table></figure><ul><li>docker build : 就是构建一个 docker 镜像</li><li>-t docker-demo:1.0 ：-t 参数是指定镜像的名称（repository 和 tag）</li><li>. : 最后的点是指构建时 Dockerfile 所在路径，由于我们进入了 demo 目录，所以指定的是.代表当前目录，也可以直接指定 Dockerfile 目录：</li></ul><p>运行这个镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.创建并运行容器</span><br>docker run -d --name <span class="hljs-built_in">dd</span> -p 8080:8080 docker-demo:1.0<br><span class="hljs-comment"># 2.查看容器</span><br>dps<br><span class="hljs-comment"># 结果</span><br>CONTAINER ID   IMAGE             PORTS                                                  STATUS         NAMES<br>78a000447b49   docker-demo:1.0   0.0.0.0:8080-&gt;8080/tcp, :::8090-&gt;8090/tcp              Up 2 seconds   <span class="hljs-built_in">dd</span><br>f63cfead8502   mysql             0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   Up 2 hours     mysql<br><br><span class="hljs-comment"># 3.访问</span><br>curl localhost:8080/hello/count<br><span class="hljs-comment"># 结果：</span><br>&lt;h5&gt;欢迎访问黑马商城, 这是您第1次访问&lt;h5&gt;<br></code></pre></td></tr></table></figure><h2 id="2-5-网络"><a href="#2-5-网络" class="headerlink" title="2.5 网络"></a>2.5 网络</h2><p>我们创建了一个 Java 项目的容器，而 Java 项目往往需要访问其它各种中间件，例如 MySQL、Redis 等。现在，我们的容器之间能否互相访问呢？我们来测试一下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 1.用基本命令，寻找Networks.bridge.IPAddress属性</span><br>docker inspect mysql<br><span class="hljs-comment"># 也可以使用format过滤结果</span><br>docker inspect --format=<span class="hljs-string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;println .IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> mysql<br><span class="hljs-comment"># 得到IP地址如下：</span><br>172.17.0.2<br><br><span class="hljs-comment"># 2.然后通过命令进入dd容器</span><br>docker <span class="hljs-built_in">exec</span> -it <span class="hljs-built_in">dd</span> bash<br><br><span class="hljs-comment"># 3.在容器内，通过ping命令测试网络</span><br>ping 172.17.0.2<br><span class="hljs-comment"># 结果</span><br>PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.<br>64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 <span class="hljs-keyword">time</span>=0.053 ms<br>64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 <span class="hljs-keyword">time</span>=0.059 ms<br>64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 <span class="hljs-keyword">time</span>=0.058 ms<br></code></pre></td></tr></table></figure><p>发现可以互联，没有问题。</p><p>但是，容器的网络 IP 其实是一个虚拟的 IP，其值并不固定与某一个容器绑定，如果我们在开发时写死某个 IP，而在部署时很可能 MySQL 容器的 IP 会发生变化，连接会失败。</p><p>所以，我们必须借助于 docker 的网络功能来解决这个问题，<a href="https://docs.docker.com/engine/reference/commandline/network/">官方文档</a></p><p>常见命令有：</p><table><thead><tr><th>命令</th><th>说明</th><th>文档地址</th></tr></thead><tbody><tr><td>docker network create</td><td>创建一个网络</td><td>docker network create</td></tr><tr><td>docker network ls</td><td>查看所有网络</td><td>docs.docker.com</td></tr><tr><td>docker network rm</td><td>删除指定网络</td><td>docs.docker.com</td></tr><tr><td>docker network prune</td><td>清除未使用的网络</td><td>docs.docker.com</td></tr><tr><td>docker network connect</td><td>使指定容器连接加入某网络</td><td>docs.docker.com</td></tr><tr><td>docker network disconnect</td><td>使指定容器连接离开某网络</td><td>docker network disconnect</td></tr><tr><td>docker network inspect</td><td>查看网络详细信息</td><td>docker network inspect</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.首先通过命令创建一个网络</span><br>docker network create hmall<br><br><span class="hljs-comment"># 2.然后查看网络</span><br>docker network <span class="hljs-built_in">ls</span><br><span class="hljs-comment"># 结果：</span><br><br>NETWORK ID     NAME                        DRIVER    SCOPE<br>bb101b739304   bridge                      bridge    <span class="hljs-built_in">local</span><br>7a34682225aa   hmall                       bridge    <span class="hljs-built_in">local</span><br>9bd1d9580837   host                        host      <span class="hljs-built_in">local</span><br>89cd2e5269ff   none                        null      <span class="hljs-built_in">local</span><br>f7d1b6b61018   onlinejudgedeploy_default   bridge    <span class="hljs-built_in">local</span><br><br><span class="hljs-comment"># 其中，除了hmall和我的OJ以外，其它都是默认的网络</span><br><br><span class="hljs-comment"># 3.让dd和mysql都加入该网络，注意，在加入网络时可以通过--alias给容器起别名</span><br><span class="hljs-comment"># 这样该网络内的其它容器可以用别名互相访问！</span><br><span class="hljs-comment"># 3.1.mysql容器，指定别名为db，另外每一个容器都有一个别名是容器名</span><br>docker network connect hmall mysql --<span class="hljs-built_in">alias</span> db<br><span class="hljs-comment"># 3.2.db容器，也就是我们的java项目</span><br>docker network connect hmall <span class="hljs-built_in">dd</span><br><br><span class="hljs-comment"># 4.进入dd容器，尝试利用别名访问db</span><br><span class="hljs-comment"># 4.1.进入容器</span><br>docker <span class="hljs-built_in">exec</span> -it <span class="hljs-built_in">dd</span> bash<br><span class="hljs-comment"># 4.2.用db别名访问</span><br>ping db<br><span class="hljs-comment"># 结果</span><br>PING db (172.18.0.2) 56(84) bytes of data.<br>64 bytes from mysql.hmall (172.18.0.2): icmp_seq=1 ttl=64 <span class="hljs-keyword">time</span>=0.070 ms<br>64 bytes from mysql.hmall (172.18.0.2): icmp_seq=2 ttl=64 <span class="hljs-keyword">time</span>=0.056 ms<br><span class="hljs-comment"># 4.3.用容器名访问</span><br>ping mysql<br><span class="hljs-comment"># 结果：</span><br>PING mysql (172.18.0.2) 56(84) bytes of data.<br>64 bytes from mysql.hmall (172.18.0.2): icmp_seq=1 ttl=64 <span class="hljs-keyword">time</span>=0.044 ms<br>64 bytes from mysql.hmall (172.18.0.2): icmp_seq=2 ttl=64 <span class="hljs-keyword">time</span>=0.054 ms<br></code></pre></td></tr></table></figure><h1 id="3-JAVA-项目部署-Docker-Compose"><a href="#3-JAVA-项目部署-Docker-Compose" class="headerlink" title="3.JAVA 项目部署(Docker Compose)"></a>3.JAVA 项目部署(Docker Compose)</h1><h2 id="3-1-Docker-Compose"><a href="#3-1-Docker-Compose" class="headerlink" title="3.1 Docker Compose"></a>3.1 Docker Compose</h2><p>Docker Compose 可以帮助我们实现多个相互关联的 Docker 容器的快速部署。它允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器。</p><p>docker-compose 文件中可以定义多个相互关联的应用容器，每一个应用容器被称为一个服务（service）。由于 service 就是在定义某个应用的运行时参数，因此与 docker run 参数非常相似。</p><table><thead><tr><th><code>docker run</code> 参数</th><th><code>docker compose</code> 指令</th><th>说明</th></tr></thead><tbody><tr><td>–name</td><td>container_name</td><td>容器名称</td></tr><tr><td>-p</td><td>ports</td><td>端口映射</td></tr><tr><td>-e</td><td>environment</td><td>环境变量</td></tr><tr><td>-v</td><td>volumes</td><td>数据卷配置</td></tr><tr><td>–network</td><td>networks</td><td>网络</td></tr></tbody></table><p>举例来说，用 docker run 部署 MySQL 的命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  --name mysql \<br>  -p 3306:3306 \<br>  -e TZ=Asia/Shanghai \<br>  -e MYSQL_ROOT_PASSWORD=123 \<br>  -v ./mysql/data:/var/lib/mysql \<br>  -v ./mysql/conf:/etc/mysql/conf.d \<br>  -v ./mysql/init:/docker-entrypoint-initdb.d \<br>  --network hmall<br>  mysql<br></code></pre></td></tr></table></figure><p>如果用 docker-compose.yml 文件来定义，就是这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">version: <span class="hljs-string">&quot;3.8&quot;</span><br><br>services:<br>  mysql:<br>    image: mysql<br>    container_name: mysql<br>    ports:<br>      - <span class="hljs-string">&quot;3306:3306&quot;</span><br>    environment:<br>      TZ: Asia/Shanghai<br>      MYSQL_ROOT_PASSWORD: 123<br>    volumes:<br>      - <span class="hljs-string">&quot;./mysql/conf:/etc/mysql/conf.d&quot;</span><br>      - <span class="hljs-string">&quot;./mysql/data:/var/lib/mysql&quot;</span><br>    networks:<br>      - new<br>networks:<br>  new:<br>    name: hmall<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyBatisPlus使用</title>
    <link href="/2025/02/23/MyBatisPlus%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/02/23/MyBatisPlus%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="1-使用步骤"><a href="#1-使用步骤" class="headerlink" title="1. 使用步骤"></a>1. 使用步骤</h1><h2 id="1-1-引入-MyBatisPlus-依赖"><a href="#1-1-引入-MyBatisPlus-依赖" class="headerlink" title="1.1 引入 MyBatisPlus 依赖"></a>1.1 引入 MyBatisPlus 依赖</h2><p>MyBatisPlus 官方提供了 starter，其中集成了 Mybatis 和 MybatisPlus 的所有功能，并且实现了自动装配效果。<br>因此我们可以用 MybatisPlus 的 starter 代替 Mybatis 的 starter：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;&gt;</span>dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="1-2-定义-Mapper"><a href="#1-2-定义-Mapper" class="headerlink" title="1.2 定义 Mapper"></a>1.2 定义 Mapper</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-3-常用注解"><a href="#1-3-常用注解" class="headerlink" title="1.3 常用注解"></a>1.3 常用注解</h2><p>MyBatisPlus 通过扫描实体类，并基于反射获取实体类信息作为数据库表信息。</p><ul><li>类名驼峰转下划线作为表名</li><li>名为 id 的字段作为主键</li><li>变量名驼峰转下划线作为字段名</li></ul><p>MybatisPlus 中比较常用的几个注解如下：</p><ul><li>@TableName：用来指定表名</li><li>@TableId：用来指定表中的主键字段信息</li><li>@TableField：用来指定表中的普通字段信息</li></ul><p>其中 TableId 支持两个属性：value（指定主键名）和 type（指定主键生成策略）。<br>IdType 枚举：</p><ul><li>AUTO：数据库自增长（如果想要主键自增需要指定为 AUTO，否则默认的方法是第三种雪花算法）</li><li>INPUT：通过 set 方法自行输入</li><li>ASSIGN_ID：分配 ID，接口 IdentifierGenerator 的方法 nextId 来生成 id，默认实现类为 DefaultIdentifierGenerator 雪花算法</li></ul><p>使用@TableField 的常见场景：</p><ul><li>成员变量名与数据库字段名不一致</li><li>成员变量名以 is 开头，且是布尔值（反射的时候会把 is 去掉，所以需要指定）</li><li>成员变量名与数据库关键字冲突（例如 order 需要转义为`order&#96;）</li><li>成员变量不是数据库字段（指定 exist&#x3D;false）</li></ul><h2 id="1-4-常见配置"><a href="#1-4-常见配置" class="headerlink" title="1.4 常见配置"></a>1.4 常见配置</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.itheima.mp.domain.po</span> <span class="hljs-comment"># 实体类包名</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">&quot;classpath*:/mapper/**/*.xml&quot;</span> <span class="hljs-comment"># Mapper.xml文件地址，当前这个是默认值。</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启下划线到驼峰命名转换</span><br>    <span class="hljs-attr">cache-enabled:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 关闭二级缓存</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span> <span class="hljs-comment"># 全局id类型为自增长</span><br>      <span class="hljs-attr">update-strategy:</span> <span class="hljs-string">not_null</span> <span class="hljs-comment"># 全局更新填充字段策略,只更新非null字段</span><br></code></pre></td></tr></table></figure><h1 id="2-核心功能"><a href="#2-核心功能" class="headerlink" title="2. 核心功能"></a>2. 核心功能</h1><h2 id="2-1-条件构造器"><a href="#2-1-条件构造器" class="headerlink" title="2.1 条件构造器"></a>2.1 条件构造器</h2><p>除了新增以外，修改、删除、查询的 SQL 语句都需要指定 where 条件。因此 BaseMapper 中提供的相关方法除了以 id 作为 where 条件以外，还支持更加复杂的 where 条件。</p><h3 id="2-1-1-QueryWrapper"><a href="#2-1-1-QueryWrapper" class="headerlink" title="2.1.1.QueryWrapper"></a>2.1.1.QueryWrapper</h3><p><img src="https://s2.loli.net/2025/02/23/SekuP1oDMU7gcIl.png" alt="image.png"><br>查询：查询出名字中带 o 的，存款大于等于 1000 元的人。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testQueryWrapper</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.构建查询条件 where name like &quot;%o%&quot; AND balance &gt;= 1000</span><br>    QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;()<br>            .select(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;info&quot;</span>, <span class="hljs-string">&quot;balance&quot;</span>)<br>            .like(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;o&quot;</span>)<br>            .ge(<span class="hljs-string">&quot;balance&quot;</span>, <span class="hljs-number">1000</span>);<br>    <span class="hljs-comment">// 2.查询数据</span><br>    List&lt;User&gt; users = userMapper.selectList(wrapper);<br>    users.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><p>更新：更新用户名为 jack 的用户的余额为 2000，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateByQueryWrapper</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.构建查询条件 where name = &quot;Jack&quot;</span><br>    QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;Jack&quot;</span>);<br>    <span class="hljs-comment">// 2.更新数据，user中非null字段都会作为set语句</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    user.setBalance(<span class="hljs-number">2000</span>);<br>    userMapper.update(user, wrapper);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-1-2-UpdateWrapper"><a href="#2-1-2-UpdateWrapper" class="headerlink" title="2.1.2.UpdateWrapper"></a>2.1.2.UpdateWrapper</h3><p>基于 BaseMapper 中的 update 方法更新时只能直接赋值，对于一些复杂的需求就难以实现。<br>例如：更新 id 为 1,2,4 的用户的余额，扣 200<br>SET 的赋值结果是基于字段现有值的，这个时候就要利用 UpdateWrapper 中的 setSql 功能了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateWrapper</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Long&gt; ids = List.of(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">4L</span>);<br>    <span class="hljs-comment">// 1.生成SQL</span><br>    UpdateWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateWrapper</span>&lt;User&gt;()<br>            .setSql(<span class="hljs-string">&quot;balance = balance - 200&quot;</span>) <span class="hljs-comment">// SET balance = balance - 200</span><br>            .in(<span class="hljs-string">&quot;id&quot;</span>, ids); <span class="hljs-comment">// WHERE id in (1, 2, 4)</span><br>        <span class="hljs-comment">// 2.更新，注意第一个参数可以给null，也就是不填更新字段和数据，</span><br>    <span class="hljs-comment">// 而是基于UpdateWrapper中的setSQL来更新</span><br>    userMapper.update(<span class="hljs-literal">null</span>, wrapper);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-1-3-LambdaQueryWrapper"><a href="#2-1-3-LambdaQueryWrapper" class="headerlink" title="2.1.3.LambdaQueryWrapper"></a>2.1.3.LambdaQueryWrapper</h3><p>无论是 QueryWrapper 还是 UpdateWrapper 在构造条件的时候都需要写死字段名称，不推荐。<br>那么如何获取字段名？<br>其中一种办法是基于变量的 gettter 方法结合反射技术。因此我们只要将条件对应的字段的 getter 方法传递给 MybatisPlus，它就能计算出对应的变量名了。而传递方法可以使用 JDK8 中的方法引用和 Lambda 表达式。<br>因此 MybatisPlus 又提供了一套基于 Lambda 的 Wrapper，包含两个：</p><ul><li>LambdaQueryWrapper</li><li>LambdaUpdateWrapper<br>分别对应 QueryWrapper 和 UpdateWrapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testLambdaQueryWrapper</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.构建条件 WHERE username LIKE &quot;%o%&quot; AND balance &gt;= 1000</span><br>    QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>    wrapper.lambda()<br>            .select(User::getId, User::getUsername, User::getInfo, User::getBalance)<br>            .like(User::getUsername, <span class="hljs-string">&quot;o&quot;</span>)<br>            .ge(User::getBalance, <span class="hljs-number">1000</span>);<br>    <span class="hljs-comment">// 2.查询</span><br>    List&lt;User&gt; users = userMapper.selectList(wrapper);<br>    users.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-2-自定义-SQL"><a href="#2-2-自定义-SQL" class="headerlink" title="2.2.自定义 SQL"></a>2.2.自定义 SQL</h2><p>SQL 语句最好都维护在持久层，而不是业务层。就当前案例来说，由于条件是 in 语句，只能将 SQL 写在 Mapper.xml 文件，利用 foreach 来生成动态 SQL。<br>这实在是太麻烦了。假如查询条件更复杂，动态 SQL 的编写也会更加复杂。</p><p>所以，MybatisPlus 提供了自定义 SQL 功能，可以让我们利用 Wrapper 生成查询条件，再结合 Mapper.xml 编写 SQL</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testCustomWrapper</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.准备自定义查询条件</span><br>    List&lt;Long&gt; ids = List.of(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">4L</span>);<br>    QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;().in(<span class="hljs-string">&quot;id&quot;</span>, ids);<br><br>    <span class="hljs-comment">// 2.调用mapper的自定义方法，直接传递Wrapper</span><br>    userMapper.deductBalanceByIds(<span class="hljs-number">200</span>, wrapper);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.mapper;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.User;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Param;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Update;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Param;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br>    <span class="hljs-meta">@Select(&quot;UPDATE user SET balance = balance - #&#123;money&#125; $&#123;ew.customSqlSegment&#125;&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductBalanceByIds</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;money&quot;)</span> <span class="hljs-type">int</span> money, <span class="hljs-meta">@Param(&quot;ew&quot;)</span> QueryWrapper&lt;User&gt; wrapper)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-3-Service-接口"><a href="#2-3-Service-接口" class="headerlink" title="2.3 Service 接口"></a>2.3 Service 接口</h2><p>MybatisPlus 不仅提供了 BaseMapper，还提供了通用的 Service 接口及默认实现，封装了一些常用的 service 模板方法。<br>通用接口为 IService，默认实现为 ServiceImpl，其中封装的方法可以分为以下几类：</p><ul><li>save：新增</li><li>remove：删除</li><li>update：更新</li><li>get：查询单个结果</li><li>list：查询集合结果</li><li>count：计数</li><li>page：分页查询</li></ul><h3 id="2-3-2-基本用法"><a href="#2-3-2-基本用法" class="headerlink" title="2.3.2.基本用法"></a>2.3.2.基本用法</h3><p>由于 Service 中经常需要定义与业务有关的自定义方法，因此我们不能直接使用 IService，而是自定义 Service 接口，然后继承 IService 以拓展方法。同时，让自定义的 Service 实现类继承 ServiceImpl，这样就不用自己实现 IService 中的接口了。<br>首先，定义 IUserService，继承 IService：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.User;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;User&gt; &#123;<br>    <span class="hljs-comment">// 拓展自定义方法</span><br>&#125;<br></code></pre></td></tr></table></figure><p>编写 UserServiceImpl 类，继承 ServiceImpl，实现 UserService：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.User;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.service.IUserService;<br><span class="hljs-keyword">import</span> com.itheima.mp.mapper.UserMapper;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt;<br>                                                                                                        <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-3-IService-批量新增"><a href="#2-3-3-IService-批量新增" class="headerlink" title="2.3.3.IService 批量新增"></a>2.3.3.IService 批量新增</h3><p>需求：批量插入 10 万条用户数据，并作出对比：<br>普通 for 循环插入<br>IService 的批量插入<br>开启 rewriteBatchedStatements&#x3D;true 参数</p><p>批处理方案：<br>普通 for 循环逐条插入速度极差，不推荐<br>MP 的批量新增，基于预编译的批处理，性能不错<br>配置 jdbc 参数，开 rewriteBatchedStatements，性能最好</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>MyBatisPlus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>若依搭建</title>
    <link href="/2025/02/18/%E8%8B%A5%E4%BE%9D%E6%90%AD%E5%BB%BA/"/>
    <url>/2025/02/18/%E8%8B%A5%E4%BE%9D%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="若依搭建"><a href="#若依搭建" class="headerlink" title="若依搭建"></a>若依搭建</h1><h2 id="若依版本"><a href="#若依版本" class="headerlink" title="若依版本"></a>若依版本</h2><h3 id="官方"><a href="#官方" class="headerlink" title="官方"></a>官方</h3><p>若依官方针对不同开发需求提供了多个版本的框架，每个版本都有其独特的特点和适用场景：</p><ul><li><strong>前后端混合版本</strong>：RuoYi 结合了 SpringBoot 和 Bootstrap 的前端开发框架，适合快速构建传统的 Web 应用程序，其中前端和后端代码在同一项目中协同工作。</li><li><strong>前后端分离版本</strong>：RuoYi-Vue 利用 SpringBoot 作为后端开发框架，与 Vue.js 结合，实现了前后端分离的开发模式。这种架构有助于提高开发效率，前后端可以独立开发和部署，更适合现代化的 Web 应用开发。</li><li><strong>微服务版本</strong>：RuoYi-Cloud 基于 Spring Cloud &amp; Alibaba 微服务架构，为构建大型分布式系统提供了完整的解决方案。它支持服务发现、配置管理、负载均衡等微服务特性，适合需要高可扩展性和高可用性的企业级应用。</li><li><strong>移动端版本</strong>：RuoYi-App 采用 Uniapp 进行开发，结合了 Vue.js 的优势，可以实现跨平台的移动端应用开发。一次编写，多端运行的能力使得它成为开发 iOS 和 Android 应用的理想选择。</li></ul><p>这些版本的框架为开发者提供了多样化的选择，无论是传统的 Web 应用、现代化的前后端分离应用，还是复杂的微服务架构和跨平台的移动端应用，都能找到合适的若依框架版本来满足开发需求。</p><h3 id="非官方"><a href="#非官方" class="headerlink" title="非官方"></a>非官方</h3><p>若依框架因其强大的功能和灵活性，吸引了众多第三方开发者基于其核心架构进行扩展和优化，从而形成了丰富的生态系统。</p><p>这些扩展不仅增强了若依框架的功能性，也满足了开发者在不同场景下的具体需求。例如：</p><ul><li>RuoYi-Vue3（前端升级 Vue3 Element Plus Vite）<ul><li><a href="https://github.com/yangzongzhuan/RuoYi-Vue3">https://github.com/yangzongzhuan/RuoYi-Vue3</a></li></ul></li><li>RuoYi-Vue-Plus（后端集成 Mybatis-Plus、Hutool、OSS 存储、分布式锁等组件）<ul><li><a href="https://gitee.com/dromara/RuoYi-Vue-Plus">https://gitee.com/dromara/RuoYi-Vue-Plus</a></li></ul></li></ul><h2 id="RuoYi-Vue"><a href="#RuoYi-Vue" class="headerlink" title="RuoYi-Vue"></a>RuoYi-Vue</h2><p>lRuoYi-Vue 版本，采用了前后端分离的单体架构设计：</p><p>软件环境：JDK、MySQL 、Redis 、Maven、Node</p><p>技术选型：Spring Boot、Spring Security、MyBatis、Jwt、Vue3、Element-Plus</p><p>官方地址：<a href="https://gitee.com/y_project/RuoYi-Vue">https://gitee.com/y_project/RuoYi-Vue</a></p><p>扩展地址：<a href="https://gitee.com/ys-gitee/RuoYi-Vue3">https://gitee.com/ys-gitee/RuoYi-Vue3</a></p><table><thead><tr><th><strong>官方推荐</strong></th><th><strong>课程版本</strong></th></tr></thead><tbody><tr><td>JDK &gt;&#x3D; 1.8</td><td>JDK 11</td></tr><tr><td>Mysql &gt;&#x3D; 5.7.0</td><td>MySQL 8</td></tr><tr><td>Redis &gt;&#x3D; 3.0</td><td>Redis 5（Win）</td></tr><tr><td>Maven &gt;&#x3D; 3.0</td><td>Maven 3.6</td></tr><tr><td>Node &gt;&#x3D; 12</td><td>Node 16（Vue3）</td></tr></tbody></table><h2 id="运行后端项目"><a href="#运行后端项目" class="headerlink" title="运行后端项目"></a>运行后端项目</h2><h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><h4 id="Git-下载"><a href="#Git-下载" class="headerlink" title="Git 下载"></a>Git 下载</h4><p>通过 idea 克隆若依源码，仓库地址：<a href="https://gitee.com/y_project/RuoYi-Vue.git">https://gitee.com/y_project/RuoYi-Vue.git</a></p><h4 id="Maven-构建"><a href="#Maven-构建" class="headerlink" title="Maven 构建"></a>Maven 构建</h4><p>使用 idea 打开项目后，等待环境检查（主要是 Maven 下载项目依赖）</p><h3 id="MySQL-相关"><a href="#MySQL-相关" class="headerlink" title="MySQL 相关"></a>MySQL 相关</h3><h4 id="导入-sql"><a href="#导入-sql" class="headerlink" title="导入 sql"></a>导入 sql</h4><p>1、创建数据库<code>create schema ry-vue;</code></p><p>2、执行自带的 sql 脚本文件，完成导入</p><p>3、导入后<code>ry-vue</code>库内置 30 张表</p><h4 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h4><p>在<code>ruoyi-admin</code>模块下，编辑<code>resources</code>目录下的<code>application-druid.yml</code>，修改数据库连接</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 数据源配置</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>    <span class="hljs-attr">driverClassName:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-comment"># 主库数据源</span><br>      <span class="hljs-attr">master:</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">数据库地址</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">数据库账号</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">数据库密码</span><br></code></pre></td></tr></table></figure><h3 id="Redis-相关"><a href="#Redis-相关" class="headerlink" title="Redis 相关"></a>Redis 相关</h3><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><p>在 redis 解压目录下，执行<code>redis-server.exe redis.windows.conf</code>启动</p><h4 id="配置信息-1"><a href="#配置信息-1" class="headerlink" title="配置信息"></a>配置信息</h4><p>在<code>ruoyi-admin</code>模块下，<code>resources</code>目录下的<code>application.yml</code>，可以设置 redis 密码等相关信息</p><h3 id="项目运行"><a href="#项目运行" class="headerlink" title="项目运行"></a>项目运行</h3><p>在<code>ruoyi-admin</code>模块下，运行<code>com.ruoyi.RuoYiApplication.java</code>，出现如下图表示启动成功</p><p><img src="/assets/image-20231115114924549.png" alt="image-20231115114924549"></p><p>后端运行成功可以通过([<a href="http://localhost:8080/">http://localhost:8080</a> )访问，但是不会出现静态页面，可以继续参考下面步骤部署前端，然后通过前端地址来访问。</p><p><img src="/assets/image-20240407115558123.png" alt="image-20240407115558123"></p><h2 id="运行前端项目"><a href="#运行前端项目" class="headerlink" title="运行前端项目"></a>运行前端项目</h2><h3 id="初始化项目-1"><a href="#初始化项目-1" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>进入开发目录下，使用 vscode 命令<code>code </code>打开项目</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">克隆vue3项目</span><br>git clone https://gitee.com/ys-gitee/RuoYi-Vue3.git<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">通过vscode打开项目</span><br>code ./RuoYi-Vue3<br></code></pre></td></tr></table></figure><h3 id="项目运行-1"><a href="#项目运行-1" class="headerlink" title="项目运行"></a>项目运行</h3><p>在 vscode 终端中输入以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装依赖</span><br>npm install<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">建议不要直接使用 cnpm 安装依赖，会有各种诡异的 bug。可以通过如下操作解决 npm 下载速度慢的问题</span><br>npm install --registry=https://registry.npmmirror.com<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">启动服务</span><br>npm run dev<br></code></pre></td></tr></table></figure><p>打开浏览器，输入：([<a href="http://localhost/">http://localhost:80</a>) 默认账户&#x2F;密码 <code>admin/admin123</code>）若能正确展示登录页面，并能成功登录，菜单及页面展示正常，则表明环境搭建成功</p><h1 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h1><p>在若依项目成功搭建之后，深入了解其代码生成器功能是掌握框架的重要一环。</p><p>接下来，我们将利用若依框架的代码生成器实现 CRM 系统中的<strong>课程管理</strong>功能，这将使我们能够实际体验并掌握如何在项目中有效使用这一工具。</p><h2 id="功能需求"><a href="#功能需求" class="headerlink" title="功能需求"></a>功能需求</h2><blockquote><p>实现 CRM 系统中的课程管理功能，涵盖增加、删除、修改和查询课程信息的完整前后端代码。</p><p>原型地址：<a href="https://app.mockplus.cn/run/prototype/_lwaPYSV9Ue6/byFT7QUzmCqJ/2AadzZnerRIDo?cps=collapse&isShare=true">https://app.mockplus.cn/run/prototype/_lwaPYSV9Ue6/byFT7QUzmCqJ/2AadzZnerRIDo?cps=collapse&amp;isShare=true</a></p></blockquote><p><img src="/assets/image-20240407145252756.png" alt="image-20240407145252756"></p><h2 id="步骤分析"><a href="#步骤分析" class="headerlink" title="步骤分析"></a>步骤分析</h2><p>1、准备课程表结构和数据 sql 文件，导入到数据库中</p><p>2、登录系统（系统工具 -&gt; 代码生成 -&gt; 导入课程表）</p><p>3、代码生成列表中找到课程表（可预览、编辑、同步、删除生成配置）</p><p>4、点击生成代码会得到一个<code>ruoyi.zip</code></p><p>5、执行 sql 文件导入菜单，按照包内目录结构复制到自己的项目中即可</p><h2 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h2><h3 id="提供课程表"><a href="#提供课程表" class="headerlink" title="提供课程表"></a>提供课程表</h3><p>准备课程表结构和数据 sql 文件，导入到数据库中</p><p><img src="/assets/image-20240407160249913.png" alt="image-20240407145252756"></p><h3 id="系统导入"><a href="#系统导入" class="headerlink" title="系统导入"></a>系统导入</h3><p>登录系统（系统工具 -&gt; 代码生成 -&gt; 导入课程表）</p><p><img src="/assets/image-20240407145252756.gif" alt="image-20240407145252756"></p><h3 id="配置代码"><a href="#配置代码" class="headerlink" title="配置代码"></a>配置代码</h3><p>代码生成列表中找到课程表（可预览、编辑、同步、删除生成配置）</p><img src="assets/image-20240515194239631.png" alt="image-20240515194239631" style="zoom:100%;" /><h3 id="点击生成"><a href="#点击生成" class="headerlink" title="点击生成"></a>点击生成</h3><p>点击生成代码，得到一个<code>ruoyi.zip</code></p><img src="assets/image-20240407171714267.png" alt="image-20240407171714267" style="zoom:65%;" /><p>解压后得到：后端代码、前端代码、菜单 sql</p><img src="assets/image-20240407171214375.png" alt="image-20240407171214375" style="zoom:80%;" /><h2 id="代码导入"><a href="#代码导入" class="headerlink" title="代码导入"></a>代码导入</h2><h3 id="导入课程菜单"><a href="#导入课程菜单" class="headerlink" title="导入课程菜单"></a>导入课程菜单</h3><p>执行 sql 脚本，导入菜单数据</p><p><img src="/assets/image-20240407172732924.png" alt="image-20240407172732924"></p><h3 id="导入后端代码"><a href="#导入后端代码" class="headerlink" title="导入后端代码"></a>导入后端代码</h3><p>将生成的后端代码和 mappep 文件，导入<code>ruoyi-admin</code>模块中</p><p><img src="/assets/image-20240515194048039.png" alt="image-20240515194048039"></p><blockquote><p>注意：如果导入后的代码重启后没生效，可以通过 maven 先 clean 再启动</p></blockquote><h3 id="导入前端代码"><a href="#导入前端代码" class="headerlink" title="导入前端代码"></a>导入前端代码</h3><p>将生成的前端代码，导入<code>ruoyi-ui</code>模块中</p><p><img src="/assets/image-20240515194033701.png" alt="image-20240515194033701"></p><h2 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h2><p>代码生成器默认生成的<strong>课程管理</strong>模块在<strong>系统工具</strong>菜单下，打开测试 CRUD 功能</p><p><img src="/assets/image-20240515194309391.png" alt="image-20240515194309391"></p><h1 id="功能详解"><a href="#功能详解" class="headerlink" title="功能详解"></a>功能详解</h1><p>我们将对若依的通用功能进行详解。本章内容分为三个重点部分：</p><h2 id="系统管理"><a href="#系统管理" class="headerlink" title="系统管理"></a>系统管理</h2><h3 id="权限系统"><a href="#权限系统" class="headerlink" title="权限系统"></a>权限系统</h3><h4 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h4><p>若依提供了企业级通用权限系统，我们这里拿 CRM 系统先给大家演示下：</p><p>地址：<a href="https://huike-crm.itheima.net/">https://huike-crm.itheima.net/</a></p><ul><li><p>demo 账号（超级管理员），可以查看所有功能菜单</p></li><li><p>zhangsan 账号（市场专员），可以查看线索管理菜单</p></li><li><p>yueyue 账号（销售专员），可以查看商机、合同等菜单</p></li></ul><p><img src="/assets/image-20240515194350937.png" alt="image-20240515194350937"></p><h4 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h4><p>lRBAC（基于角色的访问控制）是一种广泛使用的访问控制模型，通过角色来分配和管理用户的菜单权限。</p><p><img src="/assets/image-20240515194432239.png" alt="image-20240515194432239"></p><h4 id="表关系"><a href="#表关系" class="headerlink" title="表关系"></a>表关系</h4><p><img src="/assets/image-20240515194525518.png" alt="image-20240515194525518"></p><p><img src="/assets/image-20240515194550233.png" alt="image-20240515194550233"></p><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>创建新用户小智并关联课研人员角色，仅限课程管理和统计分析菜单访问。</p><p><img src="/assets/image-20240515211530662.png" alt="image-20240515211530662"></p><p>实现步骤：</p><p>① 创建菜单</p><p>② 创建角色，并分配权限</p><p>③ 创建用户，并关联角色</p><p><img src="/assets/image-20240515194805143.png" alt="image-20240515194805143"></p><h3 id="数据字典"><a href="#数据字典" class="headerlink" title="数据字典"></a>数据字典</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>若依内置的数据字典，用于维护系统中常见的静态数据。例如：性别、状态…</p><p><img src="/assets/image-20240515194849692.png" alt="image-20240515194849692"></p><p>功能包括：字典类型管理、字典数据管理</p><p><img src="/assets/image-20240515194953367.png" alt="image-20240515194953367"></p><h4 id="表关系-1"><a href="#表关系-1" class="headerlink" title="表关系"></a>表关系</h4><p><img src="/assets/image-20240515195031748.png" alt="image-20240515195031748"></p><h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p>将课程管理的学科字段改为数据字典维护。</p><p><img src="/assets/image-20240515211609621.png" alt="image-20240515211609621"></p><p>实现步骤：</p><p>① 添加字典类型和数据</p><p><img src="/assets/image-20240515195114801.png" alt="image-20240515195114801"></p><p>② 修改代码生成信息</p><p><img src="/assets/image-20240515195134472.png" alt="image-20240515195134472"></p><p>③ 下载代码，导入前端</p><p><img src="/assets/image-20240515195146589.png" alt="image-20240515195146589"></p><h3 id="参数设置"><a href="#参数设置" class="headerlink" title="参数设置"></a>参数设置</h3><p>参数设置：对系统中的参数进行动态维护。</p><p><img src="/assets/image-20240515195404229.png" alt="image-20240515195404229"></p><p>关闭登录验证码</p><p><img src="/assets/image-20240515195419521.png" alt="image-20240515195419521"></p><h3 id="通知公告"><a href="#通知公告" class="headerlink" title="通知公告"></a>通知公告</h3><p>RuoYi 的通知公告功能提供了一个方便的方式来发布和管理通知、公告和新闻等信息。管理员可以创建、编辑和删除通知（支持富文本编辑和附件上传）。</p><p>系统将信息发送给指定的用户、部门或角色。用户可以通过系统界面或电子邮件接收通知，从而确保信息及时传达（这部分需要自己开发）。</p><p>通知公告功能有助于组织内部沟通和信息传递，提高了工作效率和信息共享。</p><p><img src="/assets/image-20240515195457616.png" alt="image-20240515195457616"></p><h3 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h3><p>登录日志</p><ul><li>记录用户的登录信息，包括登录时间和地点（IP 地址）。</li><li>帮助管理员监控登录行为，及时发现任何可疑的登录尝试。</li><li>同样提供搜索和筛选功能，方便查找特定用户的登录历史。</li></ul><img src="assets/image-20240515195520979.png" alt="image-20240515195520979" style="zoom:90%;" /><p>操作日志</p><ul><li>记录用户在系统中的所有操作，如查看、修改数据等。</li><li>帮助管理员检查谁做了什么，以及何时做的，确保数据准确无误。</li><li>可以快速搜索和找到特定的操作记录，便于管理和审查。</li></ul><img src="assets/image-20240515195525287.png" alt="image-20240515195525287" style="zoom:80%;" /><h2 id="系统监控"><a href="#系统监控" class="headerlink" title="系统监控"></a>系统监控</h2><h3 id="监控相关"><a href="#监控相关" class="headerlink" title="监控相关"></a>监控相关</h3><p>若依提供了一些列强大的监控工具，能够帮助开发者和运维快速了解应用程序的性能状态。</p><p><img src="/assets/image-20240515195822097.png" alt="image-20240515195822097"></p><ol><li><strong>在线用户</strong>：<ul><li>管理员可以看到当前谁在系统里，他们什么时候登录的，从哪里登录的，属于哪个部门。</li><li>如果有人没权限还赖着不走，管理员可以一键让他们下线，保证系统的安全。</li></ul></li><li><strong>数据监控</strong>：<ul><li>管理员可以实时看到系统的各项指标，比如资源使用情况，数据库状态等。</li><li>通过图表可以直观地看出系统是否健康，如果出现问题，系统会发出警报。</li></ul></li><li><strong>服务监控</strong>：<ul><li>管理员可以监控系统中各个服务是否正常运行，以及它们的性能指标。</li><li>如果服务出现问题，系统会立即通知管理员，并通过仪表板展示，方便管理员快速了解情况。</li></ul></li><li><strong>缓存监控</strong>：<ul><li>管理员可以监控系统的缓存使用情况，比如缓存是否经常被用到，缓存的大小等。</li><li>系统还可以自动清理缓存，保持数据的新鲜度，如果缓存有问题，也会发出警报。</li></ul></li></ol><h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><h4 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h4><p>若依为定时任务功能提供方便友好的 web 界面，实现动态管理任务。</p><p><img src="/assets/image-20240515195859181.png" alt="image-20240515195859181"></p><h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><p>每间隔 5 秒，控制台输出系统时间。</p><p><img src="/assets/image-20240515212217472.png" alt="image-20240515212217472"></p><p>实现步骤：</p><p>① 创建任务类<br><img src="/assets/image-20240515200554019.png" alt="image-20240515200554019"></p><p>② 添加任务规则</p><p><img src="/assets/image-20240515200608310.png" alt="image-20240515200608310"></p><ul><li>任务名称：自定义，如：定时查询任务状态</li><li>任务分组：根据字典<code>sys_job_group</code>配置，可自行进行配置</li><li>调用目标字符串：设置后台任务方法名称参数</li><li>执行表达式：可查询官方<code>cron</code>表达式介绍</li><li>执行策略：定时任务自定义执行策略</li><li>并发执行：是否需要多个任务间同时执行</li></ul><p>③ 启动任务</p><p><img src="/assets/image-20240515212230091.png" alt="image-20240515212230091"></p><h2 id="系统工具"><a href="#系统工具" class="headerlink" title="系统工具"></a>系统工具</h2><h3 id="表单构建"><a href="#表单构建" class="headerlink" title="表单构建"></a>表单构建</h3><h4 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h4><ul><li>允许用户通过拖放等可视化操作创建表单，比如用来收集数据的表格或调查问卷。</li><li>可以自定义表单的各个部分，比如添加不同的输入项和设置验证规则，无需编写代码。</li><li>提供了导出数据、导入数据、分享表单和设置权限的功能，方便数据管理和共享。</li></ul><p><img src="/assets/image-20240515201246417.png" alt="image-20240515201246417"></p><h4 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h4><p>通过表单构建工具，单独制作一个添加课程的表单页面。</p><p><img src="/assets/image-20240515212304226.png" alt="image-20240515212304226"></p><p>实现步骤：</p><p>① 制作表单并导出<br><img src="/assets/image-20240515201358208.png" alt="image-20240515201358208"></p><p>② 复制到前端工程<br><img src="/assets/image-20240515201427300.png" alt="image-20240515201427300"></p><p>③ 创建动态菜单</p><p><img src="/assets/image-20240515201440877.png" alt="image-20240515201440877"></p><h3 id="代码生成-1"><a href="#代码生成-1" class="headerlink" title="代码生成"></a>代码生成</h3><ul><li>自动化工具，可以快速生成项目中常用的代码，如数据库操作类、后端控制器、前端页面等。</li><li>支持根据数据库的表结构反向生成代码，减少手动编写的工作量。</li><li>提供三种生成模板：单表、 <span style='color:red'>树表</span>、主子表（一对多），可以生成适用于 Spring Boot、MyBatis 等流行框架的代码，提高开发效率和代码质量。</li><li>树表是一种展示层级数据的表格，能展开折叠，清晰呈现父子关系，便于管理。</li></ul><p><img src="/assets/image-20240515201619313.png" alt="image-20240515201619313"></p><p>代码生成配置主表实现细节：</p><p><img src="/assets/image-20240515201640870.png" alt="image-20240515201640870"></p><h3 id="系统接口"><a href="#系统接口" class="headerlink" title="系统接口"></a>系统接口</h3><ul><li>Swagger，能够自动生成 API 的同步在线文档，并提供 Web 界面进行接口调用和测试。</li></ul><p><img src="/assets/image-20240515201705896.png" alt="image-20240515201705896"></p><h1 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h1><p>在功能的讲解过程中，涉及的前后端项目的结构和配置文件，我们还比较陌生，为了更好的使用若依进行项目开发，所以接下来，我们开始进入项目结构这部分内容的学习</p><h2 id="后端结构"><a href="#后端结构" class="headerlink" title="后端结构"></a>后端结构</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java">com.ruoyi<br>├── ruoyi-admin      <span class="hljs-comment">// 后台服务模块</span><br>│       └── web                           <span class="hljs-comment">// 内置功能的表现层</span><br>│       └── RuoYiApplication              <span class="hljs-comment">// 若依项目启动类</span><br>├── ruoyi-common     <span class="hljs-comment">// 通用工具模块</span><br>│       └── annotation                    <span class="hljs-comment">// 自定义注解</span><br>│       └── config                        <span class="hljs-comment">// 全局配置</span><br>│       └── constant                      <span class="hljs-comment">// 通用常量</span><br>│       └── core                          <span class="hljs-comment">// 核心控制</span><br>│       └── enums                         <span class="hljs-comment">// 通用枚举</span><br>│       └── exception                     <span class="hljs-comment">// 通用异常</span><br>│       └── filter                        <span class="hljs-comment">// 过滤器处理</span><br>│       └── utils                         <span class="hljs-comment">// 通用类处理</span><br>│       └── xss                           <span class="hljs-comment">// 自定义xss校验</span><br>├── ruoyi-framework  <span class="hljs-comment">// 框架核心模块</span><br>│       └── aspectj                       <span class="hljs-comment">// AOP配置</span><br>│       └── config                        <span class="hljs-comment">// 系统配置</span><br>│       └── datasource                    <span class="hljs-comment">// 多数据源配置</span><br>│       └── interceptor                   <span class="hljs-comment">// 拦截器</span><br>│       └── manager                       <span class="hljs-comment">// 异步处理</span><br>│       └── security                      <span class="hljs-comment">// 权限控制</span><br>│       └── web                           <span class="hljs-comment">// 前端控制</span><br>├── ruoyi-generator  <span class="hljs-comment">// 代码生成模块（可移除）</span><br>├── ruoyi-quartz     <span class="hljs-comment">// 定时任务模块（可移除）</span><br>├── ruoyi-system     <span class="hljs-comment">// 系统代码模块</span><br>│       └── domain                        <span class="hljs-comment">// 系统代码的实体类</span><br>│       └── mapper                        <span class="hljs-comment">// 系统代码的持久层</span><br>│       └── service                       <span class="hljs-comment">// 系统代码的业务层</span><br></code></pre></td></tr></table></figure><p><img src="/assets/image-20240515202429752.png" alt="image-20240515202429752"></p><h2 id="项目中配置"><a href="#项目中配置" class="headerlink" title="项目中配置"></a>项目中配置</h2><p>项目中的配置文件都在 ruoyi-admin 模块下，如下图：</p><p><img src="/assets/image-20240515202447038.png" alt="image-20240515202447038"></p><ul><li>i18n：国际化处理</li><li>META-INF：存储了项目的元信息（<em>描述数据的数据</em>），无需修改</li><li>mybatis：mybatis 相关的配置信息</li><li>application.yml：项目中的核心配置</li><li>application-druid.yml：数据库连接配置</li><li>banner.txt：默认的 banner 图标信息，项目启动，控制台打印显示</li><li>logback.xml：日志配置</li></ul><p>最主要的两个配置文件：application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 项目相关配置</span><br><span class="hljs-attr">ruoyi:</span><br>  <span class="hljs-comment"># 名称</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">RuoYi</span><br>  <span class="hljs-comment"># 版本</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">3.8</span><span class="hljs-number">.7</span><br>  <span class="hljs-comment"># 版权年份</span><br>  <span class="hljs-attr">copyrightYear:</span> <span class="hljs-number">2024</span><br>  <span class="hljs-comment"># 文件路径 示例（ Windows配置D:/ruoyi/uploadPath，Linux配置 /home/ruoyi/uploadPath）</span><br>  <span class="hljs-attr">profile:</span> <span class="hljs-string">D:/ruoyi/uploadPath</span><br>  <span class="hljs-comment"># 获取ip地址开关</span><br>  <span class="hljs-attr">addressEnabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-comment"># 验证码类型 math 数字计算 char 字符验证</span><br>  <span class="hljs-attr">captchaType:</span> <span class="hljs-string">math</span><br><br><span class="hljs-comment"># 开发环境配置</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-comment"># 服务器的HTTP端口，默认为8080</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-comment"># 应用的访问路径</span><br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/</span><br>  <span class="hljs-attr">tomcat:</span><br>    <span class="hljs-comment"># tomcat的URI编码</span><br>    <span class="hljs-attr">uri-encoding:</span> <span class="hljs-string">UTF-8</span><br>    <span class="hljs-comment"># 连接数满后的排队数，默认为100</span><br>    <span class="hljs-attr">accept-count:</span> <span class="hljs-number">1000</span><br>    <span class="hljs-attr">threads:</span><br>      <span class="hljs-comment"># tomcat最大线程数，默认为200</span><br>      <span class="hljs-attr">max:</span> <span class="hljs-number">800</span><br>      <span class="hljs-comment"># Tomcat启动初始化的线程数，默认值10</span><br>      <span class="hljs-attr">min-spare:</span> <span class="hljs-number">100</span><br><br><span class="hljs-comment"># 日志配置</span><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">com.ruoyi:</span> <span class="hljs-string">debug</span><br>    <span class="hljs-attr">org.springframework:</span> <span class="hljs-string">warn</span><br><br><span class="hljs-comment"># 用户配置</span><br><span class="hljs-attr">user:</span><br>  <span class="hljs-attr">password:</span><br>    <span class="hljs-comment"># 密码最大错误次数</span><br>    <span class="hljs-attr">maxRetryCount:</span> <span class="hljs-number">5</span><br>    <span class="hljs-comment"># 密码锁定时间（默认10分钟）</span><br>    <span class="hljs-attr">lockTime:</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment"># Spring配置</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment"># 资源信息</span><br>  <span class="hljs-attr">messages:</span><br>    <span class="hljs-comment"># 国际化资源文件路径</span><br>    <span class="hljs-attr">basename:</span> <span class="hljs-string">i18n/messages</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">druid</span><br>  <span class="hljs-comment"># 文件上传</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">multipart:</span><br>      <span class="hljs-comment"># 单个文件大小</span><br>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">10MB</span><br>      <span class="hljs-comment"># 设置总上传的文件大小</span><br>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">20MB</span><br>  <span class="hljs-comment"># 服务模块</span><br>  <span class="hljs-attr">devtools:</span><br>    <span class="hljs-attr">restart:</span><br>      <span class="hljs-comment"># 热部署开关</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># redis 配置</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-comment"># 地址</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-comment"># 端口，默认为6379</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-comment"># 数据库索引</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br>    <span class="hljs-comment"># 密码</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-comment"># 连接超时时间</span><br>    <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span><br>    <span class="hljs-attr">lettuce:</span><br>      <span class="hljs-attr">pool:</span><br>        <span class="hljs-comment"># 连接池中的最小空闲连接</span><br>        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span><br>        <span class="hljs-comment"># 连接池中的最大空闲连接</span><br>        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span><br>        <span class="hljs-comment"># 连接池的最大数据库连接数</span><br>        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span><br>        <span class="hljs-comment"># #连接池最大阻塞等待时间（使用负值表示没有限制）</span><br>        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">-1ms</span><br><br><span class="hljs-comment"># token配置</span><br><span class="hljs-attr">token:</span><br>  <span class="hljs-comment"># 令牌自定义标识</span><br>  <span class="hljs-attr">header:</span> <span class="hljs-string">Authorization</span><br>  <span class="hljs-comment"># 令牌密钥</span><br>  <span class="hljs-attr">secret:</span> <span class="hljs-string">abcdefghijklmnopqrstuvwxyz</span><br>  <span class="hljs-comment"># 令牌有效期（默认30分钟）</span><br>  <span class="hljs-attr">expireTime:</span> <span class="hljs-number">30</span><br><br><span class="hljs-comment"># MyBatis配置</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-comment"># 搜索指定包别名</span><br>  <span class="hljs-attr">typeAliasesPackage:</span> <span class="hljs-string">com.ruoyi.**.domain</span><br>  <span class="hljs-comment"># 配置mapper的扫描，找到所有的mapper.xml映射文件</span><br>  <span class="hljs-attr">mapperLocations:</span> <span class="hljs-string">classpath*:mapper/**/*Mapper.xml</span><br>  <span class="hljs-comment"># 加载全局的配置文件</span><br>  <span class="hljs-attr">configLocation:</span> <span class="hljs-string">classpath:mybatis/mybatis-config.xml</span><br><br><span class="hljs-comment"># PageHelper分页插件</span><br><span class="hljs-attr">pagehelper:</span><br>  <span class="hljs-attr">helperDialect:</span> <span class="hljs-string">mysql</span><br>  <span class="hljs-attr">supportMethodsArguments:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">params:</span> <span class="hljs-string">count=countSql</span><br><br><span class="hljs-comment"># Swagger配置</span><br><span class="hljs-attr">swagger:</span><br>  <span class="hljs-comment"># 是否开启swagger</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># 请求前缀</span><br>  <span class="hljs-attr">pathMapping:</span> <span class="hljs-string">/dev-api</span><br><br><span class="hljs-comment"># 防止XSS攻击</span><br><span class="hljs-attr">xss:</span><br>  <span class="hljs-comment"># 过滤开关</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># 排除链接（多个用逗号分隔）</span><br>  <span class="hljs-attr">excludes:</span> <span class="hljs-string">/system/notice</span><br>  <span class="hljs-comment"># 匹配链接</span><br>  <span class="hljs-attr">urlPatterns:</span> <span class="hljs-string">/system/*,/monitor/*,/tool/*</span><br></code></pre></td></tr></table></figure><h2 id="模块依赖关系"><a href="#模块依赖关系" class="headerlink" title="模块依赖关系"></a>模块依赖关系</h2><p>各个模块之间的依赖关系：</p><p><img src="/assets/image-20240515202002135.png" alt="image-20240515202002135"></p><h2 id="前端结构"><a href="#前端结构" class="headerlink" title="前端结构"></a>前端结构</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js">ruoyi-vue3<br>├── bin                        <span class="hljs-comment">// 执行脚本</span><br>├── html                       <span class="hljs-comment">// IE低版本提示页</span><br>├── node_modules               <span class="hljs-comment">// 第三方依赖库</span><br>├── public                     <span class="hljs-comment">// 公共资源</span><br>│   ├── favicon.<span class="hljs-property">ico</span>            <span class="hljs-comment">// favicon图标</span><br>├── src                        <span class="hljs-comment">// 源代码</span><br>│   ├── api                    <span class="hljs-comment">// 所有请求</span><br>│   ├── assets                 <span class="hljs-comment">// 静态资源</span><br>│   ├── components             <span class="hljs-comment">// 全局公用组件</span><br>│   ├── directive              <span class="hljs-comment">// 全局指令</span><br>│   ├── layout                 <span class="hljs-comment">// 布局</span><br>│   ├── plugins                <span class="hljs-comment">// 通用插件</span><br>│   ├── router                 <span class="hljs-comment">// 路由配置</span><br>│   ├── store                  <span class="hljs-comment">// 状态管理</span><br>│   ├── utils                  <span class="hljs-comment">// 全局公用方法</span><br>│   ├── views                  <span class="hljs-comment">// 视图组件</span><br>│   ├── <span class="hljs-title class_">App</span>.<span class="hljs-property">vue</span>                <span class="hljs-comment">// 入口组件</span><br>│   ├── main.<span class="hljs-property">js</span>                <span class="hljs-comment">// 入口文件</span><br>│   ├── permission.<span class="hljs-property">js</span>          <span class="hljs-comment">// 权限管理</span><br>│   └── settings.<span class="hljs-property">js</span>            <span class="hljs-comment">// 系统配置</span><br>├── vite                       <span class="hljs-comment">// 构建工具</span><br>├── .<span class="hljs-property">env</span>.<span class="hljs-property">development</span>           <span class="hljs-comment">// 开发环境配置</span><br>├── .<span class="hljs-property">env</span>.<span class="hljs-property">production</span>            <span class="hljs-comment">// 生产环境配置</span><br>├── .<span class="hljs-property">env</span>.<span class="hljs-property">staging</span>               <span class="hljs-comment">// 测试环境配置</span><br>├── .<span class="hljs-property">gitignore</span>                 <span class="hljs-comment">// git 忽略项</span><br>├── index.<span class="hljs-property">html</span>                 <span class="hljs-comment">// 入口页面</span><br>├── package.<span class="hljs-property">json</span>               <span class="hljs-comment">// 项目配置文件（相当于pom.xml）</span><br>└── vue.<span class="hljs-property">config</span>.<span class="hljs-property">js</span>              <span class="hljs-comment">// Vue项目的配置信息（相当于application.yml）</span><br></code></pre></td></tr></table></figure><p><img src="/assets/image-20240515202411640.png" alt="image-20240515202411640"></p><h2 id="表结构介绍"><a href="#表结构介绍" class="headerlink" title="表结构介绍"></a>表结构介绍</h2><p><code>ruoyi-vue</code>数据库设计包含了多个表结构，用于支持系统的各种功能模块。</p><p>这些表可以根据它们的功能和用途进行分类，以便在后期使用时能够快速定位和理解。以下是对这些表结构的分类和简要说明：</p><p><img src="/assets/image-20240515202517972.png" alt="image-20240515202517972"></p><p><img src="/assets/ruoyi-vue.png" alt="ruoyi-vue"></p><h1 id="源码阅读"><a href="#源码阅读" class="headerlink" title="源码阅读"></a>源码阅读</h1><p>本章我们将围绕入门案例生成的课程管理进行讲解，包含前后端代码的分析，以及前后端代码交互的流程，通过这部分的学习，不仅能让我们掌握若依的基础业务逻辑，在此基础上还能为我们日后的定制开发提供强有力的支撑。</p><h2 id="前端代码分析"><a href="#前端代码分析" class="headerlink" title="前端代码分析"></a>前端代码分析</h2><p>找到 src&#x2F;views&#x2F;course&#x2F;course&#x2F;index.vue 文件，护理项目的前端代码已经添加了详细的注释，如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;app-container&quot;&gt;<br>    &lt;!-- 搜索表单 start --&gt;<br>    &lt;el-form<br>      :model=&quot;queryParams&quot;<br>      ref=&quot;queryRef&quot;<br>      :inline=&quot;true&quot;<br>      v-show=&quot;showSearch&quot;<br>      label-width=&quot;68px&quot;<br>    &gt;<br>      &lt;el-form-item label=&quot;课程编码&quot; prop=&quot;code&quot;&gt;<br>        &lt;el-input<br>          v-model=&quot;queryParams.code&quot;<br>          placeholder=&quot;请输入课程编码&quot;<br>          clearable<br>          @keyup.enter=&quot;handleQuery&quot;<br>        /&gt;<br>      &lt;/el-form-item&gt;<br>      &lt;el-form-item label=&quot;课程学科&quot; prop=&quot;subject&quot;&gt;<br>        &lt;el-select<br>          v-model=&quot;queryParams.subject&quot;<br>          placeholder=&quot;请选择课程学科&quot;<br>          clearable<br>        &gt;<br>          &lt;el-option<br>            v-for=&quot;dict in course_subject&quot;<br>            :key=&quot;dict.value&quot;<br>            :label=&quot;dict.label&quot;<br>            :value=&quot;dict.value&quot;<br>          /&gt;<br>        &lt;/el-select&gt;<br>      &lt;/el-form-item&gt;<br>      &lt;el-form-item label=&quot;课程名称&quot; prop=&quot;name&quot;&gt;<br>        &lt;el-input<br>          v-model=&quot;queryParams.name&quot;<br>          placeholder=&quot;请输入课程名称&quot;<br>          clearable<br>          @keyup.enter=&quot;handleQuery&quot;<br>        /&gt;<br>      &lt;/el-form-item&gt;<br>      &lt;el-form-item label=&quot;适用人群&quot; prop=&quot;applicablePerson&quot;&gt;<br>        &lt;el-input<br>          v-model=&quot;queryParams.applicablePerson&quot;<br>          placeholder=&quot;请输入适用人群&quot;<br>          clearable<br>          @keyup.enter=&quot;handleQuery&quot;<br>        /&gt;<br>      &lt;/el-form-item&gt;<br>      &lt;el-form-item&gt;<br>        &lt;el-button type=&quot;primary&quot; icon=&quot;Search&quot; @click=&quot;handleQuery&quot;<br>          &gt;搜索&lt;/el-button<br>        &gt;<br>        &lt;el-button icon=&quot;Refresh&quot; @click=&quot;resetQuery&quot;&gt;重置&lt;/el-button&gt;<br>      &lt;/el-form-item&gt;<br>    &lt;/el-form&gt;<br>    &lt;!-- 搜索表单 end --&gt;<br><br>    &lt;!-- 按钮区域 start --&gt;<br>    &lt;el-row :gutter=&quot;10&quot; class=&quot;mb8&quot;&gt;<br>      &lt;el-col :span=&quot;1.5&quot;&gt;<br>        &lt;el-button<br>          type=&quot;primary&quot;<br>          plain<br>          icon=&quot;Plus&quot;<br>          @click=&quot;handleAdd&quot;<br>          v-hasPermi=&quot;[&#x27;course:course:add&#x27;]&quot;<br>          &gt;新增&lt;/el-button<br>        &gt;<br>      &lt;/el-col&gt;<br>      &lt;el-col :span=&quot;1.5&quot;&gt;<br>        &lt;el-button<br>          type=&quot;success&quot;<br>          plain<br>          icon=&quot;Edit&quot;<br>          :disabled=&quot;single&quot;<br>          @click=&quot;handleUpdate&quot;<br>          v-hasPermi=&quot;[&#x27;course:course:edit&#x27;]&quot;<br>          &gt;修改&lt;/el-button<br>        &gt;<br>      &lt;/el-col&gt;<br>      &lt;el-col :span=&quot;1.5&quot;&gt;<br>        &lt;el-button<br>          type=&quot;danger&quot;<br>          plain<br>          icon=&quot;Delete&quot;<br>          :disabled=&quot;multiple&quot;<br>          @click=&quot;handleDelete&quot;<br>          v-hasPermi=&quot;[&#x27;course:course:remove&#x27;]&quot;<br>          &gt;删除&lt;/el-button<br>        &gt;<br>      &lt;/el-col&gt;<br>      &lt;el-col :span=&quot;1.5&quot;&gt;<br>        &lt;el-button<br>          type=&quot;warning&quot;<br>          plain<br>          icon=&quot;Download&quot;<br>          @click=&quot;handleExport&quot;<br>          v-hasPermi=&quot;[&#x27;course:course:export&#x27;]&quot;<br>          &gt;导出&lt;/el-button<br>        &gt;<br>      &lt;/el-col&gt;<br>      &lt;right-toolbar<br>        v-model:showSearch=&quot;showSearch&quot;<br>        @queryTable=&quot;getList&quot;<br>      &gt;&lt;/right-toolbar&gt;<br>    &lt;/el-row&gt;<br>    &lt;!-- 按钮区域end --&gt;<br><br>    &lt;!-- 数据展示表格 start --&gt;<br>    &lt;el-table<br>      v-loading=&quot;loading&quot;<br>      :data=&quot;courseList&quot;<br>      @selection-change=&quot;handleSelectionChange&quot;<br>    &gt;<br>      &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot; align=&quot;center&quot; /&gt;<br>      &lt;el-table-column label=&quot;课程id&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;<br>      &lt;el-table-column label=&quot;课程编码&quot; align=&quot;center&quot; prop=&quot;code&quot; /&gt;<br>      &lt;el-table-column label=&quot;课程学科&quot; align=&quot;center&quot; prop=&quot;subject&quot;&gt;<br>        &lt;template #default=&quot;scope&quot;&gt;<br>          &lt;dict-tag :options=&quot;course_subject&quot; :value=&quot;scope.row.subject&quot; /&gt;<br>        &lt;/template&gt;<br>      &lt;/el-table-column&gt;<br>      &lt;el-table-column label=&quot;课程名称&quot; align=&quot;center&quot; prop=&quot;name&quot; /&gt;<br>      &lt;el-table-column label=&quot;价格&quot; align=&quot;center&quot; prop=&quot;price&quot; /&gt;<br>      &lt;el-table-column<br>        label=&quot;适用人群&quot;<br>        align=&quot;center&quot;<br>        prop=&quot;applicablePerson&quot;<br>      /&gt;<br>      &lt;el-table-column label=&quot;课程介绍&quot; align=&quot;center&quot; prop=&quot;info&quot; /&gt;<br>      &lt;el-table-column<br>        label=&quot;操作&quot;<br>        align=&quot;center&quot;<br>        class-name=&quot;small-padding fixed-width&quot;<br>      &gt;<br>        &lt;template #default=&quot;scope&quot;&gt;<br>          &lt;el-button<br>            link<br>            type=&quot;primary&quot;<br>            icon=&quot;Edit&quot;<br>            @click=&quot;handleUpdate(scope.row)&quot;<br>            v-hasPermi=&quot;[&#x27;course:course:edit&#x27;]&quot;<br>            &gt;修改&lt;/el-button<br>          &gt;<br>          &lt;el-button<br>            link<br>            type=&quot;primary&quot;<br>            icon=&quot;Delete&quot;<br>            @click=&quot;handleDelete(scope.row)&quot;<br>            v-hasPermi=&quot;[&#x27;course:course:remove&#x27;]&quot;<br>            &gt;删除&lt;/el-button<br>          &gt;<br>        &lt;/template&gt;<br>      &lt;/el-table-column&gt;<br>    &lt;/el-table&gt;<br>    &lt;!-- 数据展示表格 end --&gt;<br><br>    &lt;!-- 分页区域 start --&gt;<br>    &lt;pagination<br>      v-show=&quot;total &gt; 0&quot;<br>      :total=&quot;total&quot;<br>      v-model:page=&quot;queryParams.pageNum&quot;<br>      v-model:limit=&quot;queryParams.pageSize&quot;<br>      @pagination=&quot;getList&quot;<br>    /&gt;<br>    &lt;!-- 分页区域 end --&gt;<br><br>    &lt;!-- 添加或修改课程管理对话框 --&gt;<br>    &lt;el-dialog :title=&quot;title&quot; v-model=&quot;open&quot; width=&quot;500px&quot; append-to-body&gt;<br>      &lt;el-form ref=&quot;courseRef&quot; :model=&quot;form&quot; :rules=&quot;rules&quot; label-width=&quot;80px&quot;&gt;<br>        &lt;el-form-item label=&quot;课程编码&quot; prop=&quot;code&quot;&gt;<br>          &lt;el-input v-model=&quot;form.code&quot; placeholder=&quot;请输入课程编码&quot; /&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;课程学科&quot; prop=&quot;subject&quot;&gt;<br>          &lt;el-select v-model=&quot;form.subject&quot; placeholder=&quot;请选择课程学科&quot;&gt;<br>            &lt;el-option<br>              v-for=&quot;dict in course_subject&quot;<br>              :key=&quot;dict.value&quot;<br>              :label=&quot;dict.label&quot;<br>              :value=&quot;dict.value&quot;<br>            &gt;&lt;/el-option&gt;<br>          &lt;/el-select&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;课程名称&quot; prop=&quot;name&quot;&gt;<br>          &lt;el-input v-model=&quot;form.name&quot; placeholder=&quot;请输入课程名称&quot; /&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;价格&quot; prop=&quot;price&quot;&gt;<br>          &lt;el-input v-model=&quot;form.price&quot; placeholder=&quot;请输入价格&quot; /&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;适用人群&quot; prop=&quot;applicablePerson&quot;&gt;<br>          &lt;el-input<br>            v-model=&quot;form.applicablePerson&quot;<br>            placeholder=&quot;请输入适用人群&quot;<br>          /&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;课程介绍&quot; prop=&quot;info&quot;&gt;<br>          &lt;el-input v-model=&quot;form.info&quot; placeholder=&quot;请输入课程介绍&quot; /&gt;<br>        &lt;/el-form-item&gt;<br>      &lt;/el-form&gt;<br>      &lt;template #footer&gt;<br>        &lt;div class=&quot;dialog-footer&quot;&gt;<br>          &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm&quot;&gt;确 定&lt;/el-button&gt;<br>          &lt;el-button @click=&quot;cancel&quot;&gt;取 消&lt;/el-button&gt;<br>        &lt;/div&gt;<br>      &lt;/template&gt;<br>    &lt;/el-dialog&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup name=&quot;Course&quot;&gt;<br>// 引入后端api接口<br>import &#123;<br>  listCourse,<br>  getCourse,<br>  delCourse,<br>  addCourse,<br>  updateCourse,<br>&#125; from &quot;@/api/course/course&quot;;<br>// 获取当前实例代理对象，用于访问组件数据、方法<br>const &#123; proxy &#125; = getCurrentInstance();<br>// 获取课程学科的数据字典<br>const &#123; course_subject &#125; = proxy.useDict(&quot;course_subject&quot;);<br>// 列表数据<br>const courseList = ref([]);<br>// 是否显示弹框<br>const open = ref(false);<br>// 是否显示加载状态<br>const loading = ref(true);<br>// 是否显示搜索栏<br>const showSearch = ref(true);<br>// 复选框，被选中id的数组<br>const ids = ref([]);<br>// 复选框，是否单选，用于高亮修改、删除按钮<br>const single = ref(true);<br>// 复选框，是否多选，仅高亮删除按钮<br>const multiple = ref(true);<br>// 总（记录）条数<br>const total = ref(0);<br>// 用于区分新增、修改对话框标题<br>const title = ref(&quot;&quot;);<br>// 定义reactive响应式对象<br>const data = reactive(&#123;<br>  // 新增或修改表单数据<br>  form: &#123;&#125;,<br>  // 搜索条件参数<br>  queryParams: &#123;<br>    pageNum: 1,<br>    pageSize: 10,<br>    code: null,<br>    subject: null,<br>    name: null,<br>    applicablePerson: null,<br>  &#125;,<br>  // 表单校验规则<br>  rules: &#123;<br>    code: [&#123; required: true, message: &quot;课程编码不能为空&quot;, trigger: &quot;blur&quot; &#125;],<br>    subject: [<br>      &#123; required: true, message: &quot;课程学科不能为空&quot;, trigger: &quot;change&quot; &#125;,<br>    ],<br>    name: [&#123; required: true, message: &quot;课程名称不能为空&quot;, trigger: &quot;blur&quot; &#125;],<br>    price: [&#123; required: true, message: &quot;价格不能为空&quot;, trigger: &quot;blur&quot; &#125;],<br>    applicablePerson: [<br>      &#123; required: true, message: &quot;适用人群不能为空&quot;, trigger: &quot;blur&quot; &#125;,<br>    ],<br>    info: [&#123; required: true, message: &quot;课程介绍不能为空&quot;, trigger: &quot;blur&quot; &#125;],<br>  &#125;,<br>&#125;);<br>// 将data对象的三个属性，转换为ref响应式对象<br>const &#123; queryParams, form, rules &#125; = toRefs(data);<br><br>/** 查询课程管理列表 */<br>function getList() &#123;<br>  loading.value = true;<br>  listCourse(queryParams.value).then((response) =&gt; &#123;<br>    courseList.value = response.rows;<br>    total.value = response.total;<br>    loading.value = false;<br>  &#125;);<br>&#125;<br><br>// 取消按钮<br>function cancel() &#123;<br>  open.value = false;<br>  reset();<br>&#125;<br><br>// 表单重置<br>function reset() &#123;<br>  form.value = &#123;<br>    id: null,<br>    code: null,<br>    subject: null,<br>    name: null,<br>    price: null,<br>    applicablePerson: null,<br>    info: null,<br>    createTime: null,<br>    updateTime: null,<br>  &#125;;<br>  proxy.resetForm(&quot;courseRef&quot;);<br>&#125;<br><br>/** 搜索按钮操作 */<br>function handleQuery() &#123;<br>  queryParams.value.pageNum = 1;<br>  getList();<br>&#125;<br><br>/** 重置按钮操作 */<br>function resetQuery() &#123;<br>  proxy.resetForm(&quot;queryRef&quot;);<br>  handleQuery();<br>&#125;<br><br>// 多选框选中数据<br>function handleSelectionChange(selection) &#123;<br>  ids.value = selection.map((item) =&gt; item.id);<br>  single.value = selection.length != 1;<br>  multiple.value = !selection.length;<br>&#125;<br><br>/** 新增按钮操作 */<br>function handleAdd() &#123;<br>  reset();<br>  open.value = true;<br>  title.value = &quot;添加课程管理&quot;;<br>&#125;<br><br>/** 修改按钮操作 */<br>function handleUpdate(row) &#123;<br>  reset();<br>  const _id = row.id || ids.value;<br>  getCourse(_id).then((response) =&gt; &#123;<br>    form.value = response.data;<br>    open.value = true;<br>    title.value = &quot;修改课程管理&quot;;<br>  &#125;);<br>&#125;<br><br>/** 提交按钮 */<br>function submitForm() &#123;<br>  proxy.$refs[&quot;courseRef&quot;].validate((valid) =&gt; &#123;<br>    if (valid) &#123;<br>      if (form.value.id != null) &#123;<br>        updateCourse(form.value).then((response) =&gt; &#123;<br>          proxy.$modal.msgSuccess(&quot;修改成功&quot;);<br>          open.value = false;<br>          getList();<br>        &#125;);<br>      &#125; else &#123;<br>        addCourse(form.value).then((response) =&gt; &#123;<br>          proxy.$modal.msgSuccess(&quot;新增成功&quot;);<br>          open.value = false;<br>          getList();<br>        &#125;);<br>      &#125;<br>    &#125;<br>  &#125;);<br>&#125;<br><br>/** 删除按钮操作 */<br>function handleDelete(row) &#123;<br>  const _ids = row.id || ids.value;<br>  proxy.$modal<br>    .confirm(&#x27;是否确认删除课程管理编号为&quot;&#x27; + _ids + &#x27;&quot;的数据项？&#x27;)<br>    .then(function () &#123;<br>      return delCourse(_ids);<br>    &#125;)<br>    .then(() =&gt; &#123;<br>      getList();<br>      proxy.$modal.msgSuccess(&quot;删除成功&quot;);<br>    &#125;)<br>    .catch(() =&gt; &#123;&#125;);<br>&#125;<br><br>/** 导出按钮操作 */<br>function handleExport() &#123;<br>  proxy.download(<br>    &quot;course/course/export&quot;,<br>    &#123;<br>      ...queryParams.value,<br>    &#125;,<br>    `course_$&#123;new Date().getTime()&#125;.xlsx`<br>  );<br>&#125;<br><br>// 页面加载时执行-查询课程管理列表<br>getList();<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h2 id="后端代码分析"><a href="#后端代码分析" class="headerlink" title="后端代码分析"></a>后端代码分析</h2><h3 id="CourseController"><a href="#CourseController" class="headerlink" title="CourseController"></a>CourseController</h3><p>ruoyi-admin 模块下找到这个类：com.ruoyi.web.controller.course.CourseController 里面有 5 个对应的方法接口，详细代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.course.controller;<br><br><span class="hljs-keyword">import</span> com.sky.common.annotation.Log;<br><span class="hljs-keyword">import</span> com.sky.common.core.controller.BaseController;<br><span class="hljs-keyword">import</span> com.sky.common.core.domain.AjaxResult;<br><span class="hljs-keyword">import</span> com.sky.common.core.page.TableDataInfo;<br><span class="hljs-keyword">import</span> com.sky.common.enums.BusinessType;<br><span class="hljs-keyword">import</span> com.sky.common.utils.poi.ExcelUtil;<br><span class="hljs-keyword">import</span> com.sky.course.domain.Course;<br><span class="hljs-keyword">import</span> com.sky.course.service.ICourseService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 课程管理Controller</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> itheima</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/course/course&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span><br>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ICourseService courseService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询课程管理列表</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;course:course:list&#x27;)&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> TableDataInfo <span class="hljs-title function_">list</span><span class="hljs-params">(Course course)</span><br>    &#123;<br>        <span class="hljs-comment">//1. 开启分页</span><br>        startPage();<br>        <span class="hljs-comment">//2. 查询课程列表</span><br>        List&lt;Course&gt; list = courseService.selectCourseList(course);<br>        <span class="hljs-comment">//3. 返回表格分页数据对象</span><br>        <span class="hljs-keyword">return</span> getDataTable(list);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 导出课程管理列表</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;course:course:export&#x27;)&quot;)</span><br>    <span class="hljs-meta">@Log(title = &quot;课程管理&quot;, businessType = BusinessType.EXPORT)</span><br>    <span class="hljs-meta">@PostMapping(&quot;/export&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">export</span><span class="hljs-params">(HttpServletResponse response, Course course)</span><br>    &#123;<br>        List&lt;Course&gt; list = courseService.selectCourseList(course);<br>        ExcelUtil&lt;Course&gt; util = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExcelUtil</span>&lt;Course&gt;(Course.class);<br>        util.exportExcel(response, list, <span class="hljs-string">&quot;课程管理数据&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取课程管理详细信息</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;course:course:query&#x27;)&quot;)</span><br>    <span class="hljs-meta">@GetMapping(value = &quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">getInfo</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> success(courseService.selectCourseById(id));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 新增课程管理</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;course:course:add&#x27;)&quot;)</span><br>    <span class="hljs-meta">@Log(title = &quot;课程管理&quot;, businessType = BusinessType.INSERT)</span><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Course course)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> toAjax(courseService.insertCourse(course));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改课程管理</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;course:course:edit&#x27;)&quot;)</span><br>    <span class="hljs-meta">@Log(title = &quot;课程管理&quot;, businessType = BusinessType.UPDATE)</span><br>    <span class="hljs-meta">@PutMapping</span><br>    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Course course)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> toAjax(courseService.updateCourse(course));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除课程管理</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;course:course:remove&#x27;)&quot;)</span><br>    <span class="hljs-meta">@Log(title = &quot;课程管理&quot;, businessType = BusinessType.DELETE)</span><br>    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;ids&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long[] ids)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> toAjax(courseService.deleteCourseByIds(ids));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="BaseController"><a href="#BaseController" class="headerlink" title="BaseController"></a>BaseController</h3><p>Controller 继承了 BaseController，其中 BaseController 详细定义如下图：</p><p><img src="/assets/image-20240515203205623.png" alt="image-20240515203205623"></p><h3 id="TableDataInfo"><a href="#TableDataInfo" class="headerlink" title="TableDataInfo"></a>TableDataInfo</h3><p>分页查询统一返回对象：表格分页数据对象</p><p><img src="/assets/image-20240515203308811.png" alt="image-20240515203308811"></p><h3 id="AjaxResult"><a href="#AjaxResult" class="headerlink" title="AjaxResult"></a>AjaxResult</h3><p>增删改查统一返回对象：操作消息提醒</p><p><img src="/assets/image-20240515203414483.png" alt="image-20240515203414483"></p><h3 id="BaseEntity"><a href="#BaseEntity" class="headerlink" title="BaseEntity"></a>BaseEntity</h3><p>所有实体类默认继承的 BaseEntity 基类</p><p><img src="/assets/image-20240515203531887.png" alt="image-20240515203531887"></p><h3 id="权限注解"><a href="#权限注解" class="headerlink" title="权限注解"></a>权限注解</h3><p>@PreAuthorize 注解是 Spring Security 框架中用来做权限检查的。</p><p>它在运行方法前先验证权限，权限够就放行，不够就拦截。</p><p><img src="/assets/image-20240515203653598.png" alt="image-20240515203653598"></p><p>权限控制流程图</p><p><img src="/assets/image-20240515203730129.png" alt="image-20240515203730129"> <img src="/assets/image-20240515203733871.png" alt="image-20240515203733871"></p><h2 id="前后端交互流程"><a href="#前后端交互流程" class="headerlink" title="前后端交互流程"></a>前后端交互流程</h2><p>查询课程管理列表</p><h3 id="接口文档"><a href="#接口文档" class="headerlink" title="接口文档"></a>接口文档</h3><p><img src="/assets/image-20240515203815442.png" alt="image-20240515203815442"></p><h3 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h3><p>在前端开发中，跨域是一个常见的问题，特别是在使用 Vue 框架进行开发时。跨域是指在浏览器中发送的 AJAX 请求的目标地址与当前页面的地址不在同一个域下，这会导致浏览器的同源策略产生限制，从而阻止了跨域请求的发送。然而，我们可以通过代理服务器来解决这个问题。</p><p><img src="/assets/image-20240515203903598.png" alt="image-20240515203903598"></p><p>代理服务器是位于客户端和目标服务器之间的一台服务器，它接收客户端发送的请求，并将请求转发给目标服务器。通过在代理服务器上进行请求转发，可以绕过浏览器的同源策略限制，从而实现跨域请求。</p><p>在 vue.config.js 文件中添加以下内容：</p><p><img src="/assets/image-20240515203936120.png" alt="image-20240515203936120"></p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>若依</tag>
      
      <tag>springboot</tag>
      
      <tag>vue</tag>
      
      <tag>mysql</tag>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>419小U的数列因子挑战</title>
    <link href="/2025/02/03/419%E5%B0%8FU%E7%9A%84%E6%95%B0%E5%88%97%E5%9B%A0%E5%AD%90%E6%8C%91%E6%88%98/"/>
    <url>/2025/02/03/419%E5%B0%8FU%E7%9A%84%E6%95%B0%E5%88%97%E5%9B%A0%E5%AD%90%E6%8C%91%E6%88%98/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>512会议按时抵达所需的最小延迟跳过次数</title>
    <link href="/2025/02/02/512%E4%BC%9A%E8%AE%AE%E6%8C%89%E6%97%B6%E6%8A%B5%E8%BE%BE%E6%89%80%E9%9C%80%E7%9A%84%E6%9C%80%E5%B0%8F%E5%BB%B6%E8%BF%9F%E8%B7%B3%E8%BF%87%E6%AC%A1%E6%95%B0/"/>
    <url>/2025/02/02/512%E4%BC%9A%E8%AE%AE%E6%8C%89%E6%97%B6%E6%8A%B5%E8%BE%BE%E6%89%80%E9%9C%80%E7%9A%84%E6%9C%80%E5%B0%8F%E5%BB%B6%E8%BF%9F%E8%B7%B3%E8%BF%87%E6%AC%A1%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p>思路<br>使用动态规划求解。在每条路线上维护一个数组 dp，其中 dp[i][j] 表示前i条路线后恰好跳过 j 次等待时所需的最短时间。然后可以使用滚动数组进行优化，即只维护一个长度为 n 的 dp 数组。</p></li><li><p>状态转移</p><ul><li>对于第一条路线，时间为 dist[0] &#x2F; speed，不需要等待。</li><li>对于后续路线，第 i 条的时间有两种选择：<ul><li>不跳过等待：需要等待至最近的整数小时，即 dp[j] &#x3D; ceil(前一状态的时间) + 当前路程时间</li><li>跳过等待：直接加上当前路程的时间，即 dp[j] &#x3D; 前一状态的时间 + 当前路程时间，同时跳过次数增加 1<br>最后取两种方法的较优值更新 dp。</li></ul></li></ul></li></ol><h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> ceil<br>inf = <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">dist: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], speed: <span class="hljs-built_in">int</span>, hoursBefore: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    n = <span class="hljs-built_in">len</span>(dist)<br>    pre = [inf] * n<br>    pre[<span class="hljs-number">0</span>] = dist[<span class="hljs-number">0</span>] / speed<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n):<br>        cur = [inf] * n<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>):<br>            <span class="hljs-comment"># 用, 不用</span><br>            cur[j] = <span class="hljs-built_in">min</span>(pre[j - <span class="hljs-number">1</span>], ceil(pre[j]) <span class="hljs-keyword">if</span> pre[j] != inf <span class="hljs-keyword">else</span> inf) + dist[i] / speed<br>        pre = cur.copy()<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">if</span> pre[j] &lt;= hoursBefore:<br>            <span class="hljs-keyword">return</span> j<br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(dist=[<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>], speed=<span class="hljs-number">5</span>, hoursBefore=<span class="hljs-number">3</span>) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(dist=[<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>], speed=<span class="hljs-number">7</span>, hoursBefore=<span class="hljs-number">4</span>) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(dist=[<span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>], speed=<span class="hljs-number">4</span>, hoursBefore=<span class="hljs-number">8</span>) == <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>时间复杂度：$O(n^2)$，其中 n 为路线数量。<br>空间复杂度：$O(n)$。</p>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>393小F的超市购物策略</title>
    <link href="/2025/02/01/393%E5%B0%8FF%E7%9A%84%E8%B6%85%E5%B8%82%E8%B4%AD%E7%89%A9%E7%AD%96%E7%95%A5/"/>
    <url>/2025/02/01/393%E5%B0%8FF%E7%9A%84%E8%B6%85%E5%B8%82%E8%B4%AD%E7%89%A9%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 F 需要在初始金额 x 内购物，每个商品有价格 a[i] 和喜爱度 b[i]。目标是在不超出预算的情况下获得最大化的喜爱度和。特殊之处在于：</p><ul><li>初始没有优惠机会，只有在原价购买（支付 a[i]）后，才获得下一个商品半价购买（支付 a[i]&#x2F;&#x2F;2）的优惠机会；</li><li>如果优惠机会未使用（状态 op 为 1），可以选择对当前商品使用优惠（半价购买），但使用后恢复普通状态（op 变为 0）；</li><li>跳过或使用优惠购买后，优惠机会均被重置为 0，即必须重新原价购买才能获得优惠资格。</li></ul><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>用 DFS + 记忆化（cache）来搜索所有可能的购买组合。<br> 定义递归函数 dfs(i, j, op)：</p><ul><li>i：当前处理的商品下标</li><li>j：剩余金额</li><li>op：优惠状态（1 表示可以半价购买，0 表示无优惠机会）<br>对于每个商品有三种选择：</li><li>跳过该商品：金额不变，且状态重置为 0</li><li>如果有优惠机会（op &#x3D;&#x3D; 1）且剩余金额够商品半价，则可半价购买，金额减少 a[i]&#x2F;&#x2F;2，购买后状态置为 0</li><li>如果剩余金额够以原价购买，则购买该商品，金额减少 a[i]，同时获得下一个商品使用优惠的机会，即状态变为 1<br>最终返回达到末尾时获得的喜爱度总和的最大值。</li></ul><h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> cache<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, x: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span>, b: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br><span class="hljs-meta">    @cache</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">i, j, op</span>):<br>        <span class="hljs-keyword">if</span> i == n:  <span class="hljs-comment"># 所有商品处理完毕</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        <span class="hljs-comment"># 不购买，且状态重置为 0</span><br>        res = dfs(i + <span class="hljs-number">1</span>, j, <span class="hljs-number">0</span>)<br>        <span class="hljs-comment"># 若有优惠机会，尝试半价购买</span><br>        <span class="hljs-keyword">if</span> op == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> j &gt;= a[i] // <span class="hljs-number">2</span>:<br>            res = <span class="hljs-built_in">max</span>(res, dfs(i + <span class="hljs-number">1</span>, j - a[i] // <span class="hljs-number">2</span>, <span class="hljs-number">0</span>) + b[i])<br>        <span class="hljs-comment"># 尝试原价购买，并获得优惠机会</span><br>        <span class="hljs-keyword">if</span> j &gt;= a[i]:<br>            res = <span class="hljs-built_in">max</span>(res, dfs(i + <span class="hljs-number">1</span>, j - a[i], <span class="hljs-number">1</span>) + b[i])<br>        <span class="hljs-keyword">return</span> res<br><br>    <span class="hljs-keyword">return</span> dfs(<span class="hljs-number">0</span>, x, <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>时间复杂度：$O(n * x)$，其中 n 为商品数量，x 为初始金额。<br>空间复杂度：$O(n * x)$。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>386小C的合法k-size字符串问题</title>
    <link href="/2025/02/01/386%E5%B0%8FC%E7%9A%84%E5%90%88%E6%B3%95k-size%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%97%AE%E9%A2%98/"/>
    <url>/2025/02/01/386%E5%B0%8FC%E7%9A%84%E5%90%88%E6%B3%95k-size%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 C 最近在研究合法的 k-size 字符串。一个字符串被称为 k-size，是指它可以被分成恰好 k 段连续的相同字符组成的子串。</p><p>例如：</p><ul><li>字符串 “aabbbccc” 是 3-size，因为它可以分成 [“aa”, “bbb”, “ccc”] 这三段。</li><li>字符串 “ababaab” 是 6-size，因为它可以分成 [“a”, “b”, “a”, “b”, “aa”, “b”] 这六段。</li></ul><p>小 C 认为，只有当每个连续段的长度至少为 2 时，该字符串才是合法的。例如，”aabbbccc” 是合法的，而 “ababaab” 不是合法的。</p><p>现在，给定字符串长度 n 和要求的连续段数量 k，小 C 想知道，长度为 n 的、仅由小写字母组成的合法的 k-size 字符串有多少个？答案可能非常大，请将结果对 10^9+7 取模。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><strong>分段计数</strong><br> 将字符串分成 k 段，每段由相同字符组成，且每段长度至少为 2。设每段的长度为 L₁, L₂, …, Lₖ，则有<br>  L₁ + L₂ + … + Lₖ &#x3D; n，并且 Lᵢ ≥ 2。<br> 令 xᵢ &#x3D; Lᵢ - 2（xᵢ ≥ 0），则<br>  x₁ + x₂ + … + xₖ &#x3D; n - 2k。<br> 非负整数解的个数即为<br>  C((n - 2k) + k - 1, k - 1) &#x3D; C(n - k - 1, k - 1)。</p></li><li><p><strong>选字母方案</strong><br>每一段所用的字符均相同，且相邻段的字符不同。</p><ul><li>第一段有 26 种选法</li><li>剩余每段必须和前一段不同，因此每段有 25 种选法<br>故字母的选取方案为 26 × 25^(k - 1)。</li></ul></li><li><p><strong>最终答案</strong><br> 合法的 k-size 字符串数为两部分组合，即<br>   答案 &#x3D; C(n - k - 1, k - 1) × 26 × 25^(k - 1)。<br> 由于 n 和 k 可能较大，计算过程中需要使用模 1e9+7。</p></li></ol><h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">def</span> C(n, m, p):<br>    <span class="hljs-attribute">if</span> m &lt; <span class="hljs-number">0</span> or n &lt; m:<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-attribute">if</span> m == <span class="hljs-number">0</span>:<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-attribute">m</span> = min(m, n - m)<br>    <span class="hljs-attribute">a</span> = <span class="hljs-number">1</span><br>    <span class="hljs-attribute">b</span> = <span class="hljs-number">1</span><br>    <span class="hljs-attribute">for</span> i in range(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):<br>        <span class="hljs-attribute">a</span> = a * (n - i + <span class="hljs-number">1</span>) % p<br>        <span class="hljs-attribute">b</span> = (b * i) % p<br>    <span class="hljs-attribute">return</span> a * pow(b, p - <span class="hljs-number">2</span>, p) % p<br><br><span class="hljs-attribute">def</span> lucas(n, m, p):<br>    <span class="hljs-attribute">return</span> C(n % p, m % p, p) * lucas(n // p, m // p, p) % p if m else <span class="hljs-number">1</span><br><br><span class="hljs-attribute">mod</span> = int(<span class="hljs-number">1</span>e9 + <span class="hljs-number">7</span>)<br><span class="hljs-attribute">def</span> solution(n: int, k:int) -&gt; int:<br>    <span class="hljs-attribute">return</span> lucas(n - k - <span class="hljs-number">1</span>, k - <span class="hljs-number">1</span>, mod) * <span class="hljs-number">26</span> * pow(<span class="hljs-number">25</span>, k - <span class="hljs-number">1</span>, mod) % mod<br><br><span class="hljs-attribute">if</span> __name__ == &#x27;__main__&#x27;:<br>    <span class="hljs-attribute">print</span>(solution(n = <span class="hljs-number">2</span>, k = <span class="hljs-number">1</span>) == <span class="hljs-number">26</span>)<br>    <span class="hljs-attribute">print</span>(solution(n = <span class="hljs-number">4</span>, k = <span class="hljs-number">2</span>) == <span class="hljs-number">650</span>)<br>    <span class="hljs-attribute">print</span>(solution(n = <span class="hljs-number">10</span>, k = <span class="hljs-number">5</span>) == <span class="hljs-number">10156250</span>)<br><br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>时间复杂度：$O(k)$。<br>空间复杂度：$O(1)$。</p>]]></content>
    
    
    
    <tags>
      
      <tag>组合数学</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>374字符串权值最小化分割问题</title>
    <link href="/2025/02/01/374%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9D%83%E5%80%BC%E6%9C%80%E5%B0%8F%E5%8C%96%E5%88%86%E5%89%B2%E9%97%AE%E9%A2%98/"/>
    <url>/2025/02/01/374%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9D%83%E5%80%BC%E6%9C%80%E5%B0%8F%E5%8C%96%E5%88%86%E5%89%B2%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 G 定义了一个字符串的权值为：字符串的长度乘以字符串中不同字母的种类数量。现在，小 G 有一个字符串，她希望将这个字符串切分成 <code>k</code> 个子串，并希望这些子串的最大权值尽可能小。你需要帮助小 G 找到最优的切分方案，使得这 <code>k</code> 个子串中的最大权值最小化。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>看见最大值最小化直接二分答案，然后判断是否能够切分成 <code>k</code> 个子串。<br><code>check</code>的时候，遍历字符串，用一个集合记录当前子串的不同字母，如果当前子串的不同字母数量乘以当前子串的长度大于 <code>mid</code>，则说明需要切分，切分的次数加一。<br>最后判断切分的次数是否大于 <code>k</code>，如果大于 <code>k</code>，说明 <code>mid</code> 太小，需要增大，否则减小。</p><h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    n = <span class="hljs-built_in">len</span>(s)<br>    l, r = <span class="hljs-number">1</span>, <span class="hljs-number">26</span> * n<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">mid</span>):<br>        d = <span class="hljs-built_in">set</span>()<br>        cnt = length = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            length += <span class="hljs-number">1</span><br>            d.add(s[i])<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(d) * length &gt; mid:<br>                length = <span class="hljs-number">1</span><br>                d = <span class="hljs-built_in">set</span>(&#123;s[i]&#125;)<br>                cnt += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> cnt + <span class="hljs-number">1</span> &gt; k<br><br>    <span class="hljs-keyword">while</span> l &lt;= r:<br>        mid = l + r &gt;&gt; <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> check(mid):<br>            l = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            r = mid - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> l<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;ababbbb&quot;</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">6</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;abcabcabc&quot;</span>, <span class="hljs-number">3</span>) == <span class="hljs-number">9</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;aaabbbcccddd&quot;</span>, <span class="hljs-number">4</span>) == <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><p><strong>时间复杂度</strong>：</p><ul><li>二分查找的时间复杂度为 <code>O(log (26 * n))</code>。</li><li>每次 <code>check</code> 调用的时间复杂度为 <code>O(n)</code>，因为需要遍历整个字符串。</li><li>因此，总的时间复杂度为 <code>O(n log (26 * n))</code>。</li></ul></li><li><p><strong>空间复杂度</strong>：</p><ul><li>使用了常数级别的额外空间，空间复杂度为 <code>O(1)</code>。</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>二分</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>410小R的数组构造挑战</title>
    <link href="/2025/01/31/410%E5%B0%8FR%E7%9A%84%E6%95%B0%E7%BB%84%E6%9E%84%E9%80%A0%E6%8C%91%E6%88%98/"/>
    <url>/2025/01/31/410%E5%B0%8FR%E7%9A%84%E6%95%B0%E7%BB%84%E6%9E%84%E9%80%A0%E6%8C%91%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 R 有一个长度为 <code>n</code> 的数组，数组相邻元素的差值最多为 <code>1</code>，即 $|a_i − a_{i+1}| ≤ 1$，且数组中的元素都是正整数，即 $a_i ≥ 1$。现在已知数组的长度为 <code>n</code>，数组的和为 <code>m</code>，小 R 想知道所有符合条件的数组中，第 $p$ 个位置的元素 $a_p$ 的最大值是多少。</p><h4 id="约束条件："><a href="#约束条件：" class="headerlink" title="约束条件："></a>约束条件：</h4><ul><li><code>1 ≤ p ≤ n ≤ m</code></li></ul><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><strong>二分查找</strong>：</p><ul><li>使用二分查找在范围 <code>[1, m]</code> 内寻找 <code>a_p</code> 的最大可能值。</li><li><code>l</code> 表示当前范围的下界，<code>r</code> 表示上界。</li></ul></li><li><p><strong>辅助函数 <code>calc(i, v)</code></strong>：</p><ul><li>计算从位置 <code>i</code> 开始，向两边扩展时，每个位置的值如何分配，使得相邻元素差值不超过 <code>1</code>。</li><li>如果 <code>v &gt; i</code>，则左侧的元素从 <code>v - i + 1</code> 递增到 <code>v</code>，形成等差数列。</li><li>如果 <code>v ≤ i</code>，则前 <code>v</code> 个元素递增，剩下的元素为 <code>1</code>。</li><li>可以通过等差数列求和公式$O(1)$计算。</li></ul></li></ol><h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, m: <span class="hljs-built_in">int</span>, p: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">i, v</span>):<br>        <span class="hljs-keyword">if</span> v &gt; i:<br>            <span class="hljs-keyword">return</span> (v + v - i + <span class="hljs-number">1</span>) * i // <span class="hljs-number">2</span><br>        <span class="hljs-keyword">return</span> v * (v + <span class="hljs-number">1</span>) // <span class="hljs-number">2</span> + i - v<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">x</span>):<br>        <span class="hljs-keyword">return</span> calc(p, x) + calc(n - p + <span class="hljs-number">1</span>, x) - x<br><br>    l, r = <span class="hljs-number">1</span>, m<br>    <span class="hljs-keyword">while</span> l &lt;= r:<br>        mid = l + r &gt;&gt; <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> check(mid) &lt;= m:<br>            l = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            r = mid - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> r<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">1</span>) == <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">3</span>) == <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><p><strong>时间复杂度</strong>：</p><ul><li>二分查找的时间复杂度为 <code>O(log m)</code>。每次 <code>check</code> 调用的时间复杂度为 <code>O(1)</code>，因为 <code>calc</code> 函数的计算是常数时间。因此，总的时间复杂度为 <code>O(log m)</code>。</li></ul></li><li><p><strong>空间复杂度</strong>：</p><ul><li>使用了常数级别的额外空间，空间复杂度为 <code>O(1)</code>。</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>二分</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>403小N的改数组问题</title>
    <link href="/2025/01/29/403%E5%B0%8FN%E7%9A%84%E6%94%B9%E6%95%B0%E7%BB%84%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/29/403%E5%B0%8FN%E7%9A%84%E6%94%B9%E6%95%B0%E7%BB%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>题目要求在一个正整数的表示中，恰好修改 <code>k</code> 位，使其成为 75 的倍数。要满足 75 的倍数条件，必须满足以下两点：</p><ol><li><p><strong>末两位是 00、25、50 或 75</strong>：这是因为 75 是 25 和 3 的最小公倍数，所以数的末两位需要是上述之一以满足被 25 整除，同时整个数的数字之和需要被 3 整除。</p></li><li><p><strong>数字之和被 3 整除</strong>：这是因为一个数能被 75 整除当且仅当其各位数字之和能被 3 整除。</p></li><li><p><strong>状态参数</strong>：</p><ul><li><code>i</code>: 当前处理的位数位置。</li><li><code>left</code>: 剩余可以修改的位数。</li><li><code>is_num</code>: 是否已经开始形成有效数字（防止前导零）。</li><li><code>sum</code>: 当前数字之和模 3 的值。</li></ul></li><li><p><strong>递归终止条件</strong>：</p><ul><li>当处理到倒数第二位时，检查末两位是否可以组成 <code>00</code>, <code>25</code>, <code>50</code>, <code>75</code> 之一，并且总修改次数与 <code>left</code> 相等，同时数字之和满足被 3 整除的条件。</li></ul></li><li><p><strong>选择每一位数字</strong>：</p><ul><li>对于每一位，根据是否已经开始形成数字 (<code>is_num</code>) 决定当前位可以取的最小值（防止前导零）。</li><li>尝试所有可能的数字（0-9），并相应地更新剩余修改次数和数字之和。</li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> cache<br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    n = <span class="hljs-built_in">len</span>(s)<br>    <span class="hljs-keyword">if</span> n &lt;= <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><span class="hljs-meta">    @cache</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">i, left, is_num, <span class="hljs-built_in">sum</span></span>):<br>        <span class="hljs-keyword">if</span> left &lt; <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        <span class="hljs-keyword">if</span> i == n - <span class="hljs-number">2</span>:<br>            ans = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;00&quot;</span>, <span class="hljs-string">&quot;25&quot;</span>, <span class="hljs-string">&quot;50&quot;</span>, <span class="hljs-string">&quot;75&quot;</span>]:<br>                <span class="hljs-keyword">if</span> t == <span class="hljs-string">&quot;00&quot;</span> <span class="hljs-keyword">and</span> is_num == <span class="hljs-literal">False</span>:<br>                    <span class="hljs-keyword">continue</span><br>                cnt = (t[<span class="hljs-number">0</span>] != s[i]) + (t[<span class="hljs-number">1</span>] != s[i + <span class="hljs-number">1</span>])<br>                <span class="hljs-keyword">if</span> cnt != left <span class="hljs-keyword">or</span> (<span class="hljs-built_in">int</span>(t[<span class="hljs-number">0</span>]) + <span class="hljs-built_in">int</span>(t[<span class="hljs-number">1</span>]) + <span class="hljs-built_in">sum</span>) % <span class="hljs-number">3</span>:<br>                    <span class="hljs-keyword">continue</span><br>                ans += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">return</span> ans<br>        res = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span> <span class="hljs-keyword">if</span> is_num <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>, <span class="hljs-number">10</span>):<br>            res += dfs(i + <span class="hljs-number">1</span>, left - (j != <span class="hljs-built_in">int</span>(s[i])), is_num <span class="hljs-keyword">or</span> j, (<span class="hljs-built_in">sum</span> + j) % <span class="hljs-number">3</span>)<br>        <span class="hljs-keyword">return</span> res % mod<br>    res = dfs(<span class="hljs-number">0</span>, k, <span class="hljs-literal">False</span>, <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(s = <span class="hljs-string">&quot;3554&quot;</span>, k = <span class="hljs-number">2</span>) == <span class="hljs-number">7</span>)<br>    <span class="hljs-built_in">print</span>(solution(s = <span class="hljs-string">&quot;6005&quot;</span>, k = <span class="hljs-number">1</span>) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(s = <span class="hljs-string">&quot;911154&quot;</span>, k = <span class="hljs-number">3</span>) == <span class="hljs-number">187</span>)<br><br><br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：由于使用了记忆化搜索，状态数为 <code>n * k * 2 * 3</code>，其中 <code>n</code> 是数字长度，<code>k</code> 是允许修改的位数。同时枚举了每位被修改成哪个数字。因此，时间复杂度为 <code>O(n * k * 2 * 3 * 10)</code>。其中<code>n</code>为字符串<code>s</code>的长度。</li><li><strong>空间复杂度</strong>：同样为 <code>O(n * k * 2 * 3)</code>，用于存储记忆化搜索的状态。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>398小L的元素修改问题</title>
    <link href="/2025/01/29/398%E5%B0%8FL%E7%9A%84%E5%85%83%E7%B4%A0%E4%BF%AE%E6%94%B9%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/29/398%E5%B0%8FL%E7%9A%84%E5%85%83%E7%B4%A0%E4%BF%AE%E6%94%B9%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>小 R 拿到了一个数组，她可以进行如下操作：使得一个元素加<code>1</code>，另一个元素减<code>1</code>。她希望最终数组的每个元素大小都在$ [l, r] $的范围内。小 R 想知道，最少需要多少次操作可以达到目标。</p><p>如果无法通过有限次操作使所有元素都落在指定范围内，则返回 <code>-1</code>。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>为了使数组中的所有元素都落在区间 ([l, r]) 内，小 R 可以通过进行以下操作来调整数组：</p><ol><li><p><strong>统计调整需求</strong>：</p><ul><li>遍历数组，计算所有小于 (l) 的元素需要增加的总次数（记为 <code>cnt1</code>）。</li><li>计算所有大于 (r) 的元素需要减少的总次数（记为 <code>cnt2</code>）。</li></ul></li><li><p><strong>验证总和条件</strong>：</p><ul><li><p>计算数组元素的总和 (s)。</p></li><li><p>检查是否满足 (l \times n \leq s \leq r \times n)。</p><ul><li>如果不满足，说明无法通过有限次操作将所有元素调整到指定范围内，返回 <code>-1</code>。</li></ul></li><li><p>如果满足总和条件，所需的最小操作次数为 <code>cnt1</code> 和 <code>cnt2</code> 中的较大值。这是因为每一次操作可以同时满足一个增加和一个减少的需求。</p></li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, l: <span class="hljs-built_in">int</span>, r: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    cnt1 = cnt2 = s = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a:<br>        <span class="hljs-keyword">if</span> x &lt; l:<br>            cnt1 += l - x<br>        <span class="hljs-keyword">if</span> x &gt; r:<br>            cnt2 += x - r<br>        s += x<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(cnt1, cnt2) <span class="hljs-keyword">if</span> l * n &lt;= s &lt;= r * n <span class="hljs-keyword">else</span> -<span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">2</span>, l = <span class="hljs-number">3</span>, r = <span class="hljs-number">5</span>, a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]) == -<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">3</span>, l = <span class="hljs-number">4</span>, r = <span class="hljs-number">6</span>, a = [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">4</span>, l = <span class="hljs-number">2</span>, r = <span class="hljs-number">8</span>, a = [<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>]) == <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>时间复杂度：$O(n)$，其中$ n $是数组的长度。<br>空间复杂度：$O(1)$。</p>]]></content>
    
    
    
    <tags>
      
      <tag>贪心</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>433数组元素最小操作次数问题</title>
    <link href="/2025/01/27/433%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0%E6%9C%80%E5%B0%8F%E6%93%8D%E4%BD%9C%E6%AC%A1%E6%95%B0%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/27/433%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0%E6%9C%80%E5%B0%8F%E6%93%8D%E4%BD%9C%E6%AC%A1%E6%95%B0%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>我们需要将数组中的所有元素通过一系列“除以 2 并向下取整”的操作变得相等。目标是找到最少的操作次数使得所有元素相等。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><strong>记录每个数及其通过不断除以 2 后可能出现的值：</strong></p><ul><li>对于数组中的每个元素 <code>x</code>，记录它本身及其通过不断除以 2 后得到的所有可能值。</li><li>同时记录将 <code>x</code> 变成这些值所需的操作次数。</li></ul></li><li><p><strong>使用哈希表统计：</strong></p><ul><li>使用两个字典 <code>cnt</code> 和 <code>d</code>：<ul><li><code>cnt[x]</code>：记录值 <code>x</code> 出现的次数，即有多少个元素可以通过某些操作变成 <code>x</code>。</li><li><code>d[x]</code>：记录所有将元素变成 <code>x</code> 所需的总操作次数。</li></ul></li></ul></li><li><p><strong>遍历所有可能的目标值，找到最小的总操作次数：</strong></p><ul><li>遍历字典 <code>cnt</code> 中的所有键 <code>x</code>，如果 <code>cnt[x]</code> 等于数组的长度 <code>n</code>，表示所有元素都可以被转换为 <code>x</code>。</li><li>在满足条件的 <code>x</code> 中，选择 <code>d[x]</code> 最小的作为答案。</li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    d = defaultdict(<span class="hljs-built_in">int</span>)<br>    cnt = defaultdict(<span class="hljs-built_in">int</span>)<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a:<br>        cnt[x] += <span class="hljs-number">1</span><br>        i = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> x:<br>            i += <span class="hljs-number">1</span><br>            x //= <span class="hljs-number">2</span><br>            cnt[x] += <span class="hljs-number">1</span><br>            d[x] += i<br>    res = <span class="hljs-built_in">min</span>(d[x] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> cnt <span class="hljs-keyword">if</span> cnt[x] == n)<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">4</span>, a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>]) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">1</span>, a = [<span class="hljs-number">114514</span>]) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">5</span>, a = [<span class="hljs-number">16</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]) == <span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度：</strong> O(n log MAX)，其中 <code>n</code> 是数组的长度，<code>MAX</code> 是数组中最大元素的值。因为对于每个元素，最多需要进行 log(MAX) 次除以 2 的操作。</li><li><strong>空间复杂度：</strong> O(n log MAX)，用于存储所有可能的中间值及其对应的操作次数。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>稀土掘金</tag>
      
      <tag>哈希表</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>448最大连续子数组和问题</title>
    <link href="/2025/01/27/448%E6%9C%80%E5%A4%A7%E8%BF%9E%E7%BB%AD%E5%AD%90%E6%95%B0%E7%BB%84%E5%92%8C%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/27/448%E6%9C%80%E5%A4%A7%E8%BF%9E%E7%BB%AD%E5%AD%90%E6%95%B0%E7%BB%84%E5%92%8C%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>给定一个整数数组，允许最多进行一次修改，将任意一个元素修改为任意给定的值 <code>x</code>。求经过修改后，能够得到的连续子数组的最大和。</p><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>一个比较经典的动态规划，需要注意的是题目要求的是必须恰好修改一次。</p><ol><li><p><strong>特殊情况处理</strong>：</p><ul><li>当数组长度为 1 时，返回 <code>x</code>。</li><li>如果数组中所有元素都小于等于 0，返回数组中最大的元素和 <code>x</code> 中的较大者。</li></ul></li><li><p><strong>前缀和计算</strong>：</p><ul><li>使用后缀数组 <code>suf</code>，其中 <code>suf[i]</code> 表示从第 <code>i</code> 个元素开始的最大子数组和。</li><li>从数组末尾向前遍历，更新 <code>suf[i]</code> 为 <code>suf[i+1] + a[i-1]</code> 和 <code>0</code> 的较大值。</li></ul></li><li><p><strong>遍历数组并计算结果</strong>：</p><ul><li>使用变量 <code>f</code> 来记录当前的最大子数组和。</li><li>对于每个位置 <code>i</code>，计算将 <code>a[i-1]</code> 修改为 <code>x</code> 后的最大子数组和，更新结果 <code>res</code>。</li><li>更新 <code>f</code> 为 <code>f + a[i-1]</code> 和 <code>0</code> 的较大值，以便下一次迭代使用。</li></ul></li></ol><h2 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, x: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> x<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(i &lt;= <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(a + [x])<br>    suf = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        suf[i] = <span class="hljs-built_in">max</span>(suf[i + <span class="hljs-number">1</span>] + a[i - <span class="hljs-number">1</span>], <span class="hljs-number">0</span>)<br>    res = f = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        res = <span class="hljs-built_in">max</span>(res, f + suf[i + <span class="hljs-number">1</span>] + x, f, suf[i + <span class="hljs-number">1</span>])<br>        f = <span class="hljs-built_in">max</span>(f + a[i - <span class="hljs-number">1</span>], <span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">5</span>, x = <span class="hljs-number">10</span>, a = [<span class="hljs-number">5</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">5</span>, -<span class="hljs-number">3</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">15</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">2</span>, x = -<span class="hljs-number">3</span>, a = [-<span class="hljs-number">5</span>, -<span class="hljs-number">2</span>]) == -<span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">6</span>, x = <span class="hljs-number">10</span>, a = [<span class="hljs-number">4</span>, -<span class="hljs-number">2</span>, -<span class="hljs-number">11</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, -<span class="hljs-number">1</span>]) == <span class="hljs-number">15</span>)<br><br></code></pre></td></tr></table></figure><h2 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h2><ul><li><strong>时间复杂度</strong>：O(n)，其中 n 是数组的长度。需要两次遍历数组。</li><li><strong>空间复杂度</strong>：O(n)，用于存储后缀数组 <code>suf</code>。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>贪心</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>412小S的子序列平均数之和</title>
    <link href="/2025/01/27/412%E5%B0%8FS%E7%9A%84%E5%AD%90%E5%BA%8F%E5%88%97%E5%B9%B3%E5%9D%87%E6%95%B0%E4%B9%8B%E5%92%8C/"/>
    <url>/2025/01/27/412%E5%B0%8FS%E7%9A%84%E5%AD%90%E5%BA%8F%E5%88%97%E5%B9%B3%E5%9D%87%E6%95%B0%E4%B9%8B%E5%92%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>小 S 得到了一个由 <code>n</code> 个元素组成的数组，她想求出所有子序列的平均数之和。由于子序列的数量非常多，因此需要对结果取模 (10^9 + 7) 来避免结果过大。子序列是从原数组中选择部分元素，保持原数组的顺序形成的新数组。</p><p>你需要输出所有子序列的平均数之和对 (10^9 + 7) 取模的值。</p><p>可以证明，最终的答案一定是一个有理数 (\frac{a}{b})，对 (p) 取模的意义是在 ([0, p-1]) 区间找到一个满足 (x \cdot b \mod p &#x3D; a) 的 (x)。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目要求计算所有子序列的平均数之和。由于子序列的数量指数级增长，直接枚举所有子序列会导致时间复杂度过高。因此，我们需要找到一种高效的方法来计算结果。</p><p>考虑到子序列的平均数可以表示为子序列元素之和除以子序列的长度，我们可以将问题转化为计算所有子序列元素之和的加权和，其中权重是子序列长度的倒数。</p><p>具体步骤如下：</p><ol><li><p><strong>组合数学</strong>：对于长度为<code>i</code>的子序列，一共有<code>C(n, i)</code>中，而每个元素在子序列中的出现的次数为<code>C(n-1, i-1)</code>，因此可以直接计算出子序列元素之和的加权和。</p></li><li><p><strong>预处理组合数</strong>：为了快速计算组合数 <code>C(n, k)</code>，我们提前计算阶乘和逆阶乘，并利用模反元素进行组合数的计算。</p></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>N = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e5</span> + <span class="hljs-number">10</span>)<br>fac = [<span class="hljs-number">1</span>] * N<br>infac = [<span class="hljs-number">1</span>] * N<br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, N):<br>    fac[i] = fac[i - <span class="hljs-number">1</span>] * i % mod<br>    infac[i] = infac[i - <span class="hljs-number">1</span>] * <span class="hljs-built_in">pow</span>(i, mod - <span class="hljs-number">2</span>, mod) % mod<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">comb</span>(<span class="hljs-params">n, k</span>):<br>    <span class="hljs-keyword">return</span> fac[n] * infac[n - k] % mod * infac[k] % mod<br><br>inv = <span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">pow</span>(x, mod - <span class="hljs-number">2</span>, mod)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, arr: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    s = <span class="hljs-built_in">sum</span>(arr)<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        res = (res + s * comb(n - <span class="hljs-number">1</span>, i - <span class="hljs-number">1</span>) * inv(i)) % mod<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]) == <span class="hljs-number">14</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>]) == <span class="hljs-number">500000008</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]) == <span class="hljs-number">15</span>)<br><br><br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>时间复杂度: $O(n)$, 预处理组合数的时间复杂度为$O(n)$，计算结果的时间复杂度为$O(n)$。<code>pow</code>可以再预处理一下。<br>空间复杂度: $O(n)$</p>]]></content>
    
    
    
    <tags>
      
      <tag>组合数学</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>606画作</title>
    <link href="/2025/01/25/606%E7%94%BB%E4%BD%9C/"/>
    <url>/2025/01/25/606%E7%94%BB%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在一个充满色彩的艺术画廊里，小艾拥有 <code>n</code> 幅长度不一的画作，每幅画的长度都是从 <code>1</code> 到 <code>n</code> 的自然数。小艾的目标是将这些画作以特定的顺序摆放，并确保从入口处可以清晰地恰好看到 <code>k</code> 幅画作。判断某幅画是否可见的标准是：它左侧的画作中没有比它更高的遮挡物。</p><p>小艾想要计算出所有可能的摆放方式，以满足上述可见性条件。由于结果可能会非常庞大，需要将最终的答案对 <code>10^9 + 7</code> 进行取模后输出。</p><p><strong>约束条件：</strong></p><ul><li>时间限制：3 秒</li><li>数据范围为 <code>1 ≤ k ≤ n ≤ 3000</code></li></ul><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>这道题目可以通过动态规划来解决。定义 <code>dp[i][j]</code> 表示前 <code>i</code> 幅画中恰好有 <code>j</code> 幅画可见的排列数。对于每一幅画，我们有两种选择：</p><ol><li><strong>当前画作是最高的</strong>：此时它一定是可见的，因此 <code>dp[i][j] += dp[i-1][j-1]</code>。</li><li><strong>当前画作不是最高的</strong>：这样它不会被看到，除了最高的还有 <code>i</code> 种选择来保持不是最高的状态，因此 <code>dp[i][j] += dp[i-1][j] * i</code>。</li></ol><p>为了优化空间复杂度，可以使用滚动数组，仅保留前一状态和当前状态。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, k: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    pre = [<span class="hljs-number">0</span>] * (k + <span class="hljs-number">1</span>)<br>    pre[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        cur = [<span class="hljs-number">0</span>] * (k + <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, k + <span class="hljs-number">1</span>):<br>            cur[j] = (pre[j - <span class="hljs-number">1</span>] + i * pre[j]) % mod<br>        pre = cur.copy()<br>    <span class="hljs-keyword">return</span> pre[k]<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n=<span class="hljs-number">4</span>, k=<span class="hljs-number">2</span>) == <span class="hljs-number">11</span>)<br>    <span class="hljs-built_in">print</span>(solution(n=<span class="hljs-number">6</span>, k=<span class="hljs-number">3</span>) == <span class="hljs-number">225</span>)<br>    <span class="hljs-built_in">print</span>(solution(n=<span class="hljs-number">7</span>, k=<span class="hljs-number">4</span>) == <span class="hljs-number">735</span>)<br>    <span class="hljs-built_in">print</span>(solution(n=<span class="hljs-number">9</span>, k=<span class="hljs-number">5</span>) == <span class="hljs-number">22449</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>602金银珠宝的数值</title>
    <link href="/2025/01/25/602%E9%87%91%E9%93%B6%E7%8F%A0%E5%AE%9D%E7%9A%84%E6%95%B0%E5%80%BC/"/>
    <url>/2025/01/25/602%E9%87%91%E9%93%B6%E7%8F%A0%E5%AE%9D%E7%9A%84%E6%95%B0%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在一个神秘的竞技场中，勇敢的探险者小青拥有两个宝箱：一个宝箱里装满了 n 个金银珠宝的数值，另一个则是一个包含 m 个神秘符文的序列。小青面临着一个挑战：在接下来的 m 轮中，他必须在这两者之间做出明智的选择，以获得最高的财富。</p><p>在每一轮（第 i 轮）中，小青可以选择从宝箱的最上面或最下面取出一个珠宝 x。然后，他会将这个珠宝的价值乘以对应的符文 c[i]，并把结果累加到他的总财富中。被取出的珠宝将从宝箱中消失，接着小青会继续下一轮操作，直到完成 m 轮。</p><p>你的任务是帮助小青计算，在完成 m 轮挑战后，他可以获得的最高财富是多少。</p><p><strong>输入：</strong></p><ul><li><code>stones</code>：宝箱中 n 个金银珠宝的数值</li><li><code>c</code>：m 个神秘符文</li></ul><p><strong>约束条件：</strong></p><ul><li>时间限制：3 秒</li><li>1 ≤ m ≤ n ≤ 2000</li><li>-1000 ≤ stones[i], c[i] ≤ 1000</li></ul><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>这道题目可以通过动态规划和记忆化搜索来解决。小青在每一轮可以选择从宝箱的最上面或最下面取出一个珠宝，并将其价值乘以对应的符文，累加到总财富中。目标是最大化总财富。</p><p>使用递归加缓存（memoization）的方式来避免重复计算。定义一个函数 <code>dfs(i, j)</code>，表示在当前选择了 前<code>i</code> 个左端元素和 后<code>j</code> 个右端元素后的最大财富。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> cache<br><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> setrecursionlimit<br>setrecursionlimit(<span class="hljs-number">4010</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">stones: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], c: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>    n, m = <span class="hljs-built_in">len</span>(stones), <span class="hljs-built_in">len</span>(c)<br><span class="hljs-meta">    @cache</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">i, j</span>):<br>        <span class="hljs-keyword">if</span> n - (j - i + <span class="hljs-number">1</span>) &gt;= m:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(dfs(i + <span class="hljs-number">1</span>, j) + stones[i] * c[n - (j - i + <span class="hljs-number">1</span>)], dfs(i, j - <span class="hljs-number">1</span>) + stones[j] * c[n - (j - i + <span class="hljs-number">1</span>)])<br>    <span class="hljs-keyword">return</span> dfs(<span class="hljs-number">0</span>, n - <span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(stones=[-<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>], c=[<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">3</span>]) == <span class="hljs-number">25</span>)<br>    <span class="hljs-built_in">print</span>(solution(stones=[<span class="hljs-number">6</span>, -<span class="hljs-number">7</span>, <span class="hljs-number">1</span>], c=[<span class="hljs-number">4</span>, -<span class="hljs-number">3</span>]) == <span class="hljs-number">45</span>)<br>    <span class="hljs-built_in">print</span>(solution(stones=[<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">9</span>], c=[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, -<span class="hljs-number">5</span>]) == <span class="hljs-number">40</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>记忆化搜索</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>600数组递增操作问题</title>
    <link href="/2025/01/25/600%E6%95%B0%E7%BB%84%E9%80%92%E5%A2%9E%E6%93%8D%E4%BD%9C%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/25/600%E6%95%B0%E7%BB%84%E9%80%92%E5%A2%9E%E6%93%8D%E4%BD%9C%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在一个神秘的森林里，两个探险家，小智和小璇，面临着一项艰巨的任务。他们拥有两个魔法宝箱，分别装有整数列表 <code>list1</code> 和 <code>list2</code>。他们的目标是通过某种方式将 <code>list1</code> 转变为一个严格递增的序列。</p><p>他们可以执行的操作是：在任意时刻，选择 <code>list1</code> 中的一个元素和 <code>list2</code> 中的一个元素进行替换。具体来说，他们可以选择 <code>list1</code> 的某个位置 <code>i</code> 和 <code>list2</code> 的某个位置 <code>j</code>，并将 <code>list1[i]</code> 设置为 <code>list2[j]</code>。</p><p>现在，小智和小璇需要你帮助他们计算出，通过最少的操作次数，是否可以将 <code>list1</code> 变为严格递增的序列。如果可以做到，请返回所需的最少操作次数；如果不可能，请返回 <code>-1</code>。</p><h3 id="测试样例"><a href="#测试样例" class="headerlink" title="测试样例"></a>测试样例</h3><p>样例 1：</p><p>输入：<code>list1 = [3, 8, 4, 10, 11]</code>, <code>list2 = [2, 7, 5, 9]</code><br>输出：<code>1</code></p><p>样例 2：</p><p>输入：<code>list1 = [5, 9, 7, 11]</code>, <code>list2 = [1, 6, 8, 12]</code><br>输出：<code>1</code></p><p>样例 3：</p><p>输入：<code>list1 = [1, 3, 4, 6]</code>, <code>list2 = [2, 5]</code><br>输出：<code>0</code></p><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>这道题目要求通过最小的操作次数，将 <code>list1</code> 转变为一个严格递增的序列。可以选择将 <code>list1</code> 中的任意元素替换为 <code>list2</code> 中的任意元素。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>使用动态规划来解决这个问题。维护一个字典 <code>pre</code>，其中键表示当前序列的最后一个元素，值表示达到该值并且序列是严格递增的所需的最小操作次数。</p><ol><li><strong>初始化</strong>：将 <code>pre</code> 初始化为 <code>&#123; -inf: 0 &#125;</code>，表示在序列开始前，最后一个元素为负无穷，操作次数为 0。</li><li><strong>遍历 <code>list1</code></strong>：对于 <code>list1</code> 中的每一个元素 <code>x</code>，<ul><li>创建一个新的字典 <code>cur</code> 来记录当前状态。</li><li>对于 <code>pre</code> 中的每一个状态 <code>k</code>，<ul><li>如果 <code>x &gt; k</code>，则可以不替换，直接更新 <code>cur[x]</code>。</li><li>使用二分查找找到 <code>list2</code> 中第一个大于 <code>k</code> 的元素 <code>a[j]</code>，将 <code>cur[a[j]]</code> 更新为 <code>v + 1</code>。</li></ul></li></ul></li><li><strong>更新状态</strong>：将 <code>pre</code> 更新为 <code>cur</code> 的副本。</li><li><strong>结果</strong>：遍历完成后，如果 <code>cur</code> 不为空，返回最小的操作次数，否则返回 -1。</li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> bisect <span class="hljs-keyword">import</span> bisect_right<br><br>inf = <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">list1: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], list2: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>    a = <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">set</span>(list2))<br>    pre = defaultdict(<span class="hljs-keyword">lambda</span>: inf)<br>    pre[-inf] = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i, x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(list1):<br>        cur = defaultdict(<span class="hljs-keyword">lambda</span>: inf)<br>        <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> pre.items():<br>            <span class="hljs-keyword">if</span> x &gt; k:<br>                cur[x] = <span class="hljs-built_in">min</span>(cur[x], v)<br>            j = bisect_right(a, k)<br>            <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(a):<br>                cur[a[j]] = <span class="hljs-built_in">min</span>(cur[a[j]], v + <span class="hljs-number">1</span>)<br>        pre = cur.copy()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cur:<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">min</span>(cur.values())<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(list1=[<span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>], list2=[<span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(list1=[<span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>], list2=[<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(list1=[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>], list2=[<span class="hljs-number">2</span>, <span class="hljs-number">5</span>]) == <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：$O(n ^ 2 log m)$，其中 n 是 <code>list1</code> 的长度，m 是 <code>list2</code> 的长度。主要由排序和二分查找操作决定。</li><li><strong>空间复杂度</strong>：$O(m)$，用于存储动态规划的状态。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>稀土掘金</tag>
      
      <tag>二分查找</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>357区间和匹配问题</title>
    <link href="/2025/01/24/357%E5%8C%BA%E9%97%B4%E5%92%8C%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/24/357%E5%8C%BA%E9%97%B4%E5%92%8C%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 U 手上有两个长度为 n 的数组 A 和 B。她需要找到所有的区间[L, R]，满足在这个区间内，数组 A 的元素和在范围[La, Ra]之间，同时数组 B 的元素和在范围[Lb, Rb]之间。你能帮助她计算满足条件的区间数量吗？</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><strong>前缀和预处理</strong></p><ul><li>使用前缀和数组 SA 和 SB 分别存储数组 A 和 B 的累积和</li></ul></li><li><p><strong>二分查找</strong></p><ul><li>遍历每个右端点 i</li><li>对于每个右端点，需要找到合适的左端点范围</li><li>使用二分查找快速定位满足条件的左端点区间</li></ul></li><li><p><strong>区间条件转换</strong></p><ul><li>对于区间[L,R]，其和必须在[La,Ra]之间</li><li>可以转换为: SA[R] - SA[L-1] ∈ [La,Ra]</li><li>进一步转换为: SA[R] - Ra ≤ SA[L-1] ≤ SA[R] - La</li></ul></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">N: <span class="hljs-built_in">int</span>, A: <span class="hljs-built_in">list</span>, B: <span class="hljs-built_in">list</span>, La: <span class="hljs-built_in">int</span>, Ra: <span class="hljs-built_in">int</span>, Lb: <span class="hljs-built_in">int</span>, Rb: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-comment"># 计算前缀和数组</span><br>    SA = <span class="hljs-built_in">list</span>(accumulate(A, initial=<span class="hljs-number">0</span>))  <span class="hljs-comment"># A的前缀和</span><br>    SB = <span class="hljs-built_in">list</span>(accumulate(B, initial=<span class="hljs-number">0</span>))  <span class="hljs-comment"># B的前缀和</span><br>    res = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># 遍历每个右端点</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(A) + <span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 对数组A，计算左端点应满足的值域范围</span><br>        x, y = SA[i] - La, SA[i] - Ra  <span class="hljs-comment"># y &lt;= SA[L-1] &lt;= x</span><br>        l1, r1 = bisect_left(SA, y), bisect_right(SA, x)<br><br>        <span class="hljs-comment"># 对数组B，计算左端点应满足的值域范围</span><br>        x, y = SB[i] - Lb, SB[i] - Rb  <span class="hljs-comment"># y &lt;= SB[L-1] &lt;= x</span><br>        l2, r2 = bisect_left(SB, y), bisect_right(SB, x)<br><br>        <span class="hljs-comment"># 取两个数组共同满足的左端点范围</span><br>        l = <span class="hljs-built_in">max</span>(l1, l2)  <span class="hljs-comment"># 左端点的最大值</span><br>        r = <span class="hljs-built_in">min</span>(r1, r2)  <span class="hljs-comment"># 右端点的最小值</span><br>        res += <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, r - l)  <span class="hljs-comment"># 累加满足条件的区间数</span><br><br>    <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li>时间复杂度：O(N log N)<ul><li>前缀和计算：O(N)</li><li>对每个右端点进行二分查找：O(N log N)</li></ul></li><li>空间复杂度：O(N)<ul><li>需要存储两个前缀和数组</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>前缀和</tag>
      
      <tag>稀土掘金</tag>
      
      <tag>二分查找</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>349删除路径后的最短路问题</title>
    <link href="/2025/01/24/349%E5%88%A0%E9%99%A4%E8%B7%AF%E5%BE%84%E5%90%8E%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/24/349%E5%88%A0%E9%99%A4%E8%B7%AF%E5%BE%84%E5%90%8E%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 F 正在探索一个有 <code>n</code> 个点的地图，其中每个点都有对应的二维坐标 <code>(xi, yi)</code>。起点是第 <code>s</code> 个点，终点是第 <code>t</code> 个点，原本所有点之间都有一条线段，表示可以通行，并且长度为欧几里得距离。但是由于某些意外，起点 <code>s</code> 和终点 <code>t</code> 之间的直接通行路径被删除了。小 F 希望你帮忙计算从 <code>s</code> 到 <code>t</code> 的最短路径，允许经过其他点，但不能直接通过删除的那条线。</p><p>需要注意的是，点 <code>i, j</code> 之间的欧几里得距离计算公式为：</p><p>[ \text{distance} &#x3D; \sqrt{(x_i - x_j)^2 + (y_i - y_j)^2} ]</p><p>你需要输出从起点 <code>s</code> 到终点 <code>t</code> 的最短距离，结果需要四舍五入到小数点后两位。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>我们需要计算从起点 <code>s</code> 到终点 <code>t</code> 的最短路径，允许经过其他点，但不能直接通过删除的那条线。由于任意两个点之间都有线段连接，可以通过枚举中间点来计算最短距离</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, s: <span class="hljs-built_in">int</span>, t: <span class="hljs-built_in">int</span>, x: <span class="hljs-built_in">list</span>, y: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    s -= <span class="hljs-number">1</span><br>    t -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> sqrt<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dis</span>(<span class="hljs-params">p, q</span>):<br>        dx = x[p] - x[q]<br>        dy = y[p] - y[q]<br>        <span class="hljs-keyword">return</span> sqrt(dx * dx + dy * dy)<br><br>    res = <span class="hljs-built_in">min</span>(dis(s, i) + dis(t, i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n) <span class="hljs-keyword">if</span> i != s <span class="hljs-keyword">and</span> i != t)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;res:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n=<span class="hljs-number">5</span>, s=<span class="hljs-number">1</span>, t=<span class="hljs-number">5</span>, x=[<span class="hljs-number">17253</span>, <span class="hljs-number">25501</span>, <span class="hljs-number">28676</span>, <span class="hljs-number">30711</span>, <span class="hljs-number">18651</span>], y=[<span class="hljs-number">15901</span>, <span class="hljs-number">15698</span>, <span class="hljs-number">32041</span>, <span class="hljs-number">11015</span>, <span class="hljs-number">9733</span>]) == <span class="hljs-string">&#x27;17333.65&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(solution(n=<span class="hljs-number">4</span>, s=<span class="hljs-number">2</span>, t=<span class="hljs-number">4</span>, x=[<span class="hljs-number">5000</span>, <span class="hljs-number">12000</span>, <span class="hljs-number">8000</span>, <span class="hljs-number">14000</span>], y=[<span class="hljs-number">3000</span>, <span class="hljs-number">9000</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">4000</span>]) == <span class="hljs-string">&#x27;15652.48&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(solution(n=<span class="hljs-number">6</span>, s=<span class="hljs-number">3</span>, t=<span class="hljs-number">6</span>, x=[<span class="hljs-number">20000</span>, <span class="hljs-number">22000</span>, <span class="hljs-number">24000</span>, <span class="hljs-number">26000</span>, <span class="hljs-number">28000</span>, <span class="hljs-number">30000</span>], y=[<span class="hljs-number">15000</span>, <span class="hljs-number">13000</span>, <span class="hljs-number">11000</span>, <span class="hljs-number">17000</span>, <span class="hljs-number">19000</span>, <span class="hljs-number">21000</span>]) == <span class="hljs-string">&#x27;11772.70&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>时间复杂度：$O(n)$，其中 $n$ 是点的数量。我们需要遍历所有点来计算最短路径。<br>空间复杂度：$O(1)$。</p>]]></content>
    
    
    
    <tags>
      
      <tag>枚举</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>348分割数字串获取3的倍数问题</title>
    <link href="/2025/01/24/348%E5%88%86%E5%89%B2%E6%95%B0%E5%AD%97%E4%B8%B2%E8%8E%B7%E5%8F%963%E7%9A%84%E5%80%8D%E6%95%B0%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/24/348%E5%88%86%E5%89%B2%E6%95%B0%E5%AD%97%E4%B8%B2%E8%8E%B7%E5%8F%963%E7%9A%84%E5%80%8D%E6%95%B0%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="问题理解"><a href="#问题理解" class="headerlink" title="问题理解"></a>问题理解</h3><p>我们需要将一个数字串分割成多个子串，使得这些子串中是 3 的倍数的数量最大化。每个子串不能包含前导零（除了数字 0 本身）。</p><ul><li>使用一个数组 <code>f</code> 来记录以每个位置结尾的子串中，最多有多少个是 3 的倍数的子串。</li><li>使用一个数组 <code>last</code> 来记录每个余数（0, 1, 2）最后一次出现的位置。</li></ul><h3 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol><li><p><strong>初始化</strong>：</p><ul><li>初始化 <code>last</code> 数组为 <code>[-1, -1, -1]</code>，表示每个余数（0, 1, 2）还没有出现过。</li><li>初始化 <code>f</code> 数组为 <code>[0] * n</code>，其中 <code>n</code> 是字符串的长度。</li></ul></li><li><p><strong>处理第一个字符</strong>：</p><ul><li>计算第一个字符的余数，并更新 <code>last</code> 数组。</li><li>如果第一个字符的余数是 0，则 <code>f[0]</code> 设为 1，表示第一个字符本身就是一个 3 的倍数。</li></ul></li><li><p><strong>动态规划更新</strong>：</p><ul><li>从第二个字符开始遍历字符串。</li><li>对于每个字符，计算当前字符与前面字符的和的余数 <code>j</code>。</li><li>如果 <code>last[j]</code> 不是 <code>-1</code>，说明前面有一个位置的余数与当前余数相同，可以形成一个 3 的倍数的子串，更新 <code>f[i]</code>。</li><li>如果 <code>j</code> 是 0，说明当前字符本身就是一个 3 的倍数，更新 <code>f[i]</code>。</li><li>更新 <code>last[j]</code> 为当前位置 <code>i</code>。</li></ul></li><li><p><strong>返回结果</strong>：</p><ul><li>最终结果是 <code>f</code> 数组的最后一个元素 <code>f[-1]</code>，表示整个字符串中最多有多少个是 3 的倍数的子串。</li></ul></li></ol><h3 id="解题代码"><a href="#解题代码" class="headerlink" title="解题代码"></a>解题代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    n = <span class="hljs-built_in">len</span>(s)<br>    last = [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>]<br>    last[<span class="hljs-built_in">int</span>(s[<span class="hljs-number">0</span>]) % <span class="hljs-number">3</span>] = <span class="hljs-number">0</span><br>    f = [<span class="hljs-number">0</span>] * n<br>    <span class="hljs-keyword">if</span> last[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span>:<br>        f[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br>    j = <span class="hljs-built_in">int</span>(s[<span class="hljs-number">0</span>]) % <span class="hljs-number">3</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n):<br>        f[i] = f[i - <span class="hljs-number">1</span>]<br>        j = (j + <span class="hljs-built_in">int</span>(s[i])) % <span class="hljs-number">3</span><br>        <span class="hljs-keyword">if</span> last[j] &gt;= <span class="hljs-number">0</span>:<br>            f[i] = <span class="hljs-built_in">max</span>(f[i], f[last[j]] + <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">elif</span> j == <span class="hljs-number">0</span>:<br>            f[i] = <span class="hljs-built_in">max</span>(f[i], <span class="hljs-number">1</span>)<br>        last[j] = i<br>    <span class="hljs-keyword">return</span> f[-<span class="hljs-number">1</span>]<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;1123&quot;</span>) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;300&quot;</span>) == <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;987654321&quot;</span>) == <span class="hljs-number">6</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>$s$ 的长度是 $n$，时间复杂度是 $O(n)$，空间复杂度是 $O(n)$。</p>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>334二进制尾零子数组问题</title>
    <link href="/2025/01/21/334%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%B0%BE%E9%9B%B6%E5%AD%90%E6%95%B0%E7%BB%84%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/21/334%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%B0%BE%E9%9B%B6%E5%AD%90%E6%95%B0%E7%BB%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><p>要求在一个由正整数组成的数组中找到一个最短的连续子数组，使得该子数组中所有元素的乘积在二进制表示中至少有 <code>k</code> 个连续的 <code>0</code>，即乘积是 <code>2^k</code> 的倍数。如果不存在这样的子数组，则返回 <code>-1</code>。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><strong>因子 2 的计数</strong>：</p><ul><li>乘积为 <code>2^k</code> 的倍数，等价于乘积中包含至少 <code>k</code> 个因子 2。</li></ul></li><li><p><strong>滑动窗口</strong>：</p><ul><li>使用双指针<code>l</code>和<code>r</code>来维护一个滑动窗口。<code>l</code>表示窗口的左端，<code>r</code>表示窗口的右端。</li><li>遍历数组，逐步扩大右端<code>r</code>，将当前元素的因子 2 数量加到<code>cnt2</code>。</li><li>当<code>cnt2</code>达到或超过<code>k</code>时，尝试缩小左端<code>l</code>，以找到最短满足条件的子数组长度。每次缩小时，减去左端元素的因子 2 数量，并移动左指针。</li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, k: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">div</span>(<span class="hljs-params">x</span>):<br>        cnt2 = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>            x //= <span class="hljs-number">2</span><br>            cnt2 += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> cnt2<br>    res = n + <span class="hljs-number">1</span><br>    cnt2 = l = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> r, x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(a):<br>        cnt2 += div(x)<br>        <span class="hljs-keyword">while</span> cnt2 - div(a[l]) &gt;= k <span class="hljs-keyword">and</span> l &lt; r:<br>            cnt2 -= div(a[l])<br>            l += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> cnt2 &gt;= k:<br>            res = <span class="hljs-built_in">min</span>(res, r - l + <span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> res <span class="hljs-keyword">if</span> res &lt; n + <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> -<span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">6</span>, k = <span class="hljs-number">3</span>, a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]) == <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">5</span>, k = <span class="hljs-number">2</span>, a = [<span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">4</span>, k = <span class="hljs-number">4</span>, a = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>]) == -<span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：<code>O(n)</code>，其中<code>n</code>是数组的长度。每个元素最多被遍历两次（一次作为右端，一次作为左端）。</li><li><strong>空间复杂度</strong>：<code>O(1)</code>，只使用了常数级别的额外空间。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>稀土掘金</tag>
      
      <tag>双指针</tag>
      
      <tag>滑动窗口</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>328不大于n的好数计数问题</title>
    <link href="/2025/01/21/328%E4%B8%8D%E5%A4%A7%E4%BA%8En%E7%9A%84%E5%A5%BD%E6%95%B0%E8%AE%A1%E6%95%B0%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/21/328%E4%B8%8D%E5%A4%A7%E4%BA%8En%E7%9A%84%E5%A5%BD%E6%95%B0%E8%AE%A1%E6%95%B0%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 C 定义一个正整数为“好数”，当且仅当这个数的相邻数位都不相同。比如，1024 和 121 是好数，但 233 不是。现在小 C 想知道，不大于给定整数 n 的好数有多少个。结果对 $10^9 + 7$ 取模。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><strong>转换为字符串</strong>：首先将整数 <code>n</code> 转换为字符串 <code>s</code>，以便逐位处理。</p></li><li><p><strong>定义状态</strong>：</p><ul><li><code>i</code>：当前处理到第 <code>i</code> 位。</li><li><code>pre</code>：前一位的数字，用于判断当前位是否与前一位不同。</li><li><code>is_limit</code>：当前位是否受到上界的限制，即前面的数字是否已经与 <code>n</code> 的对应位相同。</li><li><code>is_num</code>：当前是否已经开始构造数字（避免前导零）。</li></ul></li><li><p><strong>递归函数 <code>dfs</code></strong>：</p><ul><li>当 <code>i</code> 等于 <code>len(s)</code> 时，表示所有位都已经处理完毕，如果已经开始构造数字，则返回 <code>1</code>，否则返回 <code>0</code>。</li><li>如果尚未开始构造数字，可以选择跳过当前位（即不选择任何数字）。</li><li>对于每一位，可以选择从 <code>0</code> 到 <code>9</code>（根据 <code>is_limit</code> 确定上界）。</li><li>选择的数字 <code>d</code> 需要与前一位数字 <code>pre</code> 不同。</li><li>递归处理下一位，更新状态参数。</li></ul></li><li><p><strong>记忆化搜索</strong>：使用 <code>@cache</code> 装饰器对递归函数进行记忆化，以避免重复计算，提高效率。</p></li><li><p><strong>结果</strong>：最终返回符合条件的“好数”数量，对 <code>10^9 + 7</code> 取模。</p></li></ol><h3 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> cache<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    s = <span class="hljs-built_in">str</span>(n)<br><br><span class="hljs-meta">    @cache</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">i, pre, is_limit, is_num</span>):<br>        <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(s):<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(is_num)<br>        res = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_num:<br>            res = dfs(i + <span class="hljs-number">1</span>, pre, <span class="hljs-literal">False</span>, <span class="hljs-literal">False</span>)<br>        low = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> is_num <span class="hljs-keyword">else</span> <span class="hljs-number">1</span><br>        up = <span class="hljs-built_in">int</span>(s[i]) <span class="hljs-keyword">if</span> is_limit <span class="hljs-keyword">else</span> <span class="hljs-number">9</span><br>        <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(low, up + <span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">if</span> d != pre:<br>                res += dfs(i + <span class="hljs-number">1</span>, d, is_limit <span class="hljs-keyword">and</span> d == up, <span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">return</span> res<br><br>    <span class="hljs-keyword">return</span> dfs(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-literal">True</span>, <span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：<code>O(len(s) * 10 * 10)</code>，其中 <code>len(s)</code> 是整数 <code>n</code> 的位数，每一位有 <code>10</code> 种选择。动态规划的时间复杂度 &#x3D; 状态个数 × 单个状态的计算时间</li><li><strong>空间复杂度</strong>：<code>O(len(s) * 10)</code>，用于记忆化存储中间结果。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>稀土掘金</tag>
      
      <tag>数位DP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>315K排序算法最小操作次数计算</title>
    <link href="/2025/01/21/315K%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%9C%80%E5%B0%8F%E6%93%8D%E4%BD%9C%E6%AC%A1%E6%95%B0%E8%AE%A1%E7%AE%97/"/>
    <url>/2025/01/21/315K%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%9C%80%E5%B0%8F%E6%93%8D%E4%BD%9C%E6%AC%A1%E6%95%B0%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h3 id="题目解析"><a href="#题目解析" class="headerlink" title="题目解析"></a>题目解析</h3><p>给定一个长度为 n 的排列，使用 K 排序算法可以通过以下步骤将其从小到大排序：每次从数列中选择最多 K 个位置的数，将它们移除后，将剩余的数左对齐。接着对移除的数进行排序，并将它们放在数列的末尾。需要计算最少需要多少次这样的操作，才能使数列按升序排列。</p><p>需要计算最少需要多少次这样的操作，才能使数列按升序排列。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><strong>确定从头开始的最长连续递增子序列</strong>：</p><ul><li>遍历数组，找到数列中按顺序排列的最长连续递增子序列。这部分元素在最终排序中不需要移动。</li><li>记录当前序列中下一个期望出现的数值 <code>i</code>，初始为 <code>1</code>。</li><li>如果当前遍历的数 <code>x</code> 等于 <code>i</code>，则 <code>i</code> 增加一，表示下一个期望的数值。</li></ul></li><li><p><strong>计算最少操作次数</strong>：</p><ul><li>总需要移动的元素数为 <code>n - (i - 1)</code>，即总元素数减去已经按序排列的最长连续子序列的长度。</li><li>每次操作最多可以移动 <code>K</code> 个元素，因此最少的操作次数为 <code>ceil((n - (i - 1)) / K)</code>。为了避免使用浮点运算，可以使用 <code>(move + K - 1) // K</code> 来实现向上取整。</li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, k: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    i = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a:<br>        <span class="hljs-keyword">if</span> i == x:<br>            i += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> (n - i + k) // k<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">5</span>, k = <span class="hljs-number">1</span>, a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">5</span>, k = <span class="hljs-number">2</span>, a = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">6</span>, k = <span class="hljs-number">3</span>, a = [<span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：O(n)，其中 <code>n</code> 是数列的长度。遍历数列一次即可找到最长连续递增子序列。</li><li><strong>空间复杂度</strong>：O(1)，只使用了常数空间。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>贪心</tag>
      
      <tag>稀土掘金</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>生成函数</title>
    <link href="/2025/01/20/%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0/"/>
    <url>/2025/01/20/%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
    <tags>
      
      <tag>算法学习</tag>
      
      <tag>生成函数</tag>
      
      <tag>普通生成函数</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2025/01/01/test/"/>
    <url>/2025/01/01/test/</url>
    
    <content type="html"><![CDATA[<p>$$<br>A &#x3D; \begin{bmatrix}<br>        a_{11}    &amp; a_{12}    &amp; …    &amp; a_{1n}\<br>        a_{21}    &amp; a_{22}    &amp; …    &amp; a_{2n}\<br>        a_{31}    &amp; a_{22}    &amp; …    &amp; a_{3n}\<br>        \vdots    &amp; \vdots    &amp; \ddots &amp; \vdots\<br>        a_{n1}    &amp; a_{n2}    &amp; … &amp; a_{nn}\<br>    \end{bmatrix} , b &#x3D; \begin{bmatrix}<br>        b_{1}  \<br>        b_{2}  \<br>        b_{3}  \<br>        \vdots \<br>        b_{n}  \<br>    \end{bmatrix}<br>$$</p><p>$O(n)$</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>309魔幻世界中的安全区计算</title>
    <link href="/2025/01/01/309%E9%AD%94%E5%B9%BB%E4%B8%96%E7%95%8C%E4%B8%AD%E7%9A%84%E5%AE%89%E5%85%A8%E5%8C%BA%E8%AE%A1%E7%AE%97/"/>
    <url>/2025/01/01/309%E9%AD%94%E5%B9%BB%E4%B8%96%E7%95%8C%E4%B8%AD%E7%9A%84%E5%AE%89%E5%85%A8%E5%8C%BA%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>在一个大小为 <code>n x m</code> 的二维数组中，每个格子的值表示该位置的危险程度。小 F 的能力值为 <code>X</code>，当某个格子的危险程度小于等于 <code>X</code> 时，该格子被认为是安全的。相邻（上下左右连通）的安全格子组成一个安全区。需要计算整个二维数组中有多少个安全区。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>这题本质就是计算连通块的数量。使用广度优先搜索（BFS）遍历二维数组，标记已访问的安全格子。对于每一个未访问且安全的格子，启动一次 BFS，将所有相连的安全格子标记为已访问，并将安全区计数加一。</p><h3 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, m: <span class="hljs-built_in">int</span>, X: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>]]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>    vis = [[<span class="hljs-number">0</span>] * m <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bfs</span>(<span class="hljs-params">x, y</span>):<br>        q = deque([(x, y)])<br>        vis[x][y] = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> q:<br>            x, y = q.popleft()<br>            <span class="hljs-keyword">for</span> dx, dy <span class="hljs-keyword">in</span> [(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)]:<br>                nx, ny = x + dx, y + dy<br>                <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= nx &lt; n <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= ny &lt; m <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> vis[nx][ny] <span class="hljs-keyword">and</span> a[nx][ny] &lt;= X:<br>                    vis[nx][ny] = <span class="hljs-number">1</span><br>                    q.append((nx, ny))<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    res = <span class="hljs-built_in">sum</span>(bfs(i, j) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> vis[i][j] <span class="hljs-keyword">and</span> a[i][j] &lt;= X)<br>    <span class="hljs-keyword">return</span> res<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, [[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, [[<span class="hljs-number">6</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">4</span>]]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]]) == <span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p><strong>时间复杂度</strong>:通过 BFS 方法遍历整个二维数组，每个格子最多只被遍历一次，所以时间复杂度为 <code>O(n * m)</code>。<br><strong>空间复杂度</strong>:空间复杂度 <code>O(n * m)</code>。</p>]]></content>
    
    
    
    <tags>
      
      <tag>BFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>370子区间平均值问题</title>
    <link href="/2025/01/01/370%E5%AD%90%E5%8C%BA%E9%97%B4%E5%B9%B3%E5%9D%87%E5%80%BC%E9%97%AE%E9%A2%98/"/>
    <url>/2025/01/01/370%E5%AD%90%E5%8C%BA%E9%97%B4%E5%B9%B3%E5%9D%87%E5%80%BC%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p><strong>问题描述</strong></p><p>给定一个长度为 <code>n</code> 的整数数组 <code>arr</code>，以及一个有理数 <code>u/v</code>。需要找出数组中有多少个连续的子区间，其平均值恰好等于 <code>u/v</code>。</p><p><strong>解题思路</strong></p><ol><li><p><strong>转化问题</strong>：要求子区间的平均值等于 <code>u/v</code>，即子区间的总和等于 <code>(u/v) * 长度</code>。为了简化计算，我们可以将数组的每个元素都减去 <code>u/v</code>，然后问题转化为找出有多少个子区间的和为 <code>0</code>。</p></li><li><p><strong>前缀和与哈希表</strong>：</p><ul><li>使用前缀和 <code>s</code> 来记录从起始到当前元素的累积和。</li><li>使用哈希表 <code>d</code> 来存储每个前缀和出现的次数。</li><li>遍历数组，对于每个位置 <code>i</code>，计算当前的前缀和 <code>s[i]</code>：<ul><li>如果在之前的某个位置 <code>j</code>（<code>j &lt; i</code>），<code>s[j]</code> 与 <code>s[i]</code> 相等，则子区间 <code>(j+1, i)</code> 的和为 <code>0</code>。</li><li>因此，结果 <code>res</code> 增加 <code>d[s[i]]</code> 的值。</li><li>然后更新 <code>d[s[i]]</code> 的计数。</li></ul></li></ul></li></ol><p><strong>代码解析</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> accumulate<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, u: <span class="hljs-built_in">int</span>, v: <span class="hljs-built_in">int</span>, arr: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-comment"># 将每个元素减去 u/v</span><br>    a = [x - u / v <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> arr]<br>    <span class="hljs-comment"># 计算前缀和</span><br>    s = <span class="hljs-built_in">list</span>(accumulate(a))<br>    <span class="hljs-comment"># 哈希表记录前缀和出现的次数</span><br>    d = defaultdict(<span class="hljs-built_in">int</span>)<br>    d[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-comment"># 如果当前前缀和 s[i] 已存在于哈希表中，则增加相应的计数</span><br>        res += d[s[i]]<br>        <span class="hljs-comment"># 更新哈希表</span><br>        d[s[i]] += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure><p><strong>复杂度分析</strong></p><ul><li>时间复杂度: <code>O(n)</code>，其中 <code>n</code> 为数组的长度。</li><li>空间复杂度: <code>O(n)</code>。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>前缀和</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>299红色格子染色方案数计算</title>
    <link href="/2025/01/01/299%E7%BA%A2%E8%89%B2%E6%A0%BC%E5%AD%90%E6%9F%93%E8%89%B2%E6%96%B9%E6%A1%88%E6%95%B0%E8%AE%A1%E7%AE%97/"/>
    <url>/2025/01/01/299%E7%BA%A2%E8%89%B2%E6%A0%BC%E5%AD%90%E6%9F%93%E8%89%B2%E6%96%B9%E6%A1%88%E6%95%B0%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 R 有一排长度为 n 的格子，每个格子从左到右编号为 1 到 n。起初，部分格子已经被染成了红色，其他格子则没有颜色。红色格子的状态由一个长度为 n 的字符串 s 描述，其中 s[i] &#x3D; 1 表示第 i 个格子是红色的，而 s[i] &#x3D; 0 表示该格子没有颜色。</p><p>小 R 希望通过以下两种操作将所有格子都染成红色：</p><ol><li>如果第 i 个格子是红色的，且 i + 1 ≤ n，则可以将第 i + 1 个没有颜色的格子染成红色。</li><li>如果第 i 个格子是红色的，且 i - 1 ≥ 1，则可以将第 i - 1 个没有颜色的格子染成红色。</li></ol><p>请你帮小 R 计算出，存在多少种不同的染色顺序可以使所有格子最终都被染成红色，并输出答案对 10^9 + 7 取模后的结果。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>1.<strong>子数组内部的染色方案数</strong><br>首先考虑一个长度为<code>k</code>的全部未染色的格子，可以有多少种染色方案。</p><ul><li>假如这段连续的格子处于两个已染色的格子之间，那么这段格子的染色方案数为<code>2^(k-1)</code>。</li><li>假如这段连续的格子只有一端被染色，那么显然只有一种染色方案。</li></ul><ol start="2"><li><strong>合并所有的方案数</strong></li></ol><ul><li>假设有<code>x</code>段连续的未染色格子，那么可以发现，这<code>x</code>段格子的染色方案数是独立的，可以相乘。问题相当于把这<code>x</code>段格子放入长度为<code>m</code>的数组中，<code>m</code>为未染色的格子总数。</li><li>例如 有长度为<code>x1</code>、<code>x2</code>、<code>x3</code>、<code>x4</code>的未染色格子，一共有<code>m</code>个未染色格子，放入其中的方案数为<code>C(m, x1) * C(m-x1, x2) * C(m-x1-x2, x3) * C(m-x1-x2-x3, x4)</code>。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br>mx = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e5</span> + <span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># 预处理组合数</span><br>fac = [<span class="hljs-number">0</span>] * mx<br>fac[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, mx):<br>    fac[i] = fac[i - <span class="hljs-number">1</span>] * i % mod<br><br>inv_fac = [<span class="hljs-number">0</span>] * mx<br>inv_fac[mx - <span class="hljs-number">1</span>] = <span class="hljs-built_in">pow</span>(fac[mx - <span class="hljs-number">1</span>], -<span class="hljs-number">1</span>, mod)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(mx - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>    inv_fac[i - <span class="hljs-number">1</span>] = inv_fac[i] * i % mod<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">comb</span>(<span class="hljs-params">n, m</span>):<br>    <span class="hljs-keyword">if</span> n &lt; m:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> fac[n] * inv_fac[m] % mod * inv_fac[n - m] % mod<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n, s</span>):<br>    a = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n) <span class="hljs-keyword">if</span> s[i] == <span class="hljs-string">&#x27;1&#x27;</span>]<br>    <span class="hljs-comment"># 未染色的格子数</span><br>    cnt = n - <span class="hljs-built_in">len</span>(a)<br>    <span class="hljs-comment"># 处理首尾</span><br>    res = comb(cnt, a[<span class="hljs-number">0</span>]) * comb(cnt - a[<span class="hljs-number">0</span>], n - a[-<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>) % mod<br>    cnt -= (a[<span class="hljs-number">0</span>] + n - a[-<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(a)):<br>        k = a[i] - a[i - <span class="hljs-number">1</span>] - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> k &gt; <span class="hljs-number">0</span>:<br>            <span class="hljs-comment"># 内部的方案数和放置的方案数相乘</span><br>            res *= <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, k - <span class="hljs-number">1</span>, mod) * comb(cnt, k) % mod<br>            cnt -= k<br>    <span class="hljs-keyword">return</span> res % mod<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">5</span>,s = <span class="hljs-string">&quot;00101&quot;</span>) == <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">6</span>,s = <span class="hljs-string">&quot;100001&quot;</span>) == <span class="hljs-number">8</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">7</span>,s = <span class="hljs-string">&quot;0001000&quot;</span>) == <span class="hljs-number">20</span>)<br><br></code></pre></td></tr></table></figure><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><ul><li><strong>时间复杂度</strong>：<code>O(n)</code>，可以预处理<code>pow</code></li><li><strong>空间复杂度</strong>：<code>O(n)</code></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>组合数学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>326不同子序列计数问题</title>
    <link href="/2024/12/31/326%E4%B8%8D%E5%90%8C%E5%AD%90%E5%BA%8F%E5%88%97%E8%AE%A1%E6%95%B0%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/31/326%E4%B8%8D%E5%90%8C%E5%AD%90%E5%BA%8F%E5%88%97%E8%AE%A1%E6%95%B0%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>小 U 有一个字符串 <code>s</code>，他想计算该字符串的所有不同非空子序列的个数。子序列是通过删除原字符串中的部分字符（也可以不删除），且保持剩余字符的相对顺序形成的新字符串。</p><p>你的任务是帮助小 U 计算 <code>s</code> 的不同非空子序列的总数，并返回对 $10^9 + 7$ 取余的结果。</p><p><strong>例如</strong>：</p><ul><li>当 <code>s = &quot;abc&quot;</code> 时，所有不同的非空子序列包括 <code>&quot;a&quot;</code>, <code>&quot;b&quot;</code>, <code>&quot;c&quot;</code>, <code>&quot;ab&quot;</code>, <code>&quot;ac&quot;</code>, <code>&quot;bc&quot;</code>, 和 <code>&quot;abc&quot;</code>，总数为 <code>7</code>。</li></ul><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><strong>动态规划状态定义</strong>:</p><ul><li>定义 <code>f[i]</code> 为字符串 <code>s</code> 的前 <code>i</code> 个字符所能形成的不同非空子序列的数量。字典 <code>last</code> 记录每个字符上一次出现的位置。</li></ul></li><li><p><strong>动态规划转移</strong>:</p><ul><li>遍历字符串 <code>s</code>，对于每一个字符 <code>c</code> 在索引 <code>i</code> 位置：<ul><li>如果 <code>c</code> 是第一次出现，即 <code>c</code> 不在 <code>last</code> 中：<ul><li>则 <code>f[i] = f[i-1] * 2 + 1</code>。这里 <code>f[i-1] * 2</code> 表示在所有前 <code>i-1</code> 个子序列基础上，每个子序列可以选择添加或不添加 <code>c</code>，<code>+1</code> 表示包含只有 <code>c</code> 这个字符的子序列。</li></ul></li><li>如果 <code>c</code> 之前出现过：<ul><li>则 <code>f[i] = f[i-1] * 2 - f[last[c] - 1]</code>。<code>f[i-1] * 2</code> 同理，但需要减去 <code>f[last[c] - 1]</code>，以消除由上一次出现 <code>c</code> 到当前 <code>c</code> 之间重复形成的子序列，保证每个子序列唯一。</li></ul></li></ul></li><li>更新 <code>last[c] = i</code>，记录字符 <code>c</code> 的最新出现位置。</li></ul></li></ol><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    last = &#123;&#125;<br>    n = <span class="hljs-built_in">len</span>(s)<br>    f = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s, <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> last:<br>            f[i] = f[i - <span class="hljs-number">1</span>] * <span class="hljs-number">2</span> + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            f[i] = f[i - <span class="hljs-number">1</span>] * <span class="hljs-number">2</span> - f[last[c] - <span class="hljs-number">1</span>]<br>        last[c] = i<br>        f[i] %= mod<br><br>    <span class="hljs-keyword">return</span> f[-<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;abc&quot;</span>) == <span class="hljs-number">7</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;aaa&quot;</span>) == <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;abcd&quot;</span>) == <span class="hljs-number">15</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;abac&quot;</span>) == <span class="hljs-number">13</span>)<br></code></pre></td></tr></table></figure><h3 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><ul><li>该算法的时间复杂度为 <code>O(n)</code>，其中 <code>n</code> 是字符串的长度。</li><li>空间复杂度为 <code>O(n)</code>，用于存储动态规划数组 <code>f</code> 和字符最后出现位置的哈希表 <code>last</code>。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>320&#39;icci&#39;型字符串子序列问题</title>
    <link href="/2024/12/31/320-icci-%E5%9E%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%90%E5%BA%8F%E5%88%97%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/31/320-icci-%E5%9E%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%90%E5%BA%8F%E5%88%97%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>小 U 定义了一种特殊的字符串类型，称为 “icci” 型字符串。要满足这个类型，字符串必须具备以下条件：</p><ol><li>它的长度为 4。</li><li>第一个和第四个字符必须是元音字母（’a’, ‘e’, ‘i’, ‘o’, ‘u’）。</li><li>第二个和第三个字符必须是辅音字母（除了元音以外的字母）。</li><li>该字符串是一个回文串。</li></ol><p>例如，字符串 “awwa” 和 “uttu” 都是 “icci” 型字符串。现在给定一个字符串，小 U 想知道其中有多少个 “icci” 型的子序列。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>记录单个字符的数量、二元组的数量、三元组的数量。因为每次更新只和当前字符有关，可以在<code>O(26)</code>的复杂度下完成每次更新。</p><ol><li><p><strong>更新结果</strong>:</p><ul><li>如果当前字符 <code>c</code> 是元音，将 <code>triplet[x]</code> 加到结果 <code>res</code> 中，表示以 <code>x</code> 结尾的三元组可以形成有效的四元组。</li></ul></li><li><p><strong>更新三元组</strong>:</p><ul><li>如果当前字符 <code>c</code> 不是元音，对每个字母 <code>ch</code>，将 <code>pairCount[ch][x]</code> 加到 <code>triplet[ch]</code> 中，表示以 <code>ch</code> 开头、<code>x</code> 结尾的三元组数量增加。</li></ul></li><li><p><strong>更新二元组</strong>:</p><ul><li>对每个字母 <code>ch</code>，将 <code>cnt[ch]</code> 加到 <code>pairCount[ch][x]</code> 中，表示以 <code>ch</code> 开头、<code>x</code> 结尾的二元组数量增加。</li></ul></li><li><p><strong>更新字母计数</strong>:</p><ul><li>增加当前字母 <code>x</code> 的出现次数 <code>cnt[x]</code>。</li></ul></li></ol><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br>p = <span class="hljs-built_in">set</span>(<span class="hljs-string">&quot;aeiou&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    cnt = [<span class="hljs-number">0</span>] * <span class="hljs-number">26</span>  <span class="hljs-comment"># 每个字符的计数</span><br>    triplet = [<span class="hljs-number">0</span>] * <span class="hljs-number">26</span>   <span class="hljs-comment"># 以ch开头的三元组</span><br>    pairCount = [[<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>)] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>)]  <span class="hljs-comment"># i j 二元组</span><br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>        x = <span class="hljs-built_in">ord</span>(c) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br>        <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> p:<br>            res = (res + triplet[x]) % mod<br>        <span class="hljs-keyword">if</span> c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> p:<br>            <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>):<br>                triplet[ch] = (triplet[ch] + pairCount[ch][x]) % mod<br>        <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>):<br>            pairCount[ch][x] = (pairCount[ch][x] + cnt[ch]) % mod<br>        cnt[x] += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;iiaabbii&quot;</span>) == <span class="hljs-number">4</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;aekekeo&quot;</span>) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;abcdefg&quot;</span>) == <span class="hljs-number">0</span>)<br><br></code></pre></td></tr></table></figure><h3 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h3><p><strong>时间复杂度</strong>：<code>O(26n)</code>，其中 n 是字符串长度。<br><strong>空间复杂度</strong>: <code>O(26 * 26)</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>计数</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>304计算特定条件下的四元组数量</title>
    <link href="/2024/12/31/304%E8%AE%A1%E7%AE%97%E7%89%B9%E5%AE%9A%E6%9D%A1%E4%BB%B6%E4%B8%8B%E7%9A%84%E5%9B%9B%E5%85%83%E7%BB%84%E6%95%B0%E9%87%8F/"/>
    <url>/2024/12/31/304%E8%AE%A1%E7%AE%97%E7%89%B9%E5%AE%9A%E6%9D%A1%E4%BB%B6%E4%B8%8B%E7%9A%84%E5%9B%9B%E5%85%83%E7%BB%84%E6%95%B0%E9%87%8F/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>该题目要求在给定数组中找到满足条件 <code>a[i] + a[j] = a[k] ^ a[l]</code> 且 <code>i &lt; j &lt; k &lt; l</code> 的四元组数量。由于答案可能非常大，需要对 <code>10^9 + 7</code> 取模。</p><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><ol><li><p><strong>枚举所有可能的 <code>(i, j)</code> 对</strong>：</p><ul><li>对于每个 数对<code>a[i]</code>和<code>a[j]</code> <code>(i &lt; j)</code>，计算 <code>a[i] + a[j]</code> 的值，并将其存储在字典 <code>d</code> 中，并记录对应<code>a[j]</code>的下标</li><li>对字典 <code>d</code> 中每个键对应的列表进行排序，以便后续使用二分查找。</li></ul></li><li><p><strong>枚举所有可能的 <code>(k, l)</code> 对</strong>：</p><ul><li>对于每个 <code>(k, l)</code>，满足<code>k &lt; l</code>，计算 <code>a[k] ^ a[l]</code> 的值。寻找是否存在 <code>(i, j)</code> 满足 <code>a[i] + a[j] = a[k] ^ a[l]</code> 且 <code>j &lt; k</code>。</li><li>使用 <code>bisect_left</code> 在 <code>d[a[k] ^ a[l]]</code> 中找到满足 <code>j &lt; k</code> 的 <code>j</code> 的数量，并累加到结果 <code>res</code> 中。</li></ul></li></ol><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> bisect <span class="hljs-keyword">import</span> bisect_left<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    d = defaultdict(<span class="hljs-built_in">list</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, n):<br>            d[a[i] + a[j]].append(j)<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> d:<br>        d[k].sort()<br>    res = <span class="hljs-built_in">sum</span>(bisect_left(d[a[i] ^ a[j]], i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n - <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, n))<br>    <span class="hljs-keyword">return</span> res % mod<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">6</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">14</span>, [<span class="hljs-number">9</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">7</span>,<span class="hljs-number">13</span>,<span class="hljs-number">9</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>]) == <span class="hljs-number">33</span>)<br><br></code></pre></td></tr></table></figure><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><ul><li><strong>时间复杂度</strong>：<code>O(n^2logn)</code><ul><li>枚举 <code>(i, j)</code> 对需要 <code>O(n^2)</code> 时间。</li><li>对每个 <code>(k, l)</code> 对进行二分查找需要 O(log n) 时间，总体为 <code>O(n^2logn)</code>。</li></ul></li><li><strong>空间复杂度</strong>：<code>O(n^2)</code><ul><li>用于存储所有 <code>(i, j)</code> 对的和。</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>枚举</tag>
      
      <tag>二分</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>322三数之和问题</title>
    <link href="/2024/12/30/322%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/30/322%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>该问题要求在一个整数数组中找到所有满足 <code>i &lt; j &lt; k</code> 且 <code>arr[i] + arr[j] + arr[k] == target</code> 的三元组，并返回这些三元组的数量。由于可能存在大量的组合，结果需要对 $10^9 + 7$ 取模。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><strong>排序数组</strong>：首先将数组进行排序，方便使用双指针法。</li><li><strong>遍历数组</strong>：固定第一个数 <code>arr[i]</code>，然后使用双指针 <code>j</code> 和 <code>k</code> 来查找剩下的两个数。</li><li><strong>双指针查找</strong>：<ul><li>如果 <code>arr[i] + arr[j] + arr[k]</code> 小于目标值，移动左指针 <code>j</code> 以增大和。</li><li>如果大于目标值，移动右指针 <code>k</code> 以减小和。</li><li>当找到等于目标值的三元组时，需处理可能存在的重复元素：<ul><li>如果 <code>arr[j]</code> 和 <code>arr[k]</code> 相同，则可以从这段区间中任意选择两个数字组合。可以组合出 <code>(k - j + 1) * (k - j) / 2</code> 个三元组。</li><li>否则，计算左右指针处相同元素的个数 <code>l</code> 和 <code>r</code>，并将 <code>l * r</code> 加入结果中。</li></ul></li></ul></li><li><strong>取模</strong>：在每次更新结果时，对结果取模以防止溢出。</li></ol><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">arr: <span class="hljs-built_in">list</span>, t: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    arr.sort()<br>    n = <span class="hljs-built_in">len</span>(arr)<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">2</span>):<br>        j, k = i + <span class="hljs-number">1</span>, n - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> j &lt; k:<br>            <span class="hljs-keyword">if</span> arr[i] + arr[j] + arr[k] &lt; t:<br>                j += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> arr[i] + arr[j] + arr[k] &gt; t:<br>                k -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">if</span> arr[j] == arr[k]:<br>                    res += (k - j + <span class="hljs-number">1</span>) * (k - j) // <span class="hljs-number">2</span><br>                    <span class="hljs-keyword">break</span><br>                l = r = <span class="hljs-number">1</span><br>                <span class="hljs-keyword">while</span> j &lt; k <span class="hljs-keyword">and</span> arr[j] == arr[j + <span class="hljs-number">1</span>]:<br>                    l += <span class="hljs-number">1</span><br>                    j += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">while</span> j &lt; k <span class="hljs-keyword">and</span> arr[k] == arr[k - <span class="hljs-number">1</span>]:<br>                    k -= <span class="hljs-number">1</span><br>                    r += <span class="hljs-number">1</span><br>                j += <span class="hljs-number">1</span><br>                k -= <span class="hljs-number">1</span><br>                res = (res + l * r) % mod<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>], <span class="hljs-number">8</span>) == <span class="hljs-number">20</span>)<br>    <span class="hljs-built_in">print</span>(solution([<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>], <span class="hljs-number">6</span>) == <span class="hljs-number">4</span>)<br>    <span class="hljs-built_in">print</span>(solution([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>], <span class="hljs-number">9</span>) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], <span class="hljs-number">3</span>) == <span class="hljs-number">4</span>)<br><br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：$O(n^2)$，其中 $n$ 是数组的长度。排序需要 $O(n \log n)$，双指针遍历需要 $O(n^2)$。</li><li><strong>空间复杂度</strong>：$O(1)$，只使用了常数级别的额外空间。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>双指针</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>287火车驶入驶出顺序验证问题</title>
    <link href="/2024/12/30/287%E7%81%AB%E8%BD%A6%E9%A9%B6%E5%85%A5%E9%A9%B6%E5%87%BA%E9%A1%BA%E5%BA%8F%E9%AA%8C%E8%AF%81%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/30/287%E7%81%AB%E8%BD%A6%E9%A9%B6%E5%85%A5%E9%A9%B6%E5%87%BA%E9%A1%BA%E5%BA%8F%E9%AA%8C%E8%AF%81%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>要验证火车驶出的顺序是否符合栈的先进后出（FILO）规则，我们可以模拟栈的操作过程。具体步骤如下：</p><ol><li><p><strong>初始化</strong>：</p><ul><li>创建一个空栈 <code>st</code>，用于模拟休息区。</li><li>使用指针 <code>j</code> 来跟踪出栈序列 <code>b</code> 的当前元素。</li></ul></li><li><p><strong>模拟入栈和出栈</strong>：</p><ul><li>遍历驶入序列 <code>a</code>，将每个火车编号依次压入栈 <code>st</code>。</li><li>每次压入后，检查栈顶元素是否与出栈序列 <code>b</code> 中当前指针 <code>j</code> 指向的元素相同：<ul><li>如果相同，则弹出栈顶元素，并将指针 <code>j</code> 向后移动一位。</li><li>重复此过程，直到栈为空或栈顶元素不再匹配 <code>b[j]</code>。</li></ul></li></ul></li><li><p><strong>验证结果</strong>：</p><ul><li>遍历完成后，如果所有火车都按照出栈序列 <code>b</code> 顺利弹出，即栈 <code>st</code> 为空，则说明出栈序列合法，返回 <code>True</code>。</li><li>否则，返回 <code>False</code>，表示出栈序列不合法。</li></ul></li></ol><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span>, b: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    st = []<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a:<br>        st.append(x)<br>        <span class="hljs-keyword">while</span> st <span class="hljs-keyword">and</span> st[-<span class="hljs-number">1</span>] == b[j]:<br>            st.pop()<br>            j += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(st) == <span class="hljs-number">0</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]) == <span class="hljs-literal">True</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]) == <span class="hljs-literal">True</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]) == <span class="hljs-literal">False</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]) == <span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><h3 id="算法复杂度"><a href="#算法复杂度" class="headerlink" title="算法复杂度"></a>算法复杂度</h3><ul><li><strong>时间复杂度</strong>：O(n)，其中 n 是序列的长度。每个火车编号最多被压入和弹出栈一次。</li><li><strong>空间复杂度</strong>：O(n)，用于模拟栈的空间。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>模拟</tag>
      
      <tag>栈</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>279最长连续交替01子串问题</title>
    <link href="/2024/12/30/279%E6%9C%80%E9%95%BF%E8%BF%9E%E7%BB%AD%E4%BA%A4%E6%9B%BF01%E5%AD%90%E4%B8%B2%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/30/279%E6%9C%80%E9%95%BF%E8%BF%9E%E7%BB%AD%E4%BA%A4%E6%9B%BF01%E5%AD%90%E4%B8%B2%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>要解决这个问题，我们需要找到通过将二进制字符串分割并翻转各部分后，能够得到的最长连续交替<code>01</code>子串的长度。关键在于识别字符串中相邻相同字符的位置，然后尝试翻转这些部分以最大化交替子串的长度。</p><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><ul><li>字符串翻转后并不会影响最长的<code>01</code>串的长度</li><li>题目的操作会使得字符串的头和尾拼接。如果头和尾的字符是相同的，那么最长的<code>01</code>一定在原本的字符串中。</li><li>如果头和尾的字符是不同的，那么最长的<code>01</code>串可能两个部分拼接而成。这两个部分分别是原字符串的前缀和后缀，因此我们只需要找到前缀和后缀中第一个相邻相同字符的位置，然后尝试翻转这两个部分，找到最长的<code>01</code>串即可。</li></ul><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># 求最长的01子串</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">s</span>):<br>    mx = cur = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(s)):<br>        <span class="hljs-keyword">if</span> s[i] != s[i-<span class="hljs-number">1</span>]:<br>            cur += <span class="hljs-number">1</span><br>            mx = <span class="hljs-built_in">max</span>(mx, cur)<br>        <span class="hljs-keyword">else</span>:<br>            cur = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> mx<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    res = get(s)<br>    <span class="hljs-keyword">if</span> s[<span class="hljs-number">0</span>] == s[-<span class="hljs-number">1</span>]:<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(s)):<br>        <span class="hljs-keyword">if</span> s[i] == s[i-<span class="hljs-number">1</span>]:<br>            res = <span class="hljs-built_in">max</span>(res, get(s[:i][::-<span class="hljs-number">1</span>] + s[i:][::-<span class="hljs-number">1</span>]))<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s) - <span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> s[i] == s[i+<span class="hljs-number">1</span>]:<br>            res = <span class="hljs-built_in">max</span>(res, get(s[:i][::-<span class="hljs-number">1</span>] + s[i:][::-<span class="hljs-number">1</span>]))<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">return</span> res<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>贪心</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>272最大化糖果美味值问题</title>
    <link href="/2024/12/30/272%E6%9C%80%E5%A4%A7%E5%8C%96%E7%B3%96%E6%9E%9C%E7%BE%8E%E5%91%B3%E5%80%BC%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/30/272%E6%9C%80%E5%A4%A7%E5%8C%96%E7%B3%96%E6%9E%9C%E7%BE%8E%E5%91%B3%E5%80%BC%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>题目要求在一个长度为 <code>n</code> 的数组中，选择一些糖果作为奖励，满足以下限制规则：</p><ul><li>如果选择了编号为 <code>i</code> 的糖果，那么编号为 <code>i-1</code>、<code>i-2</code>、<code>i+1</code>、<code>i+2</code> 的糖果将不能被选择。</li><li>每个糖果都有一个对应的美味值。</li><li>目标是使所选糖果的美味值之和最大。</li></ul><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><ol><li><p><strong>动态规划</strong>：</p><p>定义 <code>f[i]</code> 为考虑前 <code>i</code> 个糖果时，满足条件的最大美味值之和。</p></li><li><p><strong>状态转移</strong>：</p><p>对于每个糖果 <code>i</code>，有两种选择：</p><ul><li><strong>不选择</strong>：则 <code>f[i] = max(f[i-1], f[i-2])</code></li><li><strong>选择</strong>：则不能选择 <code>i-1</code>、<code>i-2</code>，因此 <code>f[i] = f[i-3] + a[i]</code></li></ul><p>综合考虑，状态转移方程为：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">f<span class="hljs-selector-attr">[i]</span> = <span class="hljs-built_in">max</span>(f<span class="hljs-selector-attr">[i-1]</span>, f<span class="hljs-selector-attr">[i-2]</span>, f<span class="hljs-selector-attr">[i-3]</span> + <span class="hljs-selector-tag">a</span><span class="hljs-selector-attr">[i]</span>)<br></code></pre></td></tr></table></figure></li><li><p><strong>空间优化</strong>：</p><p>由于每次只需要记录前三个状态，可以使用三个变量 <code>f1</code>, <code>f2</code>, <code>f3</code> 来代替数组 <code>f</code>，从而降低空间复杂度。</p></li><li><p><strong>返回结果</strong>：</p><p>最终返回 <code>f1</code>，即考虑所有糖果后的最大美味值之和。</p></li></ol><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    f1 = f2 = f3 = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-comment"># f[i] = max(f[i - 1], f[i - 2], f[i - 3] + a[i])</span><br>        f1, f2, f3 = <span class="hljs-built_in">max</span>(f1, f2, f3 + a[i]), f1, f2<br>    <span class="hljs-keyword">return</span> f1<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">7</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>]) == <span class="hljs-number">14</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>]) == <span class="hljs-number">18</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">6</span>, [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]) == <span class="hljs-number">9</span>)<br></code></pre></td></tr></table></figure><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><ul><li><strong>时间复杂度</strong>：<code>O(n)</code>，其中 <code>n</code> 是糖果的数量。需要遍历一次数组。</li><li><strong>空间复杂度</strong>：<code>O(1)</code>，仅使用常数级别的额外空间。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>271最大化未出现自然数问题</title>
    <link href="/2024/12/30/271%E6%9C%80%E5%A4%A7%E5%8C%96%E6%9C%AA%E5%87%BA%E7%8E%B0%E8%87%AA%E7%84%B6%E6%95%B0%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/30/271%E6%9C%80%E5%A4%A7%E5%8C%96%E6%9C%AA%E5%87%BA%E7%8E%B0%E8%87%AA%E7%84%B6%E6%95%B0%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>题目要求在一个长度为 <code>n</code> 的数组中，找出最大的未出现的自然数。具体来说，找到最小的正整数 <code>m</code>，使得 <code>m</code> 没有出现在数组中。</p><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><ol><li><p><strong>计数元素频次</strong>：</p><p>使用 <code>Counter</code> 统计数组中每个元素出现的次数。这样可以快速判断某个数字是否存在于数组中。</p></li><li><p><strong>遍历寻找未出现的自然数</strong>：</p><p>从 <code>0</code> 开始，依次检查每个数字 <code>i</code> 是否存在于数组中（即 <code>cnt[i] &gt; 0</code>）。</p><ul><li>如果存在，则继续检查下一个数。由于操作可以把<code>i</code>变成更大的数字，因此可以把多余的<code>i</code>的个数用变量<code>f</code>记录下来。</li><li>如果不存在，那么查看是否还有多余的更小的数字变成当前的数字。如果有则把<code>f</code>的计数减去<code>1</code>,如果没有则返回当前的 <code>i</code> 作为结果。</li></ul></li><li><p><strong>返回结果</strong>：</p><p>如果所有 <code>0</code> 到 <code>n-1</code> 的数字都存在，则返回 <code>n</code>。</p></li></ol><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    cnt = Counter(a)<br>    f = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">if</span> cnt[i] == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">if</span> f &gt; <span class="hljs-number">0</span>:<br>                f -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> i<br>        <span class="hljs-keyword">else</span>:<br>            f += cnt[i] - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> n<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, [<span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">4</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">6</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]) == <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><ul><li><strong>时间复杂度</strong>：<code>O(n)</code>，其中 <code>n</code> 是数组长度，用于统计元素频次和遍历查找。</li><li><strong>空间复杂度</strong>：<code>O(n)</code>，用于存储元素频次。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>枚举</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>262数组子序列的排列个数</title>
    <link href="/2024/12/30/262%E6%95%B0%E7%BB%84%E5%AD%90%E5%BA%8F%E5%88%97%E7%9A%84%E6%8E%92%E5%88%97%E4%B8%AA%E6%95%B0/"/>
    <url>/2024/12/30/262%E6%95%B0%E7%BB%84%E5%AD%90%E5%BA%8F%E5%88%97%E7%9A%84%E6%8E%92%E5%88%97%E4%B8%AA%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>题目要求计算数组中满足特定条件的子序列数量。具体来说，子序列必须是从 <code>1</code> 到 <code>m</code> 的完整排列，且按升序排列。</p><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><ol><li><p><strong>计数元素频次</strong>：</p><p>使用 <code>Counter</code> 统计数组中每个元素出现的次数。这样可以快速获取每个数字出现的数量。</p></li><li><p><strong>迭代构建排列</strong>：</p><p>从 <code>1</code> 开始，依次检查每个数字 <code>i</code> 是否存在于数组中（即 <code>cnt[i] &gt; 0</code>）。</p><ul><li><p>如果存在，当前排列长度为 <code>i</code>，可以选择的方式数为 <code>cnt[i]</code>。</p></li><li><p>将当前选择方式数累乘到一个累积变量 <code>f</code> 中，表示构建长度为 <code>i</code> 的排列的总方式数。</p></li><li><p>将 <code>f</code> 加到最终结果 <code>res</code> 中。</p></li><li><p>一旦发现某个数字 <code>i</code> 在数组中不存在（即 <code>cnt[i] == 0</code>），说明无法继续构建更长的排列，循环终止。</p></li></ul></li></ol><h4 id="示例分析"><a href="#示例分析" class="headerlink" title="示例分析"></a>示例分析</h4><p>以样例 1 为例：</p><ul><li><p>数组 <code>[1, 1, 5, 2, 3, 4]</code> 中元素计数为 <code>&#123;1:2, 5:1, 2:1, 3:1, 4:1&#125;</code>。</p></li><li><p>依次计算：</p><ul><li><p><code>m=1</code>:</p><p><code>cnt[1] = 2</code> → <code>f = 2</code> → <code>res = 2</code></p></li><li><p><code>m=2</code>:</p><p><code>cnt[2] = 1</code> → <code>f = 2 * 1 = 2</code> → <code>res = 4</code></p></li><li><p><code>m=3</code>:</p><p><code>cnt[3] = 1</code> → <code>f = 2 * 1 * 1 = 2</code> → <code>res = 6</code></p></li><li><p><code>m=4</code>:</p><p><code>cnt[4] = 1</code> → <code>f = 2 * 1 * 1 * 1 = 2</code> → <code>res = 8</code></p></li><li><p><code>m=5</code>:</p><p><code>cnt[5] = 1</code> → <code>f = 2 * 1 * 1 * 1 * 1 = 2</code> → <code>res = 10</code></p></li><li><p><code>m=6</code>:</p><p><code>cnt[6] = 0</code> → 终止</p></li></ul></li><li><p>最终结果为 <code>10</code>。</p></li></ul><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    cnt = Counter(a)<br>    res = <span class="hljs-number">0</span><br>    f = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> cnt[i] == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">break</span><br>        f *= cnt[i]<br>        res += f<br><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">6</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]) == <span class="hljs-number">10</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]) == <span class="hljs-number">5</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">7</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]) == <span class="hljs-number">7</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">9</span>, [<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">8</span>]) == <span class="hljs-number">4</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, [<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>]))<br></code></pre></td></tr></table></figure><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><ul><li><strong>时间复杂度</strong>：<code>O(n)</code>，其中 <code>n</code> 是数组长度，用于统计元素频次。</li><li><strong>空间复杂度</strong>：<code>O(n)</code>，用于存储元素频次。</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>260数字匹配问题</title>
    <link href="/2024/12/29/260%E6%95%B0%E5%AD%97%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/29/260%E6%95%B0%E5%AD%97%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题概述"><a href="#问题概述" class="headerlink" title="问题概述"></a>问题概述</h3><p>小 F 拥有一串数字，需按照以下规则将这些数字两两配对：</p><ol><li>数字对中两个数字的差的绝对值必须大于等于给定的差异值 <code>M</code>。</li><li>每个数字只能被配对一次，不能出现在多个数字对中。<br>目标是找出最多能配对出多少对数字。</li></ol><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>为了最大化配对数，采取贪心策略：</p><ol><li><strong>排序</strong>：首先对数字列表 <code>X</code> 进行排序，以便于后续配对时能够高效地找到满足条件的数字对。</li><li><strong>双指针方法</strong>：<ul><li>题目中要求数字两两配对并且不能重复，因此最多的配对个数为$\lfloor \frac{n}{2} \rfloor$，因为数组是有序的。最优的情况一定是其中一个数字来自数组的左半部分，另一个数字来自右半部分</li><li>将列表分为两部分，左指针 <code>l</code> 指向较小的数字，右指针 <code>r</code> 从中间开始指向较大的数字。遍历右指针，尝试找到与左指针指向的数字差值至少为 <code>M</code> 的配对。如果差值小于<code>M</code>，那么继续移动右指针。</li></ul></li><li><strong>终止条件</strong>：当左指针超过中间位置，停止配对过程。</li></ol><h3 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">N: <span class="hljs-built_in">int</span>, M: <span class="hljs-built_in">int</span>, X: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    res = <span class="hljs-number">0</span><br>    X.sort()  <span class="hljs-comment"># 对列表进行排序</span><br>    l = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化左指针</span><br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N // <span class="hljs-number">2</span>, N):  <span class="hljs-comment"># 右指针从中间开始遍历</span><br>        <span class="hljs-keyword">if</span> X[r] - X[l] &gt;= M <span class="hljs-keyword">and</span> l &lt; N // <span class="hljs-number">2</span>:<br>            res += <span class="hljs-number">1</span>  <span class="hljs-comment"># 成功配对，计数器加一</span><br>            l += <span class="hljs-number">1</span>  <span class="hljs-comment"># 移动左指针，确保数字只被使用一次</span><br>    <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure><h3 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><ul><li>排序的时间复杂度为 <code>O(N log N)</code>。</li><li>空间复杂度<code>O(1)</code></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>贪心，双指针</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>251巧克力板选择问题</title>
    <link href="/2024/12/29/251%E5%B7%A7%E5%85%8B%E5%8A%9B%E6%9D%BF%E9%80%89%E6%8B%A9%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/29/251%E5%B7%A7%E5%85%8B%E5%8A%9B%E6%9D%BF%E9%80%89%E6%8B%A9%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>题目要求在多个背包的承重限制下，计算每个背包中最多可以携带的巧克力板数量。每块巧克力板的重量为其边长的平方。需要为每个背包找到在不超过其最大承重的情况下，能够携带的最多巧克力板数。</p><h4 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h4><ol><li><p><strong>动态规划（01 背包）</strong>：</p><ul><li>对于每个背包，使用动态规划来计算在承重限制下可以携带的最大巧克力板数。</li><li>状态 <code>f[j]</code> 表示在承重 <code>j</code> 下可以携带的最大巧克力板数。</li></ul></li><li><p><strong>状态转移</strong>：</p><ul><li>遍历每块巧克力板，重量为 <code>x^2</code>。</li><li>对于每个背包容量 <code>j</code> 从大到小遍历：<ul><li>如果选择当前巧克力板，则 <code>f[j] = max(f[j], f[j - x^2] + 1)</code>。</li></ul></li></ul></li><li><p><strong>优化</strong>：</p><ul><li>计算所有查询中的最大承重 <code>vol</code>，并初始化动态规划数组 <code>f</code>。</li><li>最终对于每个查询，直接返回对应的 <code>f[q]</code>。</li></ul></li></ol><h4 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, m: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span>, queries: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">list</span>:<br>    vol = <span class="hljs-built_in">max</span>(queries)<br>    f = [<span class="hljs-number">0</span>] * (vol + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(vol, x ** <span class="hljs-number">2</span> - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>            f[j] = <span class="hljs-built_in">max</span>(f[j], f[j - x ** <span class="hljs-number">2</span>] + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> [f[q] <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> queries]<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">15</span>]) == [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>])<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>]) == [<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">6</span>, <span class="hljs-number">4</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">18</span>, <span class="hljs-number">25</span>]) == [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>])<br></code></pre></td></tr></table></figure><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><ul><li><strong>时间复杂度</strong>：$O(nvol)$，其中 <code>n</code> 是巧克力板的数量，<code>vol</code> 是最大承重。</li><li><strong>空间复杂度</strong>：$O(vol)$，使用了一维数组 <code>f</code> 来存储状态。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>01背包</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>248小X的区间或值和</title>
    <link href="/2024/12/29/248%E5%B0%8FX%E7%9A%84%E5%8C%BA%E9%97%B4%E6%88%96%E5%80%BC%E5%92%8C/"/>
    <url>/2024/12/29/248%E5%B0%8FX%E7%9A%84%E5%8C%BA%E9%97%B4%E6%88%96%E5%80%BC%E5%92%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>题目要求计算数组中所有可能的连续子数组的权值和，权值定义为子数组中所有选取两个元素按位或（OR）的值之和。最终结果需要对 (10^9 + 7) 取模。</p><h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>首先我们不妨考虑一个暴力一些的做法，计算所有数对的按位或值之和。<br>对于数对<code>a[i]</code> 和 <code>a[j]</code>，$(0 &lt;&#x3D; i &lt; j &lt; n)$。想要连续子数组包含 <code>a[i]</code> 和 <code>a[j]</code>，那么连续子数组的左端点$l$的范围为$0 &lt;&#x3D; l &lt;&#x3D; i$，连续子数组的右端点$r$的范围为$j &lt;&#x3D; r &lt; n$。因此数对的贡献和为<code>(a[i] | a[j]) * (i + 1) * (n - j)</code>所以我们只需要枚举所有数对，将贡献累加即可</p><p>这种方法的时间复杂度为 $O(n ^ 2)$，对于数组长度大于<code>1e5</code>的情况会超时。</p><h3 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">mod</span> = <span class="hljs-keyword">int</span>(<span class="hljs-number">1</span>e9 + <span class="hljs-number">7</span>)<br>def solution(n: <span class="hljs-keyword">int</span>, <span class="hljs-keyword">a</span>: <span class="hljs-keyword">list</span>) -&gt; <span class="hljs-keyword">int</span>:<br>    <span class="hljs-keyword">res</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i in <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">for</span> <span class="hljs-keyword">j</span> in <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, n):<br>            <span class="hljs-keyword">res</span> += (<span class="hljs-keyword">a</span>[i] | <span class="hljs-keyword">a</span>[<span class="hljs-keyword">j</span>]) * (i + <span class="hljs-number">1</span>) * (n - <span class="hljs-keyword">j</span>)<br>            <span class="hljs-keyword">res</span> %= <span class="hljs-keyword">mod</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">res</span> % <span class="hljs-keyword">mod</span><br></code></pre></td></tr></table></figure><p>这种方法的时间复杂度为 $O(n ^ 2)$，对于数组长度大于<code>1e5</code>的情况会超时。</p><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><ul><li>因为每一个比特位之间相互独立，我们可以分开考虑每一位的贡献。<br>对于数对<code>a[i]</code>和<code>a[j]</code>的第<code>k</code>个比特位,我们同样可以采用上述的暴力思路去枚举每个比特位之间的贡献。</li><li>当前比特位的大小是<code>1 &lt;&lt; k</code>,同时注意到当我们固定<code>a[i]</code>而去枚举<code>a[j]</code>时，连续子数组左端点$l$的范围始终是$0&lt;&#x3D;l&lt;&#x3D;i$。那我们直接累加所有右端点的取值不就可以了！！！</li><li>在实现时，我们枚举连续子数组的右端点而累加左端点的值, 根据按位与的性质，当前比特位为<code>1</code>时，左端点可以取任意的值,而当前比特位为<code>0</code>时，只能和左端点包含<code>1</code>的连续子数组产生贡献。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">max</span>(a).bit_length()):<br>        cnt0 = cnt1 = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> a[j] &gt;&gt; i &amp; <span class="hljs-number">1</span>:<br>                res += (cnt1 + cnt0) * (n - j) * (<span class="hljs-number">1</span> &lt;&lt; i) % mod<br>                cnt1 += j + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                res += cnt1 * (n - j) * (<span class="hljs-number">1</span> &lt;&lt; i) % mod<br>                cnt0 += j + <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> res % mod<br></code></pre></td></tr></table></figure><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><ul><li>时间复杂度：$O(nlogm)$，其中 (n) 是数组长度，(m) 是数组中最大值。</li><li>空间复杂度：$O(1)$，使用常数级额外空间。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>位运算</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>246小U走排列问题</title>
    <link href="/2024/12/28/246%E5%B0%8FU%E8%B5%B0%E6%8E%92%E5%88%97%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/28/246%E5%B0%8FU%E8%B5%B0%E6%8E%92%E5%88%97%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在数轴上有 <code>n</code> 个点 <code>a[1], a[2], ..., a[n]</code>，小 U 初始位于原点。她希望按照一定的顺序访问这些点。需要计算在所有不同的访问顺序中，走过的路径的总和。每种顺序对应的路径长度等于她从原点出发依次访问这些点所走的距离之和。最终结果对 (10^9 + 7) 取模。</p><blockquote><p>这题计算贡献的思想和 236 小 U 的数组权值计算问题有一定的相似之处。感兴趣的可以去做一下</p></blockquote><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>为了计算所有排列顺序下路径长度的总和，可以分解路径长度的贡献：</p><ol><li><p><strong>每个点作为起点的贡献</strong>：</p><ul><li>每个点 <code>a[i]</code> 被访问为第一个点时，路径长度增加 <code>|a[i] - 0| = |a[i]|</code>。</li><li>由于有 <code>(n-1)!</code> 种排列方式使得 <code>a[i]</code> 是第一个点，因此总贡献为 <code>a[i] * (n-1)!</code>。</li></ul></li><li><p><strong>每对相邻点之间的贡献</strong>：</p><ul><li>对于每一对不同相邻的点 <code>(a[i], a[j])</code>，<code>|a[i] - a[j]|</code> 会在不同的排列中多次出现。</li><li>排列中一共有<code>n - 1</code>个可以这对相邻点的位置，并且放好这对相邻点之后，剩下的 <code>n - 2</code> 个点的排列方式有 <code>(n-2)!</code> 种。</li><li>因此，这对相邻点之间的贡献为 <code>|a[i] - a[j]| * (n-2)! * (n-1)</code>。我们可以枚举所有的点对，计算它们的贡献。</li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> a[<span class="hljs-number">0</span>]<br>    res = <span class="hljs-number">0</span><br>    f = <span class="hljs-number">1</span><br>    <span class="hljs-comment"># 计算 (n-2)!</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n - <span class="hljs-number">1</span>): f = f * i % mod<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        res += a[i] * f * (n - <span class="hljs-number">1</span>)    <span class="hljs-comment"># a[i] * (n-1)!</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> i != j:<br>                <span class="hljs-comment"># |a[i] - a[j]| * (n-2)! * (n-1)</span><br>                res += <span class="hljs-built_in">abs</span>(a[i] - a[j]) * f * (n - <span class="hljs-number">1</span>) % mod<br>    <span class="hljs-keyword">return</span> res % mod<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]) == <span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>]) == <span class="hljs-number">324</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">6</span>]) == <span class="hljs-number">16</span>)<br><br></code></pre></td></tr></table></figure><p>复杂度分析：<br>时间复杂度为 $O(n^2)$，空间复杂度为 $O(1)$。</p><ol start="3"><li><strong>优化</strong><ul><li>注意到点<code>a[i]</code> 作为点对中的第一个点的贡献为<code>f * (n - 1) * (a[i] 到其他所有点对的距离和)</code>，因此可以先计算出<code>a[i]</code>到其他所有点的距离和，然后再计算<code>a[i]</code>的贡献。</li><li>如何求<code>a[i]</code>到其他所有点的距离和？可以先对所有点排序，计算前缀和。<br>那么<code>a[i]</code>到其他所有点的距离和为<code>a[i]</code> * 前面的点个数 - 前面的区间和 + 后面的区间和 - a[i] * 后面的点个数。</li></ul></li></ol><p><strong>代码实现如下：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> accumulate<br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getSumAbsoluteDifferences</span>(<span class="hljs-params">nums</span>):<br>    n = <span class="hljs-built_in">len</span>(nums)<br>    s = <span class="hljs-built_in">list</span>(accumulate(nums))<br>    res = [<span class="hljs-number">0</span>] * n          <span class="hljs-comment"># res[i] = 前面的个数 * cur - 前面总和 + 后面的和 - 后面个数 * cur</span><br>    <span class="hljs-keyword">for</span> i, x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(nums):<br>        res[i] = (i + <span class="hljs-number">1</span>) * x - s[i] + (s[n - <span class="hljs-number">1</span>] - s[i]) - (n - i - <span class="hljs-number">1</span>) * x<br>        res[i] %= mod<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> a[<span class="hljs-number">0</span>]<br>    res = <span class="hljs-number">0</span><br>    a.sort()<br>    dis = getSumAbsoluteDifferences(a)<br>    f = <span class="hljs-number">1</span><br>    <span class="hljs-comment"># 计算 (n-2)!</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n - <span class="hljs-number">1</span>): f = f * i % mod<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        res = (res + a[i] * f * (n - <span class="hljs-number">1</span>) + dis[i] * (n - <span class="hljs-number">1</span>) * f) % mod<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]) == <span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>]) == <span class="hljs-number">324</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">6</span>]) == <span class="hljs-number">16</span>)<br></code></pre></td></tr></table></figure><p>复杂度分析：<br>时间复杂度为 $O(n \log n)$, 瓶颈在排序上<br>空间复杂度为 $O(n)$。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>244小U的问号替换问题</title>
    <link href="/2024/12/28/244%E5%B0%8FU%E7%9A%84%E9%97%AE%E5%8F%B7%E6%9B%BF%E6%8D%A2%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/28/244%E5%B0%8FU%E7%9A%84%E9%97%AE%E5%8F%B7%E6%9B%BF%E6%8D%A2%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>给定一个由数字字符和 <code>?</code> 组成的字符串，目标是将所有的 <code>?</code> 替换为数字字符，使得替换后的字符串表示的十进制整数是正整数 <code>p</code> 的倍数。由于方案数可能非常大，需要对最终结果取模 (10^9 + 7)。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>使用动态规划的方法解决此问题。定义 <code>f[i][j]</code> 表示前 <code>i</code> 位替换后的数模 <code>p</code> 等于 <code>j</code> 的方案数。</p><h3 id="动态规划状态"><a href="#动态规划状态" class="headerlink" title="动态规划状态"></a>动态规划状态</h3><ul><li><strong>状态定义</strong>：<code>f[i][j]</code> 表示前 <code>i</code> 位替换后数模 <code>p</code> 等于 <code>j</code> 的方案数。</li><li><strong>初始状态</strong>：<code>f[0][0] = 1</code>，表示前 0 位数模 <code>p</code> 为 0 的方案只有一种，即空串。</li><li><strong>状态转移</strong>：<ul><li>对于每一位字符 <code>c</code>（从第 1 位到第 <code>n</code> 位）：<ul><li>如果 <code>c</code> 是 <code>?</code>，则可以替换为 <code>0</code> 到 <code>9</code> 中的任意一个数字。</li><li>如果 <code>c</code> 是具体数字，则只能替换为该数字。</li></ul></li><li>对于每一个可能的当前模值 <code>j</code>，更新新的模值 <code>(j * 10 + k) % p</code>，其中 <code>k</code> 是替换后的数字。</li></ul></li><li><strong>空间优化</strong>：由于每次只需要用到上一次的状态，可以使用滚动数组进行优化。</li></ul><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># def solution(s: str, p: int) -&gt; int:</span><br><span class="hljs-comment">#     n = len(s)</span><br><span class="hljs-comment">#     f = [[0] * p for _ in range(n + 1)]</span><br><span class="hljs-comment">#     f[0][0] = 1</span><br><span class="hljs-comment">#     for i, c in enumerate(s, 1):</span><br><span class="hljs-comment">#         for j in range(p):</span><br><span class="hljs-comment">#             if c == &quot;?&quot;:</span><br><span class="hljs-comment">#                 for k in range(10):</span><br><span class="hljs-comment">#                     f[i][(j * 10 + k) % p] += f[i - 1][j]</span><br><span class="hljs-comment">#                     f[i][(j * 10 + k) % p] %= mod</span><br><span class="hljs-comment">#             else:</span><br><span class="hljs-comment">#                 f[i][(j * 10 + int(c)) % p] += f[i - 1][j]</span><br><span class="hljs-comment">#                 f[i][(j * 10 + int(c)) % p] %= mod</span><br><span class="hljs-comment">#     return f[n][0]</span><br><br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span>, p: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    n = <span class="hljs-built_in">len</span>(s)<br>    pre = [<span class="hljs-number">0</span>] * p<br>    pre[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s, <span class="hljs-number">1</span>):<br>        cur = [<span class="hljs-number">0</span>] * p<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(p):<br>            <span class="hljs-keyword">if</span> c == <span class="hljs-string">&quot;?&quot;</span>:<br>                <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>                    cur[(j * <span class="hljs-number">10</span> + k) % p] = (cur[(j * <span class="hljs-number">10</span> + k) % p] + pre[j]) % mod<br>            <span class="hljs-keyword">else</span>:<br>                cur[(j * <span class="hljs-number">10</span> + <span class="hljs-built_in">int</span>(c)) % p] = (cur[(j * <span class="hljs-number">10</span> + <span class="hljs-built_in">int</span>(c)) % p] + pre[j]) % mod<br>        pre = cur.copy()<br>    <span class="hljs-keyword">return</span> cur[<span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;??&quot;</span>, <span class="hljs-number">1</span>) == <span class="hljs-number">100</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;????1&quot;</span>, <span class="hljs-number">12</span>) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;1??2&quot;</span>, <span class="hljs-number">3</span>) == <span class="hljs-number">34</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：$O(n \times p \times 10)$，其中 <code>n</code> 是字符串长度，<code>p</code> 是给定的正整数。</li><li><strong>空间复杂度</strong>：$O(p)$</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>236小U的数组权值计算</title>
    <link href="/2024/12/28/236%E5%B0%8FU%E7%9A%84%E6%95%B0%E7%BB%84%E6%9D%83%E5%80%BC%E8%AE%A1%E7%AE%97/"/>
    <url>/2024/12/28/236%E5%B0%8FU%E7%9A%84%E6%95%B0%E7%BB%84%E6%9D%83%E5%80%BC%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>小 R 定义一个数组的“权值”为相邻两数乘积为奇数的对数。给定一个整数 n，表示数组的长度，即需要求从 1 到 n 的所有排列的权值之和。每个排列包含从 1 到 n 的每个正整数且仅出现一次。由于结果可能非常大，答案需要对 $10^9 + 7$ 取模。</p><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><ol><li><p><strong>奇数对的选择：</strong></p><ul><li>只有两个奇数的乘积为奇数</li><li>在 1 到 n 的数中，奇数的个数为 $\lceil n&#x2F;2 \rceil$。</li><li>选择两个不同的奇数有 $\lceil n&#x2F;2 \rceil \times (\lceil n&#x2F;2 \rceil - 1)$ 种方法。</li></ul></li><li><p><strong>位置的安排：</strong></p><ul><li>一个奇数对可以出现在排列中的 n-1 个相邻位置中的任意一个位置。</li><li>除去选定的两个奇数后，剩下的 n-2 个元素可以有$(n-2)!$种排列方式。</li></ul></li><li><p><strong>总计：</strong></p><ul><li>将以上部分相乘，得到总权值之和：<br>a(n) &#x3D; $\lceil n&#x2F;2 \rceil \times (\lceil n&#x2F;2 \rceil - 1) \times (n-1)!$</li></ul></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> ceil<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    res = ceil(n / <span class="hljs-number">2</span>) * ceil(n / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n): res = (res * i) % mod<br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>) == <span class="hljs-number">144</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>) == <span class="hljs-number">4</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">6</span>) == <span class="hljs-number">720</span>)<br></code></pre></td></tr></table></figure><p>复杂度分析：<br>时间复杂度：$O(n)$<br>空间复杂度：$O(1)$</p>]]></content>
    
    
    
    <tags>
      
      <tag>组合数学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>235小U的好字符串</title>
    <link href="/2024/12/27/235%E5%B0%8FU%E7%9A%84%E5%A5%BD%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    <url>/2024/12/27/235%E5%B0%8FU%E7%9A%84%E5%A5%BD%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    
    <content type="html"><![CDATA[<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>小 U 定义了一个“好字符串”，它的要求是该字符串中不包含任意长度不小于 2 的回文子串。现在小 U 拿到了一个字符串，她想知道有多少个非空的子序列是“好字符串”。你的任务是帮助她计算出这些子序列的数量。</p><p>例如，对于字符串 <code>&quot;aba&quot;</code>，它的子序列中除了 <code>&quot;aa&quot;</code> 和 <code>&quot;aba&quot;</code> 以外，其余五个子序列都是“好字符串”。</p><p>注意：由于答案可能非常大，你需要对结果取 (10^9 + 7) 进行输出。</p><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目中要求求出一个字符串中不包含任意长度不小于 2 的回文子串的子序列的数量。这里我们可以使用动态规划的方法来解决这个问题。任意一个长度大于等于 3 的回文串，一定包含一个长度为 2 的回文串或者长度为 3 的字符串。所以我们可以记录子序列中选择的前两个字符，然后遍历字符串，如果当前字符和前两个字符都不相等，那么我们可以选择当前字符，否则我们只能选择不选择当前字符。最后我们将所有的选择情况相加即可。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 记忆化搜索</span><br><span class="hljs-comment"># from functools import cache</span><br><span class="hljs-comment"># def solution(s: str) -&gt; int:</span><br><span class="hljs-comment">#     mod = int(1e9 + 7)</span><br><span class="hljs-comment">#     def dfs(i, pre1, pre2):</span><br><span class="hljs-comment">#         if i == len(s):</span><br><span class="hljs-comment">#             return 1</span><br><span class="hljs-comment">#         res = 0</span><br>          <span class="hljs-comment"># 不选择当前字符</span><br><span class="hljs-comment">#         res += dfs(i + 1, pre1, pre2)</span><br><span class="hljs-comment">#         if s[i] != pre1 and s[i] != pre2:</span><br><span class="hljs-comment">#             res += dfs(i + 1, pre2, s[i])</span><br><span class="hljs-comment">#         return res</span><br>      <span class="hljs-comment"># 不包含空序列</span><br><span class="hljs-comment">#     res = dfs(0, -1, -1) - 1</span><br><span class="hljs-comment">#     return res</span><br><br><span class="hljs-comment"># 动态规划</span><br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    n = <span class="hljs-built_in">len</span>(s)<br>    m = <span class="hljs-number">26</span><br>    f = [[<span class="hljs-number">0</span>] * (m + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>)]<br>    <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> s:<br>        c = <span class="hljs-built_in">ord</span>(ch) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>):<br>            <span class="hljs-keyword">if</span> i == c:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>):<br>                <span class="hljs-keyword">if</span> j == c:<br>                    <span class="hljs-keyword">continue</span><br>                f[j][c] += f[i][j]<br>                f[j][c] %= mod<br>        f[-<span class="hljs-number">1</span>][c] += <span class="hljs-number">1</span><br>    res = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">sum</span>(f[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>))<br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;aba&quot;</span>) == <span class="hljs-number">5</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;aaa&quot;</span>) == <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;ghij&quot;</span>) == <span class="hljs-number">15</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;zyyzbyn&quot;</span>) == <span class="hljs-number">51</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：$O(nm^2)$</li><li><strong>空间复杂度</strong>：$O(m^2)$</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
      <tag>记忆化搜索</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>229小U的chi权值计算</title>
    <link href="/2024/12/27/229%E5%B0%8FU%E7%9A%84chi%E6%9D%83%E5%80%BC%E8%AE%A1%E7%AE%97/"/>
    <url>/2024/12/27/229%E5%B0%8FU%E7%9A%84chi%E6%9D%83%E5%80%BC%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>给定一个由字符<code>&#39;c&#39;</code>、<code>&#39;h&#39;</code>、<code>&#39;i&#39;</code>、<code>&#39;?&#39;</code>组成的字符串，其中<code>&#39;?&#39;</code>可以替换为<code>&#39;c&#39;</code>、<code>&#39;h&#39;</code>或<code>&#39;i&#39;</code>。定义字符串的权值基于所有字符<code>&#39;h&#39;</code>的位置计算。对于每个<code>&#39;h&#39;</code>，其前面的<code>&#39;c&#39;</code>和后面的<code>&#39;i&#39;</code>都会对其贡献 1 的权值。求所有可能替换方案的权值之和，结果对 (10^9 + 7) 取模。</p><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><strong>统计未知字符</strong>：首先统计字符串中 <code>?</code> 的总数，用 <code>cnt</code> 表示。</li><li><strong>前缀计数</strong>：<ul><li><code>prec</code> 记录当前位置前面的 <code>c</code> 数量。</li><li><code>pre</code> 记录前面 <code>?</code> 的数量。</li></ul></li><li><strong>后缀计数</strong>：<ul><li><code>sufi</code> 记录当前位置后面的 <code>i</code> 数量。</li><li><code>suf</code> 记录后面 <code>?</code> 的数量。</li></ul></li><li><strong>遍历字符串</strong>：<ul><li>对于每个字符：<ul><li>如果是 <code>c</code>，则增加 <code>prec</code>。</li><li>如果是 <code>i</code>，则减少 <code>sufi</code>。</li><li>如果是 <code>h</code>，计算其贡献：<ul><li>固定 <code>h</code> 的贡献为 <code>prec + sufi</code>，乘以当前 <code>?</code> 的排列组合数。每个 <code>?</code> 都可以替换成 <code>c</code>、<code>h</code>、<code>i</code> 这三种字符，所以总共的替换方案为 <code>pow(3, cnt, mod)</code>。因此前面的 <code>c</code> 和 <code>i</code> 的贡献为 <code>pow(3, cnt, mod) * (prec + sufi)</code>。</li><li>考虑前面的 <code>?</code> 替换为 <code>c</code> 和后面的 <code>?</code> 替换为 <code>i</code> 的情况。前面的 <code>?</code> 替换成 <code>c</code> 也有贡献，一个 <code>?</code> 在 <code>pow(3, cnt - 1, mod)</code> 种情况下可以替换成 <code>c</code>，而当前位置前面共有<code>pre</code>个<code>?</code>,所以前面的 <code>?</code> 的贡献为 <code>pre * pow(3, cnt - 1, mod)</code>。后面的 <code>?</code> 同理为 <code>suf * pow(3, cnt - 1, mod)</code>。</li></ul></li><li>如果是 <code>?</code>，考虑其替换为 <code>h</code> 的情况，类似地计算贡献，并更新 <code>pre</code> 和 <code>suf</code>。当前的 <code>?</code> 已经替换成了 <code>h</code>，所以后面的 <code>?</code> 的贡献为 <code>suf * pow(3, cnt - 2, mod)</code>。前面的 <code>?</code> 同理为 <code>pre * pow(3, cnt - 2, mod)</code>。</li></ul></li></ul></li><li><strong>取模</strong>：最终结果对 (10^9 + 7) 取模。</li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    pre = <span class="hljs-number">0</span><br>    cnt = suf = s.count(<span class="hljs-string">&#x27;?&#x27;</span>)<br>    prec = <span class="hljs-number">0</span><br>    sufi = s.count(<span class="hljs-string">&#x27;i&#x27;</span>)<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>        <span class="hljs-keyword">if</span> s[i] == <span class="hljs-string">&#x27;i&#x27;</span>:<br>            sufi -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> s[i] == <span class="hljs-string">&#x27;c&#x27;</span>:<br>            prec += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> s[i] == <span class="hljs-string">&quot;h&quot;</span>:<br>            res = (res + <span class="hljs-built_in">pow</span>(<span class="hljs-number">3</span>, cnt, mod) * (prec + sufi) + pre * <span class="hljs-built_in">pow</span>(<span class="hljs-number">3</span>, cnt - <span class="hljs-number">1</span>, mod) + suf * <span class="hljs-built_in">pow</span>(<span class="hljs-number">3</span>, cnt - <span class="hljs-number">1</span>, mod)) % mod<br>        <span class="hljs-keyword">else</span>:<br>            suf -= <span class="hljs-number">1</span><br>            res = (res + <span class="hljs-built_in">pow</span>(<span class="hljs-number">3</span>, cnt - <span class="hljs-number">1</span>, mod) * (prec + sufi) + pre * <span class="hljs-built_in">pow</span>(<span class="hljs-number">3</span>, cnt - <span class="hljs-number">2</span>, mod) + suf * <span class="hljs-built_in">pow</span>(<span class="hljs-number">3</span>, cnt - <span class="hljs-number">2</span>, mod)) % mod<br>            pre += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> res<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;ch?hi&quot;</span>) == <span class="hljs-number">16</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;ccch&quot;</span>) == <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;c?i&quot;</span>) == <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><h2 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h2><ul><li><strong>时间复杂度</strong>：(O(n))，其中(n)是字符串的长度。（实现中可以预处理快速幂的结果，使每步计算都是(O(1))的时间复杂度）</li><li><strong>空间复杂度</strong>：(O(1))，只使用了常数额外空间。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>组合 贡献</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>206小R的二叉树探险</title>
    <link href="/2024/12/27/206%E5%B0%8FR%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91%E6%8E%A2%E9%99%A9/"/>
    <url>/2024/12/27/206%E5%B0%8FR%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91%E6%8E%A2%E9%99%A9/</url>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>在一个神奇的二叉树中，结构非常独特：每层的节点值赋值方向是交替的，第一层从左到右，第二层从右到左，以此类推，且该二叉树有无穷多层。<br>小 R 对这个二叉树充满了好奇，她想知道，在二叉树中两个节点之间 x, y 的路径长度是多少。</p><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>不妨直接考虑一颗二叉树全部从左到右编号的情况，这样我们可以获取 x 和 y 在这颗树中的编号，它们之间的相对距离不变</p><ul><li>奇数层（1、3、5、…）从左到右编号。因此位于奇数层的节点的编号不变</li><li>偶数层（2、4、6、…）从右到左编号。因此，对于偶数层，需要进行编号的对称转换。<br>第<code>k</code>层一共有<code>2^(k-1)</code>个节点，编号从<code>2^(k-1)</code>到<code>2^k-1</code>，并且观察左右对称的节点的编号总和不变，为<code>2^(k-1) + 2^k - 1</code>。因此，对于偶数层的节点<code>n</code>，其对称编号为<code>2^(k-1) + 2^k - 1 - n</code>。</li></ul><p>找到节点 <code>x</code> 和 <code>y</code> 到根节点的路径，并记录每个节点在路径中的深度，遍历两个路径，找到最近的公共祖先节点，计算路径长度。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">def</span> get_path(n):<br>    <span class="hljs-attribute">d1</span> = &#123;&#125;<br>    <span class="hljs-attribute">k</span> = n.bit_length()<br>    <span class="hljs-attribute">if</span> k % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>        <span class="hljs-attribute">n</span> = <span class="hljs-number">2</span> ** k + <span class="hljs-number">2</span> ** (k - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span> - n<br>    <span class="hljs-attribute">for</span> i in range(k):<br>        <span class="hljs-attribute">d1</span>[n] = i<br>        <span class="hljs-attribute">n</span> //= <span class="hljs-number">2</span><br>    <span class="hljs-attribute">return</span> d1<br><span class="hljs-attribute">def</span> solution(x: int, y: int) -&gt; int:<br>    <span class="hljs-attribute">d1</span> = get_path(x)<br>    <span class="hljs-attribute">d2</span> = get_path(y)<br>    <span class="hljs-attribute">res</span> = min(d1[k] + d2[k] for k in d1.keys() &amp; d2.keys())<br>    <span class="hljs-attribute">return</span> res<br><br><span class="hljs-attribute">if</span> __name__ == &#x27;__main__&#x27;:<br>    <span class="hljs-attribute">print</span>(solution(<span class="hljs-number">11</span>, <span class="hljs-number">4</span>) == <span class="hljs-number">5</span>)<br>    <span class="hljs-attribute">print</span>(solution(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>) == <span class="hljs-number">3</span>)<br>    <span class="hljs-attribute">print</span>(solution(<span class="hljs-number">7</span>, <span class="hljs-number">7</span>) == <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>二叉树</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git命令</title>
    <link href="/2024/12/26/Git%E5%91%BD%E4%BB%A4/"/>
    <url>/2024/12/26/Git%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="Linux-基本命令"><a href="#Linux-基本命令" class="headerlink" title="Linux 基本命令"></a>Linux 基本命令</h1><p>SSH 客户端<br>在 VMware 界面中操作虚拟机非常不友好，所以一般推荐使用专门的 SSH 客户端。市面上常见的有：</p><ul><li>Xshell：个人免费，商业收费，之前爆出过有隐藏后门。不推荐</li><li>Finshell：基础功能免费，高级功能收费，基于 Java，内存占用较高（在 1 个 G 左右）。不推荐</li><li>MobarXterm：基础功能免费、高级功能收费。开源、功能强大、内存占用低（只有 10m 左右），但是界面不太漂亮。推荐使用<br>(教程随便找个网上的配置就行了，注意不要使用校园网！！！我被坑了好久)</li></ul><h2 id="1-目录操作"><a href="#1-目录操作" class="headerlink" title="1.目录操作"></a>1.目录操作</h2><h3 id="1-1-切换目录"><a href="#1-1-切换目录" class="headerlink" title="1.1 切换目录"></a>1.1 切换目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /xxx/xxx          #切换到指定目录<br>cd ~                 #切换到当前用户的家目录<br>cd -                 #切换到上次访问的目录<br>cd .                 #当前目录<br>cd ..                #切换到上级目录<br>cd /                 #切换到根目录<br></code></pre></td></tr></table></figure><h3 id="1-2-查看目录"><a href="#1-2-查看目录" class="headerlink" title="1.2 查看目录"></a>1.2 查看目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls                   #查看当前目录下的文件<br>ls -l                #查看当前目录下的文件详细信息(等价于ll)<br>ls -a                #查看当前目录下的所有文件(包括隐藏文件)<br>ls -lh               #查看当前目录下的文件详细信息(包括文件大小)<br></code></pre></td></tr></table></figure><h3 id="1-3-创建目录"><a href="#1-3-创建目录" class="headerlink" title="1.3 创建目录"></a>1.3 创建目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir xxx            #创建一个目录<br>mkdir /xxx/xxx       #创建一个目录<br></code></pre></td></tr></table></figure><h3 id="1-4-删除目录"><a href="#1-4-删除目录" class="headerlink" title="1.4 删除目录"></a>1.4 删除目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">rm /path/to/file          # 删除指定文件<br>rm -r /path/to/directory   # 递归删除目录及其内容<br>rm -rf /path/to/directory  # 递归强制删除目录及其内容<br></code></pre></td></tr></table></figure><h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><ul><li><code>-r(recursion)</code>：递归删除，用于删除目录及其内部所有文件和子目录。</li><li><code>-f(force)</code>：强制删除，忽略不存在的文件并且不显示任何提示。</li></ul><h3 id="1-5-移动和重命名"><a href="#1-5-移动和重命名" class="headerlink" title="1.5 移动和重命名"></a>1.5 移动和重命名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mv 当前目录名 新目录名        # 修改目录名，同样适用于文件操作<br>mv /usr/tmp/tool /opt          # 将 /usr/tmp 目录下的 tool 目录剪切到 /opt 目录下面<br><br></code></pre></td></tr></table></figure><h2 id="2-文件操作"><a href="#2-文件操作" class="headerlink" title="2.文件操作"></a>2.文件操作</h2><h3 id="2-1-创建文件"><a href="#2-1-创建文件" class="headerlink" title="2.1 创建文件"></a>2.1 创建文件</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">touch</span> <span class="hljs-number">1</span>.txt   # 在当前目录下创建<span class="hljs-number">1</span>.txt<br></code></pre></td></tr></table></figure><h3 id="2-2-删除文件"><a href="#2-2-删除文件" class="headerlink" title="2.2 删除文件"></a>2.2 删除文件</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">rm</span> 文件名              <span class="hljs-comment"># 删除当前目录下的文件</span><br><span class="hljs-built_in">rm</span> <span class="hljs-operator">-f</span> 文件名           <span class="hljs-comment"># 删除当前目录的的文件（不询问）</span><br></code></pre></td></tr></table></figure><h3 id="2-3-编辑文件"><a href="#2-3-编辑文件" class="headerlink" title="2.3 编辑文件"></a>2.3 编辑文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br>进入后，操作界面有三种模式：命令模式（command mode）、插入模式（Insert mode）和底行模式（last line mode）<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">### 命令模式</span></span><br>- 刚进入文件就是命令模式，通过方向键控制光标位置<br>- 使用命令 `dd` 删除当前整行<br>- 使用命令 `/字段` 进行查找<br>- 按 `i` 在光标所在字符前开始插入<br>- 按 `a` 在光标所在字符后开始插入<br>- 按 `o` 在光标所在行的下面另起一新行插入<br>- 按 `:` 进入底行模式<br>- 使用 `yy` 复制当前行<br>- 使用 `p(小写)` 在光标后粘贴<br>- 使用 `P(大写)` 在光标前粘贴<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">### 插入模式</span></span><br>- 此时可以对文件内容进行编辑，左下角会显示 &quot;-- 插入 --&quot;<br>- 按 `ESC` 进入底行模式<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">### 底行模式</span></span><br>- 退出编辑：`:q`<br>- 强制退出：`:q!`<br>- 保存并退出：`:wq`<br><br></code></pre></td></tr></table></figure><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><ul><li><p><strong>启动 vi 编辑器：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi filename.txt<br></code></pre></td></tr></table></figure><p>打开文件后，默认进入命令模式。</p></li><li><p><strong>从插入模式切换到命令模式：</strong></p><ul><li>按 <code>i</code> 进入插入模式。</li><li>完成编辑后，按 <code>ESC</code> 返回命令模式。</li></ul></li><li><p><strong>从底行模式切换到命令模式：</strong></p><ul><li>在命令模式下，按 <code>:</code> 进入底行模式。</li><li>输入命令（例如 <code>:wq</code>）后，按 <code>Enter</code> 返回命令模式。</li></ul></li></ul><h3 id="2-4-查看文件"><a href="#2-4-查看文件" class="headerlink" title="2.4 查看文件"></a>2.4 查看文件</h3><h4 id="2-4-1-cat-命令"><a href="#2-4-1-cat-命令" class="headerlink" title="2.4.1. cat 命令"></a>2.4.1. <code>cat</code> 命令</h4><p><code>cat</code>（concatenate）命令用于一次性显示整个文件内容，或者将多个文件连接起来输出。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat filename.txt          # 显示文件内容<br>cat file1.txt file2.txt   # 连接并显示多个文件的内容<br></code></pre></td></tr></table></figure><h4 id="2-4-2-less命令"><a href="#2-4-2-less命令" class="headerlink" title="2.4.2 less命令"></a>2.4.2 <code>less</code>命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">less filename.txt    # 分页查看文件内容<br></code></pre></td></tr></table></figure><h1 id="Git-命令"><a href="#Git-命令" class="headerlink" title="Git 命令"></a>Git 命令</h1><h2 id="1-获取本地仓库"><a href="#1-获取本地仓库" class="headerlink" title="1.获取本地仓库"></a>1.获取本地仓库</h2><p>进入目标目录后右键点击 <code>Git Bash Here</code> 运行命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">git init<br></code></pre></td></tr></table></figure><p>成功之后可在文件夹下看到<code>.git</code>文件夹</p><h2 id="2-基础操作指令"><a href="#2-基础操作指令" class="headerlink" title="2.基础操作指令"></a>2.基础操作指令</h2><h3 id="2-1-Git-的三个主要区域"><a href="#2-1-Git-的三个主要区域" class="headerlink" title="2.1 Git 的三个主要区域"></a>2.1 Git 的三个主要区域</h3><p>在 Git 中，文件的修改会在不同的区域之间转换，这些区域主要包括工作区（Working Directory）、暂存区（Staging Area）和版本库（Repository）。理解这些区域的关系对于有效地使用 Git 至关重要。</p><ol><li><strong>工作区（Working Directory）</strong><ul><li><strong>描述</strong>：工作区是你在文件系统中实际看到和操作的项目目录。在这里，你可以编辑、添加、删除文件。</li><li><strong>状态</strong>：当你在工作区中对文件进行修改时，这些文件处于“已修改”（modified）状态。</li></ul></li><li><strong>暂存区（Staging Area）</strong><ul><li><strong>描述</strong>：暂存区是一个临时区域，用于存放即将提交到版本库的文件变更。</li><li><strong>状态</strong>：通过 <code>git add</code> 命令，你可以将工作区中已修改的文件添加到暂存区，这些文件此时处于“已暂存”（staged）状态。</li></ul></li><li><strong>版本库（Repository）</strong><ul><li><strong>描述</strong>：版本库是 Git 用来存储项目历史记录的地方。当你提交（commit）变更时，这些变更会被记录在版本库中。</li><li><strong>状态</strong>：通过 <code>git commit</code> 命令，暂存区中的文件变更会被提交到版本库，文件状态变为“已提交”（committed）。</li></ul></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git status   # 查看当前工作区和暂存区的状态<br>git add .    # 将当前目录下的所有变更添加到暂存区<br>git commit -m &quot;提交信息&quot; # 将暂存区的变更提交到版本库，并添加提交信息<br></code></pre></td></tr></table></figure><h3 id="2-2-查看提交日志"><a href="#2-2-查看提交日志" class="headerlink" title="2.2 查看提交日志"></a>2.2 查看提交日志</h3><p><strong>作用</strong>：查看提交记录</p><p><strong>命令形式</strong>：<code>git log [option]</code></p><h4 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h4><ul><li><code>--all</code>：显示所有分支</li><li><code>--pretty=oneline</code>：将提交信息显示为一行</li><li><code>--abbrev-commit</code>：使得输出的 commit ID 更简短</li><li><code>--graph</code>：以图的形式显示</li></ul><p>每次输入这些参数非常的麻烦，我们可以使用别名简化<br>打开<code>gitbash</code>，执行<code>touch ~/.bashrc</code>，然后在文件中添加如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">用于输出git提交日志</span><br>alias git-log=&#x27;git log --pretty=oneline --all --graph --abbrev-commit&#x27;<br><span class="hljs-meta prompt_"> #</span><span class="language-bash">用于输出当前目录所有文件及基本信息</span><br>alias ll=&#x27;ls -al&#x27;<br></code></pre></td></tr></table></figure><p>关闭文件后让执行文件生效，执行<code>source ~/.bashrc</code>，然后执行<code>git-log</code>即可查看提交日志</p><h3 id="2-3-版本回退"><a href="#2-3-版本回退" class="headerlink" title="2.3 版本回退"></a>2.3 版本回退</h3><p>可以通过日志产看提交的版本号，然后使用<code>git reset</code>命令回退到指定版本<br>使用<code>git reflog</code>命令可以查看已经删除的提交记录</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">git</span> <span class="hljs-string">reset</span> <span class="hljs-built_in">--hard</span> <span class="hljs-string">commitID</span>    <span class="hljs-comment"># 回退到指定版本</span><br></code></pre></td></tr></table></figure><h3 id="2-4-添加忽略文件"><a href="#2-4-添加忽略文件" class="headerlink" title="2.4 添加忽略文件"></a>2.4 添加忽略文件</h3><p>可以在项目根目录下创建<code>.gitignore</code>文件，然后在文件中添加需要忽略的文件或目录，这样提交时就不会提交这些文件<br>示例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">忽略所有.txt结尾的文件</span><br>*.txt<br><span class="hljs-meta prompt_"># </span><span class="language-bash">忽略1.doc文件</span><br>1.doc<br><br></code></pre></td></tr></table></figure><h2 id="3-分支操作"><a href="#3-分支操作" class="headerlink" title="3.分支操作"></a>3.分支操作</h2><p>Git 的分支也非常轻量。它们只是简单地指向某个提交纪录 —— 仅此而已。所以许多 Git 爱好者传颂：<br>早建分支！多用分支！<br>这是因为即使创建再多的分支也不会造成储存或内存上的开销，并且按逻辑分解工作到不同的分支要比维护那些特别臃肿的分支简单多了。</p><p>在将分支和提交记录结合起来后，我们会看到两者如何协作。现在只要记住使用分支其实就相当于在说：“我想基于这个提交以及它所有的 parent 提交进行新的工作。”</p><h3 id="3-1-创建分支"><a href="#3-1-创建分支" class="headerlink" title="3.1 创建分支"></a>3.1 创建分支</h3><p>使用 <code>git branch &lt;分支名&gt;</code> 来创建一个新分支。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch main<br></code></pre></td></tr></table></figure><h3 id="3-2-切换分支"><a href="#3-2-切换分支" class="headerlink" title="3.2 切换分支"></a>3.2 切换分支</h3><p>使用 <code>git checkout &lt;分支名&gt;</code> 来切换到指定分支。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout main<br></code></pre></td></tr></table></figure><p>使用 <code>git checkout -b &lt;分支名&gt;</code> 可以同时创建并切换到新分支。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b master<br></code></pre></td></tr></table></figure><h3 id="3-3-合并分支"><a href="#3-3-合并分支" class="headerlink" title="3.3 合并分支"></a>3.3 合并分支</h3><p>使用 <code>git merge &lt;分支名&gt;</code> 将指定分支合并到当前分支。<br>需要先切换到要合并到的分支，然后再执行合并操作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 假设当前在 main 分支上, 将 master 分支合并到 main 分支</span><br>git merge master<br></code></pre></td></tr></table></figure><h3 id="3-4-删除分支"><a href="#3-4-删除分支" class="headerlink" title="3.4 删除分支"></a>3.4 删除分支</h3><p>使用 <code>git branch -d &lt;分支名&gt;</code> 删除本地分支。<br>注意： 不能删除当前所在的分支。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch -d b1 <span class="hljs-comment"># 删除分支时，需要做各种检查</span><br>git branch -D b1 <span class="hljs-comment"># 强制删除</span><br></code></pre></td></tr></table></figure><h2 id="4-操作远程仓库"><a href="#4-操作远程仓库" class="headerlink" title="4 操作远程仓库"></a>4 操作远程仓库</h2><h3 id="4-1-创建远程仓库"><a href="#4-1-创建远程仓库" class="headerlink" title="4.1 创建远程仓库"></a>4.1 创建远程仓库</h3><p>在<code>github</code>或<code>gitee</code>上创建一个新的仓库，在本地库中执行以下命令生成 SSH 公钥(文件路径为<code>C:\Users\用户名\.ssh\id_rsa.pub</code>)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh-keygen -t rsa<br></code></pre></td></tr></table></figure><p>打开文件或者用命令<code>cat ~/.ssh/id_rsa.pub</code>查看公钥内容并将文件内容复制到远程仓库的 SSH 密钥中。</p><h3 id="4-2-添加远程仓库"><a href="#4-2-添加远程仓库" class="headerlink" title="4.2 添加远程仓库"></a>4.2 添加远程仓库</h3><p>此操作是先初始化本地库，然后与已创建的远程库进行对接。</p><p>命令： <code>git remote add &lt;远端名称&gt; &lt;仓库路径&gt;</code></p><p>远端名称，默认是 origin，取决于远端服务器设置。仓库路径，从远端服务器获取此 URL</p><p>例如:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin git@github.com:kongshuilinhua/kongshuilinhua.github.io.git<br></code></pre></td></tr></table></figure><h4 id="4-3-查看远程仓库"><a href="#4-3-查看远程仓库" class="headerlink" title="4.3 查看远程仓库"></a>4.3 查看远程仓库</h4><p>命令：<code>git remote</code></p><h4 id="4-4-推送到远程仓库"><a href="#4-4-推送到远程仓库" class="headerlink" title="4.4 推送到远程仓库"></a>4.4 推送到远程仓库</h4><p><code>git push [options] [远程仓库] [本地分支]:[远程分支]</code><br>如果远程分支名和本地分支名称相同，则可以只写本地分支。<br><code>git push</code> 命令的可选参数包括：</p><ul><li><code>-u</code> 或 <code>--set-upstream</code>：设置上游分支</li><li><code>--force</code> 或 <code>-f</code>：强制推送，即使会覆盖远程分支。</li><li><code>--all</code>：推送所有本地分支。</li><li><code>--tags</code>：推送所有本地标签。</li><li><code>--dry-run</code>：模拟推送，不执行实际操作。</li><li><code>--delete</code>：删除远程分支。</li><li><code>--mirror</code>：推送所有引用（包括标签和远程分支）。</li><li><code>--atomic</code>：确保所有分支一起推送成功，否则全部失败。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin master<br>git push --set-upstream origin master<br></code></pre></td></tr></table></figure><ul><li><code>-f</code>表示强制覆盖</li><li><code>--set-upstream</code>表示推送到远端的同时并且建立起和远端分支的关联关系。<br>如果当前分支已经和远端分支关联，则可以省略分支名和远端名。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push  <span class="hljs-comment"># 将master分支推送到已关联的远端分支</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>285水果店果篮最小成本问题</title>
    <link href="/2024/12/26/285%E6%B0%B4%E6%9E%9C%E5%BA%97%E6%9E%9C%E7%AF%AE%E6%9C%80%E5%B0%8F%E6%88%90%E6%9C%AC%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/26/285%E6%B0%B4%E6%9E%9C%E5%BA%97%E6%9E%9C%E7%AF%AE%E6%9C%80%E5%B0%8F%E6%88%90%E6%9C%AC%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题概述"><a href="#问题概述" class="headerlink" title="问题概述"></a>问题概述</h3><p>小 C 需要将 <code>n</code> 个编号为 1 到 <code>n</code> 的水果打包成若干个果篮。每个果篮最多可以容纳 <code>m</code> 个水果，且果篮中的水果编号必须连续。每个果篮的成本由以下公式决定：</p><p>[ \text{成本} &#x3D; k \times \left\lfloor \frac{u + v}{2} \right\rfloor + s ]</p><p>其中：</p><ul><li><code>k</code> 是果篮中水果的数量。</li><li><code>u</code> 是果篮中水果的最大体积。</li><li><code>v</code> 是果篮中水果的最小体积。</li><li><code>s</code> 是一个常数。</li><li>(\left\lfloor x \right\rfloor) 表示对 <code>x</code> 进行下取整。</li></ul><p>目标是找到一种打包方式，使得总成本最小。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>本题可以使用<strong>动态规划</strong>的方法来解决。设 <code>f[i]</code> 表示前 <code>i</code> 个水果的最小总成本。状态转移方程的核心思想是考虑最后一个果篮包含的水果数量，并选择使总成本最小的分割方式。</p><h3 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h3><ol><li><p><strong>初始化：</strong></p><ul><li>定义一个数组 <code>f</code>，长度为 <code>n + 1</code>，初始化所有元素为正无穷大，表示初始状态下成本无限大。</li><li>设置 <code>f[0] = 0</code>，表示不放入任何水果时的成本为 0。</li></ul></li><li><p><strong>动态规划转移：</strong></p><ul><li>遍历每一个水果位置 <code>i</code>（从 1 到 <code>n</code>），尝试将第 <code>i</code> 个水果作为当前果篮的结尾。</li><li>对于每个位置 <code>i</code>，向前遍历最多 <code>m</code> 个水果（因为每个果篮最多容纳 <code>m</code> 个水果），计算当前果篮的成本，并更新 <code>f[i]</code>。</li><li>在遍历过程中，维护当前果篮中水果的最小值 <code>mi</code> 和最大值 <code>mx</code>，以及当前果篮中水果的数量 <code>cnt</code>。</li><li>计算当前果篮的成本，并与之前的最小成本进行比较，取较小值作为 <code>f[i]</code> 的值。</li><li>如果当前果篮中的水果数量达到 <code>m</code>，则停止遍历，避免超过果篮的最大容量。</li></ul></li><li><p><strong>结果输出：</strong></p><ul><li>最终，<code>f[n]</code> 即为将所有 <code>n</code> 个水果打包的最小总成本。</li></ul></li></ol><h3 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python">inf = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, m: <span class="hljs-built_in">int</span>, s: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-comment"># f[i] 表示放入i个水果的最小价值</span><br>    f = [inf] * (n + <span class="hljs-number">1</span>)<br>    f[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span><br>    a = [<span class="hljs-number">0</span>] + a  <span class="hljs-comment"># 使水果编号从1开始</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        cnt = <span class="hljs-number">0</span><br>        mi = inf<br>        mx = -inf<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>            mi = <span class="hljs-built_in">min</span>(mi, a[j])<br>            mx = <span class="hljs-built_in">max</span>(mx, a[j])<br>            cnt += <span class="hljs-number">1</span><br>            <span class="hljs-comment"># 计算当前分组的成本</span><br>            current_cost = f[j - <span class="hljs-number">1</span>] + s + ((mx + mi) // <span class="hljs-number">2</span>) * cnt<br>            <span class="hljs-comment"># 更新f[i]为当前最小成本</span><br>            f[i] = <span class="hljs-built_in">min</span>(f[i], current_cost)<br>            <span class="hljs-keyword">if</span> cnt &gt;= m:<br>                <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 超过最大容量，停止遍历</span><br>    <span class="hljs-keyword">return</span> f[n]<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度：</strong> O(n * m)，其中 <code>n</code> 是水果的数量，<code>m</code> 是果篮的最大容量。对于每个水果位置，需要遍历最多 <code>m</code> 个位置。</li><li><strong>空间复杂度：</strong> O(n)，用于存储动态规划数组 <code>f</code>。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>动态规划</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>225小S的黑白块迷宫</title>
    <link href="/2024/12/26/225%E5%B0%8FS%E7%9A%84%E9%BB%91%E7%99%BD%E5%9D%97%E8%BF%B7%E5%AE%AB/"/>
    <url>/2024/12/26/225%E5%B0%8FS%E7%9A%84%E9%BB%91%E7%99%BD%E5%9D%97%E8%BF%B7%E5%AE%AB/</url>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在一个 n×m 的网格迷宫中，初始位置在左上角 (1,1)，目标是到达右下角 (n,m)。每个格子可以是黑色（表示为 1）或者白色（表示为 0）。移动时可以向上、下、左、右四个方向移动，但不能走出迷宫的边界。要求在移动过程中经过的黑色格子尽可能少。</p><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>本题可以使用广度优先搜索（BFS）算法来解决。由于需要最小化经过的黑色格子数量，可以将其视为带权图的最短路径问题，其中白色格子的权重为 0，黑色格子的权重为 1。</p><p><strong>BFS 遍历</strong>：</p><ul><li>从队列中取出当前格子 <code>(x, y, d)</code>。</li><li>如果当前的黑色格子数 d 大于已记录的最小值，跳过此格子。</li><li>遍历四个可能的移动方向，计算新位置 <code>(nx, ny)</code>。</li><li>如果新位置在迷宫范围内，并且通过当前路径到达新位置的黑色格子数更少，则更新 dis[nx][ny]并将新位置加入队列。</li></ul><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br>dx, dy = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, m: <span class="hljs-built_in">int</span>, grid: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    q = deque([(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)])<br>    dis = [[n * m] * m <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>    dis[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = grid[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">while</span> q:<br>        x, y, d = q.popleft()<br>        <span class="hljs-keyword">if</span> d &gt; dis[x][y]:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            nx, ny = x + dx[i], y + dy[i]<br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= nx &lt; n <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= ny &lt; m:<br>                <span class="hljs-keyword">if</span> dis[nx][ny] &gt; dis[x][y] + grid[nx][ny]:<br>                    dis[nx][ny] = dis[x][y] + grid[nx][ny]<br>                    q.append((nx, ny, dis[nx][ny]))<br>    <span class="hljs-keyword">return</span> dis[-<span class="hljs-number">1</span>][-<span class="hljs-number">1</span>]<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, [[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>, [[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]]) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, [[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]]) == <span class="hljs-number">0</span>)<br><br></code></pre></td></tr></table></figure><h2 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h2><p>该算法的时间复杂度为 O(nm)，其中 n 和 m 分别是网格的行数和列数。每个格子最多被访问一次。</p><h2 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h2><p>空间复杂度为 O(nm)，用于存储 dis 数组和队列中的元素。</p>]]></content>
    
    
    
    <tags>
      
      <tag>BFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>284模板串匹配问题</title>
    <link href="/2024/12/26/284%E6%A8%A1%E6%9D%BF%E4%B8%B2%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/"/>
    <url>/2024/12/26/284%E6%A8%A1%E6%9D%BF%E4%B8%B2%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>本题要求在给定的“模板串”中，替换所有的 <code>&#39;?&#39;</code> 以构造出多个不含前导零的正整数，并找出按字典序排列后的第 <code>k</code> 小的数。如果不存在满足条件的第 <code>k</code> 小数，返回 <code>-1</code>。</p><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><ol><li><p><strong>前导零检查</strong>：</p><ul><li>首先检查模板串的首字符是否为 <code>&#39;0&#39;</code>，如果是<code>&#39;0&#39;</code>，则直接返回 <code>-1</code>，</li></ul></li><li><p><strong>从后向前替换 <code>&#39;?&#39;</code></strong>：</p><ul><li>假如不考律前导 0 的情况，<code>???</code> 每个<code>?</code>都有十种可选的数字，可以替换为 <code>000</code> 到 <code>999</code>，共 <code>1000</code> 种可能。第 <code>k</code> 小的数，即为第 <code>k - 1</code> 个数。并且每个位置的”<code>?</code>“填入的正应该是<code>k - 1</code>的十进制的每一位数字</li><li>对于从后往前的每一个 <code>&#39;?&#39;</code>，用 <code>k % 10</code> 来替换该位置的字符，并将 <code>k</code> 整除以 <code>10</code>，以便为下一个 <code>&#39;?&#39;</code> 的替换提供新的数字。</li></ul></li><li><p><strong>处理首位 <code>&#39;?&#39;</code></strong>：</p><ul><li>如果首位是 <code>&#39;?&#39;</code>，则需要特别处理：<ul><li>替换为 <code>k + 1</code>，确保首位不是 <code>&#39;0&#39;</code>。</li><li>检查 <code>k + 1</code> 是否小于 <code>10</code>，否则无法替换为单个数字，返回 <code>-1</code>。</li></ul></li></ul></li></ol><h4 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    s = <span class="hljs-built_in">list</span>(s)<br>    <span class="hljs-keyword">if</span> s[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;0&quot;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;-1&quot;</span><br>    k -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s) - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> s[i] == <span class="hljs-string">&quot;?&quot;</span>:<br>            s[i] = <span class="hljs-built_in">str</span>(k % <span class="hljs-number">10</span>)<br>            k //= <span class="hljs-number">10</span><br>    <span class="hljs-comment"># 处理首位是 &#x27;?&#x27; 的情况</span><br>    <span class="hljs-keyword">if</span> s[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;?&quot;</span> <span class="hljs-keyword">and</span> k + <span class="hljs-number">1</span> &lt; <span class="hljs-number">10</span>:<br>        s[<span class="hljs-number">0</span>] = <span class="hljs-built_in">str</span>(k + <span class="hljs-number">1</span>)<br>        k = <span class="hljs-number">0</span><br>    <span class="hljs-comment"># 如果 k 不等于 0，说明没有找到第 k 小的数</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(s) <span class="hljs-keyword">if</span> k == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;-1&quot;</span><br></code></pre></td></tr></table></figure><h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><ul><li><strong>时间复杂度</strong>：<code>O(n)</code>，其中 <code>n</code> 是模板串的长度。需要遍历字符串一次进行替换。</li><li><strong>空间复杂度</strong>：<code>O(n)</code>，用于存储字符串的列表形式。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>模拟</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>217小R的雪球滚落计算</title>
    <link href="/2024/12/25/217%E5%B0%8FR%E7%9A%84%E9%9B%AA%E7%90%83%E6%BB%9A%E8%90%BD%E8%AE%A1%E7%AE%97/"/>
    <url>/2024/12/25/217%E5%B0%8FR%E7%9A%84%E9%9B%AA%E7%90%83%E6%BB%9A%E8%90%BD%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在一座高度为 $H$ 的山上，每个高度 $i$ 处生成了 $a_i$ 个雪球。当雪球从海拔高度 $i$ 滚到地面时，它的体积会膨胀 $x^i$ 倍。也就是说，雪球的初始体积为 $1$，滚动距离 $i$ 会使体积变成 $1 \times x^i$。我们需要计算所有滚落到地面的雪球的总体积，并对结果取模 $10^9 + 7$。</p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol><li><p><strong>理解雪球体积膨胀规则</strong>：</p><ul><li>每个雪球从高度 $i$ 滚落到地面时，其体积变为 $x^i$。</li><li>同一高度 $i$ 处有 $a_i$ 个雪球，因此该高度的雪球总体积为 $a_i \times x^i$。</li></ul></li><li><p><strong>计算总体积</strong>：</p><ul><li>对所有高度 $i$，计算 $a_i \times x^i$ 的总和。</li><li>由于体积可能会非常大，需要在计算过程中对每一项取模 $10^9 + 7$，最终结果也取模。</li></ul></li><li><p><strong>优化幂运算</strong>：</p><ul><li>使用 Python 内置的 <code>pow</code> 函数，利用其三个参数形式 <code>pow(x, i + 1, mod)</code>，高效计算 $x^{i+1} \mod (10^9 + 7)$。</li></ul></li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">H: <span class="hljs-built_in">int</span>, x: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">pow</span>(x, i + <span class="hljs-number">1</span>, mod) * a[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a))) % mod<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>]) == <span class="hljs-number">2830</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">55</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]) == <span class="hljs-number">42</span>)<br></code></pre></td></tr></table></figure><h2 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h2><ul><li><strong>时间复杂度</strong>：$O(nlog(n))$，其中 $n$ 是数组 $a$ 的长度。每个雪球体积的计算需要 $O(log(n))$ 的时间复杂度。</li><li><strong>空间复杂度</strong>：$O(1)$，只使用了常数空间存储结果。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>快速幂</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>213小R的排列挑战</title>
    <link href="/2024/12/25/213%E5%B0%8FR%E7%9A%84%E6%8E%92%E5%88%97%E6%8C%91%E6%88%98/"/>
    <url>/2024/12/25/213%E5%B0%8FR%E7%9A%84%E6%8E%92%E5%88%97%E6%8C%91%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><p>小 R 有一个长度为 n 的排列，排列中的数字是 1 到 n 的整数。她每次操作可以选择两个数<code>a_i</code>和<code>a_j</code>进行交换，前提是这两个数的下标 i 和 j 的奇偶性相同（即同为奇数或同为偶数）。目标是通过最少的操作使数组变成升序排列，如果无法实现则输出-1。</p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol><li><p><strong>下标分组</strong>：将数组根据下标的奇偶性分为两部分：</p><ul><li>奇数下标元素（0-based，即索引为 0,2,4,…）</li><li>偶数下标元素（索引为 1,3,5,…）</li></ul></li><li><p><strong>排序验证</strong>：</p><ul><li>奇数下标的元素在最终的升序排列中应该是奇数序列，即<code>1,3,5,...</code>。</li><li>如果奇数下标的排序结果不符合预期，则无法通过交换操作将数组排序，返回-1。</li></ul></li><li><p><strong>逆序数计算</strong>：</p><ul><li>分别计算奇数下标和偶数下标部分的逆序数。</li><li>逆序数代表需要多少次交换才能使该部分有序。</li><li>总交换次数为奇数下标和偶数下标部分的逆序数之和。</li></ul></li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br><span class="hljs-comment"># from bisect import bisect_right</span><br><span class="hljs-comment"># class BIT:</span><br><span class="hljs-comment">#     def __init__(self, n):</span><br><span class="hljs-comment">#         self.tree = [0] * n  # 注意下标从1开始</span><br><br><span class="hljs-comment">#     def lowbit(self, x):</span><br><span class="hljs-comment">#         return x &amp; (-x)</span><br><br><span class="hljs-comment">#     # arr[i] += val</span><br><span class="hljs-comment">#     def update(self, i, val):</span><br><span class="hljs-comment">#         while i &lt; len(self.tree):</span><br><span class="hljs-comment">#             self.tree[i] += val</span><br><span class="hljs-comment">#             i += self.lowbit(i)</span><br><br><span class="hljs-comment">#     # 返回arr[:i+1]的sum</span><br><span class="hljs-comment">#     def query(self, i):</span><br><span class="hljs-comment">#         res = 0</span><br><span class="hljs-comment">#         while i &gt; 0:</span><br><span class="hljs-comment">#             res += self.tree[i]</span><br><span class="hljs-comment">#             i -= self.lowbit(i)</span><br><span class="hljs-comment">#         return res</span><br><span class="hljs-comment"># 树状数组求解逆序对，时间复杂度为nlogn</span><br><span class="hljs-comment"># def inv(a):</span><br><span class="hljs-comment">#     n = len(a)</span><br><span class="hljs-comment">#     res = 0</span><br><span class="hljs-comment">#     tree = BIT(n + 1)</span><br><span class="hljs-comment">#     b = sorted(a)</span><br><span class="hljs-comment">#     for x in a:</span><br><span class="hljs-comment">#         i = bisect_right(b, x)</span><br><span class="hljs-comment">#         res += tree.query(n) - tree.query(i)</span><br><span class="hljs-comment">#         tree.update(i, 1)</span><br><span class="hljs-comment">#     return res</span><br><br><span class="hljs-comment"># 暴力求解逆序对，时间复杂度为n²</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inv</span>(<span class="hljs-params">a</span>):<br>    n = <span class="hljs-built_in">len</span>(a)<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, n):<br>            <span class="hljs-keyword">if</span> a[i] &gt; a[j]:<br>                res += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    odd, even = [], []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>            odd.append(a[i])<br>        <span class="hljs-keyword">else</span>:<br>            even.append(a[i])<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">sorted</span>(odd) != <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)):<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> inv(odd) + inv(even)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]) == -<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">6</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]) == -<span class="hljs-number">1</span>)<br><br><br></code></pre></td></tr></table></figure><h2 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h2><ul><li><strong>时间复杂度</strong>：O(n²)，主要由逆序数的双重循环计算决定。(可以用树状数组求解逆序对，时间复杂度为 O(nlogn))</li><li><strong>空间复杂度</strong>：O(n)，用于存储奇数和偶数下标的元素。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>逆序对</tag>
      
      <tag>树状数组</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>214小R的权值计算</title>
    <link href="/2024/12/25/214%E5%B0%8FR%E7%9A%84%E6%9D%83%E5%80%BC%E8%AE%A1%E7%AE%97/"/>
    <url>/2024/12/25/214%E5%B0%8FR%E7%9A%84%E6%9D%83%E5%80%BC%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="问题理解"><a href="#问题理解" class="headerlink" title="问题理解"></a>问题理解</h3><p>给定一个长度为 <code>n</code> 的数组 <code>a</code>，小 R 定义任意子数组的权值为 <code>1×b₁ + 2×b₂ + ... + m×bₘ</code>，其中 <code>m</code> 是子数组的长度，<code>b₁, b₂, ..., bₘ</code> 是子数组中的元素。要求计算所有子数组权值的和，结果需对 <code>10^9 + 7</code> 取模。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><blockquote><p>b1 b2 b3 b4 b5<br>b1+2b2 b2+2b3 b3+2b4 b4+2b5<br>b1+2b2+3b3 b2+2b3+3b4 b3+2b4+3b5<br>b1+2b2+3b3+4b4 b2+2b3+3b4+4b5<br>b1+2b2+3b3+4b4+5b5<br>根据规律可以看出长度为 length 的子数组转移的时候，只需要加上 length*a[i] - (s[i-1] - s[i-length-1])即可</p></blockquote><ol><li><p><strong>前缀和计算</strong>：<br>使用前缀和 <code>s</code> 来快速计算任意子数组的元素和，<code>s[i]</code> 表示前 <code>i</code> 个元素的和。</p></li><li><p><strong>权值计算</strong>：<br>对于每个子数组长度 <code>length</code>，遍历所有可能的子数组，计算当前子数组的权值 <code>cur</code>。</p><ul><li>初始时，计算第一个长度为 <code>length</code> 的子数组的权值。</li><li>随着窗口的滑动，通过更新 <code>cur</code> 来计算下一个子数组的权值：<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">cur += length * a<span class="hljs-comment">[i]</span> - (s<span class="hljs-comment">[i - 1]</span> - s<span class="hljs-comment">[i - length - 1]</span>)<br></code></pre></td></tr></table></figure>这里，<code>length * a[i]</code> 是新加入元素对权值的贡献，<code>(s[i - 1] - s[i - length - 1])</code> 是窗口内之前元素权值的调整。</li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> accumulate<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    res = <span class="hljs-number">0</span><br>    a = [<span class="hljs-number">0</span>] + a<br>    s = <span class="hljs-built_in">list</span>(accumulate(a))<br>    <span class="hljs-comment"># 枚举子数组的长度</span><br>    <span class="hljs-keyword">for</span> length <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        cur = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length + <span class="hljs-number">1</span>):<br>            cur += a[i] * i<br>        res = (res + cur) % mod<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length + <span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>            cur += length * a[i] - (s[i - <span class="hljs-number">1</span>] - s[i - length - <span class="hljs-number">1</span>])<br>            res = (res + cur) % mod<br>    <span class="hljs-keyword">return</span> res % mod<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]) == <span class="hljs-number">33</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]) == <span class="hljs-number">203</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>]) == <span class="hljs-number">80</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>枚举</tag>
      
      <tag>前缀和</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>211小R的并集大小期望计算</title>
    <link href="/2024/12/24/211%E5%B0%8FR%E7%9A%84%E5%B9%B6%E9%9B%86%E5%A4%A7%E5%B0%8F%E6%9C%9F%E6%9C%9B%E8%AE%A1%E7%AE%97/"/>
    <url>/2024/12/24/211%E5%B0%8FR%E7%9A%84%E5%B9%B6%E9%9B%86%E5%A4%A7%E5%B0%8F%E6%9C%9F%E6%9C%9B%E8%AE%A1%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>小 R 有<code>n</code>个集合，每个集合中的元素都是唯一的且互不相同。她希望通过随机选择两个集合，并计算它们的并集大小，来求出并集大小的期望值。结果需要保留两位小数。题目保证输入至少有两个集合。</p><h4 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h4><p>要计算随机选择两个集合的并集大小的期望值，关键在于确定每个元素在这两个集合的并集中出现的概率。具体步骤如下：</p><ol><li><p><strong>元素出现次数统计</strong>：</p><ul><li>首先统计每个元素在所有集合中出现的次数。即，元素<code>x</code>出现于<code>v</code>个不同的集合中。</li></ul></li><li><p><strong>计算每个元素在并集中出现的概率</strong>：</p><ul><li><p>对于一个元素<code>x</code>，它至少出现在所选的两个集合中的一个的概率，可以通过以下公式计算：<br>$$<br>P(x \text{ 出现在并集中}) &#x3D; 1 - P(x \text{ 不出现在两个集合中})<br>$$</p></li><li><p><code>x</code>不出现在两个集合中的概率为：</p><p>$$<br>P(x \text{ 不出现在两个集合中}) &#x3D; \frac{\binom{n - v}{2}}{\binom{n}{2}}<br>$$</p><p>其中，(\binom{n}{2}) 表示从<code>n</code>个集合中选取两个集合的组合数。</p></li><li><p>因此，<code>x</code>出现在并集中的概率为：<br>$$<br>P(x \text{ 出现在并集中}) &#x3D; 1 - \frac{(n - v) \times (n - v - 1)}{n \times (n - 1)}<br>$$</p></li></ul></li><li><p><strong>计算期望值</strong>：</p><ul><li>期望值为所有元素在并集中出现概率的总和，即：<br>$$<br>\text{期望值} &#x3D; \sum_{x} P(x \text{ 出现在并集中})<br>$$</li></ul></li><li><p><strong>结果格式化</strong>：</p><ul><li>最终的期望值需要保留两位小数。</li></ul></li></ol><h4 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, st: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-comment"># 统计所有元素在所有集合中出现的次数</span><br>    cnt = Counter([i <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> st <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s])<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> cnt.items():<br>        <span class="hljs-comment"># 对于每个元素，计算其出现在并集中的概率，并累加到结果中</span><br>        res += n * (n - <span class="hljs-number">1</span>) - (n - v) * (n - v - <span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># 计算期望值并格式化为两位小数</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&#123;:.2f&#125;&quot;</span>.<span class="hljs-built_in">format</span>(res / (n * (n - <span class="hljs-number">1</span>)))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]]) == <span class="hljs-string">&#x27;4.00&#x27;</span>)      <span class="hljs-comment"># 输出: True</span><br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]]) == <span class="hljs-string">&#x27;4.67&#x27;</span>)  <span class="hljs-comment"># 输出: True</span><br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, [[<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">30</span>, <span class="hljs-number">50</span>, <span class="hljs-number">70</span>]]) == <span class="hljs-string">&#x27;5.00&#x27;</span>)  <span class="hljs-comment"># 输出: True</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>数学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>209 小R的子数组权值</title>
    <link href="/2024/12/24/209%E5%B0%8FR%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84%E6%9D%83%E5%80%BC/"/>
    <url>/2024/12/24/209%E5%B0%8FR%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84%E6%9D%83%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>小 R 有一个长度为 <code>n</code> 的数组 <code>a</code>，她定义每个子区间 <code>[l, r]</code> 的权值为 <code>a[l] | a[l+1] | ... | a[r]</code>，即该区间内所有元素的按位或运算结果。小 R 非常好奇，在这 <code>n × (n + 1) / 2</code> 个子区间中，究竟有多少种不同的权值。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>对于两个二进制数 <code>a</code> 和 <code>b</code>，如果满足 <code>a &amp; b = a</code>，从集合的角度来看，<code>a</code> 对应的集合是 <code>b</code> 对应集合的子集。</p><ol><li><p><strong>遍历数组</strong>：仍然从左到右遍历数组 <code>a</code>，对于当前元素 <code>x = a[i]</code>。</p></li><li><p><strong>反向遍历更新</strong>：从索引 <code>i-1</code> 开始，向前遍历 <code>a[j]</code>：</p><ul><li><p><strong>检查子集关系</strong>：</p><ul><li><p>如果 <code>a[j] &amp; x != a[j]</code>，说明 <code>a[j]</code> 可以通过与 <code>x</code> 进行按位与运算而变小（即集合元素减少）。此时，更新 <code>a[j] = a[j] &amp; x</code>，并将更新后的值加入结果集合 <code>res</code> 中。</p></li><li><p>如果 <code>a[j] &amp; x == a[j]</code>，则 <code>x</code> 是 <code>a[j]</code> 的超集。同时，由于之前的遍历已经保证了每个集合都是其左侧相邻集合的超集，<code>x</code> 也必然是所有左侧集合的超集。在这种情况下，进一步的遍历将不会导致任何集合的变化，因此可以直接退出内层循环，提高算法效率。</p></li></ul></li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">a</span>):<br>    res = <span class="hljs-built_in">set</span>()<br>    <span class="hljs-keyword">for</span> i, x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(a):<br>        res.add(x)<br>        j = i - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> j &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> a[j] | x != a[j]:<br>            a[j] |= x<br>            res.add(a[j])<br>            j -= <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(res)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>]) == <span class="hljs-number">6</span>)<br>    <span class="hljs-built_in">print</span>(solution([<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>]) == <span class="hljs-number">8</span>)<br>    <span class="hljs-built_in">print</span>(solution([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution([<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>]) == <span class="hljs-number">6</span>)<br></code></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><strong>时间复杂度</strong>：<code>O(nlog(U))</code>，其中 <code>n</code> 是数组的长度。<code>U</code>是数组中的最大值</li><li><strong>空间复杂度</strong>：<code>O(n)</code>，用于存储不同的权值。</li></ul><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ul><li><a href="https://leetcode.cn/problems/number-of-subarrays-with-and-value-of-k/">LeetCode - Number of Subarrays With AND Value of K</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>logTrick</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>203小Q和小X的游戏</title>
    <link href="/2024/12/23/203%E5%B0%8FQ%E5%92%8C%E5%B0%8FX%E7%9A%84%E6%B8%B8%E6%88%8F/"/>
    <url>/2024/12/23/203%E5%B0%8FQ%E5%92%8C%E5%B0%8FX%E7%9A%84%E6%B8%B8%E6%88%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="203-小-Q-和小-X-的游戏"><a href="#203-小-Q-和小-X-的游戏" class="headerlink" title="203 小 Q 和小 X 的游戏"></a>203 小 Q 和小 X 的游戏</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>小 Q 和小 X 是很好的朋友，她们正在玩一个游戏。她们拿到了一个数组，游戏开始时小 Q 随机选择一个元素作为起点。接着，两人轮流行动，小 Q 先行动。</p><p>每次行动时，当前玩家需要选择当前元素左边比它更小的元素，然后移动到该元素，接下来换另一方从这个元素继续移动。如果某一方无法进行合法的移动，则该方输掉游戏。</p><p>小 Q 想知道，在双方都采取最优策略的情况下，她最终获胜的概率是多少？请输出分数的最简形式，即分子和分母互素。如果小 Q 必胜，则输出 <code>1/1</code>。如果小 Q 必败，则输出 <code>0/1</code>。</p><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>因为起点是随机的，那么一共有 $n$ 种可能的起点。对于每个起点，我们可以通过模拟游戏的过程来判断小 Q 是否能获胜。</p><p>因为双方都采取最优策略，如果当前位置左边没有比它更小的元素，那么当前玩家必败。否则先手的小 Q 可以直接移动到左边的最小元素获得胜利。因此，我们可以通过统计当前位置左边是否存在比它更小的元素来判断小 Q 是否能获胜。</p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>以下是基于上述思路的 Python 代码实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> gcd<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    mi = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br>    cnt = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">if</span> a[i] &gt; mi:<br>            cnt += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            mi = a[i]<br>    <span class="hljs-comment"># 计算最大公约数，化简分数</span><br>    g = gcd(cnt, n)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;cnt//g&#125;</span>/<span class="hljs-subst">&#123;n//g&#125;</span>&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]) == <span class="hljs-string">&#x27;3/5&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">6</span>, [<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]) == <span class="hljs-string">&#x27;2/3&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">8</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>]) == <span class="hljs-string">&#x27;1/4&#x27;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>思维</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>193小K的区间与值和</title>
    <link href="/2024/12/23/193%E5%B0%8FK%E7%9A%84%E5%8C%BA%E9%97%B4%E4%B8%8E%E5%80%BC%E5%92%8C/"/>
    <url>/2024/12/23/193%E5%B0%8FK%E7%9A%84%E5%8C%BA%E9%97%B4%E4%B8%8E%E5%80%BC%E5%92%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="193-小-K-的区间与值和"><a href="#193-小-K-的区间与值和" class="headerlink" title="193 小 K 的区间与值和"></a>193 小 K 的区间与值和</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>小 K 有一个长度为 <code>n</code> 的数组 <code>a</code>，她定义数组的权值为数组中任意两个数按位与（bitwise AND）的值之和。具体来说，对于数组中的每个连续子数组，我们可以计算所有可能的两个元素的按位与值之和，并将这些值相加。小 K 想知道该数组中所有可能的连续子数组的权值和是多少，最后结果对 $10^9 + 7$ 取模。</p><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>为了高效地计算所有连续子数组的权值和，我们需要找到一种方法避免枚举所有可能的子数组和其中的元素对。这可以通过逐位考虑每一位的贡献来实现。</p><p>具体步骤如下：</p><ol><li><p><strong>逐位处理</strong>：对于每一位 <code>i</code>（从第 0 位到第 31 位），计算该位在所有连续子数组中的贡献总和。</p></li><li><p><strong>统计位为 1 的情况</strong>：在数组中，如果某个元素的第 <code>i</code> 位为 1，那么它可以与之前位为 1 的元素形成按位与为 <code>1 &lt;&lt; i</code> 的对。</p></li><li><p><strong>计算子数组数量</strong>：对于 <code>nums[j]</code> 的每一位，考虑每个 <code>pair(i, j)</code> 满足 <code>nums[i] &amp; nums[j] = 1</code>，包含 <code>nums[i:j]</code> 的连续子数组左端点选择范围为 <code>[0 - i]</code>，右端点 <code>[j, n - 1]</code>，一共 <code>(i + 1) * (n - j)</code> 个。对于当前位置 <code>j</code>，我们可以统计出满足条件的 <code>i</code> 的个数累加起来，那么对于当前位置 <code>j</code>，满足条件的子数组个数为 <code>cnt * (n - j)</code>。</p></li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, a: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        cnt = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> a[j] &gt;&gt; i &amp; <span class="hljs-number">1</span>:      <span class="hljs-comment"># 当前位是1</span><br>                res += cnt * (n - j) * (<span class="hljs-number">1</span> &lt;&lt; i)<br>                res %= mod<br>                cnt += j + <span class="hljs-number">1</span>  <span class="hljs-comment"># 统计满足条件的i的个数</span><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">16</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]) == <span class="hljs-number">25</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">10</span>]) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">16</span>]) == <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Python 算法常用库函数</title>
    <link href="/2024/12/23/1/"/>
    <url>/2024/12/23/1/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍一些常用的 py 库函数</p></blockquote><h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><ol><li><p><code>abs(x)</code><br>返回一个数字的绝对值。参数可以是整数、浮点数、复数等。如果参数是一个复数，则返回它的模。</p></li><li><p><code>all(iterable)</code><br>如果 iterable 的所有元素均为真值（或可迭代对象为空）则返回 True 。<br>示例代码:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nums</span> =<span class="hljs-meta"> [1, 2, 3, 4, 5]</span><br><span class="hljs-comment"># 检查是否所有元素都是偶数</span><br><span class="hljs-attribute">print</span>(<span class="hljs-literal">all</span>(x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> for x in nums))  # False<br></code></pre></td></tr></table></figure></li><li><p><code>any(iterable)</code></p><p>如果 iterable 的任一元素为真值则返回 True。 如果可迭代对象为空，返回 False。<br>例：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nums</span> =<span class="hljs-meta"> [1, 2, 3, 4, 5]</span><br><span class="hljs-comment"># 检查列表中是否包含偶数</span><br><span class="hljs-attribute">print</span>(any(x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> for x in nums))  # True<br></code></pre></td></tr></table></figure></li><li><p><code>bin(x)</code><br>将一个整数转换为带前缀 “0b” 的二进制数字符串。<br>例:</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">print</span>(bin(<span class="hljs-number">5</span>)) # <span class="hljs-number">0b101</span><br><span class="hljs-built_in">print</span>(bin(-<span class="hljs-number">6</span>)) # -<span class="hljs-number">0b110</span><br></code></pre></td></tr></table></figure></li><li><p><code>chr(i)</code> 和 <code>ord(c)</code><br>这两个函数互为逆函数。<br><code>chr(i)</code>返回 Unicode 码位为整数<code>i</code> 的字符的字符串格式。<br><code>ord(c)</code>对表示单个 Unicode 字符的字符串，返回代表它 Unicode 码点的整数。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">print</span>(<span class="hljs-keyword">chr</span>(<span class="hljs-number">97</span>))  <span class="hljs-comment"># &#x27;a&#x27;</span><br><span class="hljs-keyword">print</span>(<span class="hljs-keyword">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)) <span class="hljs-comment"># 97</span><br></code></pre></td></tr></table></figure></li><li><p><code>divmod(a, b)</code><br>接受两个数字作为参数并返回由当对其使用整数除法时的商和余数组成的数字对。 结果与 (a &#x2F;&#x2F; b, a % b) 相同。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a</span>, b = divmod(<span class="hljs-number">10</span>, <span class="hljs-number">3</span>)  # a = <span class="hljs-number">3</span>, b = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p><code>enumerate(iterable, start=0)</code><br>传入一个可迭代对象返回一个元组，里面包含一个计数值（从 start 开始，默认为 0）和通过迭代 iterable 获得的值。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nums</span> =<span class="hljs-meta"> [100, 200, 300, 400, 500]</span><br><span class="hljs-comment"># [(1, 100), (2, 200), (3, 300), (4, 400), (5, 500)]</span><br><span class="hljs-attribute">print</span>(list(enumerate(nums, <span class="hljs-number">1</span>)))<br></code></pre></td></tr></table></figure></li><li><p><code>eval(expression)</code><br>用来执行一个字符串表达式，并返回表达式的值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">s = <span class="hljs-string">&quot;1 + 2 * 3 + 8 // 4&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">eval</span>(s))  <span class="hljs-comment"># 9</span><br></code></pre></td></tr></table></figure></li><li><p><code>int(x, base=10)</code><br>将一个字符串或数字转换为整数。如果第二个参数 base 给出，则 x 必须是一个字符串，表示进制数（如 2 表示二进制，8 表示八进制，10 表示十进制，16 表示十六进制）。</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">print</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;5&#x27;</span>))  <span class="hljs-meta"># 5</span><br><span class="hljs-keyword">print</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;1010&#x27;</span>, <span class="hljs-number">2</span>))  <span class="hljs-meta"># 10</span><br></code></pre></td></tr></table></figure></li><li><p><code>max(iterable, *[, key, default])</code> 和 <code>min(iterable, *[, key, default])</code><br>大家都知道这两个函数的作用，需要注意的是，如果传入的可迭代对象为空，会抛出 <em>ValueError</em> 异常。可以通过 default 参数设置默认返回值。</p><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs monkey">nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(nums))<span class="hljs-meta">  # 5</span><br>nums2 = []<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(nums2))<span class="hljs-meta">  # ValueError: max() arg is an empty sequence</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(nums2, <span class="hljs-keyword">default</span>=<span class="hljs-number">0</span>))<span class="hljs-meta">  # 0</span><br></code></pre></td></tr></table></figure></li></ol><p>11.<code>pow(base, exp, mod=None)</code><br>返回<em>base</em>的 exp 次幂；如果 mod 存在，则返回结果对 mod 取模。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">print</span>(pow(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))  # <span class="hljs-number">8</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Python 算法 库函数</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python 算法常用库函数</title>
    <link href="/2024/12/23/Python%E5%BA%93%E5%87%BD%E6%95%B0/"/>
    <url>/2024/12/23/Python%E5%BA%93%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍一些常用的 py 库函数</p></blockquote><h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><h3 id="1-1-abs-x"><a href="#1-1-abs-x" class="headerlink" title="1.1 abs(x)"></a>1.1 <code>abs(x)</code></h3><p>返回一个数字的绝对值。参数可以是整数、浮点数、复数等。如果参数是一个复数，则返回它的模。</p><h3 id="1-2-all-iterable"><a href="#1-2-all-iterable" class="headerlink" title="1.2 all(iterable)"></a>1.2 <code>all(iterable)</code></h3><p>如果 iterable 的所有元素均为真值（或可迭代对象为空）则返回 True 。<br>示例代码:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nums</span> =<span class="hljs-meta"> [1, 2, 3, 4, 5]</span><br><span class="hljs-comment"># 检查是否所有元素都是偶数</span><br><span class="hljs-attribute">print</span>(<span class="hljs-literal">all</span>(x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> for x in nums))  # False<br></code></pre></td></tr></table></figure><h3 id="1-3-any-iterable"><a href="#1-3-any-iterable" class="headerlink" title="1.3 any(iterable)"></a>1.3 <code>any(iterable)</code></h3><p>如果 iterable 的任一元素为真值则返回 True。 如果可迭代对象为空，返回 False。<br>例：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nums</span> =<span class="hljs-meta"> [1, 2, 3, 4, 5]</span><br><span class="hljs-comment"># 检查列表中是否包含偶数</span><br><span class="hljs-attribute">print</span>(any(x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> for x in nums))  # True<br></code></pre></td></tr></table></figure><h3 id="1-4-bin-x"><a href="#1-4-bin-x" class="headerlink" title="1.4 bin(x)"></a>1.4 <code>bin(x)</code></h3><p>将一个整数转换为带前缀 “0b” 的二进制数字符串。<br>例:</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">print</span>(bin(<span class="hljs-number">5</span>)) # <span class="hljs-number">0b101</span><br><span class="hljs-built_in">print</span>(bin(-<span class="hljs-number">6</span>)) # -<span class="hljs-number">0b110</span><br></code></pre></td></tr></table></figure><h3 id="1-5-chr-i-和-ord-c"><a href="#1-5-chr-i-和-ord-c" class="headerlink" title="1.5 chr(i) 和 ord(c)"></a>1.5 <code>chr(i)</code> 和 <code>ord(c)</code></h3><p>这两个函数互为逆函数。<br><code>chr(i)</code>返回 Unicode 码位为整数<code>i</code> 的字符的字符串格式。<br><code>ord(c)</code>对表示单个 Unicode 字符的字符串，返回代表它 Unicode 码点的整数。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">print</span>(<span class="hljs-keyword">chr</span>(<span class="hljs-number">97</span>))  <span class="hljs-comment"># &#x27;a&#x27;</span><br><span class="hljs-keyword">print</span>(<span class="hljs-keyword">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)) <span class="hljs-comment"># 97</span><br></code></pre></td></tr></table></figure><h3 id="1-6-divmod-a-b"><a href="#1-6-divmod-a-b" class="headerlink" title="1.6 divmod(a, b)"></a>1.6 <code>divmod(a, b)</code></h3><p>接受两个数字作为参数并返回由当对其使用整数除法时的商和余数组成的数字对。 结果与 (a &#x2F;&#x2F; b, a % b) 相同。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a</span>, b = divmod(<span class="hljs-number">10</span>, <span class="hljs-number">3</span>)  # a = <span class="hljs-number">3</span>, b = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h3 id="1-7-enumerate-iterable-start-0"><a href="#1-7-enumerate-iterable-start-0" class="headerlink" title="1.7 enumerate(iterable, start=0)"></a>1.7 <code>enumerate(iterable, start=0)</code></h3><p>传入一个可迭代对象返回一个元组，里面包含一个计数值（从 start 开始，默认为 0）和通过迭代 iterable 获得的值。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nums</span> =<span class="hljs-meta"> [100, 200, 300, 400, 500]</span><br><span class="hljs-comment"># [(1, 100), (2, 200), (3, 300), (4, 400), (5, 500)]</span><br><span class="hljs-attribute">print</span>(list(enumerate(nums, <span class="hljs-number">1</span>)))<br></code></pre></td></tr></table></figure><h3 id="1-8-eval-expression"><a href="#1-8-eval-expression" class="headerlink" title="1.8 eval(expression)"></a>1.8 <code>eval(expression)</code></h3><p>用来执行一个字符串表达式，并返回表达式的值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">s = <span class="hljs-string">&quot;1 + 2 * 3 + 8 // 4&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">eval</span>(s))  <span class="hljs-comment"># 9</span><br></code></pre></td></tr></table></figure><h3 id="1-9-int-x-base-10"><a href="#1-9-int-x-base-10" class="headerlink" title="1.9 int(x, base=10)"></a>1.9 <code>int(x, base=10)</code></h3><p>将一个字符串或数字转换为整数。如果第二个参数 base 给出，则 x 必须是一个字符串，表示进制数（如 2 表示二进制，8 表示八进制，10 表示十进制，16 表示十六进制）。</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">print</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;5&#x27;</span>))  <span class="hljs-meta"># 5</span><br><span class="hljs-keyword">print</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;1010&#x27;</span>, <span class="hljs-number">2</span>))  <span class="hljs-meta"># 10</span><br></code></pre></td></tr></table></figure><h3 id="1-10-max-iterable-key-default-和-min-iterable-key-default"><a href="#1-10-max-iterable-key-default-和-min-iterable-key-default" class="headerlink" title="1.10 max(iterable, *[, key, default]) 和 min(iterable, *[, key, default])"></a>1.10 <code>max(iterable, *[, key, default])</code> 和 <code>min(iterable, *[, key, default])</code></h3><p>大家都知道这两个函数的作用，需要注意的是，如果传入的可迭代对象为空，会抛出 <em>ValueError</em> 异常。可以通过 default 参数设置默认返回值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(nums))  <span class="hljs-comment"># 5</span><br>nums2 = []<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(nums2))  <span class="hljs-comment"># ValueError: max() arg is an empty sequence</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(nums2, default=<span class="hljs-number">0</span>))  <span class="hljs-comment"># 0</span><br></code></pre></td></tr></table></figure><h3 id="1-11-pow-base-exp-mod-None"><a href="#1-11-pow-base-exp-mod-None" class="headerlink" title="1.11 pow(base, exp, mod=None)"></a>1.11 <code>pow(base, exp, mod=None)</code></h3><p>返回<em>base</em>的 exp 次幂；如果 mod 存在，则返回结果对 mod 取模。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">mod = <span class="hljs-number">10</span>**<span class="hljs-number">9</span> + <span class="hljs-number">7</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 8</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">100</span>, mod))  <span class="hljs-comment"># 703687441</span><br></code></pre></td></tr></table></figure><blockquote><p>在 3.8 版本 pow 函数支持求逆元</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, mod))  <span class="hljs-comment"># 500000004</span><br><span class="hljs-comment"># 等价于</span><br>inv = <span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">pow</span>(x, mod - <span class="hljs-number">2</span>, mod)<br><span class="hljs-built_in">print</span>(inv(<span class="hljs-number">2</span>))  <span class="hljs-comment"># 500000004</span><br></code></pre></td></tr></table></figure><h3 id="1-12-round-number-ndigits"><a href="#1-12-round-number-ndigits" class="headerlink" title="1.12 round(number[, ndigits])"></a>1.12 <code>round(number[, ndigits])</code></h3><p>返回浮点数 number 的四舍五入值，如果给出 ndigits 参数，返回值将根据 ndigits 的值四舍五入到小数点后的位数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">round</span>(<span class="hljs-number">3.1415926</span>))  <span class="hljs-comment"># 3</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">round</span>(<span class="hljs-number">3.1415926</span>, <span class="hljs-number">2</span>))  <span class="hljs-comment"># 3.14</span><br></code></pre></td></tr></table></figure><blockquote><p>注意：round 函数的行为可能会有一些意外，例如 round(2.675, 2) 的结果是 2.67 而不是 2.68。</p></blockquote><h3 id="1-13-sorted-iterable-key-None-reverse-False"><a href="#1-13-sorted-iterable-key-None-reverse-False" class="headerlink" title="1.13 sorted(iterable, *, key=None, reverse=False)"></a>1.13 <code>sorted(iterable, *, key=None, reverse=False)</code></h3><p>返回一个排序后的列表。key 参数用于指定一个函数，用于从每个列表元素中提取用于比较的键。reverse 参数用于指定排序顺序。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">nums = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">sorted</span>(nums))  <span class="hljs-comment"># [1, 1, 2, 3, 3, 4, 5, 5, 5, 6, 9]</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">sorted</span>(nums, reverse=<span class="hljs-literal">True</span>))  <span class="hljs-comment"># [9, 6, 5, 5, 5, 4, 3, 3, 2, 1, 1]</span><br></code></pre></td></tr></table></figure><h3 id="1-14-str-x"><a href="#1-14-str-x" class="headerlink" title="1.14 str(x)"></a>1.14 <code>str(x)</code></h3><p>返回一个字符串对象。如果 x 不是字符串，则返回表示 x 的字符串。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(<span class="hljs-number">123</span>))  <span class="hljs-comment"># &#x27;123&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="1-15-sum-iterable-start-0"><a href="#1-15-sum-iterable-start-0" class="headerlink" title="1.15 sum(iterable, start=0)"></a>1.15 <code>sum(iterable, start=0)</code></h3><p>返回一个迭代器的总和。如果提供 start 参数，则会将 start 添加到总和中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">sum</span>(nums))  <span class="hljs-comment"># 15</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">sum</span>(nums, <span class="hljs-number">10</span>))  <span class="hljs-comment"># 25</span><br></code></pre></td></tr></table></figure><h3 id="1-16-zip-iterables"><a href="#1-16-zip-iterables" class="headerlink" title="1.16 zip(*iterables)"></a>1.16 <code>zip(*iterables)</code></h3><p>在多个迭代器上并行迭代，从每个迭代器返回一个数据项组成元组。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br>letters = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(nums, letters)))  <span class="hljs-comment"># [(1, &#x27;a&#x27;), (2, &#x27;b&#x27;), (3, &#x27;c&#x27;)]</span><br></code></pre></td></tr></table></figure><p>一个很好用的技巧是 zip 可以把矩阵的行变成列，列变成行，类似矩阵转置操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">g = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]]<br><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(*g):<br>  <span class="hljs-built_in">print</span>(row)<br><span class="hljs-comment"># (1, 4, 7)</span><br><span class="hljs-comment"># (2, 5, 8)</span><br><span class="hljs-comment"># (3, 6, 9)</span><br></code></pre></td></tr></table></figure><h2 id="2-collections-容器数据类型"><a href="#2-collections-容器数据类型" class="headerlink" title="2. collections 容器数据类型"></a>2. collections 容器数据类型</h2><h3 id="2-1-deque"><a href="#2-1-deque" class="headerlink" title="2.1 deque"></a>2.1 deque</h3><p>类似列表的容器，经常当作双端队列使用. append 和 pop 在其两端的速度都很快。<br>其中四个常用函数：<br><code>append(x)</code>：在右侧添加一个元素 x。<br><code>appendleft(x)</code>：在左侧添加一个元素 x。<br><code>pop()</code>：移除并返回最右侧的元素.<br><code>popleft()</code>：移除并返回最左侧的元素。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">q = deque([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])<br>q.append(<span class="hljs-number">5</span>)<br><span class="hljs-built_in">print</span>(q)  <span class="hljs-comment"># deque([1, 2, 3, 4])</span><br>q.appendleft(<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(q)  <span class="hljs-comment"># deque([0, 1, 2, 3, 4])</span><br><span class="hljs-built_in">print</span>(q.pop())  <span class="hljs-comment"># 4</span><br><span class="hljs-built_in">print</span>(q)  <span class="hljs-comment"># deque([0, 1, 2, 3])</span><br><span class="hljs-built_in">print</span>(q.popleft()) <span class="hljs-comment"># 0</span><br><span class="hljs-built_in">print</span>(q)  <span class="hljs-comment"># deque([1, 2, 3])</span><br></code></pre></td></tr></table></figure><h3 id="2-2-defaultdict"><a href="#2-2-defaultdict" class="headerlink" title="2.2 defaultdict"></a>2.2 defaultdict</h3><p>字典的子类，通过调用用户指定的工厂函数，为键提供默认值。<br>可以当成带默认值的字典使用。可以通过传入 int、list、set 等函数作为参数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">d = defaultdict(<span class="hljs-built_in">int</span>)<br>d[<span class="hljs-string">&#x27;a&#x27;</span>] = <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(d[<span class="hljs-string">&#x27;a&#x27;</span>])  <span class="hljs-comment"># 1</span><br><span class="hljs-built_in">print</span>(d[<span class="hljs-string">&#x27;b&#x27;</span>])  <span class="hljs-comment"># 0</span><br>d = defaultdict(<span class="hljs-built_in">list</span>)<br>d[<span class="hljs-string">&#x27;a&#x27;</span>].append(<span class="hljs-number">1</span>)<br>d[<span class="hljs-string">&#x27;a&#x27;</span>].append(<span class="hljs-number">2</span>)<br>d[<span class="hljs-string">&#x27;b&#x27;</span>].append(<span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>(d)  <span class="hljs-comment"># defaultdict(&lt;class &#x27;list&#x27;&gt;, &#123;&#x27;a&#x27;: [1, 2], &#x27;b&#x27;: [3]&#125;)</span><br><span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> d.items():<br>  <span class="hljs-built_in">print</span>(key, value)<br><span class="hljs-comment"># a [1, 2]</span><br><span class="hljs-comment"># b [3]</span><br></code></pre></td></tr></table></figure><h3 id="2-3-Counter"><a href="#2-3-Counter" class="headerlink" title="2.3 Counter"></a>2.3 Counter</h3><p>一个计数器工具, 提供快速和方便的计数方法。可以用于计数任何可哈希对象。元素存储为字典的键而它们的计数存储为字典的值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 它和defaultdict(int) 类似，但是它可以支持初始化时传入一个可迭代对象</span><br>cnt = Counter([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])<br><span class="hljs-comment"># 其他用法和 defaultdict(int) 类似</span><br><br><span class="hljs-comment"># 但是Counter有一个好用的方法是most_common(n)方法，返回一个列表，其中包含 n 个最常见的元素及其计数。</span><br>cnt = Counter([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>])<br><span class="hljs-built_in">print</span>(cnt.most_common(<span class="hljs-number">2</span>))  <span class="hljs-comment"># [(3, 5), (1, 4)]</span><br></code></pre></td></tr></table></figure><h2 id="3-heapq-堆队列算法"><a href="#3-heapq-堆队列算法" class="headerlink" title="3. heapq 堆队列算法"></a>3. heapq 堆队列算法</h2><h3 id="3-1-heapify-x"><a href="#3-1-heapify-x" class="headerlink" title="3.1 heapify(x)"></a>3.1 heapify(x)</h3><p>将 list x 转换成堆，原地，线性时间内。</p><h3 id="3-2-heappush-heap-item"><a href="#3-2-heappush-heap-item" class="headerlink" title="3.2 heappush(heap, item)"></a>3.2 heappush(heap, item)</h3><p>将 item 的值加入 heap 中，保持堆的不变性。</p><h3 id="3-3-heappop-heap"><a href="#3-3-heappop-heap" class="headerlink" title="3.3 heappop(heap)"></a>3.3 heappop(heap)</h3><p>弹出并返回 heap 的最小的元素，保持堆的不变性。</p><h3 id="3-4-heapreplace-heap-item"><a href="#3-4-heapreplace-heap-item" class="headerlink" title="3.4 heapreplace(heap, item)"></a>3.4 heapreplace(heap, item)</h3><p>弹出并返回 heap 中最小的一项，同时推入新的 item。 堆的大小不变。</p><h3 id="3-5-heappushpop-heap-item"><a href="#3-5-heappushpop-heap-item" class="headerlink" title="3.5 heappushpop(heap, item)"></a>3.5 heappushpop(heap, item)</h3><p>将 item 放入堆中，然后弹出并返回 heap 的最小元素。</p><h3 id="3-6-nlargest-n-iterable-key-None-和-nsmallest-n-iterable-key-None"><a href="#3-6-nlargest-n-iterable-key-None-和-nsmallest-n-iterable-key-None" class="headerlink" title="3.6 nlargest(n, iterable, key&#x3D;None) 和 nsmallest(n, iterable, key&#x3D;None)"></a>3.6 nlargest(n, iterable, key&#x3D;None) 和 nsmallest(n, iterable, key&#x3D;None)</h3><p>从 iterable 所定义的数据集中返回前 n 个最大&#x2F;最小元素组成的列表。 如果提供了 key 则其应指定一个单参数的函数</p><blockquote><p>注意 [heapify] 初始化生成的堆是最小堆，如果需要最大堆，可以将元素取负值。<br>涉及到堆的弹出操作，需要先判断堆是否为空。否则会抛出异常。<br>堆的组合操作 [heappushpop] 和 [heapreplace] 比两次操作组合起来更快。<br>[nlargest] 和 [nsmallest] 函数适用于 n 比较小的情况，n 比较大时，推荐使用 sorted 函数。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> heapq <span class="hljs-keyword">import</span> *<br>h = [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>]<br>heapify(h)<br><span class="hljs-built_in">print</span>(h)<br><span class="hljs-built_in">print</span>(heappop(h)) <span class="hljs-comment"># 1</span><br>heappush(h, <span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(h) <span class="hljs-comment"># [2, 3, 7, 4, 5]</span><br><span class="hljs-comment"># 先push再pop</span><br><span class="hljs-built_in">print</span>(heappushpop(h, <span class="hljs-number">1</span>)) <span class="hljs-comment"># 1</span><br><span class="hljs-built_in">print</span>(h) <span class="hljs-comment"># [2, 3, 7, 4, 5]</span><br><span class="hljs-comment"># 先pop再push</span><br><span class="hljs-built_in">print</span>(heapreplace(h, <span class="hljs-number">1</span>)) <span class="hljs-comment"># 2</span><br>a = [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">2</span>]<br><span class="hljs-built_in">print</span>(nlargest(<span class="hljs-number">3</span>, a)) <span class="hljs-comment"># [8, 7, 5]</span><br><span class="hljs-built_in">print</span>(nsmallest(<span class="hljs-number">3</span>, a)) <span class="hljs-comment"># [1, 2, 3]</span><br><br></code></pre></td></tr></table></figure><h2 id="4-bisect-二分查找算法"><a href="#4-bisect-二分查找算法" class="headerlink" title="4. bisect 二分查找算法"></a>4. bisect 二分查找算法</h2><h3 id="4-1-bisect-left-a-x-lo-0-hi-len-a"><a href="#4-1-bisect-left-a-x-lo-0-hi-len-a" class="headerlink" title="4.1 bisect_left(a, x, lo&#x3D;0, hi&#x3D;len(a))"></a>4.1 bisect_left(a, x, lo&#x3D;0, hi&#x3D;len(a))</h3><p>找到第一个大于等于 x 的元素的位置，保证 <code>a[:pos] </code>都小于 x。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 返回在 a 中可以插入 x 的位置，使得 a 插入 x 之后仍然有序。</span><br><span class="hljs-comment"># 如果 a 中存在 x，则返回 x 左侧的位置。</span><br><span class="hljs-keyword">from</span> bisect <span class="hljs-keyword">import</span> bisect_left<br>a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>]<br><span class="hljs-built_in">print</span>(bisect_left(a, <span class="hljs-number">2</span>))  <span class="hljs-comment"># 1</span><br><span class="hljs-built_in">print</span>(bisect_left(a, <span class="hljs-number">5</span>))  <span class="hljs-comment"># 6</span><br></code></pre></td></tr></table></figure><h3 id="4-2-bisect-right-a-x-lo-0-hi-len-a"><a href="#4-2-bisect-right-a-x-lo-0-hi-len-a" class="headerlink" title="4.2 bisect_right(a, x, lo&#x3D;0, hi&#x3D;len(a))"></a>4.2 bisect_right(a, x, lo&#x3D;0, hi&#x3D;len(a))</h3><p>找到第一个大于 x 的元素的位置，保证 <code>a[:pos] </code>都小于等于 x。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 返回在 a 中可以插入 x 的位置，使得 a 插入 x 之后仍然有序。</span><br><span class="hljs-comment"># 如果 a 中存在 x，则返回 x 右侧的位置。</span><br><span class="hljs-keyword">from</span> bisect <span class="hljs-keyword">import</span> bisect_right<br>a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>]<br><span class="hljs-built_in">print</span>(bisect_right(a, <span class="hljs-number">2</span>))  <span class="hljs-comment"># 4</span><br><span class="hljs-built_in">print</span>(bisect_right(a, <span class="hljs-number">5</span>))  <span class="hljs-comment"># 6</span><br></code></pre></td></tr></table></figure><h3 id="4-3-insort-left-a-x-lo-0-hi-len-a-和-insort-right-a-x-lo-0-hi-len-a"><a href="#4-3-insort-left-a-x-lo-0-hi-len-a-和-insort-right-a-x-lo-0-hi-len-a" class="headerlink" title="4.3 insort_left(a, x, lo&#x3D;0, hi&#x3D;len(a)) 和 insort_right(a, x, lo&#x3D;0, hi&#x3D;len(a))"></a>4.3 insort_left(a, x, lo&#x3D;0, hi&#x3D;len(a)) 和 insort_right(a, x, lo&#x3D;0, hi&#x3D;len(a))</h3><p>insort_left 将 x 插入到列表 a 中，并保持 a 有序。如果 a 中存在 x，则插入在 x 左侧。<br>insort_right 将 x 插入到列表 a 中，并保持 a 有序。如果 a 中存在 x，则插入在 x 右侧。</p><blockquote><p>注意：虽然 insort 相关函数可以二分查找并直接插入元素到指定位置。但是时间复杂度为 O(n)。个人感觉使用场景不多</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>算法</tag>
      
      <tag>Python</tag>
      
      <tag>库函数</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>149小A的移动点</title>
    <link href="/2024/12/23/149%E5%B0%8FA%E7%9A%84%E7%A7%BB%E5%8A%A8%E7%82%B9/"/>
    <url>/2024/12/23/149%E5%B0%8FA%E7%9A%84%E7%A7%BB%E5%8A%A8%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>小 M 有<code>n</code>个点，每个点的坐标为 ($x_i$, $y_i$)。她可以从一个点出发，沿着坐标轴方向移动，直到到达另一个点。具体来说，可以从 <code>(x1, y1)</code> 直接移动到 <code>(x2, y1)</code> 或者 <code>(x1, y2)</code>，但无法直接移动到 <code>(x2, y2)</code>。为了确保任意两个点之间都可以通过这种路径互相到达，小 M 需要增加最少数量的新点。</p><h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>这个问题可以转化为图论中的连通性问题。将每个点看作图中的一个节点，如果两个点在同一行或同一列，则它们之间有一条边相连。我们需要找到图中的连通分量数目，然后最少需要增加的点数就是连通分量数目减一。</p><p>具体步骤如下：</p><ol><li><strong>并查集（Union-Find）</strong>：使用并查集数据结构来管理点的连接关系，方便快速合并和查找不同连通分量。</li><li><strong>建立行和列的映射</strong>：<ul><li>使用两个字典，<code>row</code> 和 <code>col</code>，分别存储每一行和每一列上的点的索引。</li><li>遍历所有点，将具有相同<code>x</code>坐标的点加入同一行，具有相同<code>y</code>坐标的点加入同一列。</li></ul></li><li><strong>合并连通分量</strong>：<ul><li>对于每一行中的所有点，依次将它们合并到第一点所在的连通分量。</li><li>对于每一列中的所有点，依次将它们合并到第一点所在的连通分量。</li></ul></li><li><strong>计算连通分量</strong>：<ul><li>最终，通过并查集找到所有点的根节点，统计不同的根节点数量，即为连通分量的数目。</li></ul></li><li><strong>得出结果</strong>：<ul><li>最少需要增加的点数为连通分量数目减一。</li></ul></li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, points: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    p = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find</span>(<span class="hljs-params">x</span>):<br>        <span class="hljs-keyword">if</span> x != p[x]:<br>            p[x] = find(p[x])<br>        <span class="hljs-keyword">return</span> p[x]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">union</span>(<span class="hljs-params">x, y</span>):<br>        x, y = find(x), find(y)<br>        <span class="hljs-keyword">if</span> x != y:<br>            p[y] = x<br><br>    row = defaultdict(<span class="hljs-built_in">list</span>)<br>    col = defaultdict(<span class="hljs-built_in">list</span>)<br>    <span class="hljs-keyword">for</span> i, (x, y) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(points):<br>        row[x].append(i)<br>        col[y].append(i)<br><br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> row.values():<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(v)):<br>            union(v[<span class="hljs-number">0</span>], v[i])<br><br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> col.values():<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(v)):<br>            union(v[<span class="hljs-number">0</span>], v[i])<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(find(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n))) - <span class="hljs-number">1</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">2</span>, [[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">2</span>]]) == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">3</span>, [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">1</span>]]) == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, [[<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">4</span>]]) == <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>算法</tag>
      
      <tag>图论</tag>
      
      <tag>并查集</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>27游戏英雄升级潜力评估 一行代码解决</title>
    <link href="/2024/12/22/27%E6%B8%B8%E6%88%8F%E8%8B%B1%E9%9B%84%E5%8D%87%E7%BA%A7%E6%BD%9C%E5%8A%9B%E8%AF%84%E4%BC%B0-%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E8%A7%A3%E5%86%B3/"/>
    <url>/2024/12/22/27%E6%B8%B8%E6%88%8F%E8%8B%B1%E9%9B%84%E5%8D%87%E7%BA%A7%E6%BD%9C%E5%8A%9B%E8%AF%84%E4%BC%B0-%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E8%A7%A3%E5%86%B3/</url>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>小 U 在一款挂机游戏中拥有 n 个英雄。游戏中有一种历练升级机制，每天可以选择两个英雄进行历练，如果两位英雄的等级相同，则他们的等级都不会改变。如果英雄等级不同，那么等级较高的英雄会增加 1 级，而等级较低的英雄则保持不变。</p><p>小 U 希望至少有一个英雄能够达到<code>2000000000000000</code>级，现需要确定有多少英雄有潜力通过历练达到这个目标等级。</p><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>要使至少有一个英雄达到<code>2000000000000000</code>级，必须确保有英雄能够不断提升等级。观察历练规则：</p><ul><li><strong>相同等级的英雄</strong>无法提升。</li><li><strong>不同等级的英雄</strong>中，等级较高的英雄每次历练都会增加 1 级。</li></ul><p>因此，只有不是最低等级的英雄才有可能通过不断历练达到高等级。最低等级的英雄无法提升，因此它们不具备达成目标的潜力。</p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><strong>找出最低等级</strong>：确定所有英雄中当前的最低等级。</li><li><strong>计算最低等级英雄的数量</strong>：这些英雄无法通过历练提升。</li><li><strong>潜力英雄数量</strong>：总英雄数减去最低等级英雄的数量。</li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, u: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">return</span> n - u.count(<span class="hljs-built_in">min</span>(u))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">5</span>, u = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">4</span>, u = [<span class="hljs-number">100000</span>, <span class="hljs-number">100000</span>, <span class="hljs-number">100000</span>, <span class="hljs-number">100000</span>]) == <span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(solution(n = <span class="hljs-number">6</span>, u = [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>]) == <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>算法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>19 字典序最小的 01 字符串 简单 O(n)做法</title>
    <link href="/2024/12/22/19-%E5%AD%97%E5%85%B8%E5%BA%8F%E6%9C%80%E5%B0%8F%E7%9A%84-01-%E5%AD%97%E7%AC%A6%E4%B8%B2-%E7%AE%80%E5%8D%95-O-n-%E5%81%9A%E6%B3%95/"/>
    <url>/2024/12/22/19-%E5%AD%97%E5%85%B8%E5%BA%8F%E6%9C%80%E5%B0%8F%E7%9A%84-01-%E5%AD%97%E7%AC%A6%E4%B8%B2-%E7%AE%80%E5%8D%95-O-n-%E5%81%9A%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="19-字典序最小的-01-字符串-简单-O-n-做法"><a href="#19-字典序最小的-01-字符串-简单-O-n-做法" class="headerlink" title="19 字典序最小的 01 字符串 简单 O(n)做法"></a>19 字典序最小的 01 字符串 简单 O(n)做法</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>小 U 拥有一个由<code>0</code>和<code>1</code>组成的字符串，她可以进行最多<code>k</code>次操作。每次操作可以交换相邻的两个字符。目标是通过这些操作，使得最终得到的字符串字典序最小。</p><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>为了获得字典序最小的字符串，我们的目标是尽可能将<code>&#39;0&#39;</code>移向字符串的左侧而把<code>&#39;1&#39;</code>移到字符串的右侧，并且根据字典序的规则，我们应该尽量把<code>&#39;1&#39;</code>和最右边的<code>&#39;0&#39;</code>交换</p><p>具体步骤如下：</p><ol><li><strong>遍历字符串</strong>：从左到右遍历字符串中的每一个字符。</li><li><strong>遇到<code>&#39;0&#39;</code>时尝试和左边的最远的<code>&#39;1&#39;</code>交换</strong>：<ul><li>对于当前位置的<code>&#39;0&#39;</code>，尝试将其向左边移动尽可能多的位置，但移动的步数不能超过剩余的操作次数<code>ops</code>。</li><li>用指针<code>j</code>记录最左边的<code>&#39;1&#39;</code>的位置，并且<code>j</code>具有单调性，因为假设当前的<code>i - j &gt; ops</code>，这意味着本次不能交换，那么当<code>i</code>继续向右移动时,<code>i - j</code>的值只会越来越大，所以<code>j</code>也必须向右继续移动才有可能进行交换。这也意味这<code>j</code>只会从<code>0~n</code>遍历一次，复杂度为$O(n)$</li><li>更新字符串，同时减少相应的操作次数<code>k</code>。</li></ul></li></ol><p>这种方法确保了在每一步操作中，都将当前的<code>&#39;0&#39;</code>尽可能地向左移动，从而整体上达到了字典序最小的目标。</p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span>, ops: <span class="hljs-built_in">int</span>, s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    s = <span class="hljs-built_in">list</span>(s)<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">if</span> s[i] == <span class="hljs-string">&#x27;0&#x27;</span>:<br>            <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(j, i):<br>                <span class="hljs-keyword">if</span> s[k] == <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">and</span> (i - k) &lt;= ops:<br>                    s[k] = <span class="hljs-string">&#x27;0&#x27;</span><br>                    s[i] = <span class="hljs-string">&#x27;1&#x27;</span><br>                    ops -= (i - k)<br>                    j = k + <span class="hljs-number">1</span>  <span class="hljs-comment"># 更新j的位置</span><br>                    <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(s)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&quot;01010&quot;</span>) == <span class="hljs-string">&#x27;00101&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">7</span>, <span class="hljs-number">3</span>, <span class="hljs-string">&quot;1101001&quot;</span>) == <span class="hljs-string">&#x27;0110101&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;1001&quot;</span>) == <span class="hljs-string">&#x27;0101&#x27;</span>)<br></code></pre></td></tr></table></figure><p>复杂度分析<br>时间复杂度：$O(n)$</p><p>空间复杂度：$O(n)$<br>用于存储可变的字符串列表。</p>]]></content>
    
    
    
    <tags>
      
      <tag>算法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>146字符串首尾相同子序列计数</title>
    <link href="/2024/12/19/146%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%A6%96%E5%B0%BE%E7%9B%B8%E5%90%8C%E5%AD%90%E5%BA%8F%E5%88%97%E8%AE%A1%E6%95%B0/"/>
    <url>/2024/12/19/146%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%A6%96%E5%B0%BE%E7%9B%B8%E5%90%8C%E5%AD%90%E5%BA%8F%E5%88%97%E8%AE%A1%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><p>小 M 拿到了一个仅由小写字母组成的字符串，她想知道在这个字符串中，有多少个子序列的首尾字符相同。子序列的定义是：从原字符串中按原顺序取出若干字符（可以不连续）组成的新字符串。</p><p>例如，对于字符串 “arcaea”，其子序列包括 “aca”, “ara”, “aaa” 等，这些子序列的首尾字符都是相同的。</p><p>你需要计算满足这一条件的子序列数量，并输出对 998244353 取模的结果。</p><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p><strong>统计字符出现位置</strong>：<br>使用 <code>defaultdict</code> 来存储每个字符在字符串中出现的所有位置。</p></li><li><p><strong>计算子序列数量</strong>：<br>对于每个字符，考虑其所有可能的首尾位置组合 <code>(i, j)</code>，其中 $i &lt; j$。对于每一对 <code>(i, j)</code>，位于 $i$ 和 $j$ 之间的字符可以选择或不选择，因此有 $2^{j - i - 1}$ 种可能的子序列。</p></li><li><p><strong>累加结果</strong>：<br>将所有符合条件的子序列数量累加，同时加上单个字符的情况（每个字符本身也是一个有效的子序列）。</p></li><li><p><strong>取模处理</strong>：<br>最终结果对 <code>998244353</code> 取模。</p></li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    d = defaultdict(<span class="hljs-built_in">list</span>)<br>    <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s):<br>        d[c].append(i)<br>    res = <span class="hljs-number">0</span><br>    mod = <span class="hljs-number">998244353</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> d:<br>        v = d[k]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(v)):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(v)):<br>                res += <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, v[j] - v[i] - <span class="hljs-number">1</span>, mod)<br>    <span class="hljs-keyword">return</span> (res + <span class="hljs-built_in">len</span>(s)) % mod<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;arcaea&quot;</span>) == <span class="hljs-number">28</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;abcabc&quot;</span>) == <span class="hljs-number">18</span>)<br>    <span class="hljs-built_in">print</span>(solution(<span class="hljs-string">&quot;aaaaa&quot;</span>) == <span class="hljs-number">31</span>)<br></code></pre></td></tr></table></figure><h2 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h2><ul><li><strong>时间复杂度</strong>：<code>O(N^2)</code>，其中 <code>N</code> 是字符串的长度。主要消耗在于双重循环遍历每个字符的所有位置组合。</li><li><strong>空间复杂度</strong>：<code>O(N)</code>，用于存储每个字符出现的位置。</li></ul><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>模数应为 <code>998244353</code>，请确保代码中 <code>mod</code> 的值正确。</li><li>由于可能存在大量的子序列，务必在计算中进行取模操作以防止整数溢出。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>算法</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
